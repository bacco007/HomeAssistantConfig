"""Suriyakati Calendar (Thai Buddhist Calendar) implementation - Version 2.5."""
from __future__ import annotations

from datetime import datetime
import logging
from typing import Dict, Any

from homeassistant.core import HomeAssistant
from ..sensor import AlternativeTimeSensorBase

_LOGGER = logging.getLogger(__name__)

# ============================================
# CALENDAR METADATA
# ============================================

# Update interval in seconds (3600 seconds = 1 hour)
UPDATE_INTERVAL = 3600

# Complete calendar information for auto-discovery
CALENDAR_INFO = {
    "id": "suriyakati_thai",
    "version": "2.5.0",
    "icon": "mdi:buddhism",
    "category": "cultural",
    "accuracy": "official",
    "update_interval": UPDATE_INTERVAL,
    
    # Multi-language names (English primary)
    "name": {
        "en": "Thai Buddhist Calendar",
        "de": "Thail√§ndischer Buddhistischer Kalender",
        "es": "Calendario Budista Tailand√©s",
        "fr": "Calendrier Bouddhiste Tha√Ølandais",
        "it": "Calendario Buddista Thailandese",
        "nl": "Thaise Boeddhistische Kalender",
        "pt": "Calend√°rio Budista Tailand√™s",
        "ru": "–¢–∞–π—Å–∫–∏–π –±—É–¥–¥–∏–π—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å",
        "ja": "„Çø„Ç§‰ªèÊïôÊö¶",
        "zh": "Ê≥∞ÂõΩ‰ΩõÂéÜ",
        "ko": "ÌÉúÍµ≠ Î∂àÍµê Îã¨Î†•",
        "th": "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏Ñ‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢"
    },
    
    # Short descriptions for UI (English primary)
    "description": {
        "en": "Thai solar calendar with Buddhist Era year (BE = CE + 543)",
        "de": "Thail√§ndischer Sonnenkalender mit buddhistischer √Ñra (BE = CE + 543)",
        "es": "Calendario solar tailand√©s con Era Budista (EB = EC + 543)",
        "fr": "Calendrier solaire tha√Ølandais avec √àre Bouddhiste (EB = EC + 543)",
        "it": "Calendario solare thailandese con Era Buddista (EB = EC + 543)",
        "nl": "Thaise zonnekalender met Boeddhistische Era (BE = CE + 543)",
        "pt": "Calend√°rio solar tailand√™s com Era Budista (EB = EC + 543)",
        "ru": "–¢–∞–π—Å–∫–∏–π —Å–æ–ª–Ω–µ—á–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –±—É–¥–¥–∏–π—Å–∫–æ–π —ç—Ä–æ–π (–ë–≠ = –ù–≠ + 543)",
        "ja": "‰ªèÊö¶Âπ¥„ÅÆ„Çø„Ç§Â§™ÈôΩÊö¶ÔºàBE = CE + 543Ôºâ",
        "zh": "Ê≥∞ÂõΩÂ§™Èò≥ÂéÜÔºå‰ΩõÂéÜÁ∫™Âπ¥ÔºàBE = CE + 543Ôºâ",
        "ko": "Î∂àÍ∏∞ Ïó∞ÎèÑÏùò ÌÉúÍµ≠ ÌÉúÏñëÎ†• (BE = CE + 543)",
        "th": "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏Ñ‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢ ‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä (‡∏û.‡∏®. = ‡∏Ñ.‡∏®. + 543)"
    },
    
    # Detailed information for documentation
    "detailed_info": {
        "en": {
            "overview": "The official calendar of Thailand based on the Buddhist Era",
            "structure": "Solar calendar identical to Gregorian but with Buddhist Era years",
            "year": "Buddhist Era (BE) = Common Era (CE) + 543",
            "new_year": "Official New Year on January 1, traditional Songkran April 13-15",
            "months": "12 months with Thai names derived from Sanskrit",
            "weeks": "7-day weeks with planetary associations",
            "zodiac": "12-year animal cycle similar to Chinese zodiac",
            "colors": "Each day associated with lucky colors",
            "holy_days": "Buddhist holy days follow lunar calendar",
            "usage": "Official use in Thailand for all government and business"
        },
        "de": {
            "overview": "Der offizielle Kalender Thailands basierend auf der buddhistischen √Ñra",
            "structure": "Sonnenkalender identisch mit Gregorianisch aber mit buddhistischen √Ñra-Jahren",
            "year": "Buddhistische √Ñra (BE) = Christliche √Ñra (CE) + 543",
            "new_year": "Offizielles Neujahr am 1. Januar, traditionelles Songkran 13.-15. April",
            "months": "12 Monate mit thail√§ndischen Namen aus dem Sanskrit",
            "weeks": "7-Tage-Wochen mit Planetenverbindungen",
            "zodiac": "12-Jahres-Tierzyklus √§hnlich dem chinesischen Tierkreis",
            "colors": "Jeder Tag mit Gl√ºcksfarben verbunden",
            "holy_days": "Buddhistische Feiertage folgen dem Mondkalender",
            "usage": "Offizielle Verwendung in Thailand f√ºr Regierung und Wirtschaft"
        },
        "th": {
            "overview": "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏ï‡∏≤‡∏°‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä",
            "structure": "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏Ñ‡∏ï‡∏¥‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡∏£‡∏Å‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä",
            "year": "‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä (‡∏û.‡∏®.) = ‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä (‡∏Ñ.‡∏®.) + 543",
            "new_year": "‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ 1 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°, ‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå 13-15 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
            "months": "12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏±‡∏ô‡∏™‡∏Å‡∏§‡∏ï",
            "weeks": "‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞ 7 ‡∏ß‡∏±‡∏ô ‡∏ï‡∏≤‡∏°‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå",
            "zodiac": "12 ‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£ ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏õ‡∏µ‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏à‡∏µ‡∏ô",
            "colors": "‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏°‡∏µ‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
            "holy_days": "‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏Ñ‡∏ï‡∏¥",
            "usage": "‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢"
        }
    },
    
    # Thai-specific data
    "thai_data": {
        # Thai months (solar calendar)
        "months": [
            {"name": "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "roman": "Makarakhom", "english": "January", "abbr": "‡∏°.‡∏Ñ."},
            {"name": "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "roman": "Kumphaphan", "english": "February", "abbr": "‡∏Å.‡∏û."},
            {"name": "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "roman": "Minakhom", "english": "March", "abbr": "‡∏°‡∏µ.‡∏Ñ."},
            {"name": "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "roman": "Mesayon", "english": "April", "abbr": "‡πÄ‡∏°.‡∏¢."},
            {"name": "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "roman": "Phruetsaphakhom", "english": "May", "abbr": "‡∏û.‡∏Ñ."},
            {"name": "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "roman": "Mithunayon", "english": "June", "abbr": "‡∏°‡∏¥.‡∏¢."},
            {"name": "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "roman": "Karakadakhom", "english": "July", "abbr": "‡∏Å.‡∏Ñ."},
            {"name": "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "roman": "Singhakhom", "english": "August", "abbr": "‡∏™.‡∏Ñ."},
            {"name": "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "roman": "Kanyayon", "english": "September", "abbr": "‡∏Å.‡∏¢."},
            {"name": "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "roman": "Tulakhom", "english": "October", "abbr": "‡∏ï.‡∏Ñ."},
            {"name": "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "roman": "Phruetsachikayon", "english": "November", "abbr": "‡∏û.‡∏¢."},
            {"name": "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°", "roman": "Thanwakhom", "english": "December", "abbr": "‡∏ò.‡∏Ñ."}
        ],
        
        # Thai weekdays
        "weekdays": [
            {"name": "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "roman": "Wan Athit", "english": "Sunday", "planet": "Sun", "color": "Red"},
            {"name": "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "roman": "Wan Chan", "english": "Monday", "planet": "Moon", "color": "Yellow"},
            {"name": "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "roman": "Wan Angkhan", "english": "Tuesday", "planet": "Mars", "color": "Pink"},
            {"name": "‡∏û‡∏∏‡∏ò", "roman": "Wan Phut", "english": "Wednesday", "planet": "Mercury", "color": "Green"},
            {"name": "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "roman": "Wan Phruehatsabodi", "english": "Thursday", "planet": "Jupiter", "color": "Orange"},
            {"name": "‡∏®‡∏∏‡∏Å‡∏£‡πå", "roman": "Wan Suk", "english": "Friday", "planet": "Venus", "color": "Blue"},
            {"name": "‡πÄ‡∏™‡∏≤‡∏£‡πå", "roman": "Wan Sao", "english": "Saturday", "planet": "Saturn", "color": "Purple"}
        ],
        
        # Thai zodiac animals (similar to Chinese)
        "zodiac": [
            {"thai": "‡∏ä‡∏ß‡∏î", "roman": "Chuat", "english": "Rat", "emoji": "üêÄ"},
            {"thai": "‡∏â‡∏•‡∏π", "roman": "Chalu", "english": "Ox", "emoji": "üêÇ"},
            {"thai": "‡∏Ç‡∏≤‡∏•", "roman": "Khan", "english": "Tiger", "emoji": "üêÖ"},
            {"thai": "‡πÄ‡∏ñ‡∏≤‡∏∞", "roman": "Tho", "english": "Rabbit", "emoji": "üê∞"},
            {"thai": "‡∏°‡∏∞‡πÇ‡∏£‡∏á", "roman": "Marong", "english": "Dragon", "emoji": "üêâ"},
            {"thai": "‡∏°‡∏∞‡πÄ‡∏™‡πá‡∏á", "roman": "Maseng", "english": "Snake", "emoji": "üêç"},
            {"thai": "‡∏°‡∏∞‡πÄ‡∏°‡∏µ‡∏¢", "roman": "Mamia", "english": "Horse", "emoji": "üê¥"},
            {"thai": "‡∏°‡∏∞‡πÅ‡∏°", "roman": "Mamae", "english": "Goat", "emoji": "üêê"},
            {"thai": "‡∏ß‡∏≠‡∏Å", "roman": "Wok", "english": "Monkey", "emoji": "üêµ"},
            {"thai": "‡∏£‡∏∞‡∏Å‡∏≤", "roman": "Raka", "english": "Rooster", "emoji": "üêì"},
            {"thai": "‡∏à‡∏≠", "roman": "Cho", "english": "Dog", "emoji": "üêï"},
            {"thai": "‡∏Å‡∏∏‡∏ô", "roman": "Kun", "english": "Pig", "emoji": "üêñ"}
        ],
        
        # Thai numerals
        "thai_digits": ["‡πê", "‡πë", "‡πí", "‡πì", "‡πî", "‡πï", "‡πñ", "‡πó", "‡πò", "‡πô"],
        
        # Major Thai holidays
        "holidays": {
            (1, 1): {"thai": "‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà", "english": "New Year's Day"},
            (2, 14): {"thai": "‡∏ß‡∏±‡∏ô‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå", "english": "Valentine's Day"},
            (4, 6): {"thai": "‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ", "english": "Chakri Day"},
            (4, 13): {"thai": "‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå", "english": "Songkran Festival"},
            (5, 1): {"thai": "‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "english": "Labour Day"},
            (5, 4): {"thai": "‡∏ß‡∏±‡∏ô‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•", "english": "Coronation Day"},
            (7, 28): {"thai": "‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤", "english": "King's Birthday"},
            (8, 12): {"thai": "‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà", "english": "Mother's Day"},
            (10, 13): {"thai": "‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï", "english": "Memorial Day"},
            (10, 23): {"thai": "‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä", "english": "Chulalongkorn Day"},
            (12, 5): {"thai": "‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠", "english": "Father's Day"},
            (12, 10): {"thai": "‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç", "english": "Constitution Day"},
            (12, 31): {"thai": "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ", "english": "New Year's Eve"}
        }
    },
    
    # Additional metadata
    "reference_url": "https://en.wikipedia.org/wiki/Thai_solar_calendar",
    "documentation_url": "https://www.thaicalendar.com",
    "origin": "Thailand",
    "created_by": "King Chulalongkorn (Rama V)",
    "official_since": "1888 CE (2431 BE)",
    
    # Example format
    "example": "25 December 2568 BE | ‡πí‡πï ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° ‡πí‡πï‡πñ‡πò",
    "example_meaning": "25th December 2568 Buddhist Era (2025 CE)",
    
    # Related calendars
    "related": ["gregorian", "buddhist", "lunar"],
    
    # Tags for searching and filtering
    "tags": [
        "cultural", "buddhist", "thai", "thailand", "solar",
        "official", "asian", "southeast_asia", "be", "songkran"
    ],
    
    # Special features
    "features": {
        "buddhist_era": True,
        "thai_numerals": True,
        "zodiac_animals": True,
        "day_colors": True,
        "lunar_holy_days": True,
        "precision": "day"
    },
    
    # Configuration options for this calendar
    "config_options": {
        "display_language": {
            "type": "select",
            "default": "english",
            "options": ["english", "thai", "romanized", "combined"],
            "label": {
                "en": "Display Language",
                "de": "Anzeigesprache",
                "es": "Idioma de visualizaci√≥n",
                "fr": "Langue d'affichage",
                "it": "Lingua di visualizzazione",
                "nl": "Weergavetaal",
                "pt": "Idioma de exibi√ß√£o",
                "ru": "–Ø–∑—ã–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",
                "ja": "Ë°®Á§∫Ë®ÄË™û",
                "zh": "ÊòæÁ§∫ËØ≠Ë®Ä",
                "ko": "ÌëúÏãú Ïñ∏Ïñ¥",
                "th": "‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á"
            },
            "description": {
                "en": "Choose how to display the date (English, Thai script, romanized Thai, or combined)",
                "de": "W√§hlen Sie, wie das Datum angezeigt werden soll (Englisch, Thai-Schrift, romanisiertes Thai oder kombiniert)",
                "th": "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©, ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏ó‡∏¢, ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÇ‡∏£‡∏°‡∏±‡∏ô, ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏™‡∏°)"
            }
        },
        "use_thai_numerals": {
            "type": "boolean",
            "default": True,
            "label": {
                "en": "Use Thai Numerals",
                "de": "Thai-Ziffern verwenden",
                "es": "Usar n√∫meros tailandeses",
                "fr": "Utiliser les chiffres tha√Øs",
                "it": "Usa numeri thailandesi",
                "nl": "Gebruik Thaise cijfers",
                "pt": "Usar n√∫meros tailandeses",
                "ru": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–π—Å–∫–∏–µ —Ü–∏—Ñ—Ä—ã",
                "ja": "„Çø„Ç§Êï∞Â≠ó„Çí‰ΩøÁî®",
                "zh": "‰ΩøÁî®Ê≥∞ÊñáÊï∞Â≠ó",
                "ko": "ÌÉúÍµ≠ Ïà´Ïûê ÏÇ¨Ïö©",
                "th": "‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏ó‡∏¢"
            },
            "description": {
                "en": "Display numbers using Thai numerals (‡πê-‡πô)",
                "de": "Zahlen mit thail√§ndischen Ziffern anzeigen (‡πê-‡πô)",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÑ‡∏ó‡∏¢ (‡πê-‡πô)"
            }
        },
        "show_zodiac": {
            "type": "boolean",
            "default": True,
            "label": {
                "en": "Show Zodiac Animal",
                "de": "Tierkreiszeichen anzeigen",
                "es": "Mostrar animal del zodiaco",
                "fr": "Afficher l'animal du zodiaque",
                "it": "Mostra animale zodiacale",
                "nl": "Toon dierenriem dier",
                "pt": "Mostrar animal do zod√≠aco",
                "ru": "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ –∑–æ–¥–∏–∞–∫–∞",
                "ja": "Âπ≤ÊîØ„ÇíË°®Á§∫",
                "zh": "ÊòæÁ§∫ÁîüËÇñ",
                "ko": "Îù† ÎèôÎ¨º ÌëúÏãú",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏µ‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£"
            },
            "description": {
                "en": "Display the Thai zodiac animal for the current year",
                "de": "Das thail√§ndische Tierkreiszeichen f√ºr das aktuelle Jahr anzeigen",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏µ‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
            }
        },
        "show_day_color": {
            "type": "boolean",
            "default": True,
            "label": {
                "en": "Show Day Color",
                "de": "Tagesfarbe anzeigen",
                "es": "Mostrar color del d√≠a",
                "fr": "Afficher la couleur du jour",
                "it": "Mostra colore del giorno",
                "nl": "Toon dagkleur",
                "pt": "Mostrar cor do dia",
                "ru": "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–≤–µ—Ç –¥–Ω—è",
                "ja": "ÊõúÊó•„ÅÆËâ≤„ÇíË°®Á§∫",
                "zh": "ÊòæÁ§∫Êó•ÊúüÈ¢úËâ≤",
                "ko": "ÏöîÏùº ÏÉâÏÉÅ ÌëúÏãú",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô"
            },
            "description": {
                "en": "Display the traditional lucky color for each day of the week",
                "de": "Die traditionelle Gl√ºcksfarbe f√ºr jeden Wochentag anzeigen",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏ì‡∏µ"
            }
        },
        "show_buddhist_days": {
            "type": "boolean",
            "default": False,
            "label": {
                "en": "Show Buddhist Holy Days",
                "de": "Buddhistische Feiertage anzeigen",
                "es": "Mostrar d√≠as sagrados budistas",
                "fr": "Afficher les jours saints bouddhistes",
                "it": "Mostra giorni sacri buddisti",
                "nl": "Toon Boeddhistische heilige dagen",
                "pt": "Mostrar dias sagrados budistas",
                "ru": "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –±—É–¥–¥–∏–π—Å–∫–∏–µ —Å–≤—è—Ç—ã–µ –¥–Ω–∏",
                "ja": "‰ªèÊïô„ÅÆËÅñÊó•„ÇíË°®Á§∫",
                "zh": "ÊòæÁ§∫‰ΩõÊïôÂú£Êó•",
                "ko": "Î∂àÍµê ÏÑ±Ïùº ÌëúÏãú",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞"
            },
            "description": {
                "en": "Display Buddhist Uposatha days (lunar-based holy days)",
                "de": "Buddhistische Uposatha-Tage anzeigen (mondbasierte heilige Tage)",
                "th": "‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞ (‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏ß‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏Ñ‡∏ï‡∏¥)"
            }
        },
        "format": {
            "type": "select",
            "default": "full",
            "options": ["full", "medium", "short", "numeric"],
            "label": {
                "en": "Date Format",
                "de": "Datumsformat",
                "es": "Formato de fecha",
                "fr": "Format de date",
                "it": "Formato data",
                "nl": "Datumformaat",
                "pt": "Formato de data",
                "ru": "–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã",
                "ja": "Êó•‰ªòÂΩ¢Âºè",
                "zh": "Êó•ÊúüÊ†ºÂºè",
                "ko": "ÎÇ†Ïßú ÌòïÏãù",
                "th": "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"
            },
            "description": {
                "en": "Choose how detailed the date display should be",
                "de": "W√§hlen Sie, wie detailliert die Datumsanzeige sein soll",
                "th": "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"
            }
        }
    }
}


class SuriyakatiCalendarSensor(AlternativeTimeSensorBase):
    """Sensor for displaying Thai Buddhist Calendar (Suriyakati)."""
    
    # Class-level update interval
    UPDATE_INTERVAL = UPDATE_INTERVAL
    
    def __init__(self, base_name: str, hass: HomeAssistant) -> None:
        """Initialize the Suriyakati calendar sensor."""
        super().__init__(base_name, hass)
        
        # Get translated name from metadata
        calendar_name = self._translate('name', 'Thai Buddhist Calendar')
        
        # Set sensor attributes
        self._attr_name = f"{base_name} {calendar_name}"
        self._attr_unique_id = f"{base_name}_suriyakati_thai"
        self._attr_icon = CALENDAR_INFO.get("icon", "mdi:buddhism")
        
        # Default configuration options
        self._display_language = "english"
        self._use_thai_numerals = True
        self._show_zodiac = True
        self._show_day_color = True
        self._show_buddhist_days = False
        self._format = "full"
        
        # Thai data
        self._thai_data = CALENDAR_INFO["thai_data"]
        
        # Track if options have been loaded
        self._options_loaded = False
        
        _LOGGER.debug(f"Initialized Thai Buddhist Calendar sensor: {self._attr_name}")
    
    def _load_options(self) -> None:
        """Load configuration options from config entry."""
        if self._options_loaded:
            return
            
        try:
            options = self.get_plugin_options()
            if options:
                # Update configuration from plugin options
                self._display_language = options.get("display_language", self._display_language)
                self._use_thai_numerals = options.get("use_thai_numerals", self._use_thai_numerals)
                self._show_zodiac = options.get("show_zodiac", self._show_zodiac)
                self._show_day_color = options.get("show_day_color", self._show_day_color)
                self._show_buddhist_days = options.get("show_buddhist_days", self._show_buddhist_days)
                self._format = options.get("format", self._format)
                
                _LOGGER.debug(f"Thai calendar loaded options: language={self._display_language}, "
                            f"numerals={self._use_thai_numerals}, zodiac={self._show_zodiac}, "
                            f"color={self._show_day_color}, buddhist={self._show_buddhist_days}, "
                            f"format={self._format}")
            else:
                _LOGGER.debug("Thai calendar using default options - no custom options found")
                
            self._options_loaded = True
        except Exception as e:
            _LOGGER.debug(f"Thai calendar could not load options yet: {e}")
    
    async def async_added_to_hass(self) -> None:
        """When entity is added to hass."""
        await super().async_added_to_hass()
        
        # Try to load options now that IDs should be set
        self._load_options()
    
    @property
    def state(self):
        """Return the state of the sensor."""
        return self._state
    
    @property
    def extra_state_attributes(self) -> Dict[str, Any]:
        """Return the state attributes."""
        attrs = super().extra_state_attributes
        
        # Add Thai-specific attributes
        if hasattr(self, '_thai_date'):
            attrs.update(self._thai_date)
            
            # Add description in user's language
            attrs["description"] = self._translate('description')
            
            # Add reference
            attrs["reference"] = CALENDAR_INFO.get('reference_url', '')
            
            # Add configuration status
            attrs["config"] = {
                "display_language": self._display_language,
                "use_thai_numerals": self._use_thai_numerals,
                "show_zodiac": self._show_zodiac,
                "show_day_color": self._show_day_color,
                "show_buddhist_days": self._show_buddhist_days,
                "format": self._format
            }
        
        return attrs
    
    def _to_thai_number(self, n: int) -> str:
        """Convert number to Thai numerals."""
        if not self._use_thai_numerals:
            return str(n)
        
        thai_digits = self._thai_data["thai_digits"]
        return ''.join(thai_digits[int(d)] for d in str(n))
    
    def _get_buddhist_day(self, day: int, month: int) -> str:
        """Calculate Buddhist holy day (simplified)."""
        # Simplified calculation - actual dates follow lunar calendar
        # This approximates uposatha days (Buddhist sabbath)
        lunar_approximation = (day + month * 2) % 30
        
        if lunar_approximation == 8:
            return "üåì Uposatha (First Quarter)"
        elif lunar_approximation == 15:
            return "üåï Uposatha (Full Moon)"
        elif lunar_approximation == 23:
            return "üåó Uposatha (Last Quarter)"
        elif lunar_approximation in [29, 30, 0, 1]:
            return "üåë Uposatha (New Moon)"
        
        return ""
    
    def _calculate_thai_date(self, earth_date: datetime) -> Dict[str, Any]:
        """Calculate Thai Buddhist Calendar date from standard date."""
        
        # Load options if not loaded yet
        self._load_options()
        
        # Calculate Buddhist Era year
        buddhist_year = earth_date.year + 543
        
        # Get month data
        month_data = self._thai_data["months"][earth_date.month - 1]
        
        # Get weekday (Thai week starts on Sunday)
        weekday_index = (earth_date.weekday() + 1) % 7
        weekday_data = self._thai_data["weekdays"][weekday_index]
        
        # Calculate zodiac animal
        # Thai zodiac aligned so 2024 CE (2567 BE) = Year of the Dragon (index 4)
        zodiac_index = (buddhist_year - 3) % 12
        zodiac_data = self._thai_data["zodiac"][zodiac_index]
        
        # Check for holidays
        holiday_data = self._thai_data["holidays"].get((earth_date.month, earth_date.day))
        
        # Get Buddhist holy day if enabled
        buddhist_day = self._get_buddhist_day(earth_date.day, earth_date.month) if self._show_buddhist_days else ""
        
        # Format date based on display language and format
        if self._format == "numeric":
            # Numeric format
            if self._use_thai_numerals:
                formatted = f"{self._to_thai_number(earth_date.day)}/{self._to_thai_number(earth_date.month)}/{self._to_thai_number(buddhist_year)}"
            else:
                formatted = f"{earth_date.day}/{earth_date.month}/{buddhist_year}"
        elif self._format == "short":
            # Short format
            if self._display_language == "thai":
                formatted = f"{self._to_thai_number(earth_date.day)} {month_data['abbr']} {self._to_thai_number(buddhist_year)}"
            else:
                formatted = f"{earth_date.day} {month_data['english'][:3]} {buddhist_year} BE"
        elif self._format == "medium":
            # Medium format
            if self._display_language == "thai":
                formatted = f"{self._to_thai_number(earth_date.day)} {month_data['name']} {self._to_thai_number(buddhist_year)}"
            elif self._display_language == "romanized":
                formatted = f"{earth_date.day} {month_data['roman']} {buddhist_year} BE"
            else:
                formatted = f"{earth_date.day} {month_data['english']} {buddhist_year} BE"
        else:  # full
            # Full format
            if self._display_language == "thai":
                formatted = f"{weekday_data['name']} {self._to_thai_number(earth_date.day)} {month_data['name']} ‡∏û.‡∏®. {self._to_thai_number(buddhist_year)}"
            elif self._display_language == "romanized":
                formatted = f"{weekday_data['roman']}, {earth_date.day} {month_data['roman']} {buddhist_year} BE"
            elif self._display_language == "combined":
                formatted = f"{earth_date.day} {month_data['english']} {buddhist_year} BE | {self._to_thai_number(earth_date.day)} {month_data['name']} {self._to_thai_number(buddhist_year)}"
            else:  # english
                formatted = f"{weekday_data['english']}, {earth_date.day} {month_data['english']} {buddhist_year} BE"
        
        result = {
            "buddhist_year": buddhist_year,
            "gregorian_year": earth_date.year,
            "day": earth_date.day,
            "month": earth_date.month,
            "month_english": month_data["english"],
            "month_thai": month_data["name"],
            "month_romanized": month_data["roman"],
            "weekday_english": weekday_data["english"],
            "weekday_thai": weekday_data["name"],
            "weekday_romanized": weekday_data["roman"],
            "formatted": formatted,
            "gregorian_date": earth_date.strftime("%Y-%m-%d")
        }
        
        # Add Thai numerals if enabled
        if self._use_thai_numerals:
            result["day_thai"] = self._to_thai_number(earth_date.day)
            result["year_thai"] = self._to_thai_number(buddhist_year)
        
        # Add zodiac if enabled
        if self._show_zodiac:
            result["zodiac_thai"] = zodiac_data["thai"]
            result["zodiac_english"] = zodiac_data["english"]
            result["zodiac_emoji"] = zodiac_data["emoji"]
        
        # Add day color if enabled
        if self._show_day_color:
            result["day_color"] = weekday_data["color"]
            result["day_planet"] = weekday_data["planet"]
        
        # Add Buddhist holy day if applicable
        if buddhist_day:
            result["buddhist_day"] = buddhist_day
        
        # Add holiday if applicable
        if holiday_data:
            result["holiday_thai"] = holiday_data["thai"]
            result["holiday_english"] = holiday_data["english"]
        
        return result
    
    def update(self) -> None:
        """Update the sensor."""
        now = datetime.now()
        self._thai_date = self._calculate_thai_date(now)
        
        # Set state to formatted date
        self._state = self._thai_date["formatted"]
        
        _LOGGER.debug(f"Updated Thai Buddhist Calendar to {self._state}")