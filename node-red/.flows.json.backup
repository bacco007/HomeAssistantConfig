[{"id":"d5885627.8d1ba8","type":"tab","label":"Weather","disabled":false,"info":""},{"id":"9c799abb.c66da8","type":"tab","label":"Fuel","disabled":false,"info":""},{"id":"fa272026.a5eb2","type":"tab","label":"DB","disabled":false,"info":""},{"id":"babf8c24.5d5728","type":"tab","label":"RainIntensity","disabled":false,"info":""},{"id":"d7532c8a.7df9e","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"2c268447.85c5c4","type":"tab","label":"FlightTracker","disabled":false,"info":""},{"id":"657d1dd1.9b4644","type":"tab","label":"Spotify","disabled":false,"info":""},{"id":"8ceb400f.e4da4","type":"tab","label":"Homer Dashboard","disabled":true,"info":""},{"id":"8f4f6b1258852080","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"873eb379.8e35a","type":"server","name":"Home Assistant","version":2,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30},{"id":"ae13dda.6b5d8a","type":"influxdb","hostname":"192.168.1.62","port":"8086","protocol":"http","database":"homeassistant","name":"HA","usetls":false,"tls":"","influxdbVersion":"1.x"},{"id":"c1d28f3a.999178","type":"influxdb","hostname":"192.168.1.62","port":"8086","protocol":"http","database":"varken","name":"Varken","usetls":false,"tls":"","influxdbVersion":"1.x"},{"id":"c2d1b0f2.af1008","type":"mqtt-broker","name":"MQTT Server","broker":"192.168.1.90","port":"1883","clientid":"","usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"daac038a.ad7cc8","type":"modbus-client","name":"SunGrow","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":true,"queueLogEnabled":false,"tcpHost":"192.168.1.85","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectOnTimeout":true,"reconnectTimeout":2000,"parallelUnitIdsAllowed":true},{"id":"eff459ea.caa6f8","type":"mqtt-broker","name":"thomasbaxter-info","broker":"206.189.91.11","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"32ee669f.a3e77a","type":"MySQLdatabase","name":"Clarkson","host":"127.0.0.1","port":"3306","db":"clarkson","tz":"Australia/Sydney","charset":"UTF8"},{"id":"d92d10b2.f8b15","type":"modbus-client","name":"SunGrow 2","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":true,"queueLogEnabled":false,"tcpHost":"192.168.0.85","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"1","clientTimeout":"3000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":false},{"id":"751c95dd.a913ac","type":"spotify-auth","name":"Spotify OAuth2","scope":"playlist-read-private\nuser-library-read"},{"id":"08aec2ea4b076adb","type":"rmdevice","folder":"","mac":"24dfa7f0e759","host":"192.168.1.146","devType":"272a"},{"id":"9cfff822.da926","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Max Rain Last 365","query":"select time, max(\"max_value\") from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 365d AND (\"entity_id\"='bom_rain_today' OR \"entity_id\"='bom_tamworth_rain_today' or \"entity_id\"='tamworth_airport_rain_since_9am') GROUP BY time(1d) FILL(null))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":430,"y":100,"wires":[["c1564.abdf4a9c8"]]},{"id":"c1564.abdf4a9c8","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":100,"wires":[["fe248eec.87aac8"]]},{"id":"4f587f87.f1d52","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMMaxRain365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_maxrain_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"state","stateType":"msg","attributes":[{"property":"date","value":"date","valueType":"msg"},{"property":"mm","value":"$round(msg.payload.max, 2)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1190,"y":100,"wires":[[]]},{"id":"fe248eec.87aac8","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":810,"y":100,"wires":[["f1e7435.e6e04c"]]},{"id":"ebd67e08.e4ebb8","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMMinTemp365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_tempmin_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thermometer-chevron-down"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avgtemp, 3)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.maxtemp, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.mintemp, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avgtemp, 3)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1130,"y":440,"wires":[[]]},{"id":"75756fdb.e53c58","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Min/Min Temp Last 365","query":"select time, min(\"min_temp\") as \"mintemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":400,"y":380,"wires":[["8d2b07b8.5815c8"]]},{"id":"8d2b07b8.5815c8","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":610,"y":380,"wires":[["42b1c6cd.b19fc"]]},{"id":"42b1c6cd.b19fc","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":770,"y":380,"wires":[["16ab92df.ebd825"]]},{"id":"d1da186c.b3db18","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":770,"y":440,"wires":[["16ab92df.ebd825"]]},{"id":"1859b769.e29689","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":610,"y":440,"wires":[["d1da186c.b3db18"]]},{"id":"fd45bc7a.fece58","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Min/Max Temp Last 365","query":"select time, max(\"min_temp\") as \"maxtemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":410,"y":440,"wires":[["1859b769.e29689"]]},{"id":"16ab92df.ebd825","type":"join","z":"d5885627.8d1ba8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":950,"y":440,"wires":[["ebd67e08.e4ebb8"]]},{"id":"5eb8e01b.005458","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":610,"y":500,"wires":[["16ab92df.ebd825"]]},{"id":"9647a0c4.5e2a5","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Min/Avg Temp Last 365","query":"select time, mean(\"min_temp\") as \"avgtemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":410,"y":500,"wires":[["5eb8e01b.005458"]]},{"id":"4886e2d4.46b2d4","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMMaxTemp365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_tempmax_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thermometer-chevron-up"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avgtemp, 3)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.maxtemp, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.mintemp, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avgtemp, 3)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1150,"y":240,"wires":[[]]},{"id":"dd96f39e.29b888","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Max/Min Temp Last 365","query":"select time, min(\"max_temp\") as \"mintemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":430,"y":180,"wires":[["60a17c.f49aae84"]]},{"id":"60a17c.f49aae84","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":180,"wires":[["560230bb.3970d"]]},{"id":"560230bb.3970d","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":790,"y":180,"wires":[["656757e6.fcf2c8"]]},{"id":"32b7f6a1.79d3ea","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":790,"y":240,"wires":[["656757e6.fcf2c8"]]},{"id":"a1cd7b34.e8f028","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":240,"wires":[["32b7f6a1.79d3ea"]]},{"id":"619dad43.212b3c","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Max/Max Temp Last 365","query":"select time, max(\"max_temp\") as \"maxtemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":430,"y":240,"wires":[["a1cd7b34.e8f028"]]},{"id":"656757e6.fcf2c8","type":"join","z":"d5885627.8d1ba8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":970,"y":240,"wires":[["4886e2d4.46b2d4"]]},{"id":"966f4c27.dd4cf","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":300,"wires":[["656757e6.fcf2c8"]]},{"id":"4f1cc2df.e58f44","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Max/Avg Temp Last 365","query":"select time, mean(\"max_temp\") as \"avgtemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='bom_tamworth_air_temp_c' OR \"entity_id\"='bom_air_temp_c' or \"entity_id\"='tamworth_airport_temperature' or \"entity_id\"='tamworth_airport_temp') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":430,"y":300,"wires":[["966f4c27.dd4cf"]]},{"id":"ac386693.e11128","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Total Rain Last 365","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_rain_sum_rain_24' OR \"entity_id\"='netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_day' or \"entity_id\"='tempest_st_00056115_rain_today') GROUP BY time(1d) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":390,"y":580,"wires":[["1943ecca.9d301b"]]},{"id":"ee3ed6bb.25091","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeTotalRain365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_totalrain_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.sum, 2)","stateType":"jsonata","attributes":[{"property":"count","value":"$round(msg.payload.count,0)","valueType":"jsonata"},{"property":"countstring","value":"$round(msg.payload.count,0) & \" Days\"","valueType":"jsonata"},{"property":"average","value":"$round(msg.payload.average,2)","valueType":"jsonata"},{"property":"highest","value":"$round(msg.payload.highest,2)","valueType":"jsonata"},{"property":"sort","value":"4","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":830,"y":580,"wires":[[]]},{"id":"1943ecca.9d301b","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":610,"y":580,"wires":[["ee3ed6bb.25091"]]},{"id":"ced31b40.7cc3","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Max Rain Last 365","query":"select time, max(\"max_value\") from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_rain_sum_rain_24' OR \"entity_id\"='netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_day' or \"entity_id\"='tempest_st_00056115_rain_today') GROUP BY time(1d) FILL(null))","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":390,"y":640,"wires":[["d91df9bc.382d18"]]},{"id":"d91df9bc.382d18","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":610,"y":640,"wires":[["80e523e5.3fdbb8"]]},{"id":"acca2149.2ab16","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeMaxRain365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_maxrain_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"state","stateType":"msg","attributes":[{"property":"date","value":"date","valueType":"msg"},{"property":"mm","value":"$round(msg.payload.max, 2)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1150,"y":640,"wires":[[]]},{"id":"80e523e5.3fdbb8","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":770,"y":640,"wires":[["44116de1.40b854"]]},{"id":"311fef1b.5191e8","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeMinTemp365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_tempmin_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thermometer-chevron-down"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avgtemp, 3)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.maxtemp, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.mintemp, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avgtemp, 3)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1090,"y":980,"wires":[[]]},{"id":"9f77d1a3.f0c848","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Min/Min Temp Last 365","query":"select time, min(\"min_temp\") as \"mintemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":920,"wires":[["2952f86c.169c18"]]},{"id":"2952f86c.169c18","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":570,"y":920,"wires":[["799c035e.0848a4"]]},{"id":"799c035e.0848a4","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":730,"y":920,"wires":[["3077121.f8210ee"]]},{"id":"6191578.20f92a8","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":730,"y":980,"wires":[["3077121.f8210ee"]]},{"id":"e0772390.ce027","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":570,"y":980,"wires":[["6191578.20f92a8"]]},{"id":"9b8225c3.3e52b","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Min/Max Temp Last 365","query":"select time, max(\"min_temp\") as \"maxtemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":980,"wires":[["e0772390.ce027"]]},{"id":"3077121.f8210ee","type":"join","z":"d5885627.8d1ba8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":910,"y":980,"wires":[["311fef1b.5191e8"]]},{"id":"87537534.62ac28","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":570,"y":1040,"wires":[["3077121.f8210ee"]]},{"id":"f2605d19.95d2c8","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Min/Avg Temp Last 365","query":"select time, mean(\"min_temp\") as \"avgtemp\" from (SELECT min(\"value\") AS \"min_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":1040,"wires":[["87537534.62ac28"]]},{"id":"1f2952a.7e1c72d","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeMaxTemp365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_tempmax_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thermometer-chevron-up"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avgtemp, 3)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.maxtemp, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.mintemp, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avgtemp, 3)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1110,"y":780,"wires":[[]]},{"id":"79431228.3483d4","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Max/Min Temp Last 365","query":"select time, min(\"max_temp\") as \"mintemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":720,"wires":[["db16b3d5.adbd5"]]},{"id":"db16b3d5.adbd5","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":720,"wires":[["845e38af.3e52a"]]},{"id":"845e38af.3e52a","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":720,"wires":[["69599f19.338ae8"]]},{"id":"b36eca6a.c96cc","type":"moment","z":"d5885627.8d1ba8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":780,"wires":[["69599f19.338ae8"]]},{"id":"87ecf6e7.ce2e1","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":780,"wires":[["b36eca6a.c96cc"]]},{"id":"a1b93d24.af819","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Max/Max Temp Last 365","query":"select time, max(\"max_temp\") as \"maxtemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":780,"wires":[["87ecf6e7.ce2e1"]]},{"id":"69599f19.338ae8","type":"join","z":"d5885627.8d1ba8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":930,"y":780,"wires":[["1f2952a.7e1c72d"]]},{"id":"560c7d6b.894e6c","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":840,"wires":[["69599f19.338ae8"]]},{"id":"544633b3.4aa8f4","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Max/Avg Temp Last 365","query":"select time, mean(\"max_temp\") as \"avgtemp\" from (SELECT max(\"value\") AS \"max_temp\" FROM \"homeassistant\".\"autogen\".\"°C\" WHERE time > now() - 365d AND (\"entity_id\"='netatmo_brisbane_street_outdoor_temperature' OR \"entity_id\"='netatmo_outdoor_temperature' or \"entity_id\" = 'weather_outside_temperature') GROUP BY time(1d) FILL(null)  tz('Australia/Sydney'))","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":840,"wires":[["560c7d6b.894e6c"]]},{"id":"13d27691.292561","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMTotalRain365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_totalrain_lastyr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.sum, 2)","stateType":"jsonata","attributes":[{"property":"count","value":"$round(msg.payload.count,0)","valueType":"jsonata"},{"property":"countstring","value":"$round(msg.payload.count,0) & \" Days\"","valueType":"jsonata"},{"property":"average","value":"$round(msg.payload.average,2)","valueType":"jsonata"},{"property":"highest","value":"$round(msg.payload.highest,2)","valueType":"jsonata"},{"property":"sort","value":"4","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":870,"y":40,"wires":[[]]},{"id":"86d903d0.3690a","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":40,"wires":[["13d27691.292561"]]},{"id":"2ce5780e.110cd","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Total Rain Last 365","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT last(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 365d AND (\"entity_id\"='bom_rain_today' OR \"entity_id\"='bom_tamworth_rain_today' or \"entity_id\"='tamworth_airport_rain_since_9am') GROUP BY time(1d,9h) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":430,"y":40,"wires":[["86d903d0.3690a"]]},{"id":"90a11a95.5095b","type":"inject","z":"d5885627.8d1ba8","name":"1MinInt","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":300,"wires":[["2ce5780e.110cd","9cfff822.da926","75756fdb.e53c58","fd45bc7a.fece58","9647a0c4.5e2a5","dd96f39e.29b888","619dad43.212b3c","4f1cc2df.e58f44","ac386693.e11128","ced31b40.7cc3","79431228.3483d4","a1b93d24.af819","544633b3.4aa8f4","9f77d1a3.f0c848","9b8225c3.3e52b","f2605d19.95d2c8","acc1783c.e9692","1eb674fc.d1fa53","d7054ce0.fd771","a3ca8de6.634818","d33cc0ed.3cc1f","27c76c73.7ae4a4"]]},{"id":"acc1783c.e9692","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Rain This Week","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 7d AND (\"entity_id\"='netatmo_rain_sum_rain_24' OR \"entity_id\"='netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_day' or \"entity_id\"='tempest_st_00056115_rain_today') GROUP BY time(1d) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1100,"wires":[["3dbf3e45.2571aa"]]},{"id":"ce754827.a3f308","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1100,"wires":[["1b767a8.196e406"]]},{"id":"1b767a8.196e406","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeRainLast7Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_rain_last7days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"1","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":1100,"wires":[[]]},{"id":"1eb674fc.d1fa53","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Rain This Month","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 30d AND (\"entity_id\"='netatmo_rain_sum_rain_24' OR \"entity_id\"='netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_day' or \"entity_id\"='tempest_st_00056115_rain_today') GROUP BY time(1d) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1180,"wires":[["7b392c46.8fca94"]]},{"id":"ad140ae.933f2f8","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1180,"wires":[["6a5bcb5d.8aa50c"]]},{"id":"6a5bcb5d.8aa50c","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeRainLast30Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_rain_last30days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"3","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":1180,"wires":[[]]},{"id":"d7054ce0.fd771","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Rain This Week","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT last(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 7d AND (\"entity_id\"='bom_rain_today' OR \"entity_id\"='bom_tamworth_rain_today' or \"entity_id\"='tamworth_airport_rain_since_9am') GROUP BY time(1d,9h) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1280,"wires":[["4eb83a12.8ce31c"]]},{"id":"1cd31d9d.af1e4a","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1280,"wires":[["d4f5da6c.a1fc4"]]},{"id":"d4f5da6c.a1fc4","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMRainLast7Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_rain_last7days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"1","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":880,"y":1280,"wires":[[]]},{"id":"a3ca8de6.634818","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Rain This Month","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT last(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 30d AND (\"entity_id\"='bom_rain_today' OR \"entity_id\"='bom_tamworth_rain_today' or \"entity_id\"='tamworth_airport_rain_since_9am') GROUP BY time(1d,9h) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1320,"wires":[["2ba2045f.05da74"]]},{"id":"42519ec.b2c3ee","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1320,"wires":[["9175a68d.c94b78"]]},{"id":"9175a68d.c94b78","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMRainLast30Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_rain_last30days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"3","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":1320,"wires":[[]]},{"id":"b6601402.363ac8","type":"ha-entity","z":"d5885627.8d1ba8","name":"HomeRainPrior7Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_home_rain_prior7days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"2","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":1140,"wires":[[]]},{"id":"6d6fd078.e07128","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1140,"wires":[["b6601402.363ac8"]]},{"id":"d33cc0ed.3cc1f","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"Home Rain Last Week","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT max(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 14d and time < now() - 7d AND (\"entity_id\"='netatmo_rain_sum_rain_24' OR \"entity_id\"='netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_day' or \"entity_id\"='tempest_st_00056115_rain_today') GROUP BY time(1d) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1140,"wires":[["1e4276a0.870a69"]]},{"id":"8035f609.c576a8","type":"ha-entity","z":"d5885627.8d1ba8","name":"BOMRainPrior7Days","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_bom_rain_prior7days"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$exists(msg.payload.sum) ? $round(msg.payload.sum, 2) : 0","stateType":"jsonata","attributes":[{"property":"count","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 2) : 0","valueType":"jsonata"},{"property":"countstring","value":"$exists(msg.payload.count) ? $round(msg.payload.count, 0) & \" Days\" : \"No Rain\"","valueType":"jsonata"},{"property":"average","value":"$exists(msg.payload.average) ? $round(msg.payload.average, 2) : 0","valueType":"jsonata"},{"property":"highest","value":"$exists(msg.payload.highest) ? $round(msg.payload.highest, 2) : 0","valueType":"jsonata"},{"property":"sort","value":"2","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":1360,"wires":[[]]},{"id":"b5381011.4143e8","type":"split","z":"d5885627.8d1ba8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":1360,"wires":[["8035f609.c576a8"]]},{"id":"27c76c73.7ae4a4","type":"influxdb in","z":"d5885627.8d1ba8","influxdb":"ae13dda.6b5d8a","name":"BOM Rain Last Week","query":"select sum(\"max_value\") as sum, count(\"max_value\") as count, sum(\"max_value\")/count(\"max_value\") as average, max(\"max_value\") as highest from (SELECT last(\"value\") AS \"max_value\" FROM \"homeassistant\".\"autogen\".\"mm\" WHERE time > now() - 14d and time < now() - 7d AND (\"entity_id\"='bom_rain_today' OR \"entity_id\"='bom_tamworth_rain_today' or \"entity_id\"='tamworth_airport_rain_since_9am') GROUP BY time(1d,9h) FILL(null) tz('Australia/Sydney')) where max_value <> 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":1360,"wires":[["a7594347.20bcf8"]]},{"id":"7b392c46.8fca94","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1180,"wires":[["ad140ae.933f2f8"]]},{"id":"1e4276a0.870a69","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1140,"wires":[["6d6fd078.e07128"]]},{"id":"3dbf3e45.2571aa","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1100,"wires":[["ce754827.a3f308"]]},{"id":"4eb83a12.8ce31c","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1280,"wires":[["1cd31d9d.af1e4a"]]},{"id":"2ba2045f.05da74","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1320,"wires":[["42519ec.b2c3ee"]]},{"id":"a7594347.20bcf8","type":"function","z":"d5885627.8d1ba8","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload = {\n        sum: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1360,"wires":[["b5381011.4143e8"]]},{"id":"f1e7435.e6e04c","type":"function","z":"d5885627.8d1ba8","name":"Format","func":"msg.payload.state = msg.payload.max.toFixed(2) + \"mm - \" + msg.payload.date\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":100,"wires":[["4f587f87.f1d52"]]},{"id":"44116de1.40b854","type":"function","z":"d5885627.8d1ba8","name":"Format","func":"msg.payload.state = msg.payload.max.toFixed(2) + \"mm - \" + msg.payload.date\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":640,"wires":[["acca2149.2ab16"]]},{"id":"52b4407.3df954","type":"inject","z":"9c799abb.c66da8","name":"5MinInt","repeat":"300","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":480,"wires":[["44ceb95d.62e11","44cafcc7.b20ccc","d4835dd8.de7c6","6e6fc2d0.205eac","9922bb18.1eb848","713c1c93.26a5dc","47681456.500c5c","cffde371.4f064","c43653b3.1ec95","ffc0ff1c.95932","b92b209f.234a9"]]},{"id":"44ceb95d.62e11","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"BPViaduct Min Price 365","query":"select time, min(value) as min_value from (SELECT min(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_bp_tamworth_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":80,"wires":[["d1b0caa6.9fbaa"]]},{"id":"44cafcc7.b20ccc","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"BPViaduct Max Price 365","query":"select time, max(value) as max_value from (SELECT max(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_bp_tamworth_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":140,"wires":[["ab90991.673d1e8"]]},{"id":"d1b0caa6.9fbaa","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":80,"wires":[["b8367603.db012"]]},{"id":"ab90991.673d1e8","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":140,"wires":[["2b9bd7ed.b6ffc"]]},{"id":"d4835dd8.de7c6","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"BPViaduct Avg Price 365","query":"select mean(value) as avg_value from (SELECT mean(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_bp_tamworth_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":200,"wires":[["e2a73fa1.39ad58"]]},{"id":"e2a73fa1.39ad58","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":200,"wires":[["86703e2f.c59"]]},{"id":"2b9bd7ed.b6ffc","type":"moment","z":"9c799abb.c66da8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":140,"wires":[["86703e2f.c59"]]},{"id":"b8367603.db012","type":"moment","z":"9c799abb.c66da8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":80,"wires":[["86703e2f.c59"]]},{"id":"86703e2f.c59","type":"join","z":"9c799abb.c66da8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":930,"y":140,"wires":[["cdb027c7.820ed8"]]},{"id":"cdb027c7.820ed8","type":"ha-entity","z":"9c799abb.c66da8","name":"BPViaductStats365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"fuel_bpviaduct_stats365"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:fuel"},{"property":"unit_of_measurement","value":"¢/L"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avg_value, 2)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.max_value, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.min_value, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avg_value, 2)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1130,"y":140,"wires":[[]]},{"id":"6e6fc2d0.205eac","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"CaltexWhite Min Price 365","query":"select time, min(value) as min_value from (SELECT min(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_caltex_tamworth_orana_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":380,"y":260,"wires":[["902cb0e7.7d348"]]},{"id":"9922bb18.1eb848","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"CaltexWhite Max Price 365","query":"select time, max(value) as max_value from (SELECT max(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_caltex_tamworth_orana_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":380,"y":320,"wires":[["9067dba0.6a2cc"]]},{"id":"902cb0e7.7d348","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":260,"wires":[["ecee3977.5500d"]]},{"id":"9067dba0.6a2cc","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":320,"wires":[["137ec490.0d56c3"]]},{"id":"713c1c93.26a5dc","type":"influxdb in","z":"9c799abb.c66da8","influxdb":"ae13dda.6b5d8a","name":"CaltexWhite Avg Price 365","query":"select mean(value) as avg_value from (SELECT mean(\"value\") AS \"value\" FROM \"homeassistant\".\"autogen\".\"¢/L\" WHERE time > now() - 365d AND \"entity_id\"='fuelcheck_caltex_tamworth_orana_p98' GROUP BY time(1d) FILL(null) TZ('Australia/Sydney')) ","rawOutput":false,"precision":"","retentionPolicy":"","x":380,"y":380,"wires":[["ee713791.489d08"]]},{"id":"ee713791.489d08","type":"split","z":"9c799abb.c66da8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":380,"wires":[["710e3330.c3c0ac"]]},{"id":"137ec490.0d56c3","type":"moment","z":"9c799abb.c66da8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.maxdate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":320,"wires":[["710e3330.c3c0ac"]]},{"id":"ecee3977.5500d","type":"moment","z":"9c799abb.c66da8","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD MMM YYYY","locale":"C","output":"payload.mindate","outputType":"msg","outTz":"Australia/Sydney","x":750,"y":260,"wires":[["710e3330.c3c0ac"]]},{"id":"710e3330.c3c0ac","type":"join","z":"9c799abb.c66da8","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":930,"y":320,"wires":[["c64bc5f1.cdb0c"]]},{"id":"c64bc5f1.cdb0c","type":"ha-entity","z":"9c799abb.c66da8","name":"CaltexWhiteStats365","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"fuel_caltexwhite_stats365"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:fuel"},{"property":"unit_of_measurement","value":"¢/L"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.avg_value, 2)","stateType":"jsonata","attributes":[{"property":"max","value":"$round(msg.payload.max_value, 2)","valueType":"jsonata"},{"property":"min","value":"$round(msg.payload.min_value, 2)","valueType":"jsonata"},{"property":"avg","value":"$round(msg.payload.avg_value, 2)","valueType":"jsonata"},{"property":"mindate","value":"payload.mindate","valueType":"msg"},{"property":"maxdate","value":"payload.maxdate","valueType":"msg"},{"property":"datestring","value":"\"Min: \" & $string(msg.payload.mindate) & \" - Max: \" & $string(msg.payload.maxdate)","valueType":"jsonata"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1120,"y":320,"wires":[[]]},{"id":"77afb14d.478f6","type":"mysql","z":"9c799abb.c66da8","d":true,"mydb":"32ee669f.a3e77a","name":"Clarkson","x":500,"y":500,"wires":[["af418e49.c1d8"]]},{"id":"47681456.500c5c","type":"function","z":"9c799abb.c66da8","d":true,"name":"set topic","func":"msg.topic = \"SELECT MAX(F.`odometerReading`) - MIN(F.`odometerReading`) AS `totalDistance`, COUNT(F.`id`) AS `totalFillUps`, SUM(F.`totalCost`) AS `totalSpent` FROM `Fuel` F WHERE F.`vehicle` = '0C6641E6-38EB-4D34-808A8-933A3E616B7' GROUP BY F.`vehicle` \";\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":500,"wires":[["77afb14d.478f6"]]},{"id":"af418e49.c1d8","type":"split","z":"9c799abb.c66da8","d":true,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":500,"wires":[["b0bcb38f.79427","f21601cd.f3167","78462d4c.f74db4"]]},{"id":"b0bcb38f.79427","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_DistanceTracked","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_DistanceTracked"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":"km"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalDistance, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":890,"y":500,"wires":[[]]},{"id":"f21601cd.f3167","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FillUps","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_FillUps"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalFillUps, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":850,"y":560,"wires":[[]]},{"id":"78462d4c.f74db4","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FuelCost","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_TotalFuelCost"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":"$"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalSpent, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":860,"y":620,"wires":[[]]},{"id":"8abce0a5.6ede3","type":"mysql","z":"9c799abb.c66da8","d":true,"mydb":"32ee669f.a3e77a","name":"Clarkson","x":500,"y":680,"wires":[["ce5c8316.6ce82"]]},{"id":"cffde371.4f064","type":"function","z":"9c799abb.c66da8","d":true,"name":"set topic","func":"msg.topic = \"SELECT COUNT(F.`id`) AS `totalFillUps`, YEAR(F.`date`) AS `year`, SUM(F.`totalCost`) AS `totalCost` FROM `Fuel` F WHERE F.`vehicle` = '0C6641E6-38EB-4D34-808A8-933A3E616B7' AND YEAR(F.`date`) = YEAR(CURDATE()) GROUP BY YEAR(F.`date`) \";\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":680,"wires":[["8abce0a5.6ede3"]]},{"id":"ce5c8316.6ce82","type":"split","z":"9c799abb.c66da8","d":true,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":680,"wires":[["6becbceb.3015b4","60bd21b7.ff25b"]]},{"id":"6becbceb.3015b4","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FillUps_ThisYear","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_FillUps_ThisYear"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalFillUps, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":890,"y":680,"wires":[[]]},{"id":"60bd21b7.ff25b","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FuelCost_ThisYear","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_TotalFuelCost_ThisYear"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":"$"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalCost, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":890,"y":740,"wires":[[]]},{"id":"98169fa9.77ef9","type":"mysql","z":"9c799abb.c66da8","d":true,"mydb":"32ee669f.a3e77a","name":"Clarkson","x":500,"y":800,"wires":[["4e5a9a25.a69594"]]},{"id":"c43653b3.1ec95","type":"function","z":"9c799abb.c66da8","d":true,"name":"set topic","func":"msg.topic = \"SELECT COUNT(F.`id`) AS `totalFillUps`, YEAR(F.`date`) AS `year`, SUM(F.`totalCost`) AS `totalCost` FROM `Fuel` F WHERE F.`vehicle` = '0C6641E6-38EB-4D34-808A8-933A3E616B7' AND YEAR(F.`date`) = YEAR(CURDATE())-1 GROUP BY YEAR(F.`date`) \";\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":800,"wires":[["98169fa9.77ef9"]]},{"id":"4e5a9a25.a69594","type":"split","z":"9c799abb.c66da8","d":true,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":800,"wires":[["ecfb34cd.4275b8","5c6679fe.32a678"]]},{"id":"ecfb34cd.4275b8","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FillUps_LastYear","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_FillUps_LastYear"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalFillUps, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":890,"y":800,"wires":[[]]},{"id":"5c6679fe.32a678","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_FuelCost_LastYear","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_TotalFuelCost_LastYear"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":"$"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.totalCost, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":890,"y":860,"wires":[[]]},{"id":"537a6f89.6715d","type":"mysql","z":"9c799abb.c66da8","d":true,"mydb":"32ee669f.a3e77a","name":"Clarkson","x":500,"y":1020,"wires":[["5732c25.8ec8f3c"]]},{"id":"ffc0ff1c.95932","type":"function","z":"9c799abb.c66da8","d":true,"name":"set topic","func":"msg.topic = \"SET @p0='0C6641E6-38EB-4D34-808A8-933A3E616B7'; CALL `Fuel_GetByVehicle`(@p0); \";\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1020,"wires":[["537a6f89.6715d"]]},{"id":"5732c25.8ec8f3c","type":"debug","z":"9c799abb.c66da8","d":true,"name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":1040,"wires":[]},{"id":"138a393d.b57d2f","type":"mysql","z":"9c799abb.c66da8","d":true,"mydb":"32ee669f.a3e77a","name":"Clarkson","x":500,"y":920,"wires":[["40030ba.3059af4","1c245edb.500061"]]},{"id":"b92b209f.234a9","type":"function","z":"9c799abb.c66da8","d":true,"name":"set topic","func":"msg.topic = \"SELECT COUNT(F.`id`) AS `totalFillUps`, YEAR(F.`date`) AS `year`, SUM(F.`totalCost`) AS `totalCost`, MAX(F.`odometerReading`) - MIN(F.`odometerReading`) AS `totalDistance`, sum(F.`fuelAmount`) as `fuelAmount`, sum(F.`fuelAmount`)/(MAX(F.`odometerReading`) - MIN(F.`odometerReading`))*100 as `Consumption` FROM `Fuel` F WHERE F.`vehicle` = '0C6641E6-38EB-4D34-808A8-933A3E616B7' GROUP BY YEAR(F.`date`) order by year \";\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":920,"wires":[["138a393d.b57d2f"]]},{"id":"40030ba.3059af4","type":"split","z":"9c799abb.c66da8","d":true,"name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":920,"wires":[["da468e5e.0836e8"]]},{"id":"da468e5e.0836e8","type":"ha-entity","z":"9c799abb.c66da8","d":true,"name":"Car_Tiguan_Fuel","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Car_Tiguan_FillUps_Fuel"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:car"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload[0].totalFillUps, 2)","stateType":"jsonata","attributes":[{"property":"2021","value":"payload","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":850,"y":920,"wires":[[]]},{"id":"1c245edb.500061","type":"debug","z":"9c799abb.c66da8","d":true,"name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":980,"wires":[]},{"id":"5cbe604c.1ed62","type":"inject","z":"fa272026.a5eb2","name":"1MinInt","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":60,"wires":[["86086341.18cb08","e9e1dec.da8e52","991115e.0a91068","c8a44499.f7875","2839b984.e7dede","f6624129.f6bd88","42f4fdeb.b48b34","77474778.22abd","f91dc03d.3c49e"]]},{"id":"86086341.18cb08","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"InfluxDBSize","query":"SELECT max(\"diskBytes\")/1024/1024 AS \"value\" FROM \"_internal\".\"monitor\".\"shard\" WHERE time > now() - 1m AND \"database\"='homeassistant' FILL(null) tz('Australia/Sydney')","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":60,"wires":[["5350956a.5e9004"]]},{"id":"5350956a.5e9004","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":60,"wires":[["ed1d6c14.0eede8"]]},{"id":"ed1d6c14.0eede8","type":"ha-entity","z":"fa272026.a5eb2","name":"InfluxDB Size","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"influxdb_size"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:database-settings"},{"property":"unit_of_measurement","value":"Mb"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.value, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":850,"y":60,"wires":[[]]},{"id":"8fa31d33.f6d548","type":"inject","z":"fa272026.a5eb2","name":"HASS Connected?","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"homeassistant.homeAssistant.isConnected","payloadType":"global","x":130,"y":1100,"wires":[["6311fbf4.a8b4f4"]]},{"id":"6311fbf4.a8b4f4","type":"rbe","z":"fa272026.a5eb2","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":340,"y":1100,"wires":[["6b4ce4b0.ad037c"]]},{"id":"6b4ce4b0.ad037c","type":"interval-length","z":"fa272026.a5eb2","format":"human","bytopic":false,"minimum":"35","maximum":"","window":"","timeout":false,"msgTimeout":"","minimumunit":"secs","maximumunit":"secs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":false,"startup":false,"msgField":"payload","timestampField":"timestamp","repeatTimeout":false,"name":"","x":570,"y":1100,"wires":[["118db764.b6fe21"],[]]},{"id":"118db764.b6fe21","type":"mqtt out","z":"fa272026.a5eb2","name":"","topic":"harestart","qos":"","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"c2d1b0f2.af1008","x":810,"y":1100,"wires":[]},{"id":"e9e1dec.da8e52","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"InfluxDBSize","query":"SELECT max(\"diskBytes\")/1024/1024 AS \"value\" FROM \"_internal\".\"monitor\".\"shard\" WHERE time > now() - 1m AND \"database\"='varken' AND \"retentionPolicy\"='varken 30d-1h' FILL(null) tz('Australia/Sydney')","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":120,"wires":[["31f229f7.c178ce"]]},{"id":"31f229f7.c178ce","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":120,"wires":[["2cd48d0a.141992"]]},{"id":"2cd48d0a.141992","type":"ha-entity","z":"fa272026.a5eb2","name":"Varken InfluxDB Size","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"influxdb_varken_size"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:database-settings"},{"property":"unit_of_measurement","value":"Mb"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.value, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":870,"y":120,"wires":[[]]},{"id":"991115e.0a91068","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"InfluxDBSize","query":"SELECT max(\"diskBytes\")/1024/1024 AS \"value\" FROM \"_internal\".\"monitor\".\"shard\" WHERE time > now() - 1m AND \"database\"='unifi' FILL(null) tz('Australia/Sydney')","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":180,"wires":[["5b2fddcd.422e6c"]]},{"id":"5b2fddcd.422e6c","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":180,"wires":[["f757099a.d4cc4"]]},{"id":"f757099a.d4cc4","type":"ha-entity","z":"fa272026.a5eb2","name":"Unifi InfluxDB Size","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"influxdb_unifipoller_size"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:database-settings"},{"property":"unit_of_measurement","value":"Mb"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.value, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":860,"y":180,"wires":[[]]},{"id":"c8a44499.f7875","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"UniFi_UAP","query":"SELECT last(\"ip\") AS \"Address\", last(\"uptime\") AS \"Uptime\", last(\"last_seen\") *1000 AS \"Last Seen\", last(\"cpu\") AS \"CPU\", last(\"user-num_sta\") AS \"Users\", last(\"guest-num_sta\") AS \"Guests\", last(\"stat_rx_bytes\") AS \"rxbytes\", last(\"stat_tx_bytes\") AS \"txbytes\" FROM \"unifi\".\"autogen\".\"uap\" WHERE time >= now() - 5m GROUP BY \"name\", \"model\", \"serial\", \"site_name\", \"source\", \"type\", \"version\", \"mac\"","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":390,"y":260,"wires":[["107dec2d.367fa4"]]},{"id":"317647b8.d297a8","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":730,"y":260,"wires":[["68b96baa.7c5a24","957cbb4.eef05c8","4ab87d18.2096bc"]]},{"id":"7b4905a4.5af234","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_UAP","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_uap"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:wifi"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.name","stateType":"msg","attributes":[{"property":"ip_address","value":"payload.Address","valueType":"msg"},{"property":"model","value":"payload.model","valueType":"msg"},{"property":"version","value":"payload.version","valueType":"msg"},{"property":"mac","value":"payload.mac","valueType":"msg"},{"property":"serial","value":"payload.serial","valueType":"msg"},{"property":"sitename","value":"payload.site_name","valueType":"msg"},{"property":"type","value":"payload.type","valueType":"msg"},{"property":"cpu","value":"payload.CPU","valueType":"jsonata"},{"property":"users","value":"payload.Users","valueType":"msg"},{"property":"controller","value":"payload.source","valueType":"msg"},{"property":"guests","value":"payload.Guests","valueType":"msg"},{"property":"uptime","value":"payload.uptime_clean","valueType":"msg"},{"property":"lastseen","value":"payload.lastseen_clean","valueType":"msg"},{"property":"tx_data","value":"payload.tx_clean","valueType":"msg"},{"property":"rx_data","value":"payload.rx_clean","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1190,"y":260,"wires":[[]]},{"id":"68b96baa.7c5a24","type":"moment","z":"fa272026.a5eb2","name":"","topic":"","input":"payload.lastseen","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"fromNow","locale":"C","output":"payload.lastseen_clean","outputType":"msg","outTz":"Australia/Sydney","x":940,"y":260,"wires":[["7b4905a4.5af234"]]},{"id":"2839b984.e7dede","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"UniFi_USG","query":"SELECT last(\"uptime\") AS \"Uptime\", last(\"ip\") AS \"Address\", last(\"bytes\") AS \"Data\" FROM \"unifi\".\"autogen\".\"usg\" WHERE time >= now() - 1h GROUP BY \"name\", \"model\", \"serial\", \"site_name\", \"mac\", \"version\", \"source\", \"type\"","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":340,"wires":[["b8c23fee.b0a668"]]},{"id":"772d469c.a8406","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":730,"y":340,"wires":[["6486439b.4c63f4"]]},{"id":"8c14123d.0a703","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USG","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usg"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.name","stateType":"msg","attributes":[{"property":"model","value":"payload.model","valueType":"msg"},{"property":"version","value":"payload.version","valueType":"msg"},{"property":"data","value":"payload.data_clean","valueType":"msg"},{"property":"serial","value":"payload.serial","valueType":"msg"},{"property":"sitename","value":"payload.site_name","valueType":"msg"},{"property":"type","value":"payload.type","valueType":"msg"},{"property":"controller","value":"payload.source","valueType":"msg"},{"property":"external_ip_address","value":"payload.Address","valueType":"msg"},{"property":"uptime","value":"payload.uptime_clean","valueType":"msg"},{"property":"lastseen","value":"payload.lastseen_clean","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1190,"y":340,"wires":[[]]},{"id":"6486439b.4c63f4","type":"moment","z":"fa272026.a5eb2","name":"","topic":"","input":"payload.lastseen","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"fromNow","locale":"C","output":"payload.lastseen_clean","outputType":"msg","outTz":"Australia/Sydney","x":940,"y":340,"wires":[["8c14123d.0a703"]]},{"id":"b8c23fee.b0a668","type":"function","z":"fa272026.a5eb2","name":"Data","func":"bytes = msg.payload[0].Data;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].data_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":340,"wires":[["f694f36c.37fa78"]]},{"id":"f694f36c.37fa78","type":"function","z":"fa272026.a5eb2","name":"Uptime","func":"time = msg.payload[0].Uptime;\n\nminutes = ((time % 3600) / 60);\nif (minutes === 0) {\n  minutes = \"\";\n} else {\n  minutes = parseInt(minutes) + \"min\"\n}\n \nhours = ((time % 86400) / 3600);\nif (hours === 0) {\n  hours = \"\";\n} else {\n  hours = parseInt(hours) + \"hr \"\n}\n\ndays = (time / 86400);\nif (days === 0) {\n  days = \"\";\n} else {\n  days = parseInt(days) + \"d \"\n}\n \nmsg.payload[0].uptime_clean = days + hours + minutes;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":380,"wires":[["772d469c.a8406"]]},{"id":"3543d1f7.9b4ae6","type":"function","z":"fa272026.a5eb2","name":"Uptime","func":"time = msg.payload[0].Uptime;\n\nminutes = ((time % 3600) / 60);\nif (minutes === 0) {\n  minutes = \"\";\n} else {\n  minutes = parseInt(minutes) + \"min\"\n}\n \nhours = ((time % 86400) / 3600);\nif (hours === 0) {\n  hours = \"\";\n} else {\n  hours = parseInt(hours) + \"hr \"\n}\n\ndays = (time / 86400);\nif (days === 0) {\n  days = \"\";\n} else {\n  days = parseInt(days) + \"d \"\n}\n \nmsg.payload[0].uptime_clean = days + hours + minutes;\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":260,"wires":[["4fce1e37.117b"]]},{"id":"f6624129.f6bd88","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"UniFi_USW","query":"SELECT last(\"uptime\") AS \"Uptime\", last(\"rx_bytes\") AS \"rxbytes\", last(\"tx_bytes\") AS \"txbytes\" FROM \"unifi\".\"autogen\".\"usw\" WHERE time >= now() - 1h GROUP BY \"name\", \"model\", \"serial\", \"site_name\", \"mac\", \"version\", \"source\", \"type\"","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":440,"wires":[["539a7a42.3f2384","a94ab0a3.ecc24"]]},{"id":"b2a53f98.321f6","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[0].name","stateType":"msg","attributes":[{"property":"model","value":"payload[0].model","valueType":"msg"},{"property":"version","value":"payload[0].version","valueType":"msg"},{"property":"serial","value":"payload[0].serial","valueType":"msg"},{"property":"sitename","value":"payload[0].site_name","valueType":"msg"},{"property":"type","value":"payload[0].type","valueType":"msg"},{"property":"controller","value":"payload[0].source","valueType":"msg"},{"property":"uptime","value":"payload[0].uptime_clean","valueType":"msg"},{"property":"rx_data","value":"payload[0].rx_clean","valueType":"msg"},{"property":"tx_data","value":"payload[0].tx_clean","valueType":"msg"},{"property":"lastseen","value":"payload[0].lastseen_clean","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1190,"y":420,"wires":[[]]},{"id":"52846a02.f37a44","type":"moment","z":"fa272026.a5eb2","name":"","topic":"","input":"payload[0].lastseen","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"fromNow","locale":"C","output":"payload[0].lastseen_clean","outputType":"msg","outTz":"Australia/Sydney","x":940,"y":440,"wires":[["b2a53f98.321f6"]]},{"id":"539a7a42.3f2384","type":"function","z":"fa272026.a5eb2","name":"RX Bytes","func":"bytes = msg.payload[0].rxbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].rx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].rx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].rx_units = sizes[i];\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":440,"wires":[["3025261.11cd95a"]]},{"id":"3025261.11cd95a","type":"function","z":"fa272026.a5eb2","name":"Uptime","func":"time = msg.payload[0].Uptime;\n\nminutes = ((time % 3600) / 60);\nif (minutes === 0) {\n  minutes = \"\";\n} else {\n  minutes = parseInt(minutes) + \"min\"\n}\n \nhours = ((time % 86400) / 3600);\nif (hours === 0) {\n  hours = \"\";\n} else {\n  hours = parseInt(hours) + \"hr \"\n}\n\ndays = (time / 86400);\nif (days === 0) {\n  days = \"\";\n} else {\n  days = parseInt(days) + \"d \"\n}\n \nmsg.payload[0].uptime_clean = days + hours + minutes;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":480,"wires":[["d0d9c975.db75b8"]]},{"id":"d0d9c975.db75b8","type":"function","z":"fa272026.a5eb2","name":"TX Bytes","func":"bytes = msg.payload[0].txbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].tx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].tx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].tx_units = sizes[i];\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":520,"wires":[["52846a02.f37a44","7e607f36.2c7aa8","e96c7bb3.6563b8"]]},{"id":"7e607f36.2c7aa8","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW_RX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw_rx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[0].rx","stateType":"msg","attributes":[{"property":"units","value":"payload[0].rx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1200,"y":480,"wires":[[]]},{"id":"e96c7bb3.6563b8","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW_TX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw_tx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[0].tx","stateType":"msg","attributes":[{"property":"units","value":"payload[0].tx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1200,"y":540,"wires":[[]]},{"id":"107dec2d.367fa4","type":"function","z":"fa272026.a5eb2","name":"RX Bytes","func":"bytes = msg.payload[0].rxbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].rx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].rx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].rx_units = sizes[i];\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":220,"wires":[["3543d1f7.9b4ae6"]]},{"id":"4fce1e37.117b","type":"function","z":"fa272026.a5eb2","name":"TX Bytes","func":"bytes = msg.payload[0].txbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].tx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].tx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].tx_units = sizes[i];\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":300,"wires":[["317647b8.d297a8"]]},{"id":"4ab87d18.2096bc","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_UAP_RX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_uap_rx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:wifi"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.rx","stateType":"msg","attributes":[{"property":"units","value":"payload.rx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1200,"y":180,"wires":[[]]},{"id":"957cbb4.eef05c8","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_UAP_TX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_uap_tx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.tx","stateType":"msg","attributes":[{"property":"units","value":"payload.tx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1200,"y":220,"wires":[[]]},{"id":"42f4fdeb.b48b34","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"UniFi_USG_WWW","query":"SELECT last(\"uptime\") AS \"uptime\", last(\"drops\") AS \"drops\", last(\"latency\") AS \"latency\", last(\"tx_bytes-r\") AS \"tx_bytes\", last(\"rx_bytes-r\") AS \"rx_bytes\", last(\"speedtest_lastrun\") AS \"speedtest_lastrun\"  FROM \"unifi\".\"autogen\".\"subsystems\" WHERE (\"subsystem\" = 'www') AND time >= now() - 3h and time <= now() - 5s","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":390,"y":840,"wires":[["998f2504.df0b2"]]},{"id":"e2a0a248.dad23","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":730,"y":840,"wires":[["b2faf3ad.5078a"]]},{"id":"ab2ad1b0.e2144","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USG_WWW","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usg_www"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:web"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.drops","stateType":"msg","attributes":[{"property":"uptime","value":"payload.uptime_clean","valueType":"msg"},{"property":"drops","value":"payload.drops","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1170,"y":840,"wires":[[]]},{"id":"ef92ee1d.2b96f8","type":"function","z":"fa272026.a5eb2","name":"TX Bytes","func":"bytes = msg.payload[0].tx_bytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].tx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].tx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].tx_units = sizes[i];\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":880,"wires":[["e2a0a248.dad23"]]},{"id":"8e30ba54.5e75b8","type":"function","z":"fa272026.a5eb2","name":"Uptime","func":"time = msg.payload[0].uptime;\n\nminutes = ((time % 3600) / 60);\nif (minutes === 0) {\n  minutes = \"\";\n} else {\n  minutes = parseInt(minutes) + \"min\"\n}\n \nhours = ((time % 86400) / 3600);\nif (hours === 0) {\n  hours = \"\";\n} else {\n  hours = parseInt(hours) + \"hr \"\n}\n\ndays = (time / 86400);\nif (days === 0) {\n  days = \"\";\n} else {\n  days = parseInt(days) + \"d \"\n}\n \nmsg.payload[0].uptime_clean = days + hours + minutes;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":840,"wires":[["ef92ee1d.2b96f8"]]},{"id":"998f2504.df0b2","type":"function","z":"fa272026.a5eb2","name":"RX Bytes","func":"bytes = msg.payload[0].rx_bytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[0].rx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[0].rx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[0].rx_units = sizes[i];\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":800,"wires":[["8e30ba54.5e75b8"]]},{"id":"b2faf3ad.5078a","type":"moment","z":"fa272026.a5eb2","name":"","topic":"","input":"payload.speedtest_lastrun","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"fromNow","locale":"C","output":"payload.speedtest_lastrun_clean","outputType":"msg","outTz":"Australia/Sydney","x":920,"y":840,"wires":[["ab2ad1b0.e2144"]]},{"id":"77474778.22abd","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"InfluxDBSize","query":"SELECT max(\"diskBytes\")/1024/1024 AS \"value\" FROM \"_internal\".\"monitor\".\"shard\" WHERE time > now() - 1m AND \"database\"='adsb' FILL(null) tz('Australia/Sydney')","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":20,"wires":[["2f6cf634.bdae72"]]},{"id":"2f6cf634.bdae72","type":"split","z":"fa272026.a5eb2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":650,"y":20,"wires":[["fc09a2d1.e54b4"]]},{"id":"fc09a2d1.e54b4","type":"ha-entity","z":"fa272026.a5eb2","name":"ADSB InfluxDB Size","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"influxdb_size_adsb"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:database-settings"},{"property":"unit_of_measurement","value":"Mb"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.value, 2)","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":870,"y":20,"wires":[[]]},{"id":"5e63ec8d.524a84","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW_1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw_1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload[1].name","stateType":"msg","attributes":[{"property":"model","value":"payload[1].model","valueType":"msg"},{"property":"version","value":"payload[1].version","valueType":"msg"},{"property":"serial","value":"payload[1].serial","valueType":"msg"},{"property":"sitename","value":"payload[1].site_name","valueType":"msg"},{"property":"type","value":"payload[1].type","valueType":"msg"},{"property":"controller","value":"payload[1].source","valueType":"msg"},{"property":"uptime","value":"payload[1].uptime_clean","valueType":"msg"},{"property":"rx_data","value":"payload[1].rx_clean","valueType":"msg"},{"property":"tx_data","value":"payload[1].tx_clean","valueType":"msg"},{"property":"lastseen","value":"payload[1].lastseen_clean","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1190,"y":600,"wires":[[]]},{"id":"a6e2263c.86e5c8","type":"moment","z":"fa272026.a5eb2","name":"","topic":"","input":"payload[1].lastseen","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"fromNow","locale":"C","output":"payload[1].lastseen_clean","outputType":"msg","outTz":"Australia/Sydney","x":940,"y":620,"wires":[["5e63ec8d.524a84"]]},{"id":"a94ab0a3.ecc24","type":"function","z":"fa272026.a5eb2","name":"RX Bytes","func":"bytes = msg.payload[1].rxbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[1].rx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[1].rx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[1].rx_units = sizes[i];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":620,"wires":[["426b7a9c.456c74"]]},{"id":"426b7a9c.456c74","type":"function","z":"fa272026.a5eb2","name":"Uptime","func":"time = msg.payload[1].Uptime;\n\nminutes = ((time % 3600) / 60);\nif (minutes === 0) {\n  minutes = \"\";\n} else {\n  minutes = parseInt(minutes) + \"min\"\n}\n \nhours = ((time % 86400) / 3600);\nif (hours === 0) {\n  hours = \"\";\n} else {\n  hours = parseInt(hours) + \"hr \"\n}\n\ndays = (time / 86400);\nif (days === 0) {\n  days = \"\";\n} else {\n  days = parseInt(days) + \"d \"\n}\n \nmsg.payload[1].uptime_clean = days + hours + minutes;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":660,"wires":[["540fd37f.08c9ac"]]},{"id":"540fd37f.08c9ac","type":"function","z":"fa272026.a5eb2","name":"TX Bytes","func":"bytes = msg.payload[1].txbytes;\nconst sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n \nif (bytes === 0) {\n  return \"n/a\";\n}\n \nconst i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)));\n \n  if (i === 0) {\n    return bytes + \" \" + sizes[i];\n  }\n \nmsg.payload[1].tx_clean = (bytes / Math.pow(1000, i)).toFixed(1) + \" \" + sizes[i];\nmsg.payload[1].tx = (bytes / Math.pow(1000, 3)).toFixed(1);\nmsg.payload[1].tx_units = sizes[i];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":700,"wires":[["a6e2263c.86e5c8","4f06ab2a.82eeb4","8fe1ef33.7ab9f"]]},{"id":"8fe1ef33.7ab9f","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW_1_RX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw_1_rx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload[1].rx","stateType":"msg","attributes":[{"property":"units","value":"payload[1].rx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1210,"y":660,"wires":[[]]},{"id":"4f06ab2a.82eeb4","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_USW_1_TX","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"unifipoller_usw_1_tx"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:router"},{"property":"unit_of_measurement","value":"GB"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload[1].tx","stateType":"msg","attributes":[{"property":"units","value":"payload[1].tx_units","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1210,"y":720,"wires":[[]]},{"id":"f91dc03d.3c49e","type":"influxdb in","z":"fa272026.a5eb2","influxdb":"ae13dda.6b5d8a","name":"UniFi_UAP_SSID","query":"SELECT last(\"num_sta\") as clients FROM \"unifi\".\"autogen\".\"uap_vaps\" WHERE time >= now() - 5m GROUP BY \"essid\" FILL(null)","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":390,"y":940,"wires":[["944c53df.2090b","199b69d1.723e46"]]},{"id":"944c53df.2090b","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_UAP_SSID","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"UniFiPoller_UAP_SSID"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:wifi"},{"property":"unit_of_measurement","value":"Clients"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[0].clients","stateType":"msg","attributes":[{"property":"SSID","value":"payload[0].essid","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1040,"y":940,"wires":[[]]},{"id":"199b69d1.723e46","type":"ha-entity","z":"fa272026.a5eb2","name":"UniFiPoller_UAP_SSID_1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"UniFiPoller_UAP_SSID_1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:wifi"},{"property":"unit_of_measurement","value":"Clients"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[1].clients","stateType":"msg","attributes":[{"property":"SSID","value":"payload[1].essid","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1050,"y":980,"wires":[[]]},{"id":"a1311251.739f98","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 60) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":260,"wires":[["dedbc385.8b55a8"]]},{"id":"59289f36.b911f","type":"inject","z":"babf8c24.5d5728","name":"1MinInt","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":100,"y":200,"wires":[["a1311251.739f98","50c334b3.880b24","3419f6b4.adcb7a","be82ecac.5edef","b08cd2a3.50aed","3c285f81.0549e","35fa15fa.ac4762","39bdeabb.dc4a06"]]},{"id":"dedbc385.8b55a8","type":"function","z":"babf8c24.5d5728","name":"1 Hour AEP","func":"\nvar _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 8.87;\nvar _ey6 = 10.2;\nvar _ey4 = 12.5;\nvar _ey3 = 14.3;\nvar _ey2 = 16.8;\nvar _ey1 = 21.5;\nvar _ey050 = 26.8;\nvar _ey020 = 33.3;\n\nvar _aep10 = 38.8;\nvar _aep5 = 45.0;\nvar _aep2 = 53.5;\nvar _aep1 = 60.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;  \nreturn msg;","outputs":1,"noerr":0,"x":550,"y":260,"wires":[["eacc18d7.fafa68"]]},{"id":"eacc18d7.fafa68","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":260,"wires":[["931e8b5d.3ecd48"]]},{"id":"50c334b3.880b24","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 20) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":180,"wires":[["d9774d2b.b19168"]]},{"id":"d9774d2b.b19168","type":"function","z":"babf8c24.5d5728","name":"20 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 16.7;\nvar _ey6 = 19.4;\nvar _ey4 = 24.4;\nvar _ey3 = 28.0;\nvar _ey2 = 33.3;\nvar _ey1 = 42.8;\nvar _ey050 = 53.6;\nvar _ey020 = 67.4;\n\nvar _aep10 = 78.4;\nvar _aep5 = 90.7;\nvar _aep2 = 107;\nvar _aep1 = 121;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":180,"wires":[["e05ed553.1cce5"]]},{"id":"e05ed553.1cce5","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":180,"wires":[["86ffd3e7.43fa88"]]},{"id":"3419f6b4.adcb7a","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 10) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":140,"wires":[["e5fcb88.a0e16c8"]]},{"id":"e5fcb88.a0e16c8","type":"function","z":"babf8c24.5d5728","name":"10 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 23.4;\nvar _ey6 = 27.4;\nvar _ey4 = 34.5;\nvar _ey3 = 39.7;\nvar _ey2 = 47.1;\nvar _ey1 = 60.1;\nvar _ey050 = 75.4;\nvar _ey020 = 94.5;\n\nvar _aep632 = 60.1;\nvar _aep50 = 67.9;\nvar _aep20 = 92.7;\nvar _aep10 = 110;\nvar _aep5 = 127;\nvar _aep2 = 150;\nvar _aep1 = 168;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep632){ \n    _AEP = (63.2);  \n}\nif (msg.payload[0].max>_aep50){ \n    _AEP = (50);  \n}\nif (msg.payload[0].max>_aep20){ \n    _AEP = (20);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":140,"wires":[["71fe3e28.87004"]]},{"id":"71fe3e28.87004","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":140,"wires":[["1f05af3.bd51451"]]},{"id":"be82ecac.5edef","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 120) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":300,"wires":[["bac099ff.67ad6"]]},{"id":"bac099ff.67ad6","type":"function","z":"babf8c24.5d5728","name":"2 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 5.75;\nvar _ey6 = 6.56;\nvar _ey4 = 7.96;\nvar _ey3 = 9.01;\nvar _ey2 = 10.5;\nvar _ey1 = 13.3;\nvar _ey050 = 16.5;\nvar _ey020 = 20.3;\n\nvar _aep10 = 23.6;\nvar _aep5 = 27.3;\nvar _aep2 = 31.3;\nvar _aep1 = 36.3;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":300,"wires":[["50dd6eea.3a5fa"]]},{"id":"50dd6eea.3a5fa","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":300,"wires":[["d659df36.30d61"]]},{"id":"931e8b5d.3ecd48","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":260,"wires":[["3e7de169.4cf3ce"]]},{"id":"d659df36.30d61","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":300,"wires":[["4b8ffd88.01a24c"]]},{"id":"86ffd3e7.43fa88","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":180,"wires":[["ae64dbe3.1e2d2"]]},{"id":"1f05af3.bd51451","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":140,"wires":[["5b2a34dc.cc5e94"]]},{"id":"b08cd2a3.50aed","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 360) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":340,"wires":[["17ae15c5.221a52"]]},{"id":"17ae15c5.221a52","type":"function","z":"babf8c24.5d5728","name":"6 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 2.77;\nvar _ey6 = 3.15;\nvar _ey4 = 3.81;\nvar _ey3 = 4.29;\nvar _ey2 = 4.99;\nvar _ey1 = 6.23;\nvar _ey050 = 7.7;\nvar _ey020 = 9.3;\n\nvar _aep10 = 10.7;\nvar _aep5 = 12.3;\nvar _aep2 = 14.4;\nvar _aep1 = 16.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n    _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":340,"wires":[["35d2a262.1d824e"]]},{"id":"35d2a262.1d824e","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":340,"wires":[["d5891f.053fa6e"]]},{"id":"d5891f.053fa6e","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":340,"wires":[["9c32ef9e.198c5"]]},{"id":"9c32ef9e.198c5","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_6hour_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_6hour_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"7","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":340,"wires":[[]]},{"id":"4b8ffd88.01a24c","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_2hour_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_2hour_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"6","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":300,"wires":[[]]},{"id":"3e7de169.4cf3ce","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_1hour_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_1hour_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"5","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":260,"wires":[[]]},{"id":"ae64dbe3.1e2d2","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_20Min_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_20Min_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"3","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":180,"wires":[[]]},{"id":"5b2a34dc.cc5e94","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_10Min_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_10Min_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"2","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":140,"wires":[[]]},{"id":"7adf6a24.60dba4","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 360) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":760,"wires":[["aac34741.ca143"]]},{"id":"aac34741.ca143","type":"function","z":"babf8c24.5d5728","name":"6 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 2.77;\nvar _ey6 = 3.15;\nvar _ey4 = 3.81;\nvar _ey3 = 4.29;\nvar _ey2 = 4.99;\nvar _ey1 = 6.23;\nvar _ey050 = 7.7;\nvar _ey020 = 9.3;\n\nvar _aep10 = 10.7;\nvar _aep5 = 12.3;\nvar _aep2 = 14.4;\nvar _aep1 = 16.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n    _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":760,"wires":[["40072e21.fbc6b8"]]},{"id":"40072e21.fbc6b8","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":760,"wires":[["f64a02c0.541f1"]]},{"id":"f64a02c0.541f1","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":760,"wires":[["c5d24e79.cdf26"]]},{"id":"c5d24e79.cdf26","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_6hour_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_6hour_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"7","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":760,"wires":[[]]},{"id":"ef251fbb.961f4","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 20) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":600,"wires":[["eef88c2c.5eb148"]]},{"id":"eef88c2c.5eb148","type":"function","z":"babf8c24.5d5728","name":"20 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 16.7;\nvar _ey6 = 19.4;\nvar _ey4 = 24.4;\nvar _ey3 = 28.0;\nvar _ey2 = 33.3;\nvar _ey1 = 42.8;\nvar _ey050 = 53.6;\nvar _ey020 = 67.4;\n\nvar _aep10 = 78.4;\nvar _aep5 = 90.7;\nvar _aep2 = 107;\nvar _aep1 = 121;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":600,"wires":[["26320ad0.a2071e"]]},{"id":"26320ad0.a2071e","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":600,"wires":[["db6b1c0e.8ec99"]]},{"id":"db6b1c0e.8ec99","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":600,"wires":[["1c6730fe.5720d7"]]},{"id":"1c6730fe.5720d7","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_20Min_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_20Min_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"3","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":600,"wires":[[]]},{"id":"3c285f81.0549e","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 5) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":100,"wires":[["4e7acad4.d320ac"]]},{"id":"4e7acad4.d320ac","type":"function","z":"babf8c24.5d5728","name":"5 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 30.7;\nvar _ey6 = 35.9;\nvar _ey4 = 44.9;\nvar _ey3 = 51.4;\nvar _ey2 = 60.5;\nvar _ey1 = 76.3;\nvar _ey050 = 95.3;\nvar _ey020 = 119;\n\n\nvar _aep10 = 138;\nvar _aep5 = 160;\nvar _aep2 = 189;\nvar _aep1 = 212;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":100,"wires":[["d55605f4.1ce59"]]},{"id":"d55605f4.1ce59","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":100,"wires":[["f0aa00a1.4945f8","81269092.81f77"]]},{"id":"f0aa00a1.4945f8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":100,"wires":[["fedcc9b8.2176b8"]]},{"id":"fedcc9b8.2176b8","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_5Min_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_5Min_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"1","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":100,"wires":[[]]},{"id":"c02ed359.50f178","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 60) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":680,"wires":[["e43bf5ca.bf9718"]]},{"id":"e43bf5ca.bf9718","type":"function","z":"babf8c24.5d5728","name":"1 Hour AEP","func":"\nvar _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 8.87;\nvar _ey6 = 10.2;\nvar _ey4 = 12.5;\nvar _ey3 = 14.3;\nvar _ey2 = 16.8;\nvar _ey1 = 21.5;\nvar _ey050 = 26.8;\nvar _ey020 = 33.3;\n\nvar _aep10 = 38.8;\nvar _aep5 = 45.0;\nvar _aep2 = 53.5;\nvar _aep1 = 60.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;  \nreturn msg;","outputs":1,"noerr":0,"x":570,"y":680,"wires":[["afb81932.41df8"]]},{"id":"afb81932.41df8","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":680,"wires":[["c40dc2c3.b941c8"]]},{"id":"776ddf3.62b95a","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 120) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":720,"wires":[["b0df9678.010fd"]]},{"id":"b0df9678.010fd","type":"function","z":"babf8c24.5d5728","name":"2 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 5.75;\nvar _ey6 = 6.56;\nvar _ey4 = 7.96;\nvar _ey3 = 9.01;\nvar _ey2 = 10.5;\nvar _ey1 = 13.3;\nvar _ey050 = 16.5;\nvar _ey020 = 20.3;\n\nvar _aep10 = 23.6;\nvar _aep5 = 27.3;\nvar _aep2 = 31.3;\nvar _aep1 = 36.3;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":720,"wires":[["b0fdbdb7.27eeb8"]]},{"id":"b0fdbdb7.27eeb8","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":720,"wires":[["32229d8d.a4ab72"]]},{"id":"c40dc2c3.b941c8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":680,"wires":[["20278b5a.8e2fa4"]]},{"id":"32229d8d.a4ab72","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":720,"wires":[["2b1fa0f5.064bf"]]},{"id":"2b1fa0f5.064bf","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_2hour_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_2hour_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"6","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":720,"wires":[[]]},{"id":"20278b5a.8e2fa4","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_1hour_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_1hour_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"5","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":680,"wires":[[]]},{"id":"ab12b2e0.bc08b","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 10) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":560,"wires":[["e888c6ab.9c13d"]]},{"id":"e888c6ab.9c13d","type":"function","z":"babf8c24.5d5728","name":"10 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 23.4;\nvar _ey6 = 27.4;\nvar _ey4 = 34.5;\nvar _ey3 = 39.7;\nvar _ey2 = 47.1;\nvar _ey1 = 60.1;\nvar _ey050 = 75.4;\nvar _ey020 = 94.5;\n\nvar _aep632 = 60.1;\nvar _aep50 = 67.9;\nvar _aep20 = 92.7;\nvar _aep10 = 110;\nvar _aep5 = 127;\nvar _aep2 = 150;\nvar _aep1 = 168;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep632){ \n    _AEP = (63.2);  \n}\nif (msg.payload[0].max>_aep50){ \n    _AEP = (50);  \n}\nif (msg.payload[0].max>_aep20){ \n    _AEP = (20);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":560,"wires":[["8e94b36a.30142"]]},{"id":"8e94b36a.30142","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":560,"wires":[["57c0dfc1.7efbf"]]},{"id":"57c0dfc1.7efbf","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":560,"wires":[["842f01fc.12319"]]},{"id":"842f01fc.12319","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_10Min_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_10Min_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"2","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":560,"wires":[[]]},{"id":"4f87820f.bf4134","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 5) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":520,"wires":[["cb72646d.c3dd18"]]},{"id":"cb72646d.c3dd18","type":"function","z":"babf8c24.5d5728","name":"5 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 30.7;\nvar _ey6 = 35.9;\nvar _ey4 = 44.9;\nvar _ey3 = 51.4;\nvar _ey2 = 60.5;\nvar _ey1 = 76.3;\nvar _ey050 = 95.3;\nvar _ey020 = 119;\n\n\nvar _aep10 = 138;\nvar _aep5 = 160;\nvar _aep2 = 189;\nvar _aep1 = 212;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":520,"wires":[["808ffc9d.2496f8"]]},{"id":"808ffc9d.2496f8","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":520,"wires":[["83fa54b8.57a97"]]},{"id":"83fa54b8.57a97","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":520,"wires":[["b16ef0f7.52011"]]},{"id":"b16ef0f7.52011","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_5Min_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_5Min_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"1","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":520,"wires":[[]]},{"id":"928ce415.2ac6d8","type":"inject","z":"babf8c24.5d5728","name":"1HrInterval","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":620,"wires":[["4f87820f.bf4134","ab12b2e0.bc08b","ef251fbb.961f4","c02ed359.50f178","776ddf3.62b95a","7adf6a24.60dba4","82639dc0.c50e9","e597aa99.33fab8","c76024ab.3c2528"]]},{"id":"35fa15fa.ac4762","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 720) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":380,"wires":[["ef9ae4b1.004d48"]]},{"id":"ef9ae4b1.004d48","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"msg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":380,"wires":[["be2ec884.15913"]]},{"id":"be2ec884.15913","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":380,"wires":[["a46c4c29.03c6a"]]},{"id":"a46c4c29.03c6a","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":380,"wires":[["ac2847d2.af37a8"]]},{"id":"ac2847d2.af37a8","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_12hour_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_12hour_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"8","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":380,"wires":[[]]},{"id":"39bdeabb.dc4a06","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 1440) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":420,"wires":[["fc747504.ced878"]]},{"id":"fc747504.ced878","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"msg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":420,"wires":[["708f425f.74b6d4"]]},{"id":"708f425f.74b6d4","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":420,"wires":[["f52249d9.748438"]]},{"id":"f52249d9.748438","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":420,"wires":[["3016229d.895e2e"]]},{"id":"3016229d.895e2e","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_24hour_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_24hour_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"9","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":420,"wires":[[]]},{"id":"82639dc0.c50e9","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 720) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":800,"wires":[["c422997f.7021d8"]]},{"id":"c422997f.7021d8","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"\nmsg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":800,"wires":[["dfb45bfb.0943f"]]},{"id":"dfb45bfb.0943f","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":800,"wires":[["5b6a0eca.09ffc8"]]},{"id":"5b6a0eca.09ffc8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":800,"wires":[["764432ce.ee9c0c"]]},{"id":"764432ce.ee9c0c","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_12hour_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_12hour_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"8","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1220,"y":800,"wires":[[]]},{"id":"e597aa99.33fab8","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 1440) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":840,"wires":[["21403932.14b00e"]]},{"id":"21403932.14b00e","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"\nmsg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":840,"wires":[["2cab9e8b.f4870a"]]},{"id":"2cab9e8b.f4870a","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":840,"wires":[["b881f060.648f18"]]},{"id":"b881f060.648f18","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":840,"wires":[["52f7e32c.552f04"]]},{"id":"52f7e32c.552f04","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_24hour_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_24hour_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"9","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1220,"y":840,"wires":[[]]},{"id":"44c71055.ae06","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 60) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1100,"wires":[["7cdac423.950374"]]},{"id":"9486b068.8912b8","type":"inject","z":"babf8c24.5d5728","d":true,"name":"1MinInt","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":960,"wires":[["44c71055.ae06","bfecfe87.f71dc","e945b5cc.bb72c8","ced74fed.50b78","4d3e979.440d3e8","c71e5ded.bae138","39ba4f2b.5d31a8","6dd79c52.10fc74"]]},{"id":"7cdac423.950374","type":"function","z":"babf8c24.5d5728","name":"1 Hour AEP","func":"\nvar _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 8.87;\nvar _ey6 = 10.2;\nvar _ey4 = 12.5;\nvar _ey3 = 14.3;\nvar _ey2 = 16.8;\nvar _ey1 = 21.5;\nvar _ey050 = 26.8;\nvar _ey020 = 33.3;\n\nvar _aep10 = 38.8;\nvar _aep5 = 45.0;\nvar _aep2 = 53.5;\nvar _aep1 = 60.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;  \nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1100,"wires":[["acbf6be3.5174d"]]},{"id":"acbf6be3.5174d","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1100,"wires":[["3b134948.878846"]]},{"id":"bfecfe87.f71dc","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 20) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1020,"wires":[["22295e71.644c62"]]},{"id":"22295e71.644c62","type":"function","z":"babf8c24.5d5728","name":"20 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 16.7;\nvar _ey6 = 19.4;\nvar _ey4 = 24.4;\nvar _ey3 = 28.0;\nvar _ey2 = 33.3;\nvar _ey1 = 42.8;\nvar _ey050 = 53.6;\nvar _ey020 = 67.4;\n\nvar _aep10 = 78.4;\nvar _aep5 = 90.7;\nvar _aep2 = 107;\nvar _aep1 = 121;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1020,"wires":[["d4cec911.bc57b"]]},{"id":"d4cec911.bc57b","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1020,"wires":[["ea1057d1.98125"]]},{"id":"e945b5cc.bb72c8","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 10) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":980,"wires":[["ab9e438d.11df78"]]},{"id":"ab9e438d.11df78","type":"function","z":"babf8c24.5d5728","name":"10 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 23.4;\nvar _ey6 = 27.4;\nvar _ey4 = 34.5;\nvar _ey3 = 39.7;\nvar _ey2 = 47.1;\nvar _ey1 = 60.1;\nvar _ey050 = 75.4;\nvar _ey020 = 94.5;\n\nvar _aep632 = 60.1;\nvar _aep50 = 67.9;\nvar _aep20 = 92.7;\nvar _aep10 = 110;\nvar _aep5 = 127;\nvar _aep2 = 150;\nvar _aep1 = 168;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep632){ \n    _AEP = (63.2);  \n}\nif (msg.payload[0].max>_aep50){ \n    _AEP = (50);  \n}\nif (msg.payload[0].max>_aep20){ \n    _AEP = (20);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":980,"wires":[["355696c9.920cfa"]]},{"id":"355696c9.920cfa","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":980,"wires":[["55b10423.f2c474"]]},{"id":"ced74fed.50b78","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 120) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1140,"wires":[["4efabc08.a1bd3c"]]},{"id":"4efabc08.a1bd3c","type":"function","z":"babf8c24.5d5728","name":"2 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 5.75;\nvar _ey6 = 6.56;\nvar _ey4 = 7.96;\nvar _ey3 = 9.01;\nvar _ey2 = 10.5;\nvar _ey1 = 13.3;\nvar _ey050 = 16.5;\nvar _ey020 = 20.3;\n\nvar _aep10 = 23.6;\nvar _aep5 = 27.3;\nvar _aep2 = 31.3;\nvar _aep1 = 36.3;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1140,"wires":[["8ae1b22c.3c03d8"]]},{"id":"8ae1b22c.3c03d8","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1140,"wires":[["bd98664f.1fc3d8"]]},{"id":"3b134948.878846","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1100,"wires":[["e9019b55.3f106"]]},{"id":"bd98664f.1fc3d8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1140,"wires":[["f6e1ae0c.c581a8"]]},{"id":"ea1057d1.98125","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1020,"wires":[["ec302af1.dfe74"]]},{"id":"55b10423.f2c474","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":980,"wires":[["2e04cb49.703f74"]]},{"id":"4d3e979.440d3e8","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 360) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1180,"wires":[["a29a8423.f413d"]]},{"id":"a29a8423.f413d","type":"function","z":"babf8c24.5d5728","name":"6 Hour AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 2.77;\nvar _ey6 = 3.15;\nvar _ey4 = 3.81;\nvar _ey3 = 4.29;\nvar _ey2 = 4.99;\nvar _ey1 = 6.23;\nvar _ey050 = 7.7;\nvar _ey020 = 9.3;\n\nvar _aep10 = 10.7;\nvar _aep5 = 12.3;\nvar _aep2 = 14.4;\nvar _aep1 = 16.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n    _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n    _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n    _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1180,"wires":[["60d54c1f.3c66d4"]]},{"id":"60d54c1f.3c66d4","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1180,"wires":[["aacb60ce.9ea5a8"]]},{"id":"aacb60ce.9ea5a8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1180,"wires":[["5c0e3d5e.5133cc"]]},{"id":"5c0e3d5e.5133cc","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_6hour_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_6hour_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"7","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1180,"wires":[[]]},{"id":"f6e1ae0c.c581a8","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_2hour_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_2hour_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"6","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1140,"wires":[[]]},{"id":"e9019b55.3f106","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_1hour_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_1hour_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"5","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1100,"wires":[[]]},{"id":"ec302af1.dfe74","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_20Min_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_20Min_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"3","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1020,"wires":[[]]},{"id":"2e04cb49.703f74","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_10Min_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_10Min_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"2","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":980,"wires":[[]]},{"id":"c71e5ded.bae138","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select time, last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 5) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":940,"wires":[["f601cd56.baac48"]]},{"id":"f601cd56.baac48","type":"function","z":"babf8c24.5d5728","name":"5 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 30.7;\nvar _ey6 = 35.9;\nvar _ey4 = 44.9;\nvar _ey3 = 51.4;\nvar _ey2 = 60.5;\nvar _ey1 = 76.3;\nvar _ey050 = 95.3;\nvar _ey020 = 119;\n\n\nvar _aep10 = 138;\nvar _aep5 = 160;\nvar _aep2 = 189;\nvar _aep1 = 212;\n\n\nif (msg.payload[0].max>_ey12){ \n    _EY = (12);\n}\nif (msg.payload[0].max>_ey6){ \n    _EY = (6);\n}\nif (msg.payload[0].max>_ey4){ \n    _EY = (4);\n}\nif (msg.payload[0].max>_ey3){ \n    _EY = (3);\n}  \nif (msg.payload[0].max>_ey2){ \n    _EY = (2);\n}  \nif (msg.payload[0].max>_ey1){ \n    _EY = (1);\n}   \nif (msg.payload[0].max>_ey050){ \n    _EY = (0.5);\n}\nif (msg.payload[0].max>_ey020){ \n    _EY = (0.2);\n}\nif (msg.payload[0].max>_aep10){ \n    _AEP = (10);  \n}\nif (msg.payload[0].max>_aep5){ \n    _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    _AEP = (2);  \n}\nif (msg.payload[0].max>_aep1){ \n    _AEP = (1);  \n}\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":940,"wires":[["28815fbd.3b7688"]]},{"id":"28815fbd.3b7688","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":940,"wires":[["3d0c97b.8a7c5e8"]]},{"id":"3d0c97b.8a7c5e8","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":940,"wires":[["f77adadb.9106f8","2e84cd7.d0062b2"]]},{"id":"f77adadb.9106f8","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_5Min_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_5Min_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"1","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1220,"y":940,"wires":[[]]},{"id":"39ba4f2b.5d31a8","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 720) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1220,"wires":[["d1519ef0.cfb318"]]},{"id":"d1519ef0.cfb318","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"msg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1220,"wires":[["e1ffc777.61279"]]},{"id":"e1ffc777.61279","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1220,"wires":[["9896a511.f8463"]]},{"id":"9896a511.f8463","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1220,"wires":[["897ee7be.103218"]]},{"id":"897ee7be.103218","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_12hour_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_12hour_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"8","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1220,"wires":[[]]},{"id":"6dd79c52.10fc74","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 1440) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1260,"wires":[["c3ea8120.8ebf68"]]},{"id":"c3ea8120.8ebf68","type":"function","z":"babf8c24.5d5728","name":"X Hour AEP","func":"msg.payload[0].EY = 0;\nmsg.payload[0].AEP = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1260,"wires":[["ac4d20eb.1dd81"]]},{"id":"ac4d20eb.1dd81","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1260,"wires":[["97736262.725318"]]},{"id":"97736262.725318","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1260,"wires":[["69040648.41de6"]]},{"id":"69040648.41de6","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_24hour_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_24hour_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"9","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1260,"wires":[[]]},{"id":"f7816591.1bc868","type":"server-state-changed","z":"babf8c24.5d5728","name":"Rainfall Trigger","server":"873eb379.8e35a","version":3,"exposeToHomeAssistant":true,"haConfig":[{"property":"name","value":"tmp_rainfall_trigger"},{"property":"icon","value":""}],"entityidfilter":"sensor.tempest_st_00056115_rain_today","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":420,"wires":[["6340f6e7.973668","53b128cb.f70968","39bdeabb.dc4a06","35fa15fa.ac4762","b08cd2a3.50aed","be82ecac.5edef","a1311251.739f98","50c334b3.880b24","3419f6b4.adcb7a","3c285f81.0549e","c71e5ded.bae138","e945b5cc.bb72c8","bfecfe87.f71dc","44c71055.ae06","ced74fed.50b78","4d3e979.440d3e8","39ba4f2b.5d31a8","6dd79c52.10fc74","c9e8ef6f.f777e","e6ecc70a.662f98"]]},{"id":"6340f6e7.973668","type":"ha-entity","z":"babf8c24.5d5728","d":true,"name":"Is Raining?","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"tmp_israining"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":310,"y":460,"wires":[[]]},{"id":"53b128cb.f70968","type":"debug","z":"babf8c24.5d5728","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":480,"wires":[]},{"id":"81269092.81f77","type":"debug","z":"babf8c24.5d5728","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":40,"wires":[]},{"id":"eaff5786.6a5518","type":"api-call-service","z":"babf8c24.5d5728","name":"TestService","server":"873eb379.8e35a","version":3,"debugenabled":true,"service_domain":"notify","service":"slack","entityId":"","data":"{\"message\":\"Test\",\"target\":\"#tbsmarthome\",\"data\":{\"blocks\":[{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"*Test*\"}},{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"Test\"}}]}}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":350,"y":880,"wires":[[]]},{"id":"f2ee8c51.4603e","type":"inject","z":"babf8c24.5d5728","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":880,"wires":[["eaff5786.6a5518"]]},{"id":"9e7e821c.502f1","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_30min_Weekly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_30min_Weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"4","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1240,"y":220,"wires":[[]]},{"id":"3918af75.d5fac","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":220,"wires":[["9e7e821c.502f1"]]},{"id":"f37740a8.2f05b","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":220,"wires":[["3918af75.d5fac"]]},{"id":"8d7f208e.93d59","type":"function","z":"babf8c24.5d5728","name":"30 Min AEP","func":"\nvar _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 8.87;\nvar _ey6 = 10.2;\nvar _ey4 = 12.5;\nvar _ey3 = 14.3;\nvar _ey2 = 16.8;\nvar _ey1 = 21.5;\nvar _ey050 = 26.8;\nvar _ey020 = 33.3;\n\nvar _aep10 = 38.8;\nvar _aep5 = 45.0;\nvar _aep2 = 53.5;\nvar _aep1 = 60.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;  \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":220,"wires":[["f37740a8.2f05b"]]},{"id":"c9e8ef6f.f777e","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 7 days","query":"select time, max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 30) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 7d \nAND (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":220,"wires":[["8d7f208e.93d59"]]},{"id":"c76024ab.3c2528","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Max intensity 365 days","query":"select max(\"intensity\") \nfrom(SELECT moving_average(\"deriv\", 30) as intensity \nFROM( SELECT non_negative_derivative(mean(\"value\"), 1h) as deriv \nFROM \"homeassistant\".\"autogen\".\"mm\" \nWHERE time > now() - 365d AND \n(\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' \nor \"entity_id\" = 'weather_outside_rain_24hr' \nor \"entity_id\" = 'tempest_st_00056115_rain_today') \nGROUP BY time(1m)  fill(linear) ) fill(null)) ","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":340,"y":640,"wires":[["3171c641.3c97ba"]]},{"id":"3171c641.3c97ba","type":"function","z":"babf8c24.5d5728","name":"30 Min AEP","func":"var _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 16.7;\nvar _ey6 = 19.4;\nvar _ey4 = 24.4;\nvar _ey3 = 28.0;\nvar _ey2 = 33.3;\nvar _ey1 = 42.8;\nvar _ey050 = 53.6;\nvar _ey020 = 67.4;\n\nvar _aep10 = 78.4;\nvar _aep5 = 90.7;\nvar _aep2 = 107;\nvar _aep1 = 121;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":640,"wires":[["ad9f9cb7.6e6b1"]]},{"id":"ad9f9cb7.6e6b1","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":640,"wires":[["ac108c62.5121"]]},{"id":"ac108c62.5121","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":970,"y":640,"wires":[["5e0712bf.b1fdec"]]},{"id":"5e0712bf.b1fdec","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_30Min_Yearly","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_30Min_Yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.date","valueType":"msg"},{"property":"sort","value":"4","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1210,"y":640,"wires":[[]]},{"id":"57f2b94d.036d48","type":"ha-entity","z":"babf8c24.5d5728","name":"AEP_30min_Last","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"AEP_30min_Last"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm/hr"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.max, 1)","stateType":"jsonata","attributes":[{"property":"AEP","value":"$round(msg.payload.AEP, 1)","valueType":"jsonata"},{"property":"EY","value":"$round(msg.payload.EY, 1)","valueType":"jsonata"},{"property":"Time","value":"payload.max = 0 ? \"No Rain\" : payload.date","valueType":"jsonata"},{"property":"sort","value":"4","valueType":"num"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":1060,"wires":[[]]},{"id":"e101e70f.982f28","type":"moment","z":"babf8c24.5d5728","name":"FormatDate","topic":"","input":"payload.time","inputType":"msg","inTz":"Australia/Sydney","adjAmount":0,"adjType":"days","adjDir":"add","format":"HH:mm DD MMM YYYY","locale":"C","output":"payload.date","outputType":"msg","outTz":"Australia/Sydney","x":990,"y":1060,"wires":[["57f2b94d.036d48"]]},{"id":"5e22d1d2.4586d","type":"split","z":"babf8c24.5d5728","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":770,"y":1060,"wires":[["e101e70f.982f28"]]},{"id":"3de8a906.599806","type":"function","z":"babf8c24.5d5728","name":"30 Min AEP","func":"\nvar _EY=0;\nvar _AEP=0;\n\nvar _ey12 = 8.87;\nvar _ey6 = 10.2;\nvar _ey4 = 12.5;\nvar _ey3 = 14.3;\nvar _ey2 = 16.8;\nvar _ey1 = 21.5;\nvar _ey050 = 26.8;\nvar _ey020 = 33.3;\n\nvar _aep10 = 38.8;\nvar _aep5 = 45.0;\nvar _aep2 = 53.5;\nvar _aep1 = 60.1;\n\n\nif (msg.payload[0].max>_ey12){ \n    var _EY = (12);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey6){ \n    var _EY = (6);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey4){ \n    var _EY = (4);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey3){ \n    var _EY = (3);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey2){ \n    var _EY = (2);\n    var _AEP = (0);  \n}  \nif (msg.payload[0].max>_ey1){ \n    var _EY = (1);\n    var _AEP = (0);  \n}   \nif (msg.payload[0].max>_ey050){ \n    var _EY = (0.5);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_ey020){ \n    var _EY = (0.2);\n    var _AEP = (0);  \n}\nif (msg.payload[0].max>_aep10){ \n    var _AEP = (10);  \n}\n\nif (msg.payload[0].max>_aep5){ \n    var _AEP = (5);  \n}\nif (msg.payload[0].max>_aep2){ \n    var _AEP = (2);  \n}\n\nif (msg.payload[0].max>_aep1){ \n    var _AEP = (1);  \n}\n\nmsg.payload[0].EY = _EY;\nmsg.payload[0].AEP = _AEP;  \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1060,"wires":[["5e22d1d2.4586d"]]},{"id":"e6ecc70a.662f98","type":"influxdb in","z":"babf8c24.5d5728","influxdb":"ae13dda.6b5d8a","name":"Last Intensity","query":"select last(intensity) as max from (SELECT moving_average(\"non_negative_derivative\", 30) as intensity FROM(SELECT non_negative_derivative(mean(\"value\"), 1h) FROM \"homeassistant\".\"autogen\".\"mm\" WHERE (\"entity_id\" = 'netatmo_brisbane_street_rain_sum_rain_24' or \"entity_id\" = 'weather_outside_rain_24hr') AND time > now() - 365d GROUP BY time(1m)  fill(previous)) fill(0)) where intensity > 0","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":310,"y":1060,"wires":[["3de8a906.599806"]]},{"id":"2e84cd7.d0062b2","type":"debug","z":"babf8c24.5d5728","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":900,"wires":[]},{"id":"7aa8028e.75aaac","type":"inject","z":"d7532c8a.7df9e","name":"1MinInt","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":60,"wires":[["dc0dba4a.5943d","3a45014e.1642ce","14d98783.248778","4c893fc8.5fec4","c39468e1.d720d"]]},{"id":"dc0dba4a.5943d","type":"influxdb in","z":"d7532c8a.7df9e","influxdb":"c1d28f3a.999178","name":"MoviesCount","query":"SELECT time, last(\"total\") as value FROM \"varken\".\"varken 30d-1h\".\"Tautulli\" WHERE time >= now() - 3630s AND \"section_name\"='Movies' AND \"type\"='library_stats'","rawOutput":false,"precision":"","retentionPolicy":"","x":370,"y":60,"wires":[["92678c1d.bb106"]]},{"id":"92678c1d.bb106","type":"split","z":"d7532c8a.7df9e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":60,"wires":[["db8dabb7.51f83"]]},{"id":"db8dabb7.51f83","type":"ha-entity","z":"d7532c8a.7df9e","name":"PlexStats_MovieCount","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"PlexStats_MovieCount"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:filmstrip"},{"property":"unit_of_measurement","value":"Movies"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.value","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":860,"y":60,"wires":[[]]},{"id":"3a45014e.1642ce","type":"influxdb in","z":"d7532c8a.7df9e","influxdb":"c1d28f3a.999178","name":"TVShowCount","query":"SELECT time, last(\"total\") as value FROM \"varken\".\"varken 30d-1h\".\"Tautulli\" WHERE time >= now() - 3630s AND \"section_name\"='TV Shows' AND \"type\"='library_stats'","rawOutput":false,"precision":"","retentionPolicy":"","x":380,"y":200,"wires":[["70c3ce22.e5588"]]},{"id":"70c3ce22.e5588","type":"split","z":"d7532c8a.7df9e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":200,"wires":[["943db8e2.eb4428"]]},{"id":"943db8e2.eb4428","type":"ha-entity","z":"d7532c8a.7df9e","name":"PlexStats_TVShowCount","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"PlexStats_TVShowCount"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:television-play"},{"property":"unit_of_measurement","value":"TV Shows"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.value","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":870,"y":200,"wires":[[]]},{"id":"14d98783.248778","type":"influxdb in","z":"d7532c8a.7df9e","influxdb":"c1d28f3a.999178","name":"TVSeasonsCount","query":"SELECT time, last(\"seasons\") as value FROM \"varken\".\"varken 30d-1h\".\"Tautulli\" WHERE time >= now() - 3630s AND \"section_name\"='TV Shows' AND \"type\"='library_stats'","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":240,"wires":[["52432ac0.3caf24"]]},{"id":"52432ac0.3caf24","type":"split","z":"d7532c8a.7df9e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":240,"wires":[["fd053220.3acfa"]]},{"id":"fd053220.3acfa","type":"ha-entity","z":"d7532c8a.7df9e","name":"PlexStats_TVSeasonsCount","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"PlexStats_TVSeasonCount"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:television-play"},{"property":"unit_of_measurement","value":"Seasons"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.value","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":240,"wires":[[]]},{"id":"4c893fc8.5fec4","type":"influxdb in","z":"d7532c8a.7df9e","influxdb":"c1d28f3a.999178","name":"TVEpisodesCount","query":"SELECT time, last(\"episodes\") as value FROM \"varken\".\"varken 30d-1h\".\"Tautulli\" WHERE time >= now() - 3630s AND \"section_name\"='TV Shows' AND \"type\"='library_stats'","rawOutput":false,"precision":"","retentionPolicy":"","x":390,"y":280,"wires":[["3fee3da7.d46692"]]},{"id":"3fee3da7.d46692","type":"split","z":"d7532c8a.7df9e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":280,"wires":[["8fcacd47.e3f83"]]},{"id":"8fcacd47.e3f83","type":"ha-entity","z":"d7532c8a.7df9e","name":"PlexStats_TVEpisodesCount","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"PlexStats_TVEpisodeCount"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:television-play"},{"property":"unit_of_measurement","value":"Episodes"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.value","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":880,"y":280,"wires":[[]]},{"id":"c39468e1.d720d","type":"influxdb in","z":"d7532c8a.7df9e","influxdb":"c1d28f3a.999178","name":"TVShowsAdded24hrs","query":"SELECT difference(distinct(\"episodes\")) as value FROM \"varken\".\"varken 30d-1h\".\"Tautulli\" WHERE (\"type\" = 'library_stats' AND \"section_name\" =~ /^TV Shows$/) AND time >= now() - 24h group by time(1d)","rawOutput":false,"precision":"","retentionPolicy":"","x":400,"y":140,"wires":[["83011213.b2108"]]},{"id":"83011213.b2108","type":"split","z":"d7532c8a.7df9e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":630,"y":140,"wires":[["506bee74.0a6ac8"]]},{"id":"506bee74.0a6ac8","type":"ha-entity","z":"d7532c8a.7df9e","name":"PlexStats_TVShowAdded24Hrs","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"PlexStats_TVShowAdded24Hrs"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:television-play"},{"property":"unit_of_measurement","value":"TV Shows"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.value","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":890,"y":140,"wires":[[]]},{"id":"e7ed4575.4af728","type":"inject","z":"d7532c8a.7df9e","d":true,"name":"","repeat":"120","crontab":"","once":false,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":130,"y":500,"wires":[["c80c3ebc.e0f42"]]},{"id":"3ac709d3.f97cde","type":"http request","z":"d7532c8a.7df9e","d":true,"name":"post to AMBER","method":"POST","ret":"obj","url":"https://api.amberelectric.com.au/prices/listprices","tls":"","x":640,"y":520,"wires":[["35cb1b41.7e6afc","9d4c55ae.b0fbc8"]]},{"id":"c80c3ebc.e0f42","type":"function","z":"d7532c8a.7df9e","d":true,"name":"set payload and headers","func":"msg.headers = 'Content-Type: application/json';\nmsg.payload= '{ \"postcode\": \"2340\" }';\n\nreturn msg;\n","outputs":1,"noerr":0,"x":430,"y":520,"wires":[["3ac709d3.f97cde"]]},{"id":"35cb1b41.7e6afc","type":"debug","z":"d7532c8a.7df9e","d":true,"name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":830,"y":480,"wires":[]},{"id":"cffaf137.0ce64","type":"ha-entity","z":"d7532c8a.7df9e","d":true,"name":"AmberElectric_E1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"amber_currentprice_e1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:transmission-tower"},{"property":"unit_of_measurement","value":"c/kWh"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.buy, 2)","stateType":"jsonata","attributes":[{"property":"Period","value":"payload.latestperiod","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":500,"wires":[[]]},{"id":"f42966a3.ad0fa","type":"debug","z":"d7532c8a.7df9e","d":true,"name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":560,"wires":[]},{"id":"9d4c55ae.b0fbc8","type":"function","z":"d7532c8a.7df9e","d":true,"name":"Split Array","func":"function groupBy(arr, property) {\n  return arr.reduce(function(memo, x) {\n    if (!memo[x[property]]) { memo[x[property]] = []; }\n    memo[x[property]].push(x);\n    return memo;\n  }, {});\n}\n\nvar values = msg.payload.data.variablePricesAndRenewables;\n\nvar o = groupBy(values, 'periodType')\n\n\nmsg.payload[\"actual\"] = o.ACTUAL;\nmsg.payload[\"forecast\"] = o.FORECAST;\n\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":830,"y":520,"wires":[["18dac6b9.81a3f9"]]},{"id":"18dac6b9.81a3f9","type":"function","z":"d7532c8a.7df9e","d":true,"name":"Calculate Price","func":"var _wsale =  parseFloat(msg.payload.actual[msg.payload.actual.length - 1].wholesaleKWHPrice);\nvar _wsalefull = msg.payload.actual[-1];\n\nvar _fixedPriceB;\nvar _fixedPriceS;\nvar _fixedPriceC;\nvar _lossFactorB;\nvar _lossFactorS;\nvar _lossFactorC;\n\nvar _rtailB;\nvar _rtailS;\nvar _rtailC;\n\n_fixedPriceB = parseFloat(msg.payload.data.staticPrices.E1.totalfixedKWHPrice);\n_lossFactorB = parseFloat(msg.payload.data.staticPrices.E1.lossFactor);\n\n_fixedPriceS = parseFloat(msg.payload.data.staticPrices.B1.totalfixedKWHPrice);\n_lossFactorS = parseFloat(msg.payload.data.staticPrices.B1.lossFactor);\n\n_fixedPriceC = parseFloat(msg.payload.data.staticPrices.E2.totalfixedKWHPrice);\n_lossFactorC = parseFloat(msg.payload.data.staticPrices.E2.lossFactor);\n\n\n_rtailB = ((_wsale * _lossFactorB) + _fixedPriceB)/1;\n_rtailS = ((_wsale * _lossFactorS) + _fixedPriceS)/-1;\n_rtailC = ((_wsale * _lossFactorC) + _fixedPriceC)/1;\n\nmsg.payload[\"full\"] = _wsalefull;\nmsg.payload[\"buy\"] = _rtailB;\nmsg.payload[\"sell\"] = _rtailS;\nmsg.payload[\"controlled\"] = _rtailC;\nmsg.payload[\"latestperiod\"] = msg.payload.actual[msg.payload.actual.length - 1].latestPeriod;\n\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":1020,"y":520,"wires":[["f42966a3.ad0fa","cffaf137.0ce64","91249862.5694a","247b555a.f45482"]]},{"id":"91249862.5694a","type":"ha-entity","z":"d7532c8a.7df9e","d":true,"name":"AmberElectric_E2","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"amber_currentprice_e2"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:transmission-tower"},{"property":"unit_of_measurement","value":"c/kWh"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.controlled, 2)","stateType":"jsonata","attributes":[{"property":"Period","value":"payload.latestperiod","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":460,"wires":[[]]},{"id":"247b555a.f45482","type":"ha-entity","z":"d7532c8a.7df9e","d":true,"name":"AmberElectric_B1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"amber_currentprice_b1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:solar-power"},{"property":"unit_of_measurement","value":"c/kWh"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"$round(msg.payload.sell, 2)","stateType":"jsonata","attributes":[{"property":"Period","value":"payload.latestperiod","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","x":1230,"y":420,"wires":[[]]},{"id":"88748f8d.44318","type":"mqtt out","z":"d7532c8a.7df9e","name":"","topic":"weather/thomas","qos":"","retain":"true","broker":"eff459ea.caa6f8","x":360,"y":620,"wires":[]},{"id":"5bb8fed3.c6667","type":"mqtt in","z":"d7532c8a.7df9e","name":"","topic":"weather/loop","qos":"2","datatype":"auto","broker":"c2d1b0f2.af1008","inputs":0,"x":110,"y":620,"wires":[["88748f8d.44318"]]},{"id":"42e9bbf.a31f944","type":"mqtt in","z":"d7532c8a.7df9e","name":"","topic":"weather/aidan/humidity","qos":"2","datatype":"auto","broker":"eff459ea.caa6f8","inputs":0,"x":140,"y":700,"wires":[["ad3923ed.69a52"]]},{"id":"ad3923ed.69a52","type":"ha-entity","z":"d7532c8a.7df9e","name":"Aidan Humidity","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_aidan_humidity"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water-percent"},{"property":"unit_of_measurement","value":"%"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":380,"y":700,"wires":[[]]},{"id":"2594150f.9d3fba","type":"mqtt in","z":"d7532c8a.7df9e","name":"","topic":"weather/aidan/rain","qos":"2","datatype":"auto","broker":"eff459ea.caa6f8","inputs":0,"x":150,"y":760,"wires":[["dceeb46f.6d2508"]]},{"id":"dceeb46f.6d2508","type":"ha-entity","z":"d7532c8a.7df9e","name":"Aidan Rain","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_aidan_rain"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:water"},{"property":"unit_of_measurement","value":"mm"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":370,"y":760,"wires":[[]]},{"id":"53dee0d8.3bb3d","type":"mqtt in","z":"d7532c8a.7df9e","name":"","topic":"weather/aidan/temp","qos":"2","datatype":"auto","broker":"eff459ea.caa6f8","inputs":0,"x":150,"y":820,"wires":[["f8592c3c.34c84"]]},{"id":"f8592c3c.34c84","type":"ha-entity","z":"d7532c8a.7df9e","name":"Aidan Temp","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"weather_aidan_temp"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload","stateType":"jsonata","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":370,"y":820,"wires":[[]]},{"id":"8cc21d54.8d41a","type":"inject","z":"2c268447.85c5c4","name":"30secInt","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":40,"wires":[["a4346df0.47269","6cff0b5c.8fe484","d5eb7986.ffaee8","d4b6569f.813db8","7e7ccf5c.218ca8"]]},{"id":"a4346df0.47269","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Flights_Now","query":"select count(*) as \"no_flights\" from (SELECT count(\"messages\") FROM \"adsb\".\"autogen\".\"adsb_icao\" WHERE time >= now() - 5m GROUP BY \"hex\", \"flight\")","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":40,"wires":[["3eae6cd1.d43354"]]},{"id":"7f24fc6d.dabfb4","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":40,"wires":[["e22cc942.3a94f"]]},{"id":"e22cc942.3a94f","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_flights_now","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_flights_now"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"Flights"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.no_flights_count","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":930,"y":40,"wires":[[]]},{"id":"6cff0b5c.8fe484","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Flights_1Hr","query":"select count(*) as \"no_flights\" from (SELECT count(\"messages\") FROM \"adsb\".\"autogen\".\"adsb_icao\" WHERE time >= now() - 1h GROUP BY \"hex\", \"flight\")","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":80,"wires":[["7dff290f.69bb4"]]},{"id":"edac9102.ddc42","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":80,"wires":[["ac727c28.44b77"]]},{"id":"ac727c28.44b77","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_flights_1hr","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_flights_1hr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"Flights"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.no_flights_count","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":930,"y":80,"wires":[[]]},{"id":"3eae6cd1.d43354","type":"function","z":"2c268447.85c5c4","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload[0] = {\n        no_flights_count: 0,\n        count: 0,\n        average: 0,\n        highest: 0,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":40,"wires":[["7f24fc6d.dabfb4"]]},{"id":"7dff290f.69bb4","type":"function","z":"2c268447.85c5c4","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload[0] = {\n        no_flights_count: 0\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":80,"wires":[["edac9102.ddc42"]]},{"id":"d5eb7986.ffaee8","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Flights_6Hr","query":"select count(*) as \"no_flights\" from (SELECT count(\"messages\") FROM \"adsb\".\"autogen\".\"adsb_icao\" WHERE time >= now() - 6h GROUP BY \"hex\", \"flight\")","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":120,"wires":[["e15565ae.d47498"]]},{"id":"e15565ae.d47498","type":"function","z":"2c268447.85c5c4","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload[0] = {\n        no_flights_count: 0\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":120,"wires":[["c6b2b2a0.e6d1f8"]]},{"id":"c6b2b2a0.e6d1f8","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":120,"wires":[["b0cd82d.0e1088"]]},{"id":"b0cd82d.0e1088","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_flights_6hr","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_flights_6hr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"Flights"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.no_flights_count","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":930,"y":120,"wires":[[]]},{"id":"d4b6569f.813db8","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Flights_12Hr","query":"select count(*) as \"no_flights\" from (SELECT count(\"messages\") FROM \"adsb\".\"autogen\".\"adsb_icao\" WHERE time >= now() - 12h GROUP BY \"hex\", \"flight\")","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":160,"wires":[["e68018f6.fe265"]]},{"id":"e68018f6.fe265","type":"function","z":"2c268447.85c5c4","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload[0] = {\n        no_flights_count: 0\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":160,"wires":[["de5085c9.e4a818"]]},{"id":"de5085c9.e4a818","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":160,"wires":[["b8ba9bae.43ed7"]]},{"id":"b8ba9bae.43ed7","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_flights_12hr","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_flights_12hr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"Flights"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.no_flights_count","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":930,"y":160,"wires":[[]]},{"id":"7e7ccf5c.218ca8","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Flights_24Hr","query":"select count(*) as \"no_flights\" from (SELECT count(\"messages\") FROM \"adsb\".\"autogen\".\"adsb_icao\" WHERE time >= now() - 24h GROUP BY \"hex\", \"flight\")","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":200,"wires":[["edda75c5.34c7d"]]},{"id":"edda75c5.34c7d","type":"function","z":"2c268447.85c5c4","name":"Payload","func":"if (msg.payload.length === 0) {\n    msg.payload[0] = {\n        no_flights_count: 0\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":200,"wires":[["ff16774c.a6dbc8"]]},{"id":"ff16774c.a6dbc8","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":200,"wires":[["35216d50.21fec2"]]},{"id":"35216d50.21fec2","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_flights_24hr","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_flights_24hr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"Flights"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.no_flights_count","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":930,"y":200,"wires":[[]]},{"id":"f43add65.bed378","type":"inject","z":"2c268447.85c5c4","name":"1minInt","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":280,"wires":[["c46f79a.31d9008"]]},{"id":"f24014c9.ac0258","type":"ha-entity","z":"2c268447.85c5c4","name":"flighttracker_maxdistance_km","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"flighttracker_maxdistance_km"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:airplane"},{"property":"unit_of_measurement","value":"km"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.max_dist","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","x":950,"y":280,"wires":[[]]},{"id":"c46f79a.31d9008","type":"influxdb in","z":"2c268447.85c5c4","influxdb":"ae13dda.6b5d8a","name":"Max_Distance","query":"SELECT last(\"max_distance_in_metres\")/1000 AS \"max_dist\" FROM \"readsb\".\"autogen\".\"readsb\" WHERE time <= now() AND \"host\"='readsb'","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":360,"y":280,"wires":[["26342a56.6ad11e"]]},{"id":"26342a56.6ad11e","type":"split","z":"2c268447.85c5c4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":280,"wires":[["f24014c9.ac0258"]]},{"id":"63e7bb0a.6ae134","type":"inject","z":"657d1dd1.9b4644","name":"At Noon every day","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10800","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":180,"wires":[["9d48d179.933be"]]},{"id":"9f002063.27a96","type":"function","z":"657d1dd1.9b4644","name":"Create JSON array","func":"var name;\nvar url;\nvar image;\nvar payload = [];\nvar countDown = 7;\n\nfor (var element of msg.payload.items) {\n    name = element.name;\n    url = element.external_urls.spotify;\n    image = element.images[0].url;\n    if (countDown > 0) {\n        payload.push({\"name\":name,\"url\":url,\"image\": image});\n        countDown = countDown - 1;\n    }\n\n    if (name === \"Mix Tape\") {\n        payload.push({\"name\":name,\"url\":url,\"image\": image});\n    }\n}\n\nmsg.payload = payload;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":180,"wires":[["729bcf47.38701"]]},{"id":"9bade5dc.55a918","type":"change","z":"657d1dd1.9b4644","name":"All daily URLs array","rules":[{"t":"set","p":"dailyurl","pt":"flow","to":"[\"37i9dQZF1E36KiYKgPfxvc\",\"37i9dQZF1E3abc1jxGbwHT\",\"37i9dQZF1E37RVIXYh2Pm0\",\"37i9dQZF1E38DA9zKjcUrB\",\"37i9dQZF1E39pcIk2jWOdc\",\"37i9dQZF1E378GOA9wAzwU\"]","tot":"json"},{"t":"set","p":"payload","pt":"msg","to":"[\"37i9dQZF1E36KiYKgPfxvc\",\"37i9dQZF1E3abc1jxGbwHT\",\"37i9dQZF1E37RVIXYh2Pm0\",\"37i9dQZF1E38DA9zKjcUrB\",\"37i9dQZF1E39pcIk2jWOdc\",\"37i9dQZF1E378GOA9wAzwU\"]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":380,"wires":[["1c1ef24e.35d1ce"]]},{"id":"1c1ef24e.35d1ce","type":"split","z":"657d1dd1.9b4644","name":"Split array","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":780,"y":380,"wires":[["764f0be4.827044"]]},{"id":"764f0be4.827044","type":"delay","z":"657d1dd1.9b4644","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":580,"y":440,"wires":[["aff5f40a.e937c8"]]},{"id":"f8ed9029.6940e","type":"inject","z":"657d1dd1.9b4644","name":"At Noon every day","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 12 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":380,"wires":[["9595d10b.f76ae","ca8651ed.c0a9e"]]},{"id":"11a9b97e.91f827","type":"function","z":"657d1dd1.9b4644","name":"Create JSON array","func":"var daily = flow.get(\"daily\");\n \nif (Object.keys(daily).length === 0) {\n    daily = [];   \n} else {\n    daily = flow.get(\"daily\");\n}\n\nvar name;\nvar label;\nvar url = msg.payload.external_urls.spotify ;\nvar image = msg.payload.images[0].url;\n\nvar res = msg.payload.description.split(\",\");\nif (res.length === 3) {\n    name = res[0] + \",\" + res[1] + \",\";\n    label = res[2].trim();\n} else {\n    name = msg.payload.description;\n}\n\nvar json = { \"name\":name,\"url\":url,\"image\": image,\"label\": label };\n\ndaily.push(json);\n\nmsg.payload = daily;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":500,"wires":[["a7b3f862.c00c58"]]},{"id":"aff5f40a.e937c8","type":"function","z":"657d1dd1.9b4644","name":"Set msg.params","func":"msg.params = [msg.payload]; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":440,"wires":[["1cb9449c.e7bafb"]]},{"id":"1cb9449c.e7bafb","type":"spotify","z":"657d1dd1.9b4644","name":"","auth":"751c95dd.a913ac","api":"getPlaylist","x":570,"y":500,"wires":[["11a9b97e.91f827"]]},{"id":"9595d10b.f76ae","type":"change","z":"657d1dd1.9b4644","name":"","rules":[{"t":"set","p":"daily","pt":"flow","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":380,"wires":[["9bade5dc.55a918"]]},{"id":"a7b3f862.c00c58","type":"change","z":"657d1dd1.9b4644","name":"","rules":[{"t":"set","p":"daily","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":560,"wires":[[]]},{"id":"fe4d18db.5737b8","type":"function","z":"657d1dd1.9b4644","name":"If flow.daily array full yet?","func":"var daily = flow.get(\"daily\");\n \nif (Object.keys(daily).length === 0) {\n    daily = [];   \n} else {\n    daily = flow.get(\"daily\");\n}\n\nvar dailyurl = flow.get(\"dailyurl\");\n\nmsg.payload =  (daily.length == dailyurl.length); \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":640,"wires":[["d6ef51bc.ef23b"]]},{"id":"d6ef51bc.ef23b","type":"switch","z":"657d1dd1.9b4644","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":720,"wires":[["647ab1e3.37495"],["ca8651ed.c0a9e"]]},{"id":"ca8651ed.c0a9e","type":"delay","z":"657d1dd1.9b4644","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":380,"y":640,"wires":[["fe4d18db.5737b8"]]},{"id":"5828102a.5034","type":"comment","z":"657d1dd1.9b4644","name":"Get Daily Mixes","info":"","x":120,"y":340,"wires":[]},{"id":"647ab1e3.37495","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[0].name","stateType":"flow","attributes":[{"property":"image","value":"daily[0].image","valueType":"flow"},{"property":"url","value":"daily[0].url","valueType":"flow"},{"property":"name","value":"daily[0].name","valueType":"flow"},{"property":"label","value":"daily[0].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":560,"y":720,"wires":[["7602a753.a54078"]]},{"id":"8109af43.43503","type":"server-state-changed","z":"657d1dd1.9b4644","name":"Changed Selected Playlist","server":"873eb379.8e35a","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_text.spotify_active_sonos_player_id","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":1000,"wires":[["7a2c6b42.fca014"]]},{"id":"4a445710.e89748","type":"api-call-service","z":"657d1dd1.9b4644","name":"","server":"873eb379.8e35a","version":3,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"{{payload.entity_id}}","data":"","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1080,"wires":[[]]},{"id":"9f224ffa.e3397","type":"function","z":"657d1dd1.9b4644","name":"Create JSON payload","func":"var payload = flow.get(\"selectedplaylist\");\n\nif (payload != \"\") {\n    var entity = msg.payload;\n    payload = '{\"entity_id\":\"' + entity + '\",\"data\":{\"media_content_id\":\"' + payload + '\",\"media_content_type\": \"music\"}}'; \n    payload = JSON.parse(payload);\n}\n\nmsg.payload = payload;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":1080,"wires":[["4a445710.e89748"]]},{"id":"aee49016.dacec","type":"server-state-changed","z":"657d1dd1.9b4644","name":"Changed Spotify Playlist","server":"873eb379.8e35a","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_text.spotify_selected_playlist","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":940,"wires":[["21e6ac3.8654e54"]]},{"id":"21e6ac3.8654e54","type":"change","z":"657d1dd1.9b4644","name":"Set selectedplaylist","rules":[{"t":"set","p":"selectedplaylist","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":940,"wires":[[]]},{"id":"7a2c6b42.fca014","type":"switch","z":"657d1dd1.9b4644","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":400,"y":1000,"wires":[["4cf8374d.d78738"]]},{"id":"4cf8374d.d78738","type":"api-call-service","z":"657d1dd1.9b4644","name":"","server":"873eb379.8e35a","version":3,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.spotify_active_sonos_player_id","data":"{ \"value\": \"\" }","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":610,"y":1000,"wires":[["9f224ffa.e3397"]]},{"id":"7602a753.a54078","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 2","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 2"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[1].name","stateType":"flow","attributes":[{"property":"image","value":"daily[1].image","valueType":"flow"},{"property":"url","value":"daily[1].url","valueType":"flow"},{"property":"name","value":"daily[1].name","valueType":"flow"},{"property":"label","value":"daily[1].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":720,"y":720,"wires":[["82a17460.937a78"]]},{"id":"82a17460.937a78","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 3","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 3"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[2].name","stateType":"flow","attributes":[{"property":"image","value":"daily[2].image","valueType":"flow"},{"property":"url","value":"daily[2].url","valueType":"flow"},{"property":"name","value":"daily[2].name","valueType":"flow"},{"property":"label","value":"daily[2].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":880,"y":720,"wires":[["ac3ad3d4.b9cba"]]},{"id":"ac3ad3d4.b9cba","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 4","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 4"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[3].name","stateType":"flow","attributes":[{"property":"image","value":"daily[3].image","valueType":"flow"},{"property":"url","value":"daily[3].url","valueType":"flow"},{"property":"name","value":"daily[3].name","valueType":"flow"},{"property":"label","value":"daily[3].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":560,"y":780,"wires":[["4dc350c7.63fcd"]]},{"id":"4dc350c7.63fcd","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 5","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 5"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[4].name","stateType":"flow","attributes":[{"property":"image","value":"daily[4].image","valueType":"flow"},{"property":"url","value":"daily[4].url","valueType":"flow"},{"property":"name","value":"daily[4].name","valueType":"flow"},{"property":"label","value":"daily[4].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":720,"y":780,"wires":[["2c92859b.aa5a3a"]]},{"id":"2c92859b.aa5a3a","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 6","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Daily Mix 6"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"daily[5].name","stateType":"flow","attributes":[{"property":"image","value":"daily[5].image","valueType":"flow"},{"property":"url","value":"daily[5].url","valueType":"flow"},{"property":"name","value":"daily[5].name","valueType":"flow"},{"property":"label","value":"daily[5].label","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":880,"y":780,"wires":[[]]},{"id":"9d48d179.933be","type":"function","z":"657d1dd1.9b4644","name":"Set msg.params","func":"msg.params = [ { limit: 35, offset: 0 }];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":180,"wires":[["fba5e411.c1fbf8"]]},{"id":"729bcf47.38701","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 1","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 1"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[0].name","stateType":"msg","attributes":[{"property":"image","value":"payload[0].image","valueType":"msg"},{"property":"url","value":"payload[0].url","valueType":"msg"},{"property":"name","value":"payload[0].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":340,"y":260,"wires":[["f7c4cd28.837c9"]]},{"id":"f7c4cd28.837c9","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 2","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 2"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[1].name","stateType":"msg","attributes":[{"property":"image","value":"payload[1].image","valueType":"msg"},{"property":"url","value":"payload[1].url","valueType":"msg"},{"property":"name","value":"payload[1].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":560,"y":260,"wires":[["d4fcfb76.0eb2d8"]]},{"id":"d4fcfb76.0eb2d8","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 3","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 3"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[2].name","stateType":"msg","attributes":[{"property":"image","value":"payload[2].image","valueType":"msg"},{"property":"url","value":"payload[2].url","valueType":"msg"},{"property":"name","value":"payload[2].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":780,"y":260,"wires":[["2d87358c.3c4d5a"]]},{"id":"dda584ee.8b58c8","type":"comment","z":"657d1dd1.9b4644","name":"Get the two newest playlists and Mix Tape","info":"","x":200,"y":140,"wires":[]},{"id":"b09c608e.443e4","type":"comment","z":"657d1dd1.9b4644","name":"Actions from HA","info":"","x":160,"y":900,"wires":[]},{"id":"fba5e411.c1fbf8","type":"spotify","z":"657d1dd1.9b4644","name":"","auth":"751c95dd.a913ac","api":"getUserPlaylists","x":580,"y":180,"wires":[["9f002063.27a96"]]},{"id":"2d87358c.3c4d5a","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 4","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 4"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[3].name","stateType":"msg","attributes":[{"property":"image","value":"payload[3].image","valueType":"msg"},{"property":"url","value":"payload[3].url","valueType":"msg"},{"property":"name","value":"payload[3].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":340,"y":320,"wires":[["27bb6201.968a5e"]]},{"id":"27bb6201.968a5e","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 5","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 5"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[4].name","stateType":"msg","attributes":[{"property":"image","value":"payload[4].image","valueType":"msg"},{"property":"url","value":"payload[4].url","valueType":"msg"},{"property":"name","value":"payload[4].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":560,"y":320,"wires":[["baf7cde9.f07a6"]]},{"id":"baf7cde9.f07a6","type":"ha-entity","z":"657d1dd1.9b4644","name":"Sensor 6","server":"873eb379.8e35a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Playlist 6"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:spotify"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload[5].name","stateType":"msg","attributes":[{"property":"image","value":"payload[5].image","valueType":"msg"},{"property":"url","value":"payload[5].url","valueType":"msg"},{"property":"name","value":"payload[5].name","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":780,"y":320,"wires":[[]]},{"id":"eebaee8e.d885e","type":"http in","z":"8ceb400f.e4da4","name":"","url":"/dashboard-endpoint","method":"get","upload":false,"swaggerDoc":"","x":170,"y":140,"wires":[["9bf1665f.3bb228"]]},{"id":"6c25115a.9c2d58","type":"http response","z":"8ceb400f.e4da4","name":"Return JSON Response","statusCode":"200","headers":{},"x":1190,"y":140,"wires":[]},{"id":"9c7df34e.67a9e","type":"template","z":"8ceb400f.e4da4","name":"Format Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n  \"style\": \"{{style}}\",\n  \"title\": \"{{topic}}\",\n  \"content\": \"<b>{{{payload.title.0}}}</b></br>{{payload.description.0}}</br><a href={{payload.link.0}} target=_blank>Read More</a>\"\n}","output":"json","x":930,"y":140,"wires":[["6c25115a.9c2d58","73092206.fae644"]]},{"id":"a615b5ae.4e1cf8","type":"http request","z":"8ceb400f.e4da4","name":"Get News RSS Feed","method":"GET","ret":"txt","paytoqs":false,"url":"http://feeds.bbci.co.uk/news/scotland/rss.xml","tls":"","proxy":"","authType":"","x":420,"y":60,"wires":[["d883bef1.812ff"]]},{"id":"d883bef1.812ff","type":"xml","z":"8ceb400f.e4da4","name":"Convert XML to JSON","property":"payload","attr":"","chr":"","x":700,"y":60,"wires":[["41772ef5.9fc8a8"]]},{"id":"9bf1665f.3bb228","type":"change","z":"8ceb400f.e4da4","name":"Set style, Topic and Payload","rules":[{"t":"set","p":"style","pt":"msg","to":"is-success","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"feed.rss.channel[0].title[0]","tot":"flow"},{"t":"set","p":"payload","pt":"msg","to":"feed.rss.channel[0].item","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":140,"wires":[["77db7a35.7a746c"]]},{"id":"d81cae44.241e3","type":"inject","z":"8ceb400f.e4da4","name":"","repeat":"1800","crontab":"","once":true,"onceDelay":"1","topic":"Every 30 Minutes","payload":"true","payloadType":"bool","x":170,"y":60,"wires":[["a615b5ae.4e1cf8"]]},{"id":"41772ef5.9fc8a8","type":"change","z":"8ceb400f.e4da4","name":"Store in flow.feed","rules":[{"t":"move","p":"payload","pt":"msg","to":"feed","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":60,"wires":[[]]},{"id":"73092206.fae644","type":"debug","z":"8ceb400f.e4da4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1130,"y":100,"wires":[]},{"id":"77db7a35.7a746c","type":"function","z":"8ceb400f.e4da4","name":"Pick Random Item","func":"var length = msg.payload.length\nvar random = Math.floor(Math.random() * length);\n\nmsg.random = random\nmsg.payload = msg.payload[random]\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":140,"wires":[["9c7df34e.67a9e"]]},{"id":"66c94a7a9c936896","type":"RM","z":"8f4f6b1258852080","name":"","device":"08aec2ea4b076adb","action":"learn","remote":"","button":"","fix":1,"RFSweep":"false","x":480,"y":300,"wires":[["dbe16ab9c64876e3"]]},{"id":"333f3554fbe3334e","type":"inject","z":"8f4f6b1258852080","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":300,"wires":[["66c94a7a9c936896"]]},{"id":"dbe16ab9c64876e3","type":"template","z":"8f4f6b1258852080","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload.data}}","output":"str","x":640,"y":300,"wires":[["1e3b586c0d866c40"]]},{"id":"1e3b586c0d866c40","type":"debug","z":"8f4f6b1258852080","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":300,"wires":[]}]