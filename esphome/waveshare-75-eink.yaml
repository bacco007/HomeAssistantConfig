substitutions:
  esp_name: "waveshare_75_eink"
  ip_address: 192.168.1.105
  ip_gw: 192.168.1.1
  ip_netmask: 255.255.255.0

esphome:
  name: ${esp_name}
  comment: ${esp_name}
  includes:
    - common.h

esp32:
  board: esp32dev
  framework:
    type: esp-idf

logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret btpb_apikey

ota:
  - platform: esphome  # Your existing OTA method
  - platform: web_server  # Add this for web-based OTA uploads

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  manual_ip:
    static_ip: ${ip_address}
    gateway: ${ip_gw}
    subnet: ${ip_netmask}
  ap:
    ssid: ${esp_name} Fallback"
    password: !secret ap_password

captive_portal:

web_server:
  port: 80
  include_internal: true

# ---

spi:
  clk_pin: GPIO13
  mosi_pin: GPIO14

display:
  - platform: waveshare_epaper
    cs_pin: GPIO15
    dc_pin: GPIO27
    busy_pin:
      number: GPIO25
      inverted: true
    reset_pin: GPIO26
    reset_duration: 2ms
    #model: 7.50in-bV3
    model: 7.50in-bV3-bwr
    rotation: 180°
    update_interval: 3min
    id: epaper_display

    lambda: |-
      const auto COLOR_WHITE = Color(0, 0, 0); // Inverted for e-ink
      const auto COLOR_BLACK = Color(255, 255, 255); // Inverted for e-ink
      const auto COLOR_RED = Color(255, 0, 0);
      const auto COLOR_GREEN = Color(0, 255, 0);
      const auto COLOR_BLUE = Color(0, 0, 255);
      const auto COLOR_YELLOW = Color(255, 255, 0);
      const auto COLOR_ORANGE = Color(255, 165, 0);
      auto color_off = COLOR_WHITE;
      auto color_on = COLOR_BLACK;

      auto extract_time = [](const char* iso_str) -> std::string {
          // Expected format: YYYY-MM-DDTHH:MM:SS or similar
          std::string s(iso_str);
          if (s.length() >= 16) return s.substr(11, 5);
          return "";
      };

      int currentPage = id(display_page);
      if (currentPage == 0) {
        // page:name "Page 1"
        // page:dark_mode "inherit"
        // page:refresh_type "interval"
        // page:refresh_time ""
        // Clear screen for this page
        it.fill(COLOR_WHITE);
        color_off = COLOR_WHITE;
        color_on = COLOR_BLACK;
        // widget:shape_rect id:w_mjwdwfq0baz14 type:shape_rect x:0 y:450 w:800 h:30 fill:true border:1 color:black border_color:black 
        it.filled_rectangle(0, 450, 800, 30, COLOR_BLACK);
        // widget:datetime id:w_mjwdx59gj55fn type:datetime x:6 y:450 w:236 h:30 format:weekday_day_month time_size:28 date_size:21 color:white text_align:CENTER_LEFT italic:false font_family:"Ubuntu" 
        {
          auto now = id(ha_time).now();
          it.strftime(6, 450, id(font_ubuntu_400_21), COLOR_WHITE, TextAlign::TOP_LEFT, "%A %d %B", now);
        }
        // widget:wifi_signal id:w_mjwdyqavxeyjk type:wifi_signal x:765 y:453 w:24 h:24 entity:wifi_signal_dbm size:24 font_size:12 color:white show_dbm:false local:true 
        {
          const char* wifi_icon = "\U000F092B"; // Default: wifi-strength-alert-outline
          if (id(wifi_signal_dbm).has_state()) {
            float signal = id(wifi_signal_dbm).state;
            if (std::isnan(signal)) signal = -100;
            if (signal >= -50) wifi_icon = "\U000F0928";      // wifi-strength-4 (Excellent)
            else if (signal >= -60) wifi_icon = "\U000F0925"; // wifi-strength-3 (Good)
            else if (signal >= -75) wifi_icon = "\U000F0922"; // wifi-strength-2 (Fair)
            else if (signal >= -100) wifi_icon = "\U000F091F"; // wifi-strength-1 (Weak)
            else wifi_icon = "\U000F092B";                    // wifi-strength-alert-outline
          }
          it.printf(765, 453, id(font_material_design_icons_400_24), COLOR_WHITE, "%s", wifi_icon);
        }
        // widget:weather_icon id:w_mjwdzwcukw4jx type:weather_icon x:744 y:7 w:48 h:48 entity:weather.east_tamworth size:48 color:black 
        {
          std::string weather_state = id(weather_east_tamworth).state;
          const char* icon = "\U000F0599"; // Default: sunny
          if (weather_state == "clear-night") icon = "\U000F0594";
          else if (weather_state == "cloudy") icon = "\U000F0590";
          else if (weather_state == "exceptional") icon = "\U000F0026";
          else if (weather_state == "fog") icon = "\U000F0591";
          else if (weather_state == "hail") icon = "\U000F0592";
          else if (weather_state == "lightning") icon = "\U000F0593";
          else if (weather_state == "lightning-rainy") icon = "\U000F067E";
          else if (weather_state == "partlycloudy") icon = "\U000F0595";
          else if (weather_state == "pouring") icon = "\U000F0596";
          else if (weather_state == "rainy") icon = "\U000F0597";
          else if (weather_state == "snowy") icon = "\U000F0598";
          else if (weather_state == "snowy-rainy") icon = "\U000F067F";
          else if (weather_state == "sunny") icon = "\U000F0599";
          else if (weather_state == "windy") icon = "\U000F059D";
          else if (weather_state == "windy-variant") icon = "\U000F059E";
          it.printf(744, 7, id(font_material_design_icons_400_48), COLOR_BLACK, "%s", icon);
        }
        // widget:sensor_text id:w_mjwe0nzpkn7sj type:sensor_text x:606 y:5 w:131 h:52 ent:sensor.weather_temperature entity_2: title:"[Weather] Temperature" format:value_only label_font:40 value_font:40 color:black label_align:CENTER value_align:CENTER precision:1 unit:"" hide_unit:false prefix:"" postfix:"" separator:"~" local:false text_sensor:false font_family:"Ubuntu" font_weight:700 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.1f", id(sensor_weather_temperature).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "" + sensorValue + "°C" + "";
          it.printf(606 + 131/2, 5 + 52/2, id(font_ubuntu_700_40), COLOR_BLACK, TextAlign::CENTER, "%s", fullValue.c_str());
        }
        // widget:weather_forecast id:w_mjwe92bggsldj type:weather_forecast x:715 y:59 w:82 h:383 weather_entity:"weather.east_tamworth" layout:vertical show_high_low:true day_font_size:15 temp_font_size:15 icon_size:20 font_family:"Ubuntu" color:black 
        {
          static std::map<std::string, const char*> weather_icons = {
            {"clear-night", "\U000F0594"}, {"cloudy", "\U000F0590"},
            {"exceptional", "\U000F0026"}, {"fog", "\U000F0591"},
            {"hail", "\U000F0592"}, {"lightning", "\U000F0593"},
            {"lightning-rainy", "\U000F067E"}, {"partlycloudy", "\U000F0595"},
            {"pouring", "\U000F0596"}, {"rainy", "\U000F0597"},
            {"snowy", "\U000F0598"}, {"snowy-rainy", "\U000F067F"},
            {"sunny", "\U000F0599"}, {"windy", "\U000F059D"},
            {"windy-variant", "\U000F059E"}
          };
          auto get_icon = [&](const std::string& cond) -> const char* {
            return weather_icons.count(cond) ? weather_icons[cond] : "\U000F0590";
          };
          auto get_day_name = [](int offset) -> std::string {
            if (offset == 0) return "Today";
            auto t = id(ha_time).now();
            if (!t.is_valid()) return "---";
            ESPTime future = ESPTime::from_epoch_local(t.timestamp + (offset * 86400));
            char buf[8]; future.strftime(buf, sizeof(buf), "%a");
            return std::string(buf);
          };
          {
            int dx = 715; int dy = 59;
            it.printf(dx + 41, dy, id(font_ubuntu_700_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_day_name(0).c_str());
            std::string cond = id(weather_cond_day0).state;
            it.printf(dx + 41, dy + 19, id(font_material_design_icons_400_20), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_icon(cond));
            float high = id(weather_high_day0).state; float low = id(weather_low_day0).state;
            if (!std::isnan(high) && !std::isnan(low)) {
              it.printf(dx + 41, dy + 43, id(font_ubuntu_400_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%.0f/%.0f", high, low);
            }
          }
          {
            int dx = 715; int dy = 135;
            it.printf(dx + 41, dy, id(font_ubuntu_700_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_day_name(1).c_str());
            std::string cond = id(weather_cond_day1).state;
            it.printf(dx + 41, dy + 19, id(font_material_design_icons_400_20), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_icon(cond));
            float high = id(weather_high_day1).state; float low = id(weather_low_day1).state;
            if (!std::isnan(high) && !std::isnan(low)) {
              it.printf(dx + 41, dy + 43, id(font_ubuntu_400_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%.0f/%.0f", high, low);
            }
          }
          {
            int dx = 715; int dy = 211;
            it.printf(dx + 41, dy, id(font_ubuntu_700_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_day_name(2).c_str());
            std::string cond = id(weather_cond_day2).state;
            it.printf(dx + 41, dy + 19, id(font_material_design_icons_400_20), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_icon(cond));
            float high = id(weather_high_day2).state; float low = id(weather_low_day2).state;
            if (!std::isnan(high) && !std::isnan(low)) {
              it.printf(dx + 41, dy + 43, id(font_ubuntu_400_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%.0f/%.0f", high, low);
            }
          }
          {
            int dx = 715; int dy = 287;
            it.printf(dx + 41, dy, id(font_ubuntu_700_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_day_name(3).c_str());
            std::string cond = id(weather_cond_day3).state;
            it.printf(dx + 41, dy + 19, id(font_material_design_icons_400_20), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_icon(cond));
            float high = id(weather_high_day3).state; float low = id(weather_low_day3).state;
            if (!std::isnan(high) && !std::isnan(low)) {
              it.printf(dx + 41, dy + 43, id(font_ubuntu_400_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%.0f/%.0f", high, low);
            }
          }
          {
            int dx = 715; int dy = 363;
            it.printf(dx + 41, dy, id(font_ubuntu_700_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_day_name(4).c_str());
            std::string cond = id(weather_cond_day4).state;
            it.printf(dx + 41, dy + 19, id(font_material_design_icons_400_20), COLOR_BLACK, TextAlign::TOP_CENTER, "%s", get_icon(cond));
            float high = id(weather_high_day4).state; float low = id(weather_low_day4).state;
            if (!std::isnan(high) && !std::isnan(low)) {
              it.printf(dx + 41, dy + 43, id(font_ubuntu_400_15), COLOR_BLACK, TextAlign::TOP_CENTER, "%.0f/%.0f", high, low);
            }
          }
        }
        // widget:icon id:w_1767329574886_163_33 type:icon x:525 y:107 w:38 h:37 code:F0E02 size:29 color:black 
        it.printf(525, 107, id(font_material_design_icons_400_29), COLOR_BLACK, "%s", "\U000F0E02");
        // widget:sensor_text id:w_1767329574886_341_94 type:sensor_text x:529 y:111 w:186 h:29 ent:sensor.weather_temperature_today_minimum_display entity_2: title:"[Weather] Temperature Today Maximum" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"" postfix:"" separator:"~" local:false text_sensor:true font_family:"Ubuntu" font_weight:400 italic:false 
        {
          std::string val1 = id(sensor_weather_temperature_today_minimum_display_txt).state;
          std::string sensorValue = val1;
          std::string fullValue = "" + sensorValue + "" + "";
          it.printf(529 + 186, 111 + 29/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767329616788_743_15 type:sensor_text x:529 y:72 w:186 h:29 ent:sensor.weather_temperature_today_maximum_display entity_2: title:"[Weather] Temperature Today Maximum" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"" postfix:"" separator:"~" local:false text_sensor:true font_family:"Ubuntu" font_weight:400 italic:false 
        {
          std::string val1 = id(sensor_weather_temperature_today_maximum_display_txt).state;
          std::string sensorValue = val1;
          std::string fullValue = "" + sensorValue + "" + "";
          it.printf(529 + 186, 72 + 29/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:icon id:w_1767329616788_255_91 type:icon x:525 y:69 w:38 h:37 code:F0E03 size:29 color:black 
        it.printf(525, 69, id(font_material_design_icons_400_29), COLOR_BLACK, "%s", "\U000F0E03");
        // widget:sensor_text id:w_mjwegpk5qny8f type:sensor_text x:597 y:333 w:118 h:35 ent:sensor.weatherflow_rainfall_daily entity_2: title:"" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"T: " postfix:"" separator:"~" local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_weatherflow_rainfall_daily).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "T: " + sensorValue + "mm" + "";
          it.printf(597 + 118, 333 + 35/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767329800554_894_94 type:sensor_text x:597 y:355 w:118 h:35 ent:sensor.weatherflow_rainfall_weekly entity_2: title:"Weatherflow Rainfall (Weekly)" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"W: " postfix:"" separator:"~" local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_weatherflow_rainfall_weekly).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "W: " + sensorValue + "mm" + "";
          it.printf(597 + 118, 355 + 35/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767329817616_192_70 type:sensor_text x:597 y:382 w:118 h:35 ent:sensor.weatherflow_rainfall_monthly entity_2: title:"Weatherflow Rainfall (Weekly)" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"M: " postfix:"" separator:"~" local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_weatherflow_rainfall_monthly).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "M: " + sensorValue + "mm" + "";
          it.printf(597 + 118, 382 + 35/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767329837327_370_53 type:sensor_text x:597 y:406 w:118 h:35 ent:sensor.weatherflow_rainfall_yearly entity_2: title:"Weatherflow Rainfall (Weekly)" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"Y: " postfix:"" separator:"~" local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_weatherflow_rainfall_yearly).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "Y: " + sensorValue + "mm" + "";
          it.printf(597 + 118, 406 + 35/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:icon id:w_1767329895179_437_80 type:icon x:677 y:301 w:38 h:36 code:F0597 size:36 color:black 
        it.printf(677, 301, id(font_material_design_icons_400_36), COLOR_BLACK, "%s", "\U000F0597");
        // widget:sensor_text id:w_mjwixkg88gots type:sensor_text x:32 y:372 w:126 h:29 ent:sensor.moon_rise entity_2: title:"Moon Rise" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"" postfix:"" separator:"~" local:false text_sensor:true font_family:"Ubuntu" font_weight:400 italic:false 
        {
          std::string val1 = id(sensor_moon_rise_txt).state;
          std::string sensorValue = val1;
          std::string fullValue = "" + sensorValue + "" + "";
          it.printf(32 + 126, 372 + 29/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_mjwiy6t3pul6r type:sensor_text x:37 y:401 w:120 h:40 ent:sensor.moon_set entity_2: title:"Moon Set" format:value_only label_font:14 value_font:20 color:black label_align:CENTER_RIGHT value_align:CENTER_RIGHT precision:2 unit:"" hide_unit:false prefix:"" postfix:"" separator:"~" local:false text_sensor:true font_family:"Ubuntu" font_weight:400 italic:false 
        {
          std::string val1 = id(sensor_moon_set_txt).state;
          std::string sensorValue = val1;
          std::string fullValue = "" + sensorValue + "" + "";
          it.printf(37 + 120, 401 + 40/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER_RIGHT, "%s", fullValue.c_str());
        }
        // widget:icon id:w_mjwizyjfzaabf type:icon x:18 y:369 w:38 h:36 code:F1D17 size:29 color:black 
        it.printf(18, 369, id(font_material_design_icons_400_29), COLOR_BLACK, "%s", "\U000F1D17");
        // widget:icon id:w_1767337360808_985_2 type:icon x:18 y:403 w:38 h:36 code:F1D16 size:29 color:black 
        it.printf(18, 403, id(font_material_design_icons_400_29), COLOR_BLACK, "%s", "\U000F1D16");
        // widget:sensor_text id:w_mjxiwcglqbwon type:sensor_text x:306 y:384 w:188 h:27 ent:sensor.sungrow_sg5kd_daily_import_from_grid entity_2: title:"" format:value_only label_font:14 value_font:20 color:black label_align:CENTER value_align:CENTER precision:2 unit:"" hide_unit:false prefix:"From Grid: " postfix:"" separator:" ~ " local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_sungrow_sg5kd_daily_import_from_grid).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "From Grid: " + sensorValue + "kWh" + "";
          it.printf(306 + 188/2, 384 + 27/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767397781687_178_22 type:sensor_text x:306 y:410 w:188 h:27 ent:sensor.sungrow_sg5kd_daily_export_to_grid entity_2: title:"Sungrow SG5KD Daily Export to Grid" format:value_only label_font:14 value_font:20 color:black label_align:CENTER value_align:CENTER precision:2 unit:"" hide_unit:false prefix:"To Grid: " postfix:"" separator:" ~ " local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_sungrow_sg5kd_daily_export_to_grid).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "To Grid: " + sensorValue + "kWh" + "";
          it.printf(306 + 188/2, 410 + 27/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER, "%s", fullValue.c_str());
        }
        // widget:sensor_text id:w_1767397819199_342_44 type:sensor_text x:306 y:357 w:188 h:27 ent:sensor.sungrow_sg5kd_daily_generation entity_2: title:"Sungrow SG5KD Daily Export to Grid" format:value_only label_font:14 value_font:20 color:black label_align:CENTER value_align:CENTER precision:2 unit:"" hide_unit:false prefix:"Gen:  " postfix:"" separator:" ~ " local:false text_sensor:false font_family:"Ubuntu" font_weight:400 italic:false 
        {
          char buf1[32];
          snprintf(buf1, sizeof(buf1), "%.2f", id(sensor_sungrow_sg5kd_daily_generation).state);
          std::string val1 = buf1;
          std::string sensorValue = val1;
          std::string fullValue = "Gen:  " + sensorValue + "kWh" + "";
          it.printf(306 + 188/2, 357 + 27/2, id(font_ubuntu_400_20), COLOR_BLACK, TextAlign::CENTER, "%s", fullValue.c_str());
        }
        // widget:datetime id:w_mjxjby3hbicto type:datetime x:359 y:451 w:83 h:28 format:time_only time_size:28 date_size:16 color:white text_align:CENTER italic:false font_family:"Ubuntu" 
        {
          auto now = id(ha_time).now();
          it.strftime(359 + 83/2, 451, id(font_ubuntu_700_28), COLOR_WHITE, TextAlign::TOP_CENTER, "%H:%M", now);
        }
      }


# ====================================
# Device Settings
# ====================================
# Orientation: landscape
# Dark Mode: disabled
# Refresh Interval: 600
# Power Strategy: Scheduled Night Sleep
# Sleep Start Hour: 22
# Sleep End Hour: 5
# Disable updates from 22 to 5
# ====================================

globals:
  - id: display_page
    type: int
    restore_value: true
    initial_value: '0'
  - id: page_refresh_default_s
    type: int
    restore_value: true
    initial_value: '600'
  - id: page_refresh_current_s
    type: int
    restore_value: false
    initial_value: '60'
  - id: last_page_switch_time
    type: uint32_t
    restore_value: false
    initial_value: '0'

http_request:
  verify_ssl: false
  timeout: 20s

time:
  - platform: homeassistant
    id: ha_time

sensor:
  - platform: homeassistant
    id: sensor_weather_temperature
    entity_id: sensor.weather_temperature
    internal: true
  - platform: homeassistant
    id: sensor_weatherflow_rainfall_daily
    entity_id: sensor.weatherflow_rainfall_daily
    internal: true
  - platform: homeassistant
    id: sensor_weatherflow_rainfall_weekly
    entity_id: sensor.weatherflow_rainfall_weekly
    internal: true
  - platform: homeassistant
    id: sensor_weatherflow_rainfall_monthly
    entity_id: sensor.weatherflow_rainfall_monthly
    internal: true
  - platform: homeassistant
    id: sensor_weatherflow_rainfall_yearly
    entity_id: sensor.weatherflow_rainfall_yearly
    internal: true
  - platform: homeassistant
    id: sensor_sungrow_sg5kd_daily_import_from_grid
    entity_id: sensor.sungrow_sg5kd_daily_import_from_grid
    internal: true
  - platform: homeassistant
    id: sensor_sungrow_sg5kd_daily_export_to_grid
    entity_id: sensor.sungrow_sg5kd_daily_export_to_grid
    internal: true
  - platform: homeassistant
    id: sensor_sungrow_sg5kd_daily_generation
    entity_id: sensor.sungrow_sg5kd_daily_generation
    internal: true
  - platform: homeassistant
    id: weather_high_day0
    entity_id: sensor.weather_forecast_day_0_high
    internal: true
  - platform: homeassistant
    id: weather_low_day0
    entity_id: sensor.weather_forecast_day_0_low
    internal: true
  - platform: homeassistant
    id: weather_high_day1
    entity_id: sensor.weather_forecast_day_1_high
    internal: true
  - platform: homeassistant
    id: weather_low_day1
    entity_id: sensor.weather_forecast_day_1_low
    internal: true
  - platform: homeassistant
    id: weather_high_day2
    entity_id: sensor.weather_forecast_day_2_high
    internal: true
  - platform: homeassistant
    id: weather_low_day2
    entity_id: sensor.weather_forecast_day_2_low
    internal: true
  - platform: homeassistant
    id: weather_high_day3
    entity_id: sensor.weather_forecast_day_3_high
    internal: true
  - platform: homeassistant
    id: weather_low_day3
    entity_id: sensor.weather_forecast_day_3_low
    internal: true
  - platform: homeassistant
    id: weather_high_day4
    entity_id: sensor.weather_forecast_day_4_high
    internal: true
  - platform: homeassistant
    id: weather_low_day4
    entity_id: sensor.weather_forecast_day_4_low
    internal: true
  # WiFi Signal Strength Sensor
  - platform: wifi_signal
    name: "WiFi Signal"
    id: wifi_signal_dbm
    update_interval: 60s

button:
  - platform: template
    name: "Next Page"
    on_press:
      then:
        - script.execute:
            id: change_page_to
            target_page: !lambda 'return id(display_page) + 1;'
  - platform: template
    name: "Previous Page"
    on_press:
      then:
        - script.execute:
            id: change_page_to
            target_page: !lambda 'return id(display_page) - 1;'
  - platform: template
    name: "Refresh Display"
    on_press:
      then:
        - component.update: epaper_display
  - platform: template
    name: "Go to Page 1"
    on_press:
      then:
        - script.execute:
            id: change_page_to
            target_page: 0

text_sensor:
  # Home Assistant Text Sensors
  - platform: homeassistant
    id: sensor_weather_temperature_today_minimum_display_txt
    entity_id: sensor.weather_temperature_today_minimum_display
    internal: true
  - platform: homeassistant
    id: sensor_weather_temperature_today_maximum_display_txt
    entity_id: sensor.weather_temperature_today_maximum_display
    internal: true
  - platform: homeassistant
    id: sensor_moon_rise_txt
    entity_id: sensor.moon_rise
    internal: true
  - platform: homeassistant
    id: sensor_moon_set_txt
    entity_id: sensor.moon_set
    internal: true

  # Weather Entity Sensors
  - platform: homeassistant
    id: weather_east_tamworth
    entity_id: weather.east_tamworth
    internal: true

  # Weather Forecast Condition Sensors
  - platform: homeassistant
    id: weather_cond_day0
    entity_id: sensor.weather_forecast_day_0_condition
    internal: true
  - platform: homeassistant
    id: weather_cond_day1
    entity_id: sensor.weather_forecast_day_1_condition
    internal: true
  - platform: homeassistant
    id: weather_cond_day2
    entity_id: sensor.weather_forecast_day_2_condition
    internal: true
  - platform: homeassistant
    id: weather_cond_day3
    entity_id: sensor.weather_forecast_day_3_condition
    internal: true
  - platform: homeassistant
    id: weather_cond_day4
    entity_id: sensor.weather_forecast_day_4_condition
    internal: true

# ============================================================================
# HOME ASSISTANT TEMPLATE SENSORS
# Add these template sensors to your Home Assistant configuration.yaml:
# ============================================================================
#
# template:
#   - trigger:
#       - trigger: state
#         entity_id: weather.forecast_home  # Replace with your weather entity
#       - trigger: time_pattern
#         hours: "/1"
#     action:
#       - action: weather.get_forecasts
#         target:
#           entity_id: weather.forecast_home  # Replace with your weather entity
#         data:
#           type: daily
#         response_variable: forecast_data
#     sensor:
#       - name: "Weather Forecast Day 0 High"
#         unique_id: weather_forecast_day_0_high
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[0].temperature | default('N/A') }}"
#       - name: "Weather Forecast Day 0 Low"
#         unique_id: weather_forecast_day_0_low
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[0].templow | default('N/A') }}"
#       - name: "Weather Forecast Day 0 Condition"
#         unique_id: weather_forecast_day_0_condition
#         state: "{{ forecast_data['weather.forecast_home'].forecast[0].condition | default('cloudy') }}"
#       - name: "Weather Forecast Day 1 High"
#         unique_id: weather_forecast_day_1_high
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[1].temperature | default('N/A') }}"
#       - name: "Weather Forecast Day 1 Low"
#         unique_id: weather_forecast_day_1_low
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[1].templow | default('N/A') }}"
#       - name: "Weather Forecast Day 1 Condition"
#         unique_id: weather_forecast_day_1_condition
#         state: "{{ forecast_data['weather.forecast_home'].forecast[1].condition | default('cloudy') }}"
#       - name: "Weather Forecast Day 2 High"
#         unique_id: weather_forecast_day_2_high
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[2].temperature | default('N/A') }}"
#       - name: "Weather Forecast Day 2 Low"
#         unique_id: weather_forecast_day_2_low
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[2].templow | default('N/A') }}"
#       - name: "Weather Forecast Day 2 Condition"
#         unique_id: weather_forecast_day_2_condition
#         state: "{{ forecast_data['weather.forecast_home'].forecast[2].condition | default('cloudy') }}"
#       - name: "Weather Forecast Day 3 High"
#         unique_id: weather_forecast_day_3_high
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[3].temperature | default('N/A') }}"
#       - name: "Weather Forecast Day 3 Low"
#         unique_id: weather_forecast_day_3_low
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[3].templow | default('N/A') }}"
#       - name: "Weather Forecast Day 3 Condition"
#         unique_id: weather_forecast_day_3_condition
#         state: "{{ forecast_data['weather.forecast_home'].forecast[3].condition | default('cloudy') }}"
#       - name: "Weather Forecast Day 4 High"
#         unique_id: weather_forecast_day_4_high
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[4].temperature | default('N/A') }}"
#       - name: "Weather Forecast Day 4 Low"
#         unique_id: weather_forecast_day_4_low
#         unit_of_measurement: "°C"
#         state: "{{ forecast_data['weather.forecast_home'].forecast[4].templow | default('N/A') }}"
#       - name: "Weather Forecast Day 4 Condition"
#         unique_id: weather_forecast_day_4_condition
#         state: "{{ forecast_data['weather.forecast_home'].forecast[4].condition | default('cloudy') }}"
#
# ============================================================================

font:
  - file:
      type: gfonts
      family: Roboto
      weight: 400
    id: font_roboto_400_20
    size: 20
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 700
    id: font_ubuntu_700_28
    size: 28
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 400
    id: font_ubuntu_400_21
    size: 21
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: font_material_design_icons_400_24
    size: 24
    glyphs: ["\U000F091F", "\U000F0922", "\U000F0925", "\U000F0928", "\U000F092B"]
  - file:
      type: gfonts
      family: Roboto
      weight: 400
    id: font_roboto_400_12
    size: 12
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: font_material_design_icons_400_48
    size: 48
    glyphs: ["\U000F0026", "\U000F0590", "\U000F0591", "\U000F0592", "\U000F0593", "\U000F0594", "\U000F0595", "\U000F0596", "\U000F0597", "\U000F0598", "\U000F0599", "\U000F059D", "\U000F059E", "\U000F067E", "\U000F067F"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 700
    id: font_ubuntu_700_40
    size: 40
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 700
    id: font_ubuntu_700_15
    size: 15
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 400
    id: font_ubuntu_400_15
    size: 15
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: font_material_design_icons_400_20
    size: 20
    glyphs: ["\U000F0026", "\U000F0590", "\U000F0591", "\U000F0592", "\U000F0593", "\U000F0594", "\U000F0595", "\U000F0596", "\U000F0597", "\U000F0598", "\U000F0599", "\U000F059D", "\U000F059E", "\U000F067E", "\U000F067F"]
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: font_material_design_icons_400_29
    size: 29
    glyphs: ["\U000F0E02", "\U000F0E03", "\U000F1D16", "\U000F1D17"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 400
    id: font_ubuntu_400_14
    size: 14
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 400
    id: font_ubuntu_400_20
    size: 20
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: font_material_design_icons_400_36
    size: 36
    glyphs: ["\U000F0597"]
  - file:
      type: gfonts
      family: Ubuntu
      weight: 400
    id: font_ubuntu_400_16
    size: 16
    glyphs: ["\U00000020", "\U00000021", "\U00000022", "\U00000023", "\U00000024", "\U00000025", "\U00000026", "\U00000027", "\U00000028", "\U00000029", "\U0000002a", "\U0000002b", "\U0000002c", "\U0000002d", "\U0000002e", "\U0000002f", "\U00000030", "\U00000031", "\U00000032", "\U00000033", "\U00000034", "\U00000035", "\U00000036", "\U00000037", "\U00000038", "\U00000039", "\U0000003a", "\U0000003b", "\U0000003c", "\U0000003d", "\U0000003e", "\U0000003f", "\U00000040", "\U00000041", "\U00000042", "\U00000043", "\U00000044", "\U00000045", "\U00000046", "\U00000047", "\U00000048", "\U00000049", "\U0000004a", "\U0000004b", "\U0000004c", "\U0000004d", "\U0000004e", "\U0000004f", "\U00000050", "\U00000051", "\U00000052", "\U00000053", "\U00000054", "\U00000055", "\U00000056", "\U00000057", "\U00000058", "\U00000059", "\U0000005a", "\U0000005b", "\U0000005c", "\U0000005d", "\U0000005e", "\U0000005f", "\U00000060", "\U00000061", "\U00000062", "\U00000063", "\U00000064", "\U00000065", "\U00000066", "\U00000067", "\U00000068", "\U00000069", "\U0000006a", "\U0000006b", "\U0000006c", "\U0000006d", "\U0000006e", "\U0000006f", "\U00000070", "\U00000071", "\U00000072", "\U00000073", "\U00000074", "\U00000075", "\U00000076", "\U00000077", "\U00000078", "\U00000079", "\U0000007a", "\U0000007b", "\U0000007c", "\U0000007d", "\U0000007e", "\U000000B0", "\U000000B1", "\U000000B2", "\U000000B3", "\U000000B5", "\U000000A3", "\U000000A5", "\U000000A9", "\U000000AE", "\U000000D7", "\U000000F7", "\U000003BC", "\U000003A9", "\U000020AC", "\U00002122"]
script:
  - id: change_page_to
    parameters:
      target_page: int
    then:
      - lambda: |-
          int pages_count = 1;
          int target = target_page;
          while (target < 0) target += pages_count;
          target %= pages_count;
          
          if (id(display_page) != target) {
            id(display_page) = target;
            id(last_page_switch_time) = millis();
            id(epaper_display).update();
            ESP_LOGI("display", "Switched to page %d", target);
            // Restart refresh logic
            if (id(manage_run_and_sleep).is_running()) id(manage_run_and_sleep).stop();
            id(manage_run_and_sleep).execute();
          }
  - id: manage_run_and_sleep
    mode: restart
    then:
      - logger.log: "Waiting for sync..."
      - wait_until:
          condition:
            lambda: 'return id(ha_time).now().is_valid() && api_is_connected();'
          timeout: 60s
      - delay: 5s
      - lambda: 'id(page_refresh_current_s) = id(page_refresh_default_s);'
      - component.update: epaper_display
      - delay: !lambda 'return id(page_refresh_current_s) * 1000;'
      - script.execute: manage_run_and_sleep
