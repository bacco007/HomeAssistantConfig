(function(Qt){typeof define=="function"&&define.amd?define(Qt):Qt()})((function(){"use strict";var Qt,z,ec,pr,tc,rc,nc,ic,ao,lo,co,sc,Pn={},oc=[],Rm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,On=Array.isArray;function yt(e,t){for(var r in t)e[r]=t[r];return e}function uo(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Ue(e,t,r){var n,i,s,o={};for(s in t)s=="key"?n=t[s]:s=="ref"?i=t[s]:o[s]=t[s];if(arguments.length>2&&(o.children=arguments.length>3?Qt.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(s in e.defaultProps)o[s]===void 0&&(o[s]=e.defaultProps[s]);return Tn(e,o,n,i,null)}function Tn(e,t,r,n,i){var s={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++ec,__i:-1,__u:0};return i==null&&z.vnode!=null&&z.vnode(s),s}function ac(){return{current:null}}function Q(e){return e.children}function Ve(e,t){this.props=e,this.context=t}function Nr(e,t){if(t==null)return e.__?Nr(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?Nr(e):null}function lc(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return lc(e)}}function fo(e){(!e.__d&&(e.__d=!0)&&pr.push(e)&&!ki.__r++||tc!=z.debounceRendering)&&((tc=z.debounceRendering)||rc)(ki)}function ki(){for(var e,t,r,n,i,s,o,a=1;pr.length;)pr.length>a&&pr.sort(nc),e=pr.shift(),a=pr.length,e.__d&&(r=void 0,n=void 0,i=(n=(t=e).__v).__e,s=[],o=[],t.__P&&((r=yt({},n)).__v=n.__v+1,z.vnode&&z.vnode(r),ho(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[i]:null,s,i??Nr(n),!!(32&n.__u),o),r.__v=n.__v,r.__.__k[r.__i]=r,hc(s,r,o),n.__e=n.__=null,r.__e!=i&&lc(r)));ki.__r=0}function cc(e,t,r,n,i,s,o,a,l,c,u){var d,f,p,m,g,y,_,b=n&&n.__k||oc,w=t.length;for(l=Fm(r,t,b,l,w),d=0;d<w;d++)(p=r.__k[d])!=null&&(f=p.__i==-1?Pn:b[p.__i]||Pn,p.__i=d,y=ho(e,p,f,i,s,o,a,l,c,u),m=p.__e,p.ref&&f.ref!=p.ref&&(f.ref&&mo(f.ref,null,p),u.push(p.ref,p.__c||m,p)),g==null&&m!=null&&(g=m),(_=!!(4&p.__u))||f.__k===p.__k?l=uc(p,l,e,_):typeof p.type=="function"&&y!==void 0?l=y:m&&(l=m.nextSibling),p.__u&=-7);return r.__e=g,l}function Fm(e,t,r,n,i){var s,o,a,l,c,u=r.length,d=u,f=0;for(e.__k=new Array(i),s=0;s<i;s++)(o=t[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=e.__k[s]=Tn(null,o,null,null,null):On(o)?o=e.__k[s]=Tn(Q,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=e.__k[s]=Tn(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):e.__k[s]=o,l=s+f,o.__=e,o.__b=e.__b+1,a=null,(c=o.__i=Lm(o,r,l,d))!=-1&&(d--,(a=r[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(i>u?f--:i<u&&f++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?f--:c==l+1?f++:(c>l?f--:f++,o.__u|=4))):e.__k[s]=null;if(d)for(s=0;s<u;s++)(a=r[s])!=null&&(2&a.__u)==0&&(a.__e==n&&(n=Nr(a)),mc(a,a));return n}function uc(e,t,r,n){var i,s;if(typeof e.type=="function"){for(i=e.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=e,t=uc(i[s],t,r,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=Nr(e)),r.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ot(e,t){return t=t||[],e==null||typeof e=="boolean"||(On(e)?e.some(function(r){Ot(r,t)}):t.push(e)),t}function Lm(e,t,r,n){var i,s,o,a=e.key,l=e.type,c=t[r],u=c!=null&&(2&c.__u)==0;if(c===null&&a==null||u&&a==c.key&&l==c.type)return r;if(n>(u?1:0)){for(i=r-1,s=r+1;i>=0||s<t.length;)if((c=t[o=i>=0?i--:s++])!=null&&(2&c.__u)==0&&a==c.key&&l==c.type)return o}return-1}function dc(e,t,r){t[0]=="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||Rm.test(t)?r:r+"px"}function Mi(e,t,r,n,i){var s,o;e:if(t=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||dc(e.style,t,"");if(r)for(t in r)n&&r[t]==n[t]||dc(e.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")s=t!=(t=t.replace(ic,"$1")),o=t.toLowerCase(),t=o in e||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=r,r?n?r.u=n.u:(r.u=ao,e.addEventListener(t,s?co:lo,s)):e.removeEventListener(t,s?co:lo,s);else{if(i=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function fc(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=ao++;else if(t.t<r.u)return;return r(z.event?z.event(t):t)}}}function ho(e,t,r,n,i,s,o,a,l,c){var u,d,f,p,m,g,y,_,b,w,k,x,E,$,S,I,P,C=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(l=!!(32&r.__u),s=[a=t.__e=r.__e]),(u=z.__b)&&u(t);e:if(typeof C=="function")try{if(_=t.props,b="prototype"in C&&C.prototype.render,w=(u=C.contextType)&&n[u.__c],k=u?w?w.props.value:u.__:n,r.__c?y=(d=t.__c=r.__c).__=d.__E:(b?t.__c=d=new C(_,k):(t.__c=d=new Ve(_,k),d.constructor=C,d.render=Vm),w&&w.sub(d),d.state||(d.state={}),d.__n=n,f=d.__d=!0,d.__h=[],d._sb=[]),b&&d.__s==null&&(d.__s=d.state),b&&C.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=yt({},d.__s)),yt(d.__s,C.getDerivedStateFromProps(_,d.__s))),p=d.props,m=d.state,d.__v=t,f)b&&C.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),b&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(b&&C.getDerivedStateFromProps==null&&_!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(_,k),t.__v==r.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(_,d.__s,k)===!1){for(t.__v!=r.__v&&(d.props=_,d.state=d.__s,d.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(R){R&&(R.__=t)}),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(_,d.__s,k),b&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,g)})}if(d.context=k,d.props=_,d.__P=e,d.__e=!1,E=z.__r,$=0,b){for(d.state=d.__s,d.__d=!1,E&&E(t),u=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,E&&E(t),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++$<25);d.state=d.__s,d.getChildContext!=null&&(n=yt(yt({},n),d.getChildContext())),b&&!f&&d.getSnapshotBeforeUpdate!=null&&(g=d.getSnapshotBeforeUpdate(p,m)),I=u,u!=null&&u.type===Q&&u.key==null&&(I=pc(u.props.children)),a=cc(e,On(I)?I:[I],t,r,n,i,s,o,a,l,c),d.base=t.__e,t.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(R){if(t.__v=null,l||s!=null)if(R.then){for(t.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,t.__e=a}else{for(P=s.length;P--;)uo(s[P]);po(t)}else t.__e=r.__e,t.__k=r.__k,R.then||po(t);z.__e(R,t,r)}else s==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):a=t.__e=Dm(r.__e,t,r,n,i,s,o,l,c);return(u=z.diffed)&&u(t),128&t.__u?void 0:a}function po(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(po)}function hc(e,t,r){for(var n=0;n<r.length;n++)mo(r[n],r[++n],r[++n]);z.__c&&z.__c(t,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(s){s.call(i)})}catch(s){z.__e(s,i.__v)}})}function pc(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:On(e)?e.map(pc):yt({},e)}function Dm(e,t,r,n,i,s,o,a,l){var c,u,d,f,p,m,g,y=r.props||Pn,_=t.props,b=t.type;if(b=="svg"?i="http://www.w3.org/2000/svg":b=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(c=0;c<s.length;c++)if((p=s[c])&&"setAttribute"in p==!!b&&(b?p.localName==b:p.nodeType==3)){e=p,s[c]=null;break}}if(e==null){if(b==null)return document.createTextNode(_);e=document.createElementNS(i,b,_.is&&_),a&&(z.__m&&z.__m(t,s),a=!1),s=null}if(b==null)y===_||a&&e.data==_||(e.data=_);else{if(s=s&&Qt.call(e.childNodes),!a&&s!=null)for(y={},c=0;c<e.attributes.length;c++)y[(p=e.attributes[c]).name]=p.value;for(c in y)if(p=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=p;else if(!(c in _)){if(c=="value"&&"defaultValue"in _||c=="checked"&&"defaultChecked"in _)continue;Mi(e,c,null,p,i)}}for(c in _)p=_[c],c=="children"?f=p:c=="dangerouslySetInnerHTML"?u=p:c=="value"?m=p:c=="checked"?g=p:a&&typeof p!="function"||y[c]===p||Mi(e,c,p,y[c],i);if(u)a||d&&(u.__html==d.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(d&&(e.innerHTML=""),cc(t.type=="template"?e.content:e,On(f)?f:[f],t,r,n,b=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:r.__k&&Nr(r,0),a,l),s!=null)for(c=s.length;c--;)uo(s[c]);a||(c="value",b=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[c]||b=="progress"&&!m||b=="option"&&m!=y[c])&&Mi(e,c,m,y[c],i),c="checked",g!=null&&g!=e[c]&&Mi(e,c,g,y[c],i))}return e}function mo(e,t,r){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(i){z.__e(i,r)}}function mc(e,t,r){var n,i;if(z.unmount&&z.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||mo(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){z.__e(s,t)}n.base=n.__P=null}if(n=e.__k)for(i=0;i<n.length;i++)n[i]&&mc(n[i],t,r||typeof e.type!="function");r||uo(e.__e),e.__c=e.__=e.__e=void 0}function Vm(e,t,r){return this.constructor(e,r)}function mr(e,t,r){var n,i,s,o;t==document&&(t=document.documentElement),z.__&&z.__(e,t),i=(n=typeof r=="function")?null:r&&r.__k||t.__k,s=[],o=[],ho(t,e=(!n&&r||t).__k=Ue(Q,null,[e]),i||Pn,Pn,t.namespaceURI,!n&&r?[r]:i?null:t.firstChild?Qt.call(t.childNodes):null,s,!n&&r?r:i?i.__e:t.firstChild,n,o),hc(s,e,o)}function gc(e,t){mr(e,t,gc)}function zm(e,t,r){var n,i,s,o,a=yt({},e.props);for(s in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)s=="key"?n=t[s]:s=="ref"?i=t[s]:a[s]=t[s]===void 0&&o!=null?o[s]:t[s];return arguments.length>2&&(a.children=arguments.length>3?Qt.call(arguments,2):r),Tn(e.type,a,n||e.key,i||e.ref,null)}function _t(e){function t(r){var n,i;return this.getChildContext||(n=new Set,(i={})[t.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&n.forEach(function(o){o.__e=!0,fo(o)})},this.sub=function(s){n.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){n&&n.delete(s),o&&o.call(s)}}),r.children}return t.__c="__cC"+sc++,t.__=e,t.Provider=t.__l=(t.Consumer=function(r,n){return r.children(n)}).contextType=t,t}Qt=oc.slice,z={__e:function(e,t,r,n){for(var i,s,o;t=t.__;)if((i=t.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(e)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,n||{}),o=i.__d),o)return i.__E=i}catch(a){e=a}throw e}},ec=0,Ve.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=yt({},this.state),typeof e=="function"&&(e=e(yt({},r),this.props)),e&&yt(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),fo(this))},Ve.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),fo(this))},Ve.prototype.render=Q,pr=[],rc=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,nc=function(e,t){return e.__v.__b-t.__v.__b},ki.__r=0,ic=/(PointerCapture)$|Capture$/i,ao=0,lo=fc(!1),co=fc(!0),sc=0;var Tt,ue,go,yc,Rr=0,_c=[],ve=z,bc=ve.__b,vc=ve.__r,wc=ve.diffed,xc=ve.__c,kc=ve.unmount,Mc=ve.__;function gr(e,t){ve.__h&&ve.__h(ue,e,Rr||t),Rr=0;var r=ue.__H||(ue.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function F(e){return Rr=1,Nn($c,e)}function Nn(e,t,r){var n=gr(Tt++,2);if(n.t=e,!n.__c&&(n.__=[r?r(t):$c(void 0,t),function(a){var l=n.__N?n.__N[0]:n.__[0],c=n.t(l,a);l!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=ue,!ue.__f)){var i=function(a,l,c){if(!n.__c.__H)return!0;var u=n.__c.__H.__.filter(function(f){return!!f.__c});if(u.every(function(f){return!f.__N}))return!s||s.call(this,a,l,c);var d=n.__c.props!==a;return u.forEach(function(f){if(f.__N){var p=f.__[0];f.__=f.__N,f.__N=void 0,p!==f.__[0]&&(d=!0)}}),s&&s.call(this,a,l,c)||d};ue.__f=!0;var s=ue.shouldComponentUpdate,o=ue.componentWillUpdate;ue.componentWillUpdate=function(a,l,c){if(this.__e){var u=s;s=void 0,i(a,l,c),s=u}o&&o.call(this,a,l,c)},ue.shouldComponentUpdate=i}return n.__N||n.__}function ee(e,t){var r=gr(Tt++,3);!ve.__s&&bo(r.__H,t)&&(r.__=e,r.u=t,ue.__H.__h.push(r))}function Nt(e,t){var r=gr(Tt++,4);!ve.__s&&bo(r.__H,t)&&(r.__=e,r.u=t,ue.__h.push(r))}function ge(e){return Rr=5,V(function(){return{current:e}},[])}function Si(e,t,r){Rr=6,Nt(function(){if(typeof e=="function"){var n=e(t());return function(){e(null),n&&typeof n=="function"&&n()}}if(e)return e.current=t(),function(){return e.current=null}},r==null?r:r.concat(e))}function V(e,t){var r=gr(Tt++,7);return bo(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function O(e,t){return Rr=8,V(function(){return e},t)}function te(e){var t=ue.context[e.__c],r=gr(Tt++,9);return r.c=e,t?(r.__==null&&(r.__=!0,t.sub(ue)),t.props.value):e.__}function yo(e,t){ve.useDebugValue&&ve.useDebugValue(t?t(e):e)}function Bm(e){var t=gr(Tt++,10),r=F();return t.__=e,ue.componentDidCatch||(ue.componentDidCatch=function(n,i){t.__&&t.__(n,i),r[1](n)}),[r[0],function(){r[1](void 0)}]}function $i(){var e=gr(Tt++,11);if(!e.__){for(var t=ue.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var r=t.__m||(t.__m=[0,0]);e.__="P"+r[0]+"-"+r[1]++}return e.__}function qm(){for(var e;e=_c.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Ci),e.__H.__h.forEach(_o),e.__H.__h=[]}catch(t){e.__H.__h=[],ve.__e(t,e.__v)}}ve.__b=function(e){ue=null,bc&&bc(e)},ve.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Mc&&Mc(e,t)},ve.__r=function(e){vc&&vc(e),Tt=0;var t=(ue=e.__c).__H;t&&(go===ue?(t.__h=[],ue.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(Ci),t.__h.forEach(_o),t.__h=[],Tt=0)),go=ue},ve.diffed=function(e){wc&&wc(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(_c.push(t)!==1&&yc===ve.requestAnimationFrame||((yc=ve.requestAnimationFrame)||jm)(qm)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),go=ue=null},ve.__c=function(e,t){t.some(function(r){try{r.__h.forEach(Ci),r.__h=r.__h.filter(function(n){return!n.__||_o(n)})}catch(n){t.some(function(i){i.__h&&(i.__h=[])}),t=[],ve.__e(n,r.__v)}}),xc&&xc(e,t)},ve.unmount=function(e){kc&&kc(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{Ci(n)}catch(i){t=i}}),r.__H=void 0,t&&ve.__e(t,r.__v))};var Sc=typeof requestAnimationFrame=="function";function jm(e){var t,r=function(){clearTimeout(n),Sc&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(r,35);Sc&&(t=requestAnimationFrame(r))}function Ci(e){var t=ue,r=e.__c;typeof r=="function"&&(e.__c=void 0,r()),ue=t}function _o(e){var t=ue;e.__c=e.__(),ue=t}function bo(e,t){return!e||e.length!==t.length||t.some(function(r,n){return r!==e[n]})}function $c(e,t){return typeof t=="function"?t(e):t}function Cc(e,t){for(var r in t)e[r]=t[r];return e}function vo(e,t){for(var r in e)if(r!=="__source"&&!(r in t))return!0;for(var n in t)if(n!=="__source"&&e[n]!==t[n])return!0;return!1}function wo(e,t){var r=t(),n=F({t:{__:r,u:t}}),i=n[0].t,s=n[1];return Nt(function(){i.__=r,i.u=t,xo(i)&&s({t:i})},[e,r,t]),ee(function(){return xo(i)&&s({t:i}),e(function(){xo(i)&&s({t:i})})},[e]),r}function xo(e){var t,r,n=e.u,i=e.__;try{var s=n();return!((t=i)===(r=s)&&(t!==0||1/t==1/r)||t!=t&&r!=r)}catch{return!0}}function ko(e){e()}function Mo(e){return e}function So(){return[!1,ko]}var $o=Nt;function Ai(e,t){this.props=e,this.context=t}function Pe(e,t){function r(i){var s=this.props.ref,o=s==i.ref;return!o&&s&&(s.call?s(null):s.current=null),t?!t(this.props,i)||!o:vo(this.props,i)}function n(i){return this.shouldComponentUpdate=r,Ue(e,i)}return n.displayName="Memo("+(e.displayName||e.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n.type=e,n}(Ai.prototype=new Ve).isPureReactComponent=!0,Ai.prototype.shouldComponentUpdate=function(e,t){return vo(this.props,e)||vo(this.state,t)};var Ac=z.__b;z.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),Ac&&Ac(e)};var Um=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Rt(e){function t(r){var n=Cc({},r);return delete n.ref,e(n,r.ref||null)}return t.$$typeof=Um,t.render=e,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}var Ec=function(e,t){return e==null?null:Ot(Ot(e).map(t))},Ic={map:Ec,forEach:Ec,count:function(e){return e?Ot(e).length:0},only:function(e){var t=Ot(e);if(t.length!==1)throw"Children.only";return t[0]},toArray:Ot},Km=z.__e;z.__e=function(e,t,r,n){if(e.then){for(var i,s=t;s=s.__;)if((i=s.__c)&&i.__c)return t.__e==null&&(t.__e=r.__e,t.__k=r.__k),i.__c(e,t)}Km(e,t,r,n)};var Pc=z.unmount;function Oc(e,t,r){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),e.__c.__H=null),(e=Cc({},e)).__c!=null&&(e.__c.__P===r&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(n){return Oc(n,t,r)})),e}function Tc(e,t,r){return e&&r&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(n){return Tc(n,t,r)}),e.__c&&e.__c.__P===t&&(e.__e&&r.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=r)),e}function Rn(){this.__u=0,this.o=null,this.__b=null}function Nc(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function Rc(e){var t,r,n,i=null;function s(o){if(t||(t=e()).then(function(a){a&&(i=a.default||a),n=!0},function(a){r=a,n=!0}),r)throw r;if(!n)throw t;return i?Ue(i,o):null}return s.displayName="Lazy",s.__f=!0,s}function Fr(){this.i=null,this.l=null}z.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),Pc&&Pc(e)},(Rn.prototype=new Ve).__c=function(e,t){var r=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(r);var i=Nc(n.__v),s=!1,o=function(){s||(s=!0,r.__R=null,i?i(a):a())};r.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var l=n.state.__a;n.__v.__k[0]=Tc(l,l.__c.__P,l.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(o,o)},Rn.prototype.componentWillUnmount=function(){this.o=[]},Rn.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var r=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Oc(this.__b,r,n.__O=n.__P)}this.__b=null}var i=t.__a&&Ue(Q,null,e.fallback);return i&&(i.__u&=-33),[Ue(Q,null,t.__a?null:e.children),i]};var Fc=function(e,t,r){if(++r[1]===r[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(r=e.i;r;){for(;r.length>3;)r.pop()();if(r[1]<r[0])break;e.i=r=r[2]}};function Gm(e){return this.getChildContext=function(){return e.context},e.children}function Wm(e){var t=this,r=e.h;if(t.componentWillUnmount=function(){mr(null,t.v),t.v=null,t.h=null},t.h&&t.h!==r&&t.componentWillUnmount(),!t.v){for(var n=t.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;t.h=r,t.v={nodeType:1,parentNode:r,childNodes:[],__k:{__m:n.__m},contains:function(){return!0},insertBefore:function(i,s){this.childNodes.push(i),t.h.insertBefore(i,s)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),t.h.removeChild(i)}}}mr(Ue(Gm,{context:t.context},e.__v),t.v)}function Lc(e,t){var r=Ue(Wm,{__v:e,h:t});return r.containerInfo=t,r}(Fr.prototype=new Ve).__a=function(e){var t=this,r=Nc(t.__v),n=t.l.get(e);return n[0]++,function(i){var s=function(){t.props.revealOrder?(n.push(i),Fc(t,e,n)):i()};r?r(s):s()}},Fr.prototype.render=function(e){this.i=null,this.l=new Map;var t=Ot(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var r=t.length;r--;)this.l.set(t[r],this.i=[1,0,this.i]);return e.children},Fr.prototype.componentDidUpdate=Fr.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,r){Fc(e,r,t)})};var Dc=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Hm=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Jm=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Ym=/[A-Z0-9]/g,Qm=typeof document<"u",Zm=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};function Vc(e,t,r){return t.__k==null&&(t.textContent=""),mr(e,t),typeof r=="function"&&r(),e?e.__c:null}function zc(e,t,r){return gc(e,t),typeof r=="function"&&r(),e?e.__c:null}Ve.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(Ve.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var Bc=z.event;function Xm(){}function eg(){return this.cancelBubble}function tg(){return this.defaultPrevented}z.event=function(e){return Bc&&(e=Bc(e)),e.persist=Xm,e.isPropagationStopped=eg,e.isDefaultPrevented=tg,e.nativeEvent=e};var Co,rg={enumerable:!1,configurable:!0,get:function(){return this.class}},qc=z.vnode;z.vnode=function(e){typeof e.type=="string"&&(function(t){var r=t.props,n=t.type,i={},s=n.indexOf("-")===-1;for(var o in r){var a=r[o];if(!(o==="value"&&"defaultValue"in r&&a==null||Qm&&o==="children"&&n==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in r&&r.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||n!=="input"&&n!=="textarea"||Zm(r.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":Jm.test(o)&&(o=l):l=o="oninput":s&&Hm.test(o)?o=o.replace(Ym,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[o=l]&&(o="oninputCapture"),i[o]=a}}n=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Ot(r.children).forEach(function(c){c.props.selected=i.value.indexOf(c.props.value)!=-1})),n=="select"&&i.defaultValue!=null&&(i.value=Ot(r.children).forEach(function(c){c.props.selected=i.multiple?i.defaultValue.indexOf(c.props.value)!=-1:i.defaultValue==c.props.value})),r.class&&!r.className?(i.class=r.class,Object.defineProperty(i,"className",rg)):(r.className&&!r.class||r.class&&r.className)&&(i.class=i.className=r.className),t.props=i})(e),e.$$typeof=Dc,qc&&qc(e)};var jc=z.__r;z.__r=function(e){jc&&jc(e),Co=e.__c};var Uc=z.diffed;z.diffed=function(e){Uc&&Uc(e);var t=e.props,r=e.__e;r!=null&&e.type==="textarea"&&"value"in t&&t.value!==r.value&&(r.value=t.value==null?"":t.value),Co=null};var Kc={ReactCurrentDispatcher:{current:{readContext:function(e){return Co.__n[e.__c].props.value},useCallback:O,useContext:te,useDebugValue:yo,useDeferredValue:Mo,useEffect:ee,useId:$i,useImperativeHandle:Si,useInsertionEffect:$o,useLayoutEffect:Nt,useMemo:V,useReducer:Nn,useRef:ge,useState:F,useSyncExternalStore:wo,useTransition:So}}},Gc="18.3.1";function Wc(e){return Ue.bind(null,e)}function Fn(e){return!!e&&e.$$typeof===Dc}function Hc(e){return Fn(e)&&e.type===Q}function Jc(e){return!!e&&!!e.displayName&&(typeof e.displayName=="string"||e.displayName instanceof String)&&e.displayName.startsWith("Memo(")}function Yc(e){return Fn(e)?zm.apply(null,arguments):e}function Qc(e){return!!e.__k&&(mr(null,e),!0)}function Zc(e){return e&&(e.base||e.nodeType===1&&e)||null}var Xc=function(e,t){return e(t)},Ao=function(e,t){return e(t)},eu=Q,tu=Fn,ng={useState:F,useId:$i,useReducer:Nn,useEffect:ee,useLayoutEffect:Nt,useInsertionEffect:$o,useTransition:So,useDeferredValue:Mo,useSyncExternalStore:wo,startTransition:ko,useRef:ge,useImperativeHandle:Si,useMemo:V,useCallback:O,useContext:te,useDebugValue:yo,version:"18.3.1",Children:Ic,render:Vc,hydrate:zc,unmountComponentAtNode:Qc,createPortal:Lc,createElement:Ue,createContext:_t,createFactory:Wc,cloneElement:Yc,createRef:ac,Fragment:Q,isValidElement:Fn,isElement:tu,isFragment:Hc,isMemo:Jc,findDOMNode:Zc,Component:Ve,PureComponent:Ai,memo:Pe,forwardRef:Rt,flushSync:Ao,unstable_batchedUpdates:Xc,StrictMode:eu,Suspense:Rn,SuspenseList:Fr,lazy:Rc,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Kc};const Eo=Object.freeze(Object.defineProperty({__proto__:null,Children:Ic,Component:Ve,Fragment:Q,PureComponent:Ai,StrictMode:eu,Suspense:Rn,SuspenseList:Fr,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Kc,cloneElement:Yc,createContext:_t,createElement:Ue,createFactory:Wc,createPortal:Lc,createRef:ac,default:ng,findDOMNode:Zc,flushSync:Ao,forwardRef:Rt,hydrate:zc,isElement:tu,isFragment:Hc,isMemo:Jc,isValidElement:Fn,lazy:Rc,memo:Pe,render:Vc,startTransition:ko,unmountComponentAtNode:Qc,unstable_batchedUpdates:Xc,useCallback:O,useContext:te,useDebugValue:yo,useDeferredValue:Mo,useEffect:ee,useErrorBoundary:Bm,useId:$i,useImperativeHandle:Si,useInsertionEffect:$o,useLayoutEffect:Nt,useMemo:V,useReducer:Nn,useRef:ge,useState:F,useSyncExternalStore:wo,useTransition:So,version:Gc},Symbol.toStringTag,{value:"Module"}));var ig=0;function ze(e,t,r,n,i,s){t||(t={});var o,a,l=t;if("ref"in l)for(a in l={},t)a=="ref"?o=t[a]:l[a]=t[a];var c={type:e,props:l,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ig,__i:-1,__u:0,__source:i,__self:s};if(typeof e=="function"&&(o=e.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return z.vnode&&z.vnode(c),c}function sg(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function og(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var ag=(function(){function e(r){var n=this;this._insertTag=function(i){var s;n.tags.length===0?n.insertionPoint?s=n.insertionPoint.nextSibling:n.prepend?s=n.container.firstChild:s=n.before:s=n.tags[n.tags.length-1].nextSibling,n.container.insertBefore(i,s),n.tags.push(i)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(n){n.forEach(this._insertTag)},t.insert=function(n){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(og(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var s=sg(i);try{s.insertRule(n,s.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(n));this.ctr++},t.flush=function(){this.tags.forEach(function(n){var i;return(i=n.parentNode)==null?void 0:i.removeChild(n)}),this.tags=[],this.ctr=0},e})(),Be="-ms-",Ei="-moz-",re="-webkit-",ru="comm",Io="rule",Po="decl",lg="@import",nu="@keyframes",cg="@layer",ug=Math.abs,Ii=String.fromCharCode,dg=Object.assign;function fg(e,t){return Re(e,0)^45?(((t<<2^Re(e,0))<<2^Re(e,1))<<2^Re(e,2))<<2^Re(e,3):0}function iu(e){return e.trim()}function hg(e,t){return(e=t.exec(e))?e[0]:e}function ne(e,t,r){return e.replace(t,r)}function Oo(e,t){return e.indexOf(t)}function Re(e,t){return e.charCodeAt(t)|0}function Ln(e,t,r){return e.slice(t,r)}function bt(e){return e.length}function To(e){return e.length}function Pi(e,t){return t.push(e),e}function pg(e,t){return e.map(t).join("")}var Oi=1,Lr=1,su=0,He=0,ke=0,Dr="";function Ti(e,t,r,n,i,s,o){return{value:e,root:t,parent:r,type:n,props:i,children:s,line:Oi,column:Lr,length:o,return:""}}function Dn(e,t){return dg(Ti("",null,null,"",null,null,0),e,{length:-e.length},t)}function mg(){return ke}function gg(){return ke=He>0?Re(Dr,--He):0,Lr--,ke===10&&(Lr=1,Oi--),ke}function Qe(){return ke=He<su?Re(Dr,He++):0,Lr++,ke===10&&(Lr=1,Oi++),ke}function vt(){return Re(Dr,He)}function Ni(){return He}function Vn(e,t){return Ln(Dr,e,t)}function zn(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function ou(e){return Oi=Lr=1,su=bt(Dr=e),He=0,[]}function au(e){return Dr="",e}function Ri(e){return iu(Vn(He-1,No(e===91?e+2:e===40?e+1:e)))}function yg(e){for(;(ke=vt())&&ke<33;)Qe();return zn(e)>2||zn(ke)>3?"":" "}function _g(e,t){for(;--t&&Qe()&&!(ke<48||ke>102||ke>57&&ke<65||ke>70&&ke<97););return Vn(e,Ni()+(t<6&&vt()==32&&Qe()==32))}function No(e){for(;Qe();)switch(ke){case e:return He;case 34:case 39:e!==34&&e!==39&&No(ke);break;case 40:e===41&&No(e);break;case 92:Qe();break}return He}function bg(e,t){for(;Qe()&&e+ke!==57;)if(e+ke===84&&vt()===47)break;return"/*"+Vn(t,He-1)+"*"+Ii(e===47?e:Qe())}function vg(e){for(;!zn(vt());)Qe();return Vn(e,He)}function wg(e){return au(Fi("",null,null,null,[""],e=ou(e),0,[0],e))}function Fi(e,t,r,n,i,s,o,a,l){for(var c=0,u=0,d=o,f=0,p=0,m=0,g=1,y=1,_=1,b=0,w="",k=i,x=s,E=n,$=w;y;)switch(m=b,b=Qe()){case 40:if(m!=108&&Re($,d-1)==58){Oo($+=ne(Ri(b),"&","&\f"),"&\f")!=-1&&(_=-1);break}case 34:case 39:case 91:$+=Ri(b);break;case 9:case 10:case 13:case 32:$+=yg(m);break;case 92:$+=_g(Ni()-1,7);continue;case 47:switch(vt()){case 42:case 47:Pi(xg(bg(Qe(),Ni()),t,r),l);break;default:$+="/"}break;case 123*g:a[c++]=bt($)*_;case 125*g:case 59:case 0:switch(b){case 0:case 125:y=0;case 59+u:_==-1&&($=ne($,/\f/g,"")),p>0&&bt($)-d&&Pi(p>32?cu($+";",n,r,d-1):cu(ne($," ","")+";",n,r,d-2),l);break;case 59:$+=";";default:if(Pi(E=lu($,t,r,c,u,i,a,w,k=[],x=[],d),s),b===123)if(u===0)Fi($,t,E,E,k,s,d,a,x);else switch(f===99&&Re($,3)===110?100:f){case 100:case 108:case 109:case 115:Fi(e,E,E,n&&Pi(lu(e,E,E,0,0,i,a,w,i,k=[],d),x),i,x,d,a,n?k:x);break;default:Fi($,E,E,E,[""],x,0,a,x)}}c=u=p=0,g=_=1,w=$="",d=o;break;case 58:d=1+bt($),p=m;default:if(g<1){if(b==123)--g;else if(b==125&&g++==0&&gg()==125)continue}switch($+=Ii(b),b*g){case 38:_=u>0?1:($+="\f",-1);break;case 44:a[c++]=(bt($)-1)*_,_=1;break;case 64:vt()===45&&($+=Ri(Qe())),f=vt(),u=d=bt(w=$+=vg(Ni())),b++;break;case 45:m===45&&bt($)==2&&(g=0)}}return s}function lu(e,t,r,n,i,s,o,a,l,c,u){for(var d=i-1,f=i===0?s:[""],p=To(f),m=0,g=0,y=0;m<n;++m)for(var _=0,b=Ln(e,d+1,d=ug(g=o[m])),w=e;_<p;++_)(w=iu(g>0?f[_]+" "+b:ne(b,/&\f/g,f[_])))&&(l[y++]=w);return Ti(e,t,r,i===0?Io:a,l,c,u)}function xg(e,t,r){return Ti(e,t,r,ru,Ii(mg()),Ln(e,2,-2),0)}function cu(e,t,r,n){return Ti(e,t,r,Po,Ln(e,0,n),Ln(e,n+1,-1),n)}function Vr(e,t){for(var r="",n=To(e),i=0;i<n;i++)r+=t(e[i],i,e,t)||"";return r}function kg(e,t,r,n){switch(e.type){case cg:if(e.children.length)break;case lg:case Po:return e.return=e.return||e.value;case ru:return"";case nu:return e.return=e.value+"{"+Vr(e.children,n)+"}";case Io:e.value=e.props.join(",")}return bt(r=Vr(e.children,n))?e.return=e.value+"{"+r+"}":""}function Mg(e){var t=To(e);return function(r,n,i,s){for(var o="",a=0;a<t;a++)o+=e[a](r,n,i,s)||"";return o}}function Sg(e){return function(t){t.root||(t=t.return)&&e(t)}}function $g(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var Cg=function(t,r,n){for(var i=0,s=0;i=s,s=vt(),i===38&&s===12&&(r[n]=1),!zn(s);)Qe();return Vn(t,He)},Ag=function(t,r){var n=-1,i=44;do switch(zn(i)){case 0:i===38&&vt()===12&&(r[n]=1),t[n]+=Cg(He-1,r,n);break;case 2:t[n]+=Ri(i);break;case 4:if(i===44){t[++n]=vt()===58?"&\f":"",r[n]=t[n].length;break}default:t[n]+=Ii(i)}while(i=Qe());return t},Eg=function(t,r){return au(Ag(ou(t),r))},uu=new WeakMap,Ig=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,n=t.parent,i=t.column===n.column&&t.line===n.line;n.type!=="rule";)if(n=n.parent,!n)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!uu.get(n))&&!i){uu.set(t,!0);for(var s=[],o=Eg(r,s),a=n.props,l=0,c=0;l<o.length;l++)for(var u=0;u<a.length;u++,c++)t.props[c]=s[l]?o[l].replace(/&\f/g,a[u]):a[u]+" "+o[l]}}},Pg=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function du(e,t){switch(fg(e,t)){case 5103:return re+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return re+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return re+e+Ei+e+Be+e+e;case 6828:case 4268:return re+e+Be+e+e;case 6165:return re+e+Be+"flex-"+e+e;case 5187:return re+e+ne(e,/(\w+).+(:[^]+)/,re+"box-$1$2"+Be+"flex-$1$2")+e;case 5443:return re+e+Be+"flex-item-"+ne(e,/flex-|-self/,"")+e;case 4675:return re+e+Be+"flex-line-pack"+ne(e,/align-content|flex-|-self/,"")+e;case 5548:return re+e+Be+ne(e,"shrink","negative")+e;case 5292:return re+e+Be+ne(e,"basis","preferred-size")+e;case 6060:return re+"box-"+ne(e,"-grow","")+re+e+Be+ne(e,"grow","positive")+e;case 4554:return re+ne(e,/([^-])(transform)/g,"$1"+re+"$2")+e;case 6187:return ne(ne(ne(e,/(zoom-|grab)/,re+"$1"),/(image-set)/,re+"$1"),e,"")+e;case 5495:case 3959:return ne(e,/(image-set\([^]*)/,re+"$1$`$1");case 4968:return ne(ne(e,/(.+:)(flex-)?(.*)/,re+"box-pack:$3"+Be+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+re+e+e;case 4095:case 3583:case 4068:case 2532:return ne(e,/(.+)-inline(.+)/,re+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(bt(e)-1-t>6)switch(Re(e,t+1)){case 109:if(Re(e,t+4)!==45)break;case 102:return ne(e,/(.+:)(.+)-([^]+)/,"$1"+re+"$2-$3$1"+Ei+(Re(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Oo(e,"stretch")?du(ne(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Re(e,t+1)!==115)break;case 6444:switch(Re(e,bt(e)-3-(~Oo(e,"!important")&&10))){case 107:return ne(e,":",":"+re)+e;case 101:return ne(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+re+(Re(e,14)===45?"inline-":"")+"box$3$1"+re+"$2$3$1"+Be+"$2box$3")+e}break;case 5936:switch(Re(e,t+11)){case 114:return re+e+Be+ne(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return re+e+Be+ne(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return re+e+Be+ne(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return re+e+Be+e+e}return e}var Og=function(t,r,n,i){if(t.length>-1&&!t.return)switch(t.type){case Po:t.return=du(t.value,t.length);break;case nu:return Vr([Dn(t,{value:ne(t.value,"@","@"+re)})],i);case Io:if(t.length)return pg(t.props,function(s){switch(hg(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Vr([Dn(t,{props:[ne(s,/:(read-\w+)/,":"+Ei+"$1")]})],i);case"::placeholder":return Vr([Dn(t,{props:[ne(s,/:(plac\w+)/,":"+re+"input-$1")]}),Dn(t,{props:[ne(s,/:(plac\w+)/,":"+Ei+"$1")]}),Dn(t,{props:[ne(s,/:(plac\w+)/,Be+"input-$1")]})],i)}return""})}},Tg=[Og],fu=function(t){var r=t.key;if(r==="css"){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,function(g){var y=g.getAttribute("data-emotion");y.indexOf(" ")!==-1&&(document.head.appendChild(g),g.setAttribute("data-s",""))})}var i=t.stylisPlugins||Tg,s={},o,a=[];o=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(g){for(var y=g.getAttribute("data-emotion").split(" "),_=1;_<y.length;_++)s[y[_]]=!0;a.push(g)});var l,c=[Ig,Pg];{var u,d=[kg,Sg(function(g){u.insert(g)})],f=Mg(c.concat(i,d)),p=function(y){return Vr(wg(y),f)};l=function(y,_,b,w){u=b,p(y?y+"{"+_.styles+"}":_.styles),w&&(m.inserted[_.name]=!0)}}var m={key:r,sheet:new ag({key:r,container:o,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:s,registered:{},insert:l};return m.sheet.hydrate(a),m};function Ng(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var Li={exports:{}},se={};var hu;function Rg(){if(hu)return se;hu=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,m=e?Symbol.for("react.lazy"):60116,g=e?Symbol.for("react.block"):60121,y=e?Symbol.for("react.fundamental"):60117,_=e?Symbol.for("react.responder"):60118,b=e?Symbol.for("react.scope"):60119;function w(x){if(typeof x=="object"&&x!==null){var E=x.$$typeof;switch(E){case t:switch(x=x.type,x){case l:case c:case n:case s:case i:case d:return x;default:switch(x=x&&x.$$typeof,x){case a:case u:case m:case p:case o:return x;default:return E}}case r:return E}}}function k(x){return w(x)===c}return se.AsyncMode=l,se.ConcurrentMode=c,se.ContextConsumer=a,se.ContextProvider=o,se.Element=t,se.ForwardRef=u,se.Fragment=n,se.Lazy=m,se.Memo=p,se.Portal=r,se.Profiler=s,se.StrictMode=i,se.Suspense=d,se.isAsyncMode=function(x){return k(x)||w(x)===l},se.isConcurrentMode=k,se.isContextConsumer=function(x){return w(x)===a},se.isContextProvider=function(x){return w(x)===o},se.isElement=function(x){return typeof x=="object"&&x!==null&&x.$$typeof===t},se.isForwardRef=function(x){return w(x)===u},se.isFragment=function(x){return w(x)===n},se.isLazy=function(x){return w(x)===m},se.isMemo=function(x){return w(x)===p},se.isPortal=function(x){return w(x)===r},se.isProfiler=function(x){return w(x)===s},se.isStrictMode=function(x){return w(x)===i},se.isSuspense=function(x){return w(x)===d},se.isValidElementType=function(x){return typeof x=="string"||typeof x=="function"||x===n||x===c||x===s||x===i||x===d||x===f||typeof x=="object"&&x!==null&&(x.$$typeof===m||x.$$typeof===p||x.$$typeof===o||x.$$typeof===a||x.$$typeof===u||x.$$typeof===y||x.$$typeof===_||x.$$typeof===b||x.$$typeof===g)},se.typeOf=w,se}var oe={},pu;function Fg(){if(pu)return oe;pu=1;var e={};return e.NODE_ENV!=="production"&&(function(){var t=typeof Symbol=="function"&&Symbol.for,r=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,i=t?Symbol.for("react.fragment"):60107,s=t?Symbol.for("react.strict_mode"):60108,o=t?Symbol.for("react.profiler"):60114,a=t?Symbol.for("react.provider"):60109,l=t?Symbol.for("react.context"):60110,c=t?Symbol.for("react.async_mode"):60111,u=t?Symbol.for("react.concurrent_mode"):60111,d=t?Symbol.for("react.forward_ref"):60112,f=t?Symbol.for("react.suspense"):60113,p=t?Symbol.for("react.suspense_list"):60120,m=t?Symbol.for("react.memo"):60115,g=t?Symbol.for("react.lazy"):60116,y=t?Symbol.for("react.block"):60121,_=t?Symbol.for("react.fundamental"):60117,b=t?Symbol.for("react.responder"):60118,w=t?Symbol.for("react.scope"):60119;function k(U){return typeof U=="string"||typeof U=="function"||U===i||U===u||U===o||U===s||U===f||U===p||typeof U=="object"&&U!==null&&(U.$$typeof===g||U.$$typeof===m||U.$$typeof===a||U.$$typeof===l||U.$$typeof===d||U.$$typeof===_||U.$$typeof===b||U.$$typeof===w||U.$$typeof===y)}function x(U){if(typeof U=="object"&&U!==null){var no=U.$$typeof;switch(no){case r:var In=U.type;switch(In){case c:case u:case i:case o:case s:case f:return In;default:var io=In&&In.$$typeof;switch(io){case l:case d:case g:case m:case a:return io;default:return no}}case n:return no}}}var E=c,$=u,S=l,I=a,P=r,C=d,R=i,M=g,L=m,J=n,ut=o,xe=s,et=f,Ne=!1;function An(U){return Ne||(Ne=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),Pr(U)||x(U)===c}function Pr(U){return x(U)===u}function xi(U){return x(U)===l}function Or(U){return x(U)===a}function Xs(U){return typeof U=="object"&&U!==null&&U.$$typeof===r}function Ql(U){return x(U)===d}function hr(U){return x(U)===i}function En(U){return x(U)===g}function Tr(U){return x(U)===m}function eo(U){return x(U)===n}function Zl(U){return x(U)===o}function to(U){return x(U)===s}function ro(U){return x(U)===f}oe.AsyncMode=E,oe.ConcurrentMode=$,oe.ContextConsumer=S,oe.ContextProvider=I,oe.Element=P,oe.ForwardRef=C,oe.Fragment=R,oe.Lazy=M,oe.Memo=L,oe.Portal=J,oe.Profiler=ut,oe.StrictMode=xe,oe.Suspense=et,oe.isAsyncMode=An,oe.isConcurrentMode=Pr,oe.isContextConsumer=xi,oe.isContextProvider=Or,oe.isElement=Xs,oe.isForwardRef=Ql,oe.isFragment=hr,oe.isLazy=En,oe.isMemo=Tr,oe.isPortal=eo,oe.isProfiler=Zl,oe.isStrictMode=to,oe.isSuspense=ro,oe.isValidElementType=k,oe.typeOf=x})(),oe}var mu;function Lg(){if(mu)return Li.exports;mu=1;var e={};return e.NODE_ENV==="production"?Li.exports=Rg():Li.exports=Fg(),Li.exports}var Ro,gu;function Dg(){if(gu)return Ro;gu=1;var e=Lg(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},n={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[e.ForwardRef]=n,s[e.Memo]=i;function o(m){return e.isMemo(m)?i:s[m.$$typeof]||t}var a=Object.defineProperty,l=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,f=Object.prototype;function p(m,g,y){if(typeof g!="string"){if(f){var _=d(g);_&&_!==f&&p(m,_,y)}var b=l(g);c&&(b=b.concat(c(g)));for(var w=o(m),k=o(g),x=0;x<b.length;++x){var E=b[x];if(!r[E]&&!(y&&y[E])&&!(k&&k[E])&&!(w&&w[E])){var $=u(g,E);try{a(m,E,$)}catch{}}}}return m}return Ro=p,Ro}Dg();var Vg=!0;function zg(e,t,r){var n="";return r.split(" ").forEach(function(i){e[i]!==void 0?t.push(e[i]+";"):i&&(n+=i+" ")}),n}var yu=function(t,r,n){var i=t.key+"-"+r.name;(n===!1||Vg===!1)&&t.registered[i]===void 0&&(t.registered[i]=r.styles)},Bg=function(t,r,n){yu(t,r,n);var i=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var s=r;do t.insert(r===s?"."+i:"",s,t.sheet,!0),s=s.next;while(s!==void 0)}};function qg(e){for(var t=0,r,n=0,i=e.length;i>=4;++n,i-=4)r=e.charCodeAt(n)&255|(e.charCodeAt(++n)&255)<<8|(e.charCodeAt(++n)&255)<<16|(e.charCodeAt(++n)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(i){case 3:t^=(e.charCodeAt(n+2)&255)<<16;case 2:t^=(e.charCodeAt(n+1)&255)<<8;case 1:t^=e.charCodeAt(n)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var jg={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Ug=/[A-Z]|^ms/g,Kg=/_EMO_([^_]+?)_([^]*?)_EMO_/g,_u=function(t){return t.charCodeAt(1)===45},bu=function(t){return t!=null&&typeof t!="boolean"},Fo=$g(function(e){return _u(e)?e:e.replace(Ug,"-$&").toLowerCase()}),vu=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(Kg,function(n,i,s){return wt={name:i,styles:s,next:wt},i})}return jg[t]!==1&&!_u(t)&&typeof r=="number"&&r!==0?r+"px":r};function Bn(e,t,r){if(r==null)return"";var n=r;if(n.__emotion_styles!==void 0)return n;switch(typeof r){case"boolean":return"";case"object":{var i=r;if(i.anim===1)return wt={name:i.name,styles:i.styles,next:wt},i.name;var s=r;if(s.styles!==void 0){var o=s.next;if(o!==void 0)for(;o!==void 0;)wt={name:o.name,styles:o.styles,next:wt},o=o.next;var a=s.styles+";";return a}return Gg(e,t,r)}case"function":{if(e!==void 0){var l=wt,c=r(e);return wt=l,Bn(e,t,c)}break}}var u=r;return u}function Gg(e,t,r){var n="";if(Array.isArray(r))for(var i=0;i<r.length;i++)n+=Bn(e,t,r[i])+";";else for(var s in r){var o=r[s];if(typeof o!="object"){var a=o;bu(a)&&(n+=Fo(s)+":"+vu(s,a)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&t==null)for(var l=0;l<o.length;l++)bu(o[l])&&(n+=Fo(s)+":"+vu(s,o[l])+";");else{var c=Bn(e,t,o);switch(s){case"animation":case"animationName":{n+=Fo(s)+":"+c+";";break}default:n+=s+"{"+c+"}"}}}return n}var wu=/label:\s*([^\s;{]+)\s*(;|$)/g,wt;function xu(e,t,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var n=!0,i="";wt=void 0;var s=e[0];if(s==null||s.raw===void 0)n=!1,i+=Bn(r,t,s);else{var o=s;i+=o[0]}for(var a=1;a<e.length;a++)if(i+=Bn(r,t,e[a]),n){var l=s;i+=l[a]}wu.lastIndex=0;for(var c="",u;(u=wu.exec(i))!==null;)c+="-"+u[1];var d=qg(i)+c;return{name:d,styles:i,next:wt}}var Wg=function(t){return t()},Hg=Eo.useInsertionEffect?Eo.useInsertionEffect:!1,Jg=Hg||Wg,ku=_t(typeof HTMLElement<"u"?fu({key:"css"}):null),Yg=ku.Provider,Qg=function(t){return Rt(function(r,n){var i=te(ku);return t(r,i,n)})},Zg=_t({}),qn={}.hasOwnProperty,Lo="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",Do=function(t,r){var n={};for(var i in r)qn.call(r,i)&&(n[i]=r[i]);return n[Lo]=t,n},Xg=function(t){var r=t.cache,n=t.serialized,i=t.isStringTag;return yu(r,n,i),Jg(function(){return Bg(r,n,i)}),null},ey=Qg(function(e,t,r){var n=e.css;typeof n=="string"&&t.registered[n]!==void 0&&(n=t.registered[n]);var i=e[Lo],s=[n],o="";typeof e.className=="string"?o=zg(t.registered,s,e.className):e.className!=null&&(o=e.className+" ");var a=xu(s,void 0,te(Zg));o+=t.key+"-"+a.name;var l={};for(var c in e)qn.call(e,c)&&c!=="css"&&c!==Lo&&(l[c]=e[c]);return l.className=o,r&&(l.ref=r),Ue(Q,null,Ue(Xg,{cache:t,serialized:a,isStringTag:typeof i=="string"}),Ue(i,l))}),Vo=ey,h=function(t,r,n){return qn.call(r,"css")?ze(Vo,Do(t,r),n):ze(t,r,n)},A=function(t,r,n){return qn.call(r,"css")?ze(Vo,Do(t,r),n):ze(t,r,n)};const ty=({hass:e,action:t,target:r,data:n})=>{const i=t.split(".")[0],s=t.split(".")[1],o={...n,...r};return e.callService(i,s,o)},zo=async(e,t,r,n)=>{const i=t[r+"_action"];if(i?.action==="perform-action")return ty({hass:n,action:i.perform_action,target:i.target,data:i.data??{}});const s=new CustomEvent("hass-action",{bubbles:!0,composed:!0,detail:{config:{...t,entity_id:t?.entity},action:r}});return e.dispatchEvent(s),Promise.resolve()};function K(){return document.querySelector("home-assistant").hass}function zr(e,t){if(!e)return[];if(Array.isArray(e))return e;const r=e;if(r.enabled===!1||r.enabled==null)return[];const n=r.entity_id??t;let i;try{i=K().states[n]?.attributes?.friendly_name}catch{}return[{name:i??"Search",entity_id:n,media_types:r.media_types}]}const Mu=e=>({type:e.type??"custom:mediocre-media-player-card",entity_id:e?.entity_id??"",name:e?.name??null,use_art_colors:e?.use_art_colors??!1,tap_opens_popup:e?.tap_opens_popup??!1,action:e?.action??{},speaker_group:{entity_id:e?.speaker_group?.entity_id??null,entities:e?.speaker_group?.entities??[]},search:zr(e.search,e.entity_id),media_browser:e?.media_browser?Array.isArray(e.media_browser)?e.media_browser:[{entity_id:e.media_browser.entity_id??e.entity_id}]:null,ma_entity_id:e?.ma_entity_id??null,ma_favorite_button_entity_id:e?.ma_favorite_button_entity_id??null,lms_entity_id:e?.lms_entity_id??null,custom_buttons:e?.custom_buttons??[],options:{always_show_power_button:e?.options?.always_show_power_button??!1,always_show_custom_buttons:e?.options?.always_show_custom_buttons??!1,hide_when_off:e?.options?.hide_when_off??!1,hide_when_group_child:e?.options?.hide_when_group_child??!1,show_volume_step_buttons:e?.options?.show_volume_step_buttons??!1,use_volume_up_down_for_step_buttons:e?.options?.use_volume_up_down_for_step_buttons??!1},grid_options:e?.grid_options,visibility:e?.visibility}),Su=e=>({type:e.type??"custom:mediocre-massive-media-player-card",entity_id:e?.entity_id??"",use_art_colors:e?.use_art_colors??!1,mode:e?.mode??"card",action:e?.action??{},speaker_group:{entity_id:e?.speaker_group?.entity_id??null,entities:e?.speaker_group?.entities??[]},search:zr(e.search,e.entity_id),media_browser:e?.media_browser?Array.isArray(e.media_browser)?e.media_browser:[{entity_id:e.media_browser.entity_id??e.entity_id}]:null,ma_entity_id:e?.ma_entity_id??null,ma_favorite_button_entity_id:e?.ma_favorite_button_entity_id??null,lms_entity_id:e?.lms_entity_id??null,custom_buttons:e?.custom_buttons??[],options:{always_show_power_button:e?.options?.always_show_power_button??!1,show_volume_step_buttons:e?.options?.show_volume_step_buttons??!1,use_volume_up_down_for_step_buttons:e?.options?.use_volume_up_down_for_step_buttons??!1},grid_options:e?.grid_options,visibility:e?.visibility}),$u=e=>{const t={...e};return t.use_art_colors||delete t.use_art_colors,t.tap_opens_popup||delete t.tap_opens_popup,(!t.action||Object.keys(t.action).length===0)&&delete t.action,t.ma_entity_id||delete t.ma_entity_id,t.ma_favorite_button_entity_id||delete t.ma_favorite_button_entity_id,t.lms_entity_id||delete t.lms_entity_id,(!t.custom_buttons||t.custom_buttons.length===0)&&delete t.custom_buttons,t.speaker_group?.entity_id===null&&delete t.speaker_group.entity_id,!t.speaker_group?.entity_id&&(!t.speaker_group?.entities||t.speaker_group.entities.length===0)&&delete t.speaker_group,t.options?.always_show_power_button===!1&&delete t.options.always_show_power_button,t.options?.always_show_custom_buttons===!1&&delete t.options.always_show_custom_buttons,t.options?.hide_when_off===!1&&delete t.options.hide_when_off,t.options?.hide_when_group_child===!1&&delete t.options.hide_when_group_child,t.options?.show_volume_step_buttons===!1&&delete t.options.show_volume_step_buttons,t.options?.use_volume_up_down_for_step_buttons===!1&&delete t.options.use_volume_up_down_for_step_buttons,Object.keys(t.options??{}).length===0&&delete t.options,t.search=zr(t.search,t.entity_id),Array.isArray(t.search)&&t.search.length===0&&delete t.search,t},Cu=e=>{const t={...e};return t.use_art_colors||delete t.use_art_colors,(!t.action||Object.keys(t.action).length===0)&&delete t.action,t.ma_entity_id||delete t.ma_entity_id,t.ma_favorite_button_entity_id||delete t.ma_favorite_button_entity_id,t.lms_entity_id||delete t.lms_entity_id,(!t.custom_buttons||t.custom_buttons.length===0)&&delete t.custom_buttons,t.speaker_group?.entity_id===null&&delete t.speaker_group.entity_id,!t.speaker_group?.entity_id&&(!t.speaker_group?.entities||t.speaker_group.entities.length===0)&&delete t.speaker_group,t.options?.always_show_power_button===!1&&delete t.options.always_show_power_button,t.options?.show_volume_step_buttons===!1&&delete t.options.show_volume_step_buttons,t.options?.use_volume_up_down_for_step_buttons===!1&&delete t.options.use_volume_up_down_for_step_buttons,Object.keys(t.options??{}).length===0&&delete t.options,t.search=zr(t.search,t.entity_id),Array.isArray(t.search)&&t.search.length===0&&delete t.search,t},{min:ry,max:ny}=Math,yr=(e,t=0,r=1)=>ry(ny(t,e),r),Bo=e=>{e._clipped=!1,e._unclipped=e.slice(0);for(let t=0;t<=3;t++)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]=yr(e[t],0,255)):t===3&&(e[t]=yr(e[t],0,1));return e},Au={};for(let e of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])Au[`[object ${e}]`]=e.toLowerCase();function Z(e){return Au[Object.prototype.toString.call(e)]||"object"}const Y=(e,t=null)=>e.length>=3?Array.prototype.slice.call(e):Z(e[0])=="object"&&t?t.split("").filter(r=>e[0][r]!==void 0).map(r=>e[0][r]):e[0].slice(0),Br=e=>{if(e.length<2)return null;const t=e.length-1;return Z(e[t])=="string"?e[t].toLowerCase():null},{PI:Di,min:Eu,max:Iu}=Math,tt=e=>Math.round(e*100)/100,qo=e=>Math.round(e*100)/100,Ft=Di*2,jo=Di/3,iy=Di/180,sy=180/Di;function Pu(e){return[...e.slice(0,3).reverse(),...e.slice(3)]}const H={format:{},autodetect:[]};class T{constructor(...t){const r=this;if(Z(t[0])==="object"&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];let n=Br(t),i=!1;if(!n){i=!0,H.sorted||(H.autodetect=H.autodetect.sort((s,o)=>o.p-s.p),H.sorted=!0);for(let s of H.autodetect)if(n=s.test(...t),n)break}if(H.format[n]){const s=H.format[n].apply(null,i?t:t.slice(0,-1));r._rgb=Bo(s)}else throw new Error("unknown format: "+t);r._rgb.length===3&&r._rgb.push(1)}toString(){return Z(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const oy="3.2.0",X=(...e)=>new T(...e);X.version=oy;const qr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ay=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,ly=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,Ou=e=>{if(e.match(ay)){(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);const t=parseInt(e,16),r=t>>16,n=t>>8&255,i=t&255;return[r,n,i,1]}if(e.match(ly)){(e.length===5||e.length===9)&&(e=e.substr(1)),e.length===4&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const t=parseInt(e,16),r=t>>24&255,n=t>>16&255,i=t>>8&255,s=Math.round((t&255)/255*100)/100;return[r,n,i,s]}throw new Error(`unknown hex color: ${e}`)},{round:Vi}=Math,Tu=(...e)=>{let[t,r,n,i]=Y(e,"rgba"),s=Br(e)||"auto";i===void 0&&(i=1),s==="auto"&&(s=i<1?"rgba":"rgb"),t=Vi(t),r=Vi(r),n=Vi(n);let a="000000"+(t<<16|r<<8|n).toString(16);a=a.substr(a.length-6);let l="0"+Vi(i*255).toString(16);switch(l=l.substr(l.length-2),s.toLowerCase()){case"rgba":return`#${a}${l}`;case"argb":return`#${l}${a}`;default:return`#${a}`}};T.prototype.name=function(){const e=Tu(this._rgb,"rgb");for(let t of Object.keys(qr))if(qr[t]===e)return t.toLowerCase();return e},H.format.named=e=>{if(e=e.toLowerCase(),qr[e])return Ou(qr[e]);throw new Error("unknown color name: "+e)},H.autodetect.push({p:5,test:(e,...t)=>{if(!t.length&&Z(e)==="string"&&qr[e.toLowerCase()])return"named"}}),T.prototype.alpha=function(e,t=!1){return e!==void 0&&Z(e)==="number"?t?(this._rgb[3]=e,this):new T([this._rgb[0],this._rgb[1],this._rgb[2],e],"rgb"):this._rgb[3]},T.prototype.clipped=function(){return this._rgb._clipped||!1};const xt={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},cy=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function Lt(e){const t=cy.get(String(e).toLowerCase());if(!t)throw new Error("unknown Lab illuminant "+e);xt.labWhitePoint=e,xt.Xn=t[0],xt.Zn=t[1]}function jn(){return xt.labWhitePoint}const Uo=(...e)=>{e=Y(e,"lab");const[t,r,n]=e,[i,s,o]=uy(t,r,n),[a,l,c]=Nu(i,s,o);return[a,l,c,e.length>3?e[3]:1]},uy=(e,t,r)=>{const{kE:n,kK:i,kKE:s,Xn:o,Yn:a,Zn:l}=xt,c=(e+16)/116,u=.002*t+c,d=c-.005*r,f=u*u*u,p=d*d*d,m=f>n?f:(116*u-16)/i,g=e>s?Math.pow((e+16)/116,3):e/i,y=p>n?p:(116*d-16)/i,_=m*o,b=g*a,w=y*l;return[_,b,w]},Ko=e=>{const t=Math.sign(e);return e=Math.abs(e),(e<=.0031308?e*12.92:1.055*Math.pow(e,1/2.4)-.055)*t},Nu=(e,t,r)=>{const{MtxAdaptMa:n,MtxAdaptMaI:i,MtxXYZ2RGB:s,RefWhiteRGB:o,Xn:a,Yn:l,Zn:c}=xt,u=a*n.m00+l*n.m10+c*n.m20,d=a*n.m01+l*n.m11+c*n.m21,f=a*n.m02+l*n.m12+c*n.m22,p=o.X*n.m00+o.Y*n.m10+o.Z*n.m20,m=o.X*n.m01+o.Y*n.m11+o.Z*n.m21,g=o.X*n.m02+o.Y*n.m12+o.Z*n.m22,y=(e*n.m00+t*n.m10+r*n.m20)*(p/u),_=(e*n.m01+t*n.m11+r*n.m21)*(m/d),b=(e*n.m02+t*n.m12+r*n.m22)*(g/f),w=y*i.m00+_*i.m10+b*i.m20,k=y*i.m01+_*i.m11+b*i.m21,x=y*i.m02+_*i.m12+b*i.m22,E=Ko(w*s.m00+k*s.m10+x*s.m20),$=Ko(w*s.m01+k*s.m11+x*s.m21),S=Ko(w*s.m02+k*s.m12+x*s.m22);return[E*255,$*255,S*255]},Go=(...e)=>{const[t,r,n,...i]=Y(e,"rgb"),[s,o,a]=Ru(t,r,n),[l,c,u]=dy(s,o,a);return[l,c,u,...i.length>0&&i[0]<1?[i[0]]:[]]};function dy(e,t,r){const{Xn:n,Yn:i,Zn:s,kE:o,kK:a}=xt,l=e/n,c=t/i,u=r/s,d=l>o?Math.pow(l,1/3):(a*l+16)/116,f=c>o?Math.pow(c,1/3):(a*c+16)/116,p=u>o?Math.pow(u,1/3):(a*u+16)/116;return[116*f-16,500*(d-f),200*(f-p)]}function Wo(e){const t=Math.sign(e);return e=Math.abs(e),(e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))*t}const Ru=(e,t,r)=>{e=Wo(e/255),t=Wo(t/255),r=Wo(r/255);const{MtxRGB2XYZ:n,MtxAdaptMa:i,MtxAdaptMaI:s,Xn:o,Yn:a,Zn:l,As:c,Bs:u,Cs:d}=xt;let f=e*n.m00+t*n.m10+r*n.m20,p=e*n.m01+t*n.m11+r*n.m21,m=e*n.m02+t*n.m12+r*n.m22;const g=o*i.m00+a*i.m10+l*i.m20,y=o*i.m01+a*i.m11+l*i.m21,_=o*i.m02+a*i.m12+l*i.m22;let b=f*i.m00+p*i.m10+m*i.m20,w=f*i.m01+p*i.m11+m*i.m21,k=f*i.m02+p*i.m12+m*i.m22;return b*=g/c,w*=y/u,k*=_/d,f=b*s.m00+w*s.m10+k*s.m20,p=b*s.m01+w*s.m11+k*s.m21,m=b*s.m02+w*s.m12+k*s.m22,[f,p,m]};T.prototype.lab=function(){return Go(this._rgb)},Object.assign(X,{lab:(...e)=>new T(...e,"lab"),getLabWhitePoint:jn,setLabWhitePoint:Lt}),H.format.lab=Uo,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"lab"),Z(e)==="array"&&e.length===3)return"lab"}}),T.prototype.darken=function(e=1){const t=this,r=t.lab();return r[0]-=xt.Kn*e,new T(r,"lab").alpha(t.alpha(),!0)},T.prototype.brighten=function(e=1){return this.darken(-e)},T.prototype.darker=T.prototype.darken,T.prototype.brighter=T.prototype.brighten,T.prototype.get=function(e){const[t,r]=e.split("."),n=this[t]();if(r){const i=t.indexOf(r)-(t.substr(0,2)==="ok"?2:0);if(i>-1)return n[i];throw new Error(`unknown channel ${r} in mode ${t}`)}else return n};const{pow:fy}=Math,hy=1e-7,py=20;T.prototype.luminance=function(e,t="rgb"){if(e!==void 0&&Z(e)==="number"){if(e===0)return new T([0,0,0,this._rgb[3]],"rgb");if(e===1)return new T([255,255,255,this._rgb[3]],"rgb");let r=this.luminance(),n=py;const i=(o,a)=>{const l=o.interpolate(a,.5,t),c=l.luminance();return Math.abs(e-c)<hy||!n--?l:c>e?i(o,l):i(l,a)},s=(r>e?i(new T([0,0,0]),this):i(this,new T([255,255,255]))).rgb();return new T([...s,this._rgb[3]])}return my(...this._rgb.slice(0,3))};const my=(e,t,r)=>(e=Ho(e),t=Ho(t),r=Ho(r),.2126*e+.7152*t+.0722*r),Ho=e=>(e/=255,e<=.03928?e/12.92:fy((e+.055)/1.055,2.4)),qe={},jr=(e,t,r=.5,...n)=>{let i=n[0]||"lrgb";if(!qe[i]&&!n.length&&(i=Object.keys(qe)[0]),!qe[i])throw new Error(`interpolation mode ${i} is not defined`);return Z(e)!=="object"&&(e=new T(e)),Z(t)!=="object"&&(t=new T(t)),qe[i](e,t,r).alpha(e.alpha()+r*(t.alpha()-e.alpha()))};T.prototype.mix=T.prototype.interpolate=function(e,t=.5,...r){return jr(this,e,t,...r)},T.prototype.premultiply=function(e=!1){const t=this._rgb,r=t[3];return e?(this._rgb=[t[0]*r,t[1]*r,t[2]*r,r],this):new T([t[0]*r,t[1]*r,t[2]*r,r],"rgb")};const{sin:gy,cos:yy}=Math,Fu=(...e)=>{let[t,r,n]=Y(e,"lch");return isNaN(n)&&(n=0),n=n*iy,[t,yy(n)*r,gy(n)*r]},Jo=(...e)=>{e=Y(e,"lch");const[t,r,n]=e,[i,s,o]=Fu(t,r,n),[a,l,c]=Uo(i,s,o);return[a,l,c,e.length>3?e[3]:1]},_y=(...e)=>{const t=Pu(Y(e,"hcl"));return Jo(...t)},{sqrt:by,atan2:vy,round:wy}=Math,Lu=(...e)=>{const[t,r,n]=Y(e,"lab"),i=by(r*r+n*n);let s=(vy(n,r)*sy+360)%360;return wy(i*1e4)===0&&(s=Number.NaN),[t,i,s]},Yo=(...e)=>{const[t,r,n,...i]=Y(e,"rgb"),[s,o,a]=Go(t,r,n),[l,c,u]=Lu(s,o,a);return[l,c,u,...i.length>0&&i[0]<1?[i[0]]:[]]};T.prototype.lch=function(){return Yo(this._rgb)},T.prototype.hcl=function(){return Pu(Yo(this._rgb))},Object.assign(X,{lch:(...e)=>new T(...e,"lch"),hcl:(...e)=>new T(...e,"hcl")}),H.format.lch=Jo,H.format.hcl=_y,["lch","hcl"].forEach(e=>H.autodetect.push({p:2,test:(...t)=>{if(t=Y(t,e),Z(t)==="array"&&t.length===3)return e}})),T.prototype.saturate=function(e=1){const t=this,r=t.lch();return r[1]+=xt.Kn*e,r[1]<0&&(r[1]=0),new T(r,"lch").alpha(t.alpha(),!0)},T.prototype.desaturate=function(e=1){return this.saturate(-e)},T.prototype.set=function(e,t,r=!1){const[n,i]=e.split("."),s=this[n]();if(i){const o=n.indexOf(i)-(n.substr(0,2)==="ok"?2:0);if(o>-1){if(Z(t)=="string")switch(t.charAt(0)){case"+":s[o]+=+t;break;case"-":s[o]+=+t;break;case"*":s[o]*=+t.substr(1);break;case"/":s[o]/=+t.substr(1);break;default:s[o]=+t}else if(Z(t)==="number")s[o]=t;else throw new Error("unsupported value for Color.set");const a=new T(s,n);return r?(this._rgb=a._rgb,this):a}throw new Error(`unknown channel ${i} in mode ${n}`)}else return s},T.prototype.tint=function(e=.5,...t){return jr(this,"white",e,...t)},T.prototype.shade=function(e=.5,...t){return jr(this,"black",e,...t)};const xy=(e,t,r)=>{const n=e._rgb,i=t._rgb;return new T(n[0]+r*(i[0]-n[0]),n[1]+r*(i[1]-n[1]),n[2]+r*(i[2]-n[2]),"rgb")};qe.rgb=xy;const{sqrt:Qo,pow:Ur}=Math,ky=(e,t,r)=>{const[n,i,s]=e._rgb,[o,a,l]=t._rgb;return new T(Qo(Ur(n,2)*(1-r)+Ur(o,2)*r),Qo(Ur(i,2)*(1-r)+Ur(a,2)*r),Qo(Ur(s,2)*(1-r)+Ur(l,2)*r),"rgb")};qe.lrgb=ky;const My=(e,t,r)=>{const n=e.lab(),i=t.lab();return new T(n[0]+r*(i[0]-n[0]),n[1]+r*(i[1]-n[1]),n[2]+r*(i[2]-n[2]),"lab")};qe.lab=My;const Kr=(e,t,r,n)=>{let i,s;n==="hsl"?(i=e.hsl(),s=t.hsl()):n==="hsv"?(i=e.hsv(),s=t.hsv()):n==="hcg"?(i=e.hcg(),s=t.hcg()):n==="hsi"?(i=e.hsi(),s=t.hsi()):n==="lch"||n==="hcl"?(n="hcl",i=e.hcl(),s=t.hcl()):n==="oklch"&&(i=e.oklch().reverse(),s=t.oklch().reverse());let o,a,l,c,u,d;(n.substr(0,1)==="h"||n==="oklch")&&([o,l,u]=i,[a,c,d]=s);let f,p,m,g;return!isNaN(o)&&!isNaN(a)?(a>o&&a-o>180?g=a-(o+360):a<o&&o-a>180?g=a+360-o:g=a-o,p=o+r*g):isNaN(o)?isNaN(a)?p=Number.NaN:(p=a,(u==1||u==0)&&n!="hsv"&&(f=c)):(p=o,(d==1||d==0)&&n!="hsv"&&(f=l)),f===void 0&&(f=l+r*(c-l)),m=u+r*(d-u),n==="oklch"?new T([m,f,p],n):new T([p,f,m],n)},Du=(e,t,r)=>Kr(e,t,r,"lch");qe.lch=Du,qe.hcl=Du;const Sy=e=>{if(Z(e)=="number"&&e>=0&&e<=16777215){const t=e>>16,r=e>>8&255,n=e&255;return[t,r,n,1]}throw new Error("unknown num color: "+e)},$y=(...e)=>{const[t,r,n]=Y(e,"rgb");return(t<<16)+(r<<8)+n};T.prototype.num=function(){return $y(this._rgb)},Object.assign(X,{num:(...e)=>new T(...e,"num")}),H.format.num=Sy,H.autodetect.push({p:5,test:(...e)=>{if(e.length===1&&Z(e[0])==="number"&&e[0]>=0&&e[0]<=16777215)return"num"}});const Cy=(e,t,r)=>{const n=e.num(),i=t.num();return new T(n+r*(i-n),"num")};qe.num=Cy;const{floor:Ay}=Math,Ey=(...e)=>{e=Y(e,"hcg");let[t,r,n]=e,i,s,o;n=n*255;const a=r*255;if(r===0)i=s=o=n;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;const l=Ay(t),c=t-l,u=n*(1-r),d=u+a*(1-c),f=u+a*c,p=u+a;switch(l){case 0:[i,s,o]=[p,f,u];break;case 1:[i,s,o]=[d,p,u];break;case 2:[i,s,o]=[u,p,f];break;case 3:[i,s,o]=[u,d,p];break;case 4:[i,s,o]=[f,u,p];break;case 5:[i,s,o]=[p,u,d];break}}return[i,s,o,e.length>3?e[3]:1]},Iy=(...e)=>{const[t,r,n]=Y(e,"rgb"),i=Eu(t,r,n),s=Iu(t,r,n),o=s-i,a=o*100/255,l=i/(255-o)*100;let c;return o===0?c=Number.NaN:(t===s&&(c=(r-n)/o),r===s&&(c=2+(n-t)/o),n===s&&(c=4+(t-r)/o),c*=60,c<0&&(c+=360)),[c,a,l]};T.prototype.hcg=function(){return Iy(this._rgb)};const Py=(...e)=>new T(...e,"hcg");X.hcg=Py,H.format.hcg=Ey,H.autodetect.push({p:1,test:(...e)=>{if(e=Y(e,"hcg"),Z(e)==="array"&&e.length===3)return"hcg"}});const Oy=(e,t,r)=>Kr(e,t,r,"hcg");qe.hcg=Oy;const{cos:Gr}=Math,Ty=(...e)=>{e=Y(e,"hsi");let[t,r,n]=e,i,s,o;return isNaN(t)&&(t=0),isNaN(r)&&(r=0),t>360&&(t-=360),t<0&&(t+=360),t/=360,t<1/3?(o=(1-r)/3,i=(1+r*Gr(Ft*t)/Gr(jo-Ft*t))/3,s=1-(o+i)):t<2/3?(t-=1/3,i=(1-r)/3,s=(1+r*Gr(Ft*t)/Gr(jo-Ft*t))/3,o=1-(i+s)):(t-=2/3,s=(1-r)/3,o=(1+r*Gr(Ft*t)/Gr(jo-Ft*t))/3,i=1-(s+o)),i=yr(n*i*3),s=yr(n*s*3),o=yr(n*o*3),[i*255,s*255,o*255,e.length>3?e[3]:1]},{min:Ny,sqrt:Ry,acos:Fy}=Math,Ly=(...e)=>{let[t,r,n]=Y(e,"rgb");t/=255,r/=255,n/=255;let i;const s=Ny(t,r,n),o=(t+r+n)/3,a=o>0?1-s/o:0;return a===0?i=NaN:(i=(t-r+(t-n))/2,i/=Ry((t-r)*(t-r)+(t-n)*(r-n)),i=Fy(i),n>r&&(i=Ft-i),i/=Ft),[i*360,a,o]};T.prototype.hsi=function(){return Ly(this._rgb)};const Dy=(...e)=>new T(...e,"hsi");X.hsi=Dy,H.format.hsi=Ty,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"hsi"),Z(e)==="array"&&e.length===3)return"hsi"}});const Vy=(e,t,r)=>Kr(e,t,r,"hsi");qe.hsi=Vy;const Zo=(...e)=>{e=Y(e,"hsl");const[t,r,n]=e;let i,s,o;if(r===0)i=s=o=n*255;else{const a=[0,0,0],l=[0,0,0],c=n<.5?n*(1+r):n+r-n*r,u=2*n-c,d=t/360;a[0]=d+1/3,a[1]=d,a[2]=d-1/3;for(let f=0;f<3;f++)a[f]<0&&(a[f]+=1),a[f]>1&&(a[f]-=1),6*a[f]<1?l[f]=u+(c-u)*6*a[f]:2*a[f]<1?l[f]=c:3*a[f]<2?l[f]=u+(c-u)*(2/3-a[f])*6:l[f]=u;[i,s,o]=[l[0]*255,l[1]*255,l[2]*255]}return e.length>3?[i,s,o,e[3]]:[i,s,o,1]},Vu=(...e)=>{e=Y(e,"rgba");let[t,r,n]=e;t/=255,r/=255,n/=255;const i=Eu(t,r,n),s=Iu(t,r,n),o=(s+i)/2;let a,l;return s===i?(a=0,l=Number.NaN):a=o<.5?(s-i)/(s+i):(s-i)/(2-s-i),t==s?l=(r-n)/(s-i):r==s?l=2+(n-t)/(s-i):n==s&&(l=4+(t-r)/(s-i)),l*=60,l<0&&(l+=360),e.length>3&&e[3]!==void 0?[l,a,o,e[3]]:[l,a,o]};T.prototype.hsl=function(){return Vu(this._rgb)};const zy=(...e)=>new T(...e,"hsl");X.hsl=zy,H.format.hsl=Zo,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"hsl"),Z(e)==="array"&&e.length===3)return"hsl"}});const By=(e,t,r)=>Kr(e,t,r,"hsl");qe.hsl=By;const{floor:qy}=Math,jy=(...e)=>{e=Y(e,"hsv");let[t,r,n]=e,i,s,o;if(n*=255,r===0)i=s=o=n;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;const a=qy(t),l=t-a,c=n*(1-r),u=n*(1-r*l),d=n*(1-r*(1-l));switch(a){case 0:[i,s,o]=[n,d,c];break;case 1:[i,s,o]=[u,n,c];break;case 2:[i,s,o]=[c,n,d];break;case 3:[i,s,o]=[c,u,n];break;case 4:[i,s,o]=[d,c,n];break;case 5:[i,s,o]=[n,c,u];break}}return[i,s,o,e.length>3?e[3]:1]},{min:Uy,max:Ky}=Math,Gy=(...e)=>{e=Y(e,"rgb");let[t,r,n]=e;const i=Uy(t,r,n),s=Ky(t,r,n),o=s-i;let a,l,c;return c=s/255,s===0?(a=Number.NaN,l=0):(l=o/s,t===s&&(a=(r-n)/o),r===s&&(a=2+(n-t)/o),n===s&&(a=4+(t-r)/o),a*=60,a<0&&(a+=360)),[a,l,c]};T.prototype.hsv=function(){return Gy(this._rgb)};const Wy=(...e)=>new T(...e,"hsv");X.hsv=Wy,H.format.hsv=jy,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"hsv"),Z(e)==="array"&&e.length===3)return"hsv"}});const Hy=(e,t,r)=>Kr(e,t,r,"hsv");qe.hsv=Hy;function zi(e,t){let r=e.length;Array.isArray(e[0])||(e=[e]),Array.isArray(t[0])||(t=t.map(o=>[o]));let n=t[0].length,i=t[0].map((o,a)=>t.map(l=>l[a])),s=e.map(o=>i.map(a=>Array.isArray(o)?o.reduce((l,c,u)=>l+c*(a[u]||0),0):a.reduce((l,c)=>l+c*o,0)));return r===1&&(s=s[0]),n===1?s.map(o=>o[0]):s}const Xo=(...e)=>{e=Y(e,"lab");const[t,r,n,...i]=e,[s,o,a]=Jy([t,r,n]),[l,c,u]=Nu(s,o,a);return[l,c,u,...i.length>0&&i[0]<1?[i[0]]:[]]};function Jy(e){var t=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],r=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],n=zi(r,e);return zi(t,n.map(i=>i**3))}const ea=(...e)=>{const[t,r,n,...i]=Y(e,"rgb"),s=Ru(t,r,n);return[...Yy(s),...i.length>0&&i[0]<1?[i[0]]:[]]};function Yy(e){const t=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],r=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],n=zi(t,e);return zi(r,n.map(i=>Math.cbrt(i)))}T.prototype.oklab=function(){return ea(this._rgb)},Object.assign(X,{oklab:(...e)=>new T(...e,"oklab")}),H.format.oklab=Xo,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"oklab"),Z(e)==="array"&&e.length===3)return"oklab"}});const Qy=(e,t,r)=>{const n=e.oklab(),i=t.oklab();return new T(n[0]+r*(i[0]-n[0]),n[1]+r*(i[1]-n[1]),n[2]+r*(i[2]-n[2]),"oklab")};qe.oklab=Qy;const Zy=(e,t,r)=>Kr(e,t,r,"oklch");qe.oklch=Zy;const{pow:ta,sqrt:ra,PI:na,cos:zu,sin:Bu,atan2:Xy}=Math,e_=(e,t="lrgb",r=null)=>{const n=e.length;r||(r=Array.from(new Array(n)).map(()=>1));const i=n/r.reduce(function(d,f){return d+f});if(r.forEach((d,f)=>{r[f]*=i}),e=e.map(d=>new T(d)),t==="lrgb")return t_(e,r);const s=e.shift(),o=s.get(t),a=[];let l=0,c=0;for(let d=0;d<o.length;d++)if(o[d]=(o[d]||0)*r[0],a.push(isNaN(o[d])?0:r[0]),t.charAt(d)==="h"&&!isNaN(o[d])){const f=o[d]/180*na;l+=zu(f)*r[0],c+=Bu(f)*r[0]}let u=s.alpha()*r[0];e.forEach((d,f)=>{const p=d.get(t);u+=d.alpha()*r[f+1];for(let m=0;m<o.length;m++)if(!isNaN(p[m]))if(a[m]+=r[f+1],t.charAt(m)==="h"){const g=p[m]/180*na;l+=zu(g)*r[f+1],c+=Bu(g)*r[f+1]}else o[m]+=p[m]*r[f+1]});for(let d=0;d<o.length;d++)if(t.charAt(d)==="h"){let f=Xy(c/a[d],l/a[d])/na*180;for(;f<0;)f+=360;for(;f>=360;)f-=360;o[d]=f}else o[d]=o[d]/a[d];return u/=n,new T(o,t).alpha(u>.99999?1:u,!0)},t_=(e,t)=>{const r=e.length,n=[0,0,0,0];for(let i=0;i<e.length;i++){const s=e[i],o=t[i]/r,a=s._rgb;n[0]+=ta(a[0],2)*o,n[1]+=ta(a[1],2)*o,n[2]+=ta(a[2],2)*o,n[3]+=a[3]*o}return n[0]=ra(n[0]),n[1]=ra(n[1]),n[2]=ra(n[2]),n[3]>.9999999&&(n[3]=1),new T(Bo(n))},{pow:r_}=Math;function Bi(e){let t="rgb",r=X("#ccc"),n=0,i=[0,1],s=[0,1],o=[],a=[0,0],l=!1,c=[],u=!1,d=0,f=1,p=!1,m={},g=!0,y=1;const _=function(S){if(S=S||["#fff","#000"],S&&Z(S)==="string"&&X.brewer&&X.brewer[S.toLowerCase()]&&(S=X.brewer[S.toLowerCase()]),Z(S)==="array"){S.length===1&&(S=[S[0],S[0]]),S=S.slice(0);for(let I=0;I<S.length;I++)S[I]=X(S[I]);o.length=0;for(let I=0;I<S.length;I++)o.push(I/(S.length-1))}return E(),c=S},b=function(S){if(l!=null){const I=l.length-1;let P=0;for(;P<I&&S>=l[P];)P++;return P-1}return 0};let w=S=>S,k=S=>S;const x=function(S,I){let P,C;if(I==null&&(I=!1),isNaN(S)||S===null)return r;I?C=S:l&&l.length>2?C=b(S)/(l.length-2):f!==d?C=(S-d)/(f-d):C=1,C=k(C),I||(C=w(C)),y!==1&&(C=r_(C,y)),C=a[0]+C*(1-a[0]-a[1]),C=yr(C,0,1);const R=Math.floor(C*1e4);if(g&&m[R])P=m[R];else{if(Z(c)==="array")for(let M=0;M<o.length;M++){const L=o[M];if(C<=L){P=c[M];break}if(C>=L&&M===o.length-1){P=c[M];break}if(C>L&&C<o[M+1]){C=(C-L)/(o[M+1]-L),P=X.interpolate(c[M],c[M+1],C,t);break}}else Z(c)==="function"&&(P=c(C));g&&(m[R]=P)}return P};var E=()=>m={};_(e);const $=function(S){const I=X(x(S));return u&&I[u]?I[u]():I};return $.classes=function(S){if(S!=null){if(Z(S)==="array")l=S,i=[S[0],S[S.length-1]];else{const I=X.analyze(i);S===0?l=[I.min,I.max]:l=X.limits(I,"e",S)}return $}return l},$.domain=function(S){if(!arguments.length)return s;s=S.slice(0),d=S[0],f=S[S.length-1],o=[];const I=c.length;if(S.length===I&&d!==f)for(let P of Array.from(S))o.push((P-d)/(f-d));else{for(let P=0;P<I;P++)o.push(P/(I-1));if(S.length>2){const P=S.map((R,M)=>M/(S.length-1)),C=S.map(R=>(R-d)/(f-d));C.every((R,M)=>P[M]===R)||(k=R=>{if(R<=0||R>=1)return R;let M=0;for(;R>=C[M+1];)M++;const L=(R-C[M])/(C[M+1]-C[M]);return P[M]+L*(P[M+1]-P[M])})}}return i=[d,f],$},$.mode=function(S){return arguments.length?(t=S,E(),$):t},$.range=function(S,I){return _(S),$},$.out=function(S){return u=S,$},$.spread=function(S){return arguments.length?(n=S,$):n},$.correctLightness=function(S){return S==null&&(S=!0),p=S,E(),p?w=function(I){const P=x(0,!0).lab()[0],C=x(1,!0).lab()[0],R=P>C;let M=x(I,!0).lab()[0];const L=P+(C-P)*I;let J=M-L,ut=0,xe=1,et=20;for(;Math.abs(J)>.01&&et-- >0;)(function(){return R&&(J*=-1),J<0?(ut=I,I+=(xe-I)*.5):(xe=I,I+=(ut-I)*.5),M=x(I,!0).lab()[0],J=M-L})();return I}:w=I=>I,$},$.padding=function(S){return S!=null?(Z(S)==="number"&&(S=[S,S]),a=S,$):a},$.colors=function(S,I){arguments.length<2&&(I="hex");let P=[];if(arguments.length===0)P=c.slice(0);else if(S===1)P=[$(.5)];else if(S>1){const C=i[0],R=i[1]-C;P=n_(0,S).map(M=>$(C+M/(S-1)*R))}else{e=[];let C=[];if(l&&l.length>2)for(let R=1,M=l.length,L=1<=M;L?R<M:R>M;L?R++:R--)C.push((l[R-1]+l[R])*.5);else C=i;P=C.map(R=>$(R))}return X[I]&&(P=P.map(C=>C[I]())),P},$.cache=function(S){return S!=null?(g=S,$):g},$.gamma=function(S){return S!=null?(y=S,$):y},$.nodata=function(S){return S!=null?(r=X(S),$):r},$}function n_(e,t,r){let n=[],i=e<t,s=t;for(let o=e;i?o<s:o>s;i?o++:o--)n.push(o);return n}const i_=function(e){let t=[1,1];for(let r=1;r<e;r++){let n=[1];for(let i=1;i<=t.length;i++)n[i]=(t[i]||0)+t[i-1];t=n}return t},s_=function(e){let t,r,n,i;if(e=e.map(s=>new T(s)),e.length===2)[r,n]=e.map(s=>s.lab()),t=function(s){const o=[0,1,2].map(a=>r[a]+s*(n[a]-r[a]));return new T(o,"lab")};else if(e.length===3)[r,n,i]=e.map(s=>s.lab()),t=function(s){const o=[0,1,2].map(a=>(1-s)*(1-s)*r[a]+2*(1-s)*s*n[a]+s*s*i[a]);return new T(o,"lab")};else if(e.length===4){let s;[r,n,i,s]=e.map(o=>o.lab()),t=function(o){const a=[0,1,2].map(l=>(1-o)*(1-o)*(1-o)*r[l]+3*(1-o)*(1-o)*o*n[l]+3*(1-o)*o*o*i[l]+o*o*o*s[l]);return new T(a,"lab")}}else if(e.length>=5){let s,o,a;s=e.map(l=>l.lab()),a=e.length-1,o=i_(a),t=function(l){const c=1-l,u=[0,1,2].map(d=>s.reduce((f,p,m)=>f+o[m]*c**(a-m)*l**m*p[d],0));return new T(u,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return t},o_=e=>{const t=s_(e);return t.scale=()=>Bi(t),t},{round:qu}=Math;T.prototype.rgb=function(e=!0){return e===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(qu)},T.prototype.rgba=function(e=!0){return this._rgb.slice(0,4).map((t,r)=>r<3?e===!1?t:qu(t):t)},Object.assign(X,{rgb:(...e)=>new T(...e,"rgb")}),H.format.rgb=(...e)=>{const t=Y(e,"rgba");return t[3]===void 0&&(t[3]=1),t},H.autodetect.push({p:3,test:(...e)=>{if(e=Y(e,"rgba"),Z(e)==="array"&&(e.length===3||e.length===4&&Z(e[3])=="number"&&e[3]>=0&&e[3]<=1))return"rgb"}});const dt=(e,t,r)=>{if(!dt[r])throw new Error("unknown blend mode "+r);return dt[r](e,t)},Zt=e=>(t,r)=>{const n=X(r).rgb(),i=X(t).rgb();return X.rgb(e(n,i))},Xt=e=>(t,r)=>{const n=[];return n[0]=e(t[0],r[0]),n[1]=e(t[1],r[1]),n[2]=e(t[2],r[2]),n},a_=e=>e,l_=(e,t)=>e*t/255,c_=(e,t)=>e>t?t:e,u_=(e,t)=>e>t?e:t,d_=(e,t)=>255*(1-(1-e/255)*(1-t/255)),f_=(e,t)=>t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255)),h_=(e,t)=>255*(1-(1-t/255)/(e/255)),p_=(e,t)=>e===255?255:(e=255*(t/255)/(1-e/255),e>255?255:e);dt.normal=Zt(Xt(a_)),dt.multiply=Zt(Xt(l_)),dt.screen=Zt(Xt(d_)),dt.overlay=Zt(Xt(f_)),dt.darken=Zt(Xt(c_)),dt.lighten=Zt(Xt(u_)),dt.dodge=Zt(Xt(p_)),dt.burn=Zt(Xt(h_));const{pow:m_,sin:g_,cos:y_}=Math;function __(e=300,t=-1.5,r=1,n=1,i=[0,1]){let s=0,o;Z(i)==="array"?o=i[1]-i[0]:(o=0,i=[i,i]);const a=function(l){const c=Ft*((e+120)/360+t*l),u=m_(i[0]+o*l,n),f=(s!==0?r[0]+l*s:r)*u*(1-u)/2,p=y_(c),m=g_(c),g=u+f*(-.14861*p+1.78277*m),y=u+f*(-.29227*p-.90649*m),_=u+f*(1.97294*p);return X(Bo([g*255,y*255,_*255,1]))};return a.start=function(l){return l==null?e:(e=l,a)},a.rotations=function(l){return l==null?t:(t=l,a)},a.gamma=function(l){return l==null?n:(n=l,a)},a.hue=function(l){return l==null?r:(r=l,Z(r)==="array"?(s=r[1]-r[0],s===0&&(r=r[1])):s=0,a)},a.lightness=function(l){return l==null?i:(Z(l)==="array"?(i=l,o=l[1]-l[0]):(i=[l,l],o=0),a)},a.scale=()=>X.scale(a),a.hue(r),a}const b_="0123456789abcdef",{floor:v_,random:w_}=Math,x_=(e=w_)=>{let t="#";for(let r=0;r<6;r++)t+=b_.charAt(v_(e()*16));return new T(t,"hex")},{log:ju,pow:k_,floor:M_,abs:S_}=Math;function Uu(e,t=null){const r={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Z(e)==="object"&&(e=Object.values(e)),e.forEach(n=>{t&&Z(n)==="object"&&(n=n[t]),n!=null&&!isNaN(n)&&(r.values.push(n),r.sum+=n,n<r.min&&(r.min=n),n>r.max&&(r.max=n),r.count+=1)}),r.domain=[r.min,r.max],r.limits=(n,i)=>Ku(r,n,i),r}function Ku(e,t="equal",r=7){Z(e)=="array"&&(e=Uu(e));const{min:n,max:i}=e,s=e.values.sort((a,l)=>a-l);if(r===1)return[n,i];const o=[];if(t.substr(0,1)==="c"&&(o.push(n),o.push(i)),t.substr(0,1)==="e"){o.push(n);for(let a=1;a<r;a++)o.push(n+a/r*(i-n));o.push(i)}else if(t.substr(0,1)==="l"){if(n<=0)throw new Error("Logarithmic scales are only possible for values > 0");const a=Math.LOG10E*ju(n),l=Math.LOG10E*ju(i);o.push(n);for(let c=1;c<r;c++)o.push(k_(10,a+c/r*(l-a)));o.push(i)}else if(t.substr(0,1)==="q"){o.push(n);for(let a=1;a<r;a++){const l=(s.length-1)*a/r,c=M_(l);if(c===l)o.push(s[c]);else{const u=l-c;o.push(s[c]*(1-u)+s[c+1]*u)}}o.push(i)}else if(t.substr(0,1)==="k"){let a;const l=s.length,c=new Array(l),u=new Array(r);let d=!0,f=0,p=null;p=[],p.push(n);for(let y=1;y<r;y++)p.push(n+y/r*(i-n));for(p.push(i);d;){for(let _=0;_<r;_++)u[_]=0;for(let _=0;_<l;_++){const b=s[_];let w=Number.MAX_VALUE,k;for(let x=0;x<r;x++){const E=S_(p[x]-b);E<w&&(w=E,k=x),u[k]++,c[_]=k}}const y=new Array(r);for(let _=0;_<r;_++)y[_]=null;for(let _=0;_<l;_++)a=c[_],y[a]===null?y[a]=s[_]:y[a]+=s[_];for(let _=0;_<r;_++)y[_]*=1/u[_];d=!1;for(let _=0;_<r;_++)if(y[_]!==p[_]){d=!0;break}p=y,f++,f>200&&(d=!1)}const m={};for(let y=0;y<r;y++)m[y]=[];for(let y=0;y<l;y++)a=c[y],m[a].push(s[y]);let g=[];for(let y=0;y<r;y++)g.push(m[y][0]),g.push(m[y][m[y].length-1]);g=g.sort((y,_)=>y-_),o.push(g[0]);for(let y=1;y<g.length;y+=2){const _=g[y];!isNaN(_)&&o.indexOf(_)===-1&&o.push(_)}}return o}const $_=(e,t)=>{e=new T(e),t=new T(t);const r=e.luminance(),n=t.luminance();return r>n?(r+.05)/(n+.05):(n+.05)/(r+.05)};const Gu=.027,C_=5e-4,A_=.1,Wu=1.14,qi=.022,Hu=1.414,E_=(e,t)=>{e=new T(e),t=new T(t),e.alpha()<1&&(e=jr(t,e,e.alpha(),"rgb"));const r=Ju(...e.rgb()),n=Ju(...t.rgb()),i=r>=qi?r:r+Math.pow(qi-r,Hu),s=n>=qi?n:n+Math.pow(qi-n,Hu),o=Math.pow(s,.56)-Math.pow(i,.57),a=Math.pow(s,.65)-Math.pow(i,.62),l=Math.abs(s-i)<C_?0:i<s?o*Wu:a*Wu;return(Math.abs(l)<A_?0:l>0?l-Gu:l+Gu)*100};function Ju(e,t,r){return .2126729*Math.pow(e/255,2.4)+.7151522*Math.pow(t/255,2.4)+.072175*Math.pow(r/255,2.4)}const{sqrt:Dt,pow:Me,min:I_,max:P_,atan2:Yu,abs:Qu,cos:ji,sin:Zu,exp:O_,PI:Xu}=Math;function T_(e,t,r=1,n=1,i=1){var s=function(Or){return 360*Or/(2*Xu)},o=function(Or){return 2*Xu*Or/360};e=new T(e),t=new T(t);const[a,l,c]=Array.from(e.lab()),[u,d,f]=Array.from(t.lab()),p=(a+u)/2,m=Dt(Me(l,2)+Me(c,2)),g=Dt(Me(d,2)+Me(f,2)),y=(m+g)/2,_=.5*(1-Dt(Me(y,7)/(Me(y,7)+Me(25,7)))),b=l*(1+_),w=d*(1+_),k=Dt(Me(b,2)+Me(c,2)),x=Dt(Me(w,2)+Me(f,2)),E=(k+x)/2,$=s(Yu(c,b)),S=s(Yu(f,w)),I=$>=0?$:$+360,P=S>=0?S:S+360,C=Qu(I-P)>180?(I+P+360)/2:(I+P)/2,R=1-.17*ji(o(C-30))+.24*ji(o(2*C))+.32*ji(o(3*C+6))-.2*ji(o(4*C-63));let M=P-I;M=Qu(M)<=180?M:P<=I?M+360:M-360,M=2*Dt(k*x)*Zu(o(M)/2);const L=u-a,J=x-k,ut=1+.015*Me(p-50,2)/Dt(20+Me(p-50,2)),xe=1+.045*E,et=1+.015*E*R,Ne=30*O_(-Me((C-275)/25,2)),Pr=-(2*Dt(Me(E,7)/(Me(E,7)+Me(25,7))))*Zu(2*o(Ne)),xi=Dt(Me(L/(r*ut),2)+Me(J/(n*xe),2)+Me(M/(i*et),2)+Pr*(J/(n*xe))*(M/(i*et)));return P_(0,I_(100,xi))}function N_(e,t,r="lab"){e=new T(e),t=new T(t);const n=e.get(r),i=t.get(r);let s=0;for(let o in n){const a=(n[o]||0)-(i[o]||0);s+=a*a}return Math.sqrt(s)}const R_=(...e)=>{try{return new T(...e),!0}catch{return!1}},F_={cool(){return Bi([X.hsl(180,1,.9),X.hsl(250,.7,.4)])},hot(){return Bi(["#000","#f00","#ff0","#fff"]).mode("rgb")}},ia={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},ed=Object.keys(ia),td=new Map(ed.map(e=>[e.toLowerCase(),e])),L_=typeof Proxy=="function"?new Proxy(ia,{get(e,t){const r=t.toLowerCase();if(td.has(r))return e[td.get(r)]},getOwnPropertyNames(){return Object.getOwnPropertyNames(ed)}}):ia,D_=(...e)=>{e=Y(e,"cmyk");const[t,r,n,i]=e,s=e.length>4?e[4]:1;return i===1?[0,0,0,s]:[t>=1?0:255*(1-t)*(1-i),r>=1?0:255*(1-r)*(1-i),n>=1?0:255*(1-n)*(1-i),s]},{max:rd}=Math,V_=(...e)=>{let[t,r,n]=Y(e,"rgb");t=t/255,r=r/255,n=n/255;const i=1-rd(t,rd(r,n)),s=i<1?1/(1-i):0,o=(1-t-i)*s,a=(1-r-i)*s,l=(1-n-i)*s;return[o,a,l,i]};T.prototype.cmyk=function(){return V_(this._rgb)},Object.assign(X,{cmyk:(...e)=>new T(...e,"cmyk")}),H.format.cmyk=D_,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"cmyk"),Z(e)==="array"&&e.length===4)return"cmyk"}});const z_=(...e)=>{const t=Y(e,"hsla");let r=Br(e)||"lsa";return t[0]=tt(t[0]||0)+"deg",t[1]=tt(t[1]*100)+"%",t[2]=tt(t[2]*100)+"%",r==="hsla"||t.length>3&&t[3]<1?(t[3]="/ "+(t.length>3?t[3]:1),r="hsla"):t.length=3,`${r.substr(0,3)}(${t.join(" ")})`},B_=(...e)=>{const t=Y(e,"lab");let r=Br(e)||"lab";return t[0]=tt(t[0])+"%",t[1]=tt(t[1]),t[2]=tt(t[2]),r==="laba"||t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`lab(${t.join(" ")})`},q_=(...e)=>{const t=Y(e,"lch");let r=Br(e)||"lab";return t[0]=tt(t[0])+"%",t[1]=tt(t[1]),t[2]=isNaN(t[2])?"none":tt(t[2])+"deg",r==="lcha"||t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`lch(${t.join(" ")})`},j_=(...e)=>{const t=Y(e,"lab");return t[0]=tt(t[0]*100)+"%",t[1]=qo(t[1]),t[2]=qo(t[2]),t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`oklab(${t.join(" ")})`},nd=(...e)=>{const[t,r,n,...i]=Y(e,"rgb"),[s,o,a]=ea(t,r,n),[l,c,u]=Lu(s,o,a);return[l,c,u,...i.length>0&&i[0]<1?[i[0]]:[]]},U_=(...e)=>{const t=Y(e,"lch");return t[0]=tt(t[0]*100)+"%",t[1]=qo(t[1]),t[2]=isNaN(t[2])?"none":tt(t[2])+"deg",t.length>3&&t[3]<1?t[3]="/ "+(t.length>3?t[3]:1):t.length=3,`oklch(${t.join(" ")})`},{round:sa}=Math,K_=(...e)=>{const t=Y(e,"rgba");let r=Br(e)||"rgb";if(r.substr(0,3)==="hsl")return z_(Vu(t),r);if(r.substr(0,3)==="lab"){const n=jn();Lt("d50");const i=B_(Go(t),r);return Lt(n),i}if(r.substr(0,3)==="lch"){const n=jn();Lt("d50");const i=q_(Yo(t),r);return Lt(n),i}return r.substr(0,5)==="oklab"?j_(ea(t)):r.substr(0,5)==="oklch"?U_(nd(t)):(t[0]=sa(t[0]),t[1]=sa(t[1]),t[2]=sa(t[2]),(r==="rgba"||t.length>3&&t[3]<1)&&(t[3]="/ "+(t.length>3?t[3]:1),r="rgba"),`${r.substr(0,3)}(${t.slice(0,r==="rgb"?3:4).join(" ")})`)},id=(...e)=>{e=Y(e,"lch");const[t,r,n,...i]=e,[s,o,a]=Fu(t,r,n),[l,c,u]=Xo(s,o,a);return[l,c,u,...i.length>0&&i[0]<1?[i[0]]:[]]},Vt=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,ft=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,Ui=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,rt=/\s*/.source,Wr=/\s+/.source,oa=/\s*,\s*/.source,Ki=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,Hr=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,sd=new RegExp("^rgba?\\("+rt+[Vt,Vt,Vt].join(Wr)+Hr+"\\)$"),od=new RegExp("^rgb\\("+rt+[Vt,Vt,Vt].join(oa)+rt+"\\)$"),ad=new RegExp("^rgba\\("+rt+[Vt,Vt,Vt,ft].join(oa)+rt+"\\)$"),ld=new RegExp("^hsla?\\("+rt+[Ki,Ui,Ui].join(Wr)+Hr+"\\)$"),cd=new RegExp("^hsl?\\("+rt+[Ki,Ui,Ui].join(oa)+rt+"\\)$"),ud=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,dd=new RegExp("^lab\\("+rt+[ft,ft,ft].join(Wr)+Hr+"\\)$"),fd=new RegExp("^lch\\("+rt+[ft,ft,Ki].join(Wr)+Hr+"\\)$"),hd=new RegExp("^oklab\\("+rt+[ft,ft,ft].join(Wr)+Hr+"\\)$"),pd=new RegExp("^oklch\\("+rt+[ft,ft,Ki].join(Wr)+Hr+"\\)$"),{round:md}=Math,Jr=e=>e.map((t,r)=>r<=2?yr(md(t),0,255):t),Se=(e,t=0,r=100,n=!1)=>(typeof e=="string"&&e.endsWith("%")&&(e=parseFloat(e.substring(0,e.length-1))/100,n?e=t+(e+1)*.5*(r-t):e=t+e*(r-t)),+e),Ke=(e,t)=>e==="none"?t:e,aa=e=>{if(e=e.toLowerCase().trim(),e==="transparent")return[0,0,0,0];let t;if(H.format.named)try{return H.format.named(e)}catch{}if((t=e.match(sd))||(t=e.match(od))){let r=t.slice(1,4);for(let i=0;i<3;i++)r[i]=+Se(Ke(r[i],0),0,255);r=Jr(r);const n=t[4]!==void 0?+Se(t[4],0,1):1;return r[3]=n,r}if(t=e.match(ad)){const r=t.slice(1,5);for(let n=0;n<4;n++)r[n]=+Se(r[n],0,255);return r}if((t=e.match(ld))||(t=e.match(cd))){const r=t.slice(1,4);r[0]=+Ke(r[0].replace("deg",""),0),r[1]=+Se(Ke(r[1],0),0,100)*.01,r[2]=+Se(Ke(r[2],0),0,100)*.01;const n=Jr(Zo(r)),i=t[4]!==void 0?+Se(t[4],0,1):1;return n[3]=i,n}if(t=e.match(ud)){const r=t.slice(1,4);r[1]*=.01,r[2]*=.01;const n=Zo(r);for(let i=0;i<3;i++)n[i]=md(n[i]);return n[3]=+t[4],n}if(t=e.match(dd)){const r=t.slice(1,4);r[0]=Se(Ke(r[0],0),0,100),r[1]=Se(Ke(r[1],0),-125,125,!0),r[2]=Se(Ke(r[2],0),-125,125,!0);const n=jn();Lt("d50");const i=Jr(Uo(r));Lt(n);const s=t[4]!==void 0?+Se(t[4],0,1):1;return i[3]=s,i}if(t=e.match(fd)){const r=t.slice(1,4);r[0]=Se(r[0],0,100),r[1]=Se(Ke(r[1],0),0,150,!1),r[2]=+Ke(r[2].replace("deg",""),0);const n=jn();Lt("d50");const i=Jr(Jo(r));Lt(n);const s=t[4]!==void 0?+Se(t[4],0,1):1;return i[3]=s,i}if(t=e.match(hd)){const r=t.slice(1,4);r[0]=Se(Ke(r[0],0),0,1),r[1]=Se(Ke(r[1],0),-.4,.4,!0),r[2]=Se(Ke(r[2],0),-.4,.4,!0);const n=Jr(Xo(r)),i=t[4]!==void 0?+Se(t[4],0,1):1;return n[3]=i,n}if(t=e.match(pd)){const r=t.slice(1,4);r[0]=Se(Ke(r[0],0),0,1),r[1]=Se(Ke(r[1],0),0,.4,!1),r[2]=+Ke(r[2].replace("deg",""),0);const n=Jr(id(r)),i=t[4]!==void 0?+Se(t[4],0,1):1;return n[3]=i,n}};aa.test=e=>sd.test(e)||ld.test(e)||dd.test(e)||fd.test(e)||hd.test(e)||pd.test(e)||od.test(e)||ad.test(e)||cd.test(e)||ud.test(e)||e==="transparent",T.prototype.css=function(e){return K_(this._rgb,e)};const G_=(...e)=>new T(...e,"css");X.css=G_,H.format.css=aa,H.autodetect.push({p:5,test:(e,...t)=>{if(!t.length&&Z(e)==="string"&&aa.test(e))return"css"}}),H.format.gl=(...e)=>{const t=Y(e,"rgba");return t[0]*=255,t[1]*=255,t[2]*=255,t};const W_=(...e)=>new T(...e,"gl");X.gl=W_,T.prototype.gl=function(){const e=this._rgb;return[e[0]/255,e[1]/255,e[2]/255,e[3]]},T.prototype.hex=function(e){return Tu(this._rgb,e)};const H_=(...e)=>new T(...e,"hex");X.hex=H_,H.format.hex=Ou,H.autodetect.push({p:4,test:(e,...t)=>{if(!t.length&&Z(e)==="string"&&[3,4,5,6,7,8,9].indexOf(e.length)>=0)return"hex"}});const{log:Gi}=Math,gd=e=>{const t=e/100;let r,n,i;return t<66?(r=255,n=t<6?0:-155.25485562709179-.44596950469579133*(n=t-2)+104.49216199393888*Gi(n),i=t<20?0:-254.76935184120902+.8274096064007395*(i=t-10)+115.67994401066147*Gi(i)):(r=351.97690566805693+.114206453784165*(r=t-55)-40.25366309332127*Gi(r),n=325.4494125711974+.07943456536662342*(n=t-50)-28.0852963507957*Gi(n),i=255),[r,n,i,1]},{round:J_}=Math,Y_=(...e)=>{const t=Y(e,"rgb"),r=t[0],n=t[2];let i=1e3,s=4e4;const o=.4;let a;for(;s-i>o;){a=(s+i)*.5;const l=gd(a);l[2]/l[0]>=n/r?s=a:i=a}return J_(a)};T.prototype.temp=T.prototype.kelvin=T.prototype.temperature=function(){return Y_(this._rgb)};const la=(...e)=>new T(...e,"temp");Object.assign(X,{temp:la,kelvin:la,temperature:la}),H.format.temp=H.format.kelvin=H.format.temperature=gd,T.prototype.oklch=function(){return nd(this._rgb)},Object.assign(X,{oklch:(...e)=>new T(...e,"oklch")}),H.format.oklch=id,H.autodetect.push({p:2,test:(...e)=>{if(e=Y(e,"oklch"),Z(e)==="array"&&e.length===3)return"oklch"}}),Object.assign(X,{analyze:Uu,average:e_,bezier:o_,blend:dt,brewer:L_,Color:T,colors:qr,contrast:$_,contrastAPCA:E_,cubehelix:__,deltaE:T_,distance:N_,input:H,interpolate:jr,limits:Ku,mix:jr,random:x_,scale:Bi,scales:F_,valid:R_});function Q_(e){return X(e).rgba()}function Z_(e){const t=X(e).hsl();return[t[0],t[1]*100,t[2]*100,t[3]!==void 0?t[3]:1]}function X_([e,t,r]){return(e*299+t*587+r*114)/1e3}function eb(e,t=window.document.documentElement){const n=getComputedStyle(t).getPropertyValue(e);return n?n.trim():null}function yd(){const e=K();return e?Object.values(e.states).filter(t=>!!t&&t.entity_id?.startsWith("media_player.")&&_r(t)):[]}function tb(){const e=K(),t=e.entities;return Object.keys(t).filter(n=>n.startsWith("media_player.")&&t[n].platform==="squeezebox").map(n=>e.states[n])}function _d(){return!!K().services.lyrion_cli}function bd(){return!!K().services.mass_queue}const Un=({icon:e,deviceClass:t})=>{if(e)return e;switch(t){case"speaker":return"mdi:speaker";case"receiver":return"mdi:audio-video";default:return"mdi:speaker"}},zt=(e,t,r)=>{const n=r?["state","attributes.volume_level","attributes.is_volume_muted","attributes.group_members"]:["state","attributes.media_duration","attributes.media_title","attributes.media_artist","attributes.media_album_name","attributes.icon","attributes.friendly_name","attributes.entity_picture","attributes.entity_picture_local","attributes.volume_level","attributes.is_volume_muted","attributes.source","attributes.shuffle","attributes.repeat","attributes.supported_features","attributes.group_members","attributes.active_child"],i=(o,a)=>a.split(".").reduce((c,u)=>c&&c[u]!==void 0?c[u]:void 0,o),s=(o,a)=>{if(o.length!==a.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==a[l])return!1;return!0};for(const o of n){const a=i(e,o),l=i(t,o);if(Array.isArray(a)&&Array.isArray(l)){if(!s(a,l))return!0}else if(a!==l)return!0}return!1},Wi=e=>e?Array.isArray(e)?e.length>0:e.enabled===!0:!1,ca=(e,t)=>!e&&!t?!1:t&&t.length>0?!0:Array.isArray(e)?e.length>0:e?.enabled===!0;let ua={};async function da(e,t){const r=JSON.stringify(e),n=t?.staleTime??1e4,i=ua[r],s=Date.now();if(!t?.forceRefresh&&i&&s-i.timestamp<i.staleTime)return i.value;const a=await K().connection.sendMessagePromise(e);return ua={...ua,[r]:{value:a,timestamp:s,staleTime:n}},a}const Bt=()=>{const e=K();if(typeof e.selectedTheme?.dark=="boolean")return e.selectedTheme.dark;const t=window.document.documentElement,n=getComputedStyle(t).getPropertyValue("--primary-text-color");if(n){const i=Q_(n);if(i)return X_(i)>180}return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches};function Hi(e,t){return e.entity_id===t?!0:typeof e?.attributes?.active_child<"u"?e.attributes.active_child===t:!1}function _r(e){if(typeof e?.attributes?.mass_player_type<"u")return!0;if(typeof e?.attributes?.active_child<"u"){const r=K().states[e.attributes.active_child];return r?_r(r):!1}return!1}const fa=(e,t)=>Array.isArray(e)?e:[{entity_id:e?.entity_id??t}];function rb(e){if(!e)return{title:"Unavailable",subtitle:"unknown unavailable"};const{attributes:{media_title:t,media_artist:r,media_album_name:n,media_series_title:i,media_season:s,media_episode:o,source:a}={},state:l,entity_id:c}=e,u=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();if(l==="off")return{title:u,subtitle:void 0};if(l==="unavailable")return{title:"Unavailable",subtitle:`${c} unavailable`};let d=t??"";(!d||d==="")&&(a&&typeof a=="string"&&!a.startsWith("media_player.")?d=a:d=u);let f;if(i){let p="";(s||o)&&(p=`S${s??""}${o?`E${o}`:""}`),f=`${i}${p?`  ${p}`:""}`}else(n||r)&&(f=`${n&&n!==d?`${n}  `:""}${r??""}`);return{title:d,subtitle:f}}const Ji=({source:e,fallbackIcon:t})=>{switch(e?.toLowerCase()){case"spotify":return"mdi:spotify";case"airplay":return"mdi:cast-audio-variant";case"bluetooth":return"mdi:bluetooth";case"net radio":return"mdi:radio";case"server":return"mdi:server";case"usb":return"mdi:usb";case"aux":return"mdi:audio-input-rca";case"hdmi":return"mdi:hdmi-port";case"tv":return"mdi:television";case"tuner":return"mdi:radio-tower";case"optical":return"mdi:audio-input-stereo-minijack";default:return t??"mdi:music"}},Yr=(e,t)=>e===0||t?"mdi:volume-off":e<.5?"mdi:volume-medium":"mdi:volume-high";function vd(e,t,r){let n=r??t.media_players.find(s=>s.entity_id===t.entity_id);const i=e.states[n?.entity_id??t.entity_id]?.state;if(n&&wd(i,t.options?.player_is_active_when??"playing")){const s=e.states[n?.speaker_group_entity_id||n.entity_id],o=s?.attributes?.group_members;if(!o?.length||o[0]===s.entity_id)return n}return t.media_players.forEach(s=>{const o=e.states[s.entity_id];if(wd(o.state,t.options?.player_is_active_when??"playing")){const a=e.states[s.speaker_group_entity_id||s.entity_id],l=a?.attributes?.group_members;(!l?.length||l[0]===a.entity_id)&&(n=s)}}),n}const wd=(e,t)=>t==="playing"?e==="playing":e==="playing"||e==="paused",nb=(e,t,r=!1)=>{const n=K(),i=n.states[e];if(i&&(n.callService("media_player","volume_set",{entity_id:e,volume_level:t}),r&&i.attributes.group_members?.length>0)){const s=i.attributes.volume_level||0,o=s>0?t/s:1;i.attributes.group_members.slice(1).forEach(a=>{const l=n.states[a];if(!l)return;const c=l.attributes.volume_level||0,u=Math.min(Math.max(c*o,0),1);n.callService("media_player","volume_set",{entity_id:a,volume_level:u})})}};function ib(e,t){const{shuffle:r,repeat:n,supported_features:i}=t,s=e==="off",o=!s&&i!==void 0&&(i|16)===i,a=!s&&i!==void 0&&(i|32)===i,l=!s&&i!==void 0&&((i&1)===1||(i&16384)===16384),c=!s&&i!==void 0&&(i&4096)===4096,u=!c&&!l,d=!s&&!u&&r!==void 0&&i!==void 0&&(i&32768)===32768,f=!s&&!u&&n!==void 0&&i!==void 0&&(i&262144)===262144;return{supportPreviousTrack:o,supportNextTrack:a,supportsShuffle:d,supportsRepeat:f,supportsTogglePlayPause:l,supportsStop:c}}async function xd(e,t){const r=K();await r.callService("media_player","join",{entity_id:e,group_members:[t]}),await r.callService("media_player","turn_off",{entity_id:e}),await r.callService("media_player","turn_on",{entity_id:t}),await r.callService("media_player","media_play",{entity_id:t}),await r.callService("media_player","unjoin",{entity_id:e})}async function kd(e,t){const r=K();if(!r)throw new Error("hass object not available");await r.callService("music_assistant","transfer_queue",{source_player:e},{entity_id:t})}var Md=function(t,r){var n=arguments;if(r==null||!qn.call(r,"css"))return Ue.apply(void 0,n);var i=n.length,s=new Array(i);s[0]=Vo,s[1]=Do(t,r);for(var o=2;o<i;o++)s[o]=n[o];return Ue.apply(null,s)};(function(e){var t;t||(t=e.JSX||(e.JSX={}))})(Md||(Md={}));function v(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return xu(t)}function br(){var e=v.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const sb={root:v({background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"var(--mmpc-icon-size)",aspectRatio:"1","& > ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-size)",width:"var(--mmpc-icon-size)",height:"var(--mmpc-icon-size)",display:"flex"}})},be=({icon:e,size:t="medium",className:r})=>h("div",{css:sb.root,style:{"--mmpc-icon-size":`${ha(t)}px`},className:r,children:h("ha-icon",{icon:e})}),ha=e=>{switch(e){case"xxx-small":return 8;case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}},Sd=br`
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
`,j={colors:{dialog:"var(--mmpc-dialog, var(--ha-dialog-surface-background, var(--mdc-theme-surface,#fff)))",onDialog:"var(--mmpc-on-dialog, var(--primary-text-color, #333))",onDialogMuted:"var(--mmpc-on-dialog-muted, var(--secondary-text-color, #888))",onDialogDivider:"var(--mmpc-on-dialog-divider, var(--divider-color, rgba(0, 0, 0, 0.12)))",card:"var(--mmpc-card, var(--card-background-color))",onCard:"var(--mmpc-on-card, var(--primary-text-color, #333))",onCardMuted:"var(--mmpc-on-card-muted, var(--secondary-text-color, #666))",onCardDivider:"var(--mmpc-on-card-divider, var(--divider-color, rgba(0, 0, 0, 0.12)))"},sizes:{cardBorderRadius:"var(--ha-card-border-radius, var(--ha-border-radius-lg, 12px))"}};function $d(e,t){const[r,n]=F(e);return ee(()=>{const i=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(i)}},[e,t]),r}function pa(){const[e,t]=F({width:null,height:null}),r=ge(null);return[O(i=>{if(r.current&&(r.current.disconnect(),r.current=null),i?.nodeType===Node.ELEMENT_NODE){const s=new ResizeObserver(([o])=>{if(o&&o.borderBoxSize){const{inlineSize:a,blockSize:l}=o.borderBoxSize[0];t({width:a,height:l})}});s.observe(i),r.current=s}},[]),e]}function ob(){const[e,t]=F({x:null,y:null}),r=O((...n)=>{if(typeof n[0]=="object")window.scrollTo(n[0]);else if(typeof n[0]=="number"&&typeof n[1]=="number")window.scrollTo(n[0],n[1]);else throw new Error("Invalid arguments passed to scrollTo. See here for more info. https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo")},[]);return Nt(()=>{const n=()=>{t({x:window.scrollX,y:window.scrollY})};return n(),window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)}},[]),[e,r]}const ab=br`
    from { opacity: 0; }
    to { opacity: 1; }
`,Cd={popoverWrap:v({position:"relative",width:"100%",height:"100%",margin:0,padding:0,backgroundColor:"transparent",border:"none",pointerEvents:"none"}),popoverRoot:v({pointerEvents:"auto",position:"absolute",zIndex:100,opacity:1,backgroundColor:"transparent",padding:0,animation:`${ab} 0.3s ease`,maxHeight:"100vh",overflowY:"auto",":popover-open":{border:0}})},Yi=8,Ad=Rt(({renderTrigger:e,side:t="bottom",align:r="start",children:n},i)=>{const[s,o]=F(),[a,l]=F(),c=s??t,u=a??r,[d,f]=F(!1);Si(i,()=>({setOpen:f}),[f]);const p=ge(null),m=ge(null),[g,y]=F(null),[_,b]=F(null);ee(()=>{if(!d)return;function P(C){C.key==="Escape"&&f(!1)}return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[d]),ee(()=>{if(!d)return;function P(C){const R=C.composedPath?C.composedPath():[],M=C.target,L=m.current,J=p.current,ut=L&&(R.includes(L)||L.contains(M)),xe=J&&(R.includes(J)||J.contains(M));!ut&&!xe&&(f(!1),l(void 0),o(void 0))}return window.addEventListener("click",P),()=>window.removeEventListener("click",P)},[d]);const w=()=>{f(!0),y(p.current?.getBoundingClientRect()||null),setTimeout(()=>{b(m.current?.getBoundingClientRect()||null)},0)},k=O(()=>{d?(f(!1),l(void 0),o(void 0)):w()},[d]),[x]=ob(),E=O((P,C,R)=>{switch(P){case"top":return{top:Math.max(0,C.top-Yi-R.height)};case"bottom":return{top:Math.max(0,C.top+C.height+Yi)};case"left":return{left:Math.max(0,C.left-R.width-Yi)};case"right":return{left:Math.max(0,C.left+C.width+Yi)}}},[]),$=O((P,C,R,M)=>{switch(P){case"start":return C==="right"||C==="left"?{top:Math.max(0,R.top)}:{left:R.left};case"center":return C==="right"||C==="left"?{top:Math.max(0,R.top+R.height/2-M.height/2)}:{left:R.left-M.width/2+R.width/2};case"end":return C==="right"||C==="left"?{top:Math.max(0,R.top-M.height+R.height)}:{left:R.left-M.width+R.width}}},[]),S=V(()=>{if(!g||!_)return{};const P=E(c,g,_),C=$(u,c,g,_);return{...P,...C}},[g,_,c,u]);ee(()=>{const P=m.current;if(!P||!d)return;const C=new window.IntersectionObserver(R=>{R.forEach(M=>{if(M.intersectionRatio<1){if(M.boundingClientRect.height!==M.intersectionRect.height){const L=M.boundingClientRect.top!==M.intersectionRect.top,J=M.intersectionRect.bottom!==M.boundingClientRect.bottom;J&&L||(J&&(t==="bottom"&&o("top"),(t==="right"||t==="left")&&l("end")),L&&(t==="top"&&o("bottom"),(t==="right"||t==="left")&&l("start")))}if(M.boundingClientRect.width!==M.intersectionRect.width){const L=M.boundingClientRect.right!==M.intersectionRect.right,J=M.boundingClientRect.left!==M.intersectionRect.left;J&&L||(L&&((t==="top"||t==="bottom")&&l("end"),t==="right"&&o("left")),J&&((t==="top"||t==="bottom")&&l("start"),t==="left"&&o("right")))}}})},{root:null,threshold:0});return C.observe(P),()=>{C.disconnect()}},[m.current,d,t,r]);const I=F(()=>`overlay-popover-${Math.random().toString(36).substr(2,9)}`)[0];return A(Q,{children:[e({onClick:k,popoverTarget:I,ref:p}),d&&h("div",{style:{top:x?.y||0,left:x?.x||0},css:Cd.popoverWrap,id:I,popover:"manual",children:h("div",{css:Cd.popoverRoot,role:"menu",style:S,ref:m,children:n})})]})}),Qr={menuRoot:v({background:j.colors.dialog,color:j.colors.onDialog,borderRadius:12,minWidth:180,boxShadow:"0 2px 12px rgba(0,0,0,0.12)",padding:4,gap:4,display:"flex",flexDirection:"column",border:`1px solid ${j.colors.onDialogDivider}`}),item:v({display:"flex",alignItems:"center",gap:10,padding:"8px 14px",borderRadius:8,backgroundColor:"transparent",fontSize:15,cursor:"pointer",color:"inherit",transition:"background 0.15s",position:"relative",border:"none","&:hover, &[data-highlighted]":{background:j.colors.onDialogDivider},"&[data-disabled]":{color:j.colors.onDialogMuted,cursor:"not-allowed"}}),itemSelected:v({background:j.colors.onDialogDivider}),itemChevron:v({marginLeft:"auto"}),itemTitle:v({padding:"8px 14px 4px 14px",fontSize:13,fontWeight:"bold",color:j.colors.onDialogMuted})},nt=({menuItems:e,...t})=>{const r=ge(null),n=(s,o,a,l)=>s?.type==="title"?h("span",{css:Qr.itemTitle,children:s.label},s.label+l):A("button",{css:[Qr.item,s.selected&&Qr.itemSelected],onClick:()=>{a||r.current?.setOpen(!1),s.onClick&&s.onClick()},role:"menuitem",...o,children:[s.icon&&h(be,{icon:s.icon,size:"x-small"}),h("span",{children:s.label}),a&&h(be,{icon:"mdi:chevron-down",size:"x-small",css:Qr.itemChevron})]},s.label+l),i=(s,o=0)=>s.map((a,l)=>{const c=(!a.type||a.type==="item")&&!!(a.children&&a.children.length>0);return c?h(Ad,{side:"right",align:"start",renderTrigger:u=>n(a,u,c,l),children:h("div",{css:Qr.menuRoot,role:"menu",children:i(a.children,o+1)})}):n(a,{},c,l)});return h(Ad,{ref:r,...t,children:h("div",{css:Qr.menuRoot,role:"menu",children:i(e)})})},lb={MediocreMultiMediaPlayerCard:{SpeakerGrouping:{join_title:"Join media players",join_subtitle:"Selected player grouping.",link_volume:"Link Volume",player_focus_title:"Player focus",player_focus_subtitle:"Change which player you are controlling."},MediaBrowserView:{browse_media_title:"Browse Media"},SearchView:{search_in_ma_title:"Search in Music Assistant",search_title:"Search"},AdditionalActionsView:{shortcuts_title:"Shortcuts",shortcuts_subtitle:"Quick access to your favorite actions.",media_player_actions_title:"Media Player actions",media_player_actions_subtitle:"Additional controls for your media player.",mark_as_favorite:"Mark as Favorite",transfer_queue:"Transfer Queue"},QueueView:{up_next:"Up Next",up_next_subtitle:"Current playback queue"}},MediocreMediaPlayerCard:{SpeakerGrouping:{grouped_speakers_title:"Grouped speakers",link_volume_title:"Link volume",add_speakers_title:"Add speakers to group"},QueueView:{up_next:"Up Next"}},MediocreMassiveMediaPlayerCard:{PlayerActions:{volume_modal_title:"Volume",speaker_grouping_modal_title:"Speaker Grouping",media_browser_modal_title:"Media Browser",search_modal_title:"Search",shortcuts_modal_title:"Shortcuts",queue_view_modal_title:"Up Next"},SpeakerGrouping:{link_volume:"Link volume"}},Search:{search_provider:{title:"Search using.."},input_placeholder:"Search for media...",categories:{All:"All",Favorites:"Favorites",Favorite:"Favorite",Artists:"Artists",Albums:"Albums",Tracks:"Tracks",Playlists:"Playlists",Podcasts:"Podcasts",Audiobooks:"Audiobooks",Genres:"Genres",Radio:"Radio"},enqueue_mode:{title:"Enqueue Mode",play:"Play",replace:"Replace Queue",next:"Add Next",replace_next:"Replace Next",add:"Add to Queue"},no_results:"No results found."},MediaBrowser:{breadcrumb_home:"Home",filter_placeholder:"Filter results...",empty_text:"No media items available.",media_item_menu:{enqueue_dropdown_label:"Enqueue",enqueue_mode:{play:"Play",next:"Play Next",replace:"Replace Queue",add:"Add to Queue"},browse:"Browse"}},AdditionalActionsMenu:{mark_as_favorite:"Mark as Favorite",transfer_queue:"Transfer Queue",select_source:"Select Source"},player_states:{Off:"Off",Idle:"Idle",Playing:"Playing",Paused:"Paused",Stopped:"Stopped",Unavailable:"Unavailable"}},cb={MediocreMultiMediaPlayerCard:{SpeakerGrouping:{join_title:"Synk. medieafspillere",join_subtitle:"Valgt medieafspiller-gruppering.",link_volume:"Synk. lydstyrke",player_focus_title:"Afspillerfokus",player_focus_subtitle:"Vlg hvilken afspiller du styrer."},MediaBrowserView:{browse_media_title:"Gennemse medier"},SearchView:{search_in_ma_title:"Sg i Music Assistant",search_title:"Sg"},AdditionalActionsView:{shortcuts_title:"Genveje",shortcuts_subtitle:"Hurtig adgang til dine favorit-handlinger.",media_player_actions_title:"Medieafspiller-handlinger",media_player_actions_subtitle:"Ekstra valgmuligheder til din medieafspiller.",mark_as_favorite:"Marker som favorit",transfer_queue:"Overfr k"},QueueView:{up_next:"Nste i k",up_next_subtitle:"Nuvrende afspilningsk"}},MediocreMediaPlayerCard:{SpeakerGrouping:{grouped_speakers_title:"Synk. medieafspillere",link_volume_title:"Synk. lydstyrke",add_speakers_title:"Tilfj medieafspillere til gruppe"},QueueView:{up_next:"Nste i k"}},MediocreMassiveMediaPlayerCard:{PlayerActions:{volume_modal_title:"Lydstyrke",speaker_grouping_modal_title:"Synk. medieafspillere",media_browser_modal_title:"Gennemse medier",search_modal_title:"Sg",shortcuts_modal_title:"Genveje",queue_view_modal_title:"Nste i k"},SpeakerGrouping:{link_volume:"Synk. lydstyrke"}},Search:{search_provider:{title:"Sg med.."},input_placeholder:"Sg efter medier...",categories:{All:"Alt",Favorites:"Favoritter",Favorite:"Favorit",Artists:"Kunstnere",Albums:"Albums",Tracks:"Numre",Playlists:"Playlister",Podcasts:"Podcasts",Audiobooks:"Lydbger",Genres:"Genrer",Radio:"Radio"},enqueue_mode:{title:"K-tilstand",play:"Afspil",replace:"Erstat k",next:"Tilfj nste",replace_next:"Erstat nste",add:"Tilfj til k"},no_results:"Ingen resultater fundet."},MediaBrowser:{breadcrumb_home:"Hjem",filter_placeholder:"Filtrer resultater...",empty_text:"Ingen medieelementer tilgngelige.",media_item_menu:{enqueue_dropdown_label:"Tilfj til k",enqueue_mode:{play:"Afspil",next:"Afspil nste",replace:"Erstat k",add:"Tilfj til k"},browse:"Gennemse"}},AdditionalActionsMenu:{mark_as_favorite:"Marker som favorit",transfer_queue:"Overfr k",select_source:"Vlg kilde"},player_states:{Off:"Slukket",Idle:"Inaktiv",Playing:"Afspiller",Paused:"P pause",Stopped:"Stoppet",Unavailable:"Utilgngelig"}},ub={MediocreMultiMediaPlayerCard:{SpeakerGrouping:{join_title:"Juntar leitores multimdia",join_subtitle:"Agrupamento de leitor selecionado.",link_volume:"Sincronizar Volume",player_focus_title:"Foco do leitor",player_focus_subtitle:"Altere qual o leitor que est a controlar."},MediaBrowserView:{browse_media_title:"Explorar Multimdia"},SearchView:{search_in_ma_title:"Pesquisar no Music Assistant",search_title:"Pesquisar"},AdditionalActionsView:{shortcuts_title:"Atalhos",shortcuts_subtitle:"Acesso rpido s suas aes favoritas.",media_player_actions_title:"Aes do leitor multimdia",media_player_actions_subtitle:"Controlos adicionais para o seu leitor multimdia.",mark_as_favorite:"Marcar como Favorito",transfer_queue:"Transferir Fila"}},MediocreMediaPlayerCard:{SpeakerGrouping:{grouped_speakers_title:"Altifalantes agrupados",link_volume_title:"Sincronizar volume",add_speakers_title:"Adicionar altifalantes ao grupo"}},MediocreMassiveMediaPlayerCard:{PlayerActions:{volume_modal_title:"Volume",speaker_grouping_modal_title:"Agrupamento de Altifalantes",media_browser_modal_title:"Explorador de Multimdia",search_modal_title:"Pesquisar",shortcuts_modal_title:"Atalhos"},SpeakerGrouping:{link_volume:"Sincronizar volume"}},Search:{input_placeholder:"Pesquisar multimdia...",categories:{All:"Tudo",Favorites:"Favoritos",Favorite:"Favorito",Artists:"Artistas",Albums:"lbuns",Tracks:"Faixas",Playlists:"Listas de reproduo",Podcasts:"Podcasts",Audiobooks:"Audiolivros",Genres:"Gneros",Radio:"Rdio"},enqueue_mode:{play:"Reproduzir",replace:"Substituir Fila",next:"Adicionar a Seguir",replace_next:"Substituir Seguinte",add:"Adicionar  Fila"},no_results:"Nenhum resultado encontrado."},MediaBrowser:{breadcrumb_home:"Incio",filter_placeholder:"Filtrar resultados...",empty_text:"Nenhum item multimdia disponvel.",media_item_menu:{enqueue_dropdown_label:"Adicionar  fila",enqueue_mode:{play:"Reproduzir",next:"Reproduzir a Seguir",replace:"Substituir Fila",add:"Adicionar  Fila"},browse:"Explorar"}},AdditionalActionsMenu:{mark_as_favorite:"Marcar como Favorito",transfer_queue:"Transferir Fila",select_source:"Selecionar Fonte"},player_states:{Off:"Desligado",Idle:"Inativo",Playing:"A reproduzir",Paused:"Em pausa",Stopped:"Parado",Unavailable:"Indisponvel"}},db={MediocreMultiMediaPlayerCard:{SpeakerGrouping:{join_title:"Medienplayer verbinden",join_subtitle:"Ausgewhlte Player-Gruppierung.",link_volume:"Lautstrke verknpfen",player_focus_title:"Player-Fokus",player_focus_subtitle:"ndern, welchen Player gesteuert wird."},MediaBrowserView:{browse_media_title:"Medien durchsuchen"},SearchView:{search_in_ma_title:"In Music Assistant suchen",search_title:"Suche"},AdditionalActionsView:{shortcuts_title:"Kurzbefehle",shortcuts_subtitle:"Schnellzugriff auf bevorzugten Aktionen.",media_player_actions_title:"Medienplayer-Aktionen",media_player_actions_subtitle:"Zustzliche Steuerungen fr Medienplayer.",mark_as_favorite:"Als Favorit markieren",transfer_queue:"Warteschlange bertragen"}},MediocreMediaPlayerCard:{SpeakerGrouping:{grouped_speakers_title:"Gruppierte Lautsprecher",link_volume_title:"Lautstrke verknpfen",add_speakers_title:"Lautsprecher zur Gruppe hinzufgen"}},MediocreMassiveMediaPlayerCard:{PlayerActions:{volume_modal_title:"Lautstrke",speaker_grouping_modal_title:"Lautsprecher-Gruppierung",media_browser_modal_title:"Medienbrowser",search_modal_title:"Suche",shortcuts_modal_title:"Kurzbefehle"},SpeakerGrouping:{link_volume:"Lautstrke verknpfen"}},Search:{input_placeholder:"Nach Medien suchen...",categories:{All:"Alle",Favorites:"Favoriten",Favorite:"Favorit",Artists:"Knstler",Albums:"Alben",Tracks:"Titel",Playlists:"Playlisten",Podcasts:"Podcasts",Audiobooks:"Hrbcher",Genres:"Genres",Radio:"Radio"},enqueue_mode:{play:"Abspielen",replace:"Warteschlange ersetzen",next:"Als Nchstes abspielen",replace_next:"Nchstes ersetzen",add:"Zur Warteschlange hinzufgen"},no_results:"Keine Ergebnisse gefunden."},MediaBrowser:{breadcrumb_home:"Startseite",filter_placeholder:"Ergebnisse filtern...",empty_text:"Keine Medienelemente verfgbar.",media_item_menu:{enqueue_dropdown_label:"Zur Warteschlange",enqueue_mode:{play:"Abspielen",next:"Als Nchstes abspielen",replace:"Warteschlange ersetzen",add:"Zur Warteschlange hinzufgen"},browse:"Durchsuchen"}},AdditionalActionsMenu:{mark_as_favorite:"Als Favorit markieren",transfer_queue:"Wiedergabeliste bergeben",select_source:"Quelle whlen"},player_states:{Off:"Aus",Idle:"Leerlauf",Playing:"Abspielen",Paused:"Pausiert",Stopped:"Gestoppt",Unavailable:"Nicht verfgbar"}},fb={MediocreMultiMediaPlayerCard:{SpeakerGrouping:{join_title:"Mediaspelers koppelen",join_subtitle:"Geselecteerde spelergroep.",link_volume:"Volume koppelen",player_focus_title:"Spelerfocus",player_focus_subtitle:"Wijzig welke speler je bedient."},MediaBrowserView:{browse_media_title:"Media bladeren"},SearchView:{search_in_ma_title:"Zoeken in Music Assistant",search_title:"Zoeken"},AdditionalActionsView:{shortcuts_title:"Snelkoppelingen",shortcuts_subtitle:"Snelle toegang tot je favoriete acties.",media_player_actions_title:"Mediaspeleracties",media_player_actions_subtitle:"Extra bedieningselementen voor je mediaspeler.",mark_as_favorite:"Markeren als favoriet",transfer_queue:"Wachtrij overzetten"}},MediocreMediaPlayerCard:{SpeakerGrouping:{grouped_speakers_title:"Gegroepeerde luidsprekers",link_volume_title:"Volume koppelen",add_speakers_title:"Luidsprekers toevoegen aan groep"}},MediocreMassiveMediaPlayerCard:{PlayerActions:{volume_modal_title:"Volume",speaker_grouping_modal_title:"Luidsprekergroepering",media_browser_modal_title:"Mediabrowser",search_modal_title:"Zoeken",shortcuts_modal_title:"Snelkoppelingen"},SpeakerGrouping:{link_volume:"Volume koppelen"}},Search:{input_placeholder:"Zoeken naar media...",categories:{All:"Alles",Favorites:"Favorieten",Favorite:"Favoriet",Artists:"Artiesten",Albums:"Albums",Tracks:"Nummers",Playlists:"Afspeellijsten",Podcasts:"Podcasts",Audiobooks:"Luisterboeken",Genres:"Genres",Radio:"Radio"},enqueue_mode:{play:"Afspelen",replace:"Wachtrij vervangen",next:"Als volgende toevoegen",replace_next:"Volgende vervangen",add:"Aan wachtrij toevoegen"},no_results:"Geen resultaten gevonden."},MediaBrowser:{breadcrumb_home:"Home",filter_placeholder:"Resultaten filteren...",empty_text:"Geen media-items beschikbaar.",media_item_menu:{enqueue_dropdown_label:"In wachtrij",enqueue_mode:{play:"Afspelen",next:"Speel volgende af",replace:"Wachtrij vervangen",add:"Aan wachtrij toevoegen"},browse:"Bladeren"}},AdditionalActionsMenu:{mark_as_favorite:"Markeren als favoriet",transfer_queue:"Wachtrij overzetten",select_source:"Bron selecteren"},player_states:{Off:"Uit",Idle:"Inactief",Playing:"Afspelen",Paused:"Gepauzeerd",Stopped:"Gestopt",Unavailable:"Niet beschikbaar"}};function Qi(e,t=""){return Object.keys(e).reduce((r,n)=>{const i=e[n],s=t?`${t}.${n}`:n;return typeof i=="string"?r[s]=i:typeof i=="object"&&i!==null&&Object.assign(r,Qi(i,s)),r},{})}const hb=["en","da","pt","de","nl"],ma={en:lb,da:cb,pt:ub,de:db,nl:fb},Ed=_t({}),pb=Pe(({locale:e,children:t})=>{const r=V(()=>hb.includes(e)?Object.assign({},Qi(ma.en),Qi(ma[e])):Qi(ma.en),[e]);return h(Ed.Provider,{value:{messages:r,locale:e},children:t})}),Fe=()=>{const e=te(Ed),t=O(({id:r,defaultMessage:n})=>e.messages[r]??n??r,[e.messages]);return V(()=>({t}),[t])},Id=_t({player:{}}),ga=Pe(({children:e,entityId:t})=>{const r=$e(),{t:n}=Fe(),i=V(()=>{const s=r.states[t];if(!s)return{player:{entity_id:t,state:"unavailable",attributes:{},title:n({id:"player_states.Unavailable"}),subtitle:`${t} unavailable`}};const{title:o,subtitle:a}=rb(s);return{player:{...s,title:n({id:`player_states.${o}`,defaultMessage:o}),subtitle:a}}},[r.states[t],t]);return h(Id.Provider,{value:i,children:typeof e=="function"?e(i):e})}),ye=()=>{const e=te(Id);if(!e)throw new Error("useHass must be used within a HassContextProvider");return e.player},Pd=({ma_entity_id:e,ma_favorite_button_entity_id:t,lms_entity_id:r,noSourceSelection:n,...i})=>{const{t:s}=Fe(),o=ye(),a=V(()=>_r(o),[o]),l=V(()=>r&&Hi(o,r),[o,r]),c=O(()=>{t&&K().callService("button","press",{entity_id:t})},[t]),u=O(f=>{e&&kd(e,f)},[e]),d=V(()=>{const f=[];if(e&&a){const p=yd().filter(m=>m.entity_id!==e&&_r(m)&&m.state!=="unavailable");t&&f.push({label:s({id:"AdditionalActionsMenu.mark_as_favorite"}),icon:"mdi:heart-plus",onClick:c}),p.length>0&&f.push({label:s({id:"AdditionalActionsMenu.transfer_queue"}),icon:"mdi:transfer",children:p.map(m=>({label:m.attributes.friendly_name||m.entity_id,onClick:()=>u(m.entity_id)}))})}if(r&&l){const p=tb().filter(m=>m.entity_id!==r&&m.state!=="unavailable");p.length>0&&f.push({label:s({id:"AdditionalActionsMenu.transfer_queue"}),icon:"mdi:transfer",children:p.map(m=>({label:m.attributes.friendly_name||m.entity_id,onClick:()=>{xd(r,m.entity_id)}}))})}return!n&&o.attributes.source_list?.length&&o.attributes.source_list?.length>0&&f.push({label:s({id:"AdditionalActionsMenu.select_source"}),icon:"mdi:import",children:(o.attributes.source_list??[]).map(p=>({label:p,onClick:()=>{K().callService("media_player","select_source",{entity_id:o.entity_id,source:p})}}))}),f},[t,a,e,r,c,u,n]);return d.length===0?null:h(nt,{menuItems:d,...i})},Kn={root:v({background:"none",border:"none",cursor:"pointer",padding:"0px",margin:"0px",position:"relative",overflow:"hidden",width:"var(--mmpc-art-width)",height:"var(--mmpc-art-height)","&::after":{content:'""',display:"block",paddingBottom:"100%"}}),contentContainer:v({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"}),image:v({height:"100%",aspectRatio:"1 / 1",objectFit:"cover",borderRadius:"var(--mmpc-art-border-radius, 4px)",opacity:0}),imageLoaded:v({animation:`${Sd} 0.3s ease forwards`}),iconContainer:v({display:"flex",justifyContent:"center",alignItems:"center","--icon-primary-color":j.colors.card,backgroundColor:j.colors.onCard,opacity:.5,borderRadius:"var(--mmpc-art-border-radius, 4px)",height:"100%",aspectRatio:"1 / 1"})},Od=({size:e,borderRadius:t=4,iconSize:r,renderLongPressIndicator:n,...i})=>{const s=ye(),{media_title:o,media_artist:a,entity_picture:l,entity_picture_local:c,icon:u,device_class:d,source:f}=s.attributes,p=c||l,m=s.state,[g,y]=F(!1),[_,b]=F(!1),[w,k]=F(null),x=ge(null);ee(()=>{x.current!==p&&(x.current=p,E(p))},[p]);const E=O(($,S=0)=>{if(!$)return b(!1),y(!1),k(null),null;k(null),y(!1);const I=new Image;I.onerror=()=>{if(x.current===$){if(S<2){setTimeout(()=>{x.current===$&&E($,S+1)},500);return}y(!0)}},I.onloadstart=()=>{x.current===$&&(b(!1),y(!1))},I.onload=()=>{x.current===$&&b(!0)},I.src=K().hassUrl($),k(I),I.complete&&(y(!1),b(!0))},[]);return A("button",{css:Kn.root,style:{"--mmpc-art-border-radius":`${t}px`,"--mmpc-art-width":e?typeof e=="string"?e:`${e}px`:"100%","--mmpc-art-height":e?typeof e=="string"?e:`${e}px`:"unset",...typeof e=="number"?{flexShrink:0}:{}},...i,children:[h("div",{css:Kn.contentContainer,children:w?.src&&m!=="off"&&!g?h("img",{css:[Kn.image,_&&Kn.imageLoaded],src:w.src,alt:o&&a?`${o} by ${a}`:`Source: ${f}`}):h("div",{css:Kn.iconContainer,children:h(be,{icon:m==="off"||!f?Un({icon:u,deviceClass:d}):Ji({source:f}),size:r})})}),n&&n()]})},de=_t(null),Zi=Pe(({rootElement:e,config:t,children:r})=>{const n=V(()=>({rootElement:e,config:t}),[e,t]);return h(de.Provider,{value:n,children:r})}),Gn={root:v({position:"relative",background:"none",border:"none",display:"flex",flex:0,flexDirection:"row",height:"32px",fontSize:"13px",fontWeight:500,lineHeight:"32px",padding:"0 12px",borderRadius:"16px",color:`var(--mmpc-chip-foreground, ${j.colors.card})`,backgroundColor:`var(--mmpc-chip-background, ${j.colors.onCard})`,"--icon-primary-color":`var(--mmpc-chip-foreground, ${j.colors.card})`,borderColor:`var(--mmpc-chip-border, ${j.colors.onCardDivider})`,borderStyle:"solid",borderWidth:0,marginRight:"5px",alignItems:"center",gap:"4px",textWrap:"nowrap",cursor:"pointer","&:hover":{opacity:.8},opacity:1,"& ha-icon":{pointerEvents:"none"}}),rootInvertedColors:v({color:`var(--mmpc-chip-background, ${j.colors.onCard})`,backgroundColor:`var(--mmpc-chip-foreground, ${j.colors.card})`,"--icon-primary-color":`var(--mmpc-chip-background, ${j.colors.onCard})`}),rootWithBorder:v({borderWidth:"1px"}),rootSmall:v({height:"24px",fontSize:"12px",lineHeight:"24px",padding:"0 8px",borderRadius:"12px"}),rootLoading:v({opacity:.8})},Ze=Rt(({loading:e,icon:t,iconPosition:r="left",size:n="medium",invertedColors:i=!1,border:s=!1,children:o,...a},l)=>{const c=()=>{if(e)return h(vr,{size:"x-small"});if(t)return h(be,{size:"x-small",icon:t})};return A("button",{css:[Gn.root,n==="small"&&Gn.rootSmall,i&&Gn.rootInvertedColors,s&&Gn.rootWithBorder,e&&Gn.rootLoading],...a,ref:l,children:[r==="left"&&c(),o,r==="right"&&c()]})});var ya;(ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:void 0)!=null&&ya.__PREACT_DEVTOOLS__&&ya.__PREACT_DEVTOOLS__.attachPreact("10.28.2",z,{Fragment:Q,Component:Ve});var Td={};function kt(e){return e.type===Q?"Fragment":typeof e.type=="function"?e.type.displayName||e.type.name:typeof e.type=="string"?e.type:"#text"}var Wn=[],Zr=[];function Nd(){return Wn.length>0?Wn[Wn.length-1]:null}var Rd=!0;function _a(e){return typeof e.type=="function"&&e.type!=Q}function Ee(e){for(var t=[e],r=e;r.__o!=null;)t.push(r.__o),r=r.__o;return t.reduce(function(n,i){n+="  in "+kt(i);var s=i.__source;return s?n+=" (at "+s.fileName+":"+s.lineNumber+")":Rd&&console.warn("Add @babel/plugin-transform-react-jsx-source to get a more detailed component stack. Note that you should not add it to production builds of your App for bundle size reasons."),Rd=!1,n+`
`},"")}var mb=typeof WeakMap=="function";function ba(e){var t=[];return e.__k&&e.__k.forEach(function(r){r&&typeof r.type=="function"?t.push.apply(t,ba(r)):r&&typeof r.type=="string"&&t.push(r.type)}),t}function Fd(e){return e?typeof e.type=="function"?e.__==null?e.__e!=null&&e.__e.parentNode!=null?e.__e.parentNode.localName:"":Fd(e.__):e.type:""}var gb=Ve.prototype.setState;function va(e){return e==="table"||e==="tfoot"||e==="tbody"||e==="thead"||e==="td"||e==="tr"||e==="th"}Ve.prototype.setState=function(e,t){return this.__v==null&&this.state==null&&console.warn(`Calling "this.setState" inside the constructor of a component is a no-op and might be a bug in your application. Instead, set "this.state = {}" directly.

`+Ee(Nd())),gb.call(this,e,t)};var yb=/^(address|article|aside|blockquote|details|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|main|menu|nav|ol|p|pre|search|section|table|ul)$/,_b=Ve.prototype.forceUpdate;function it(e){var t=e.props,r=kt(e),n="";for(var i in t)if(t.hasOwnProperty(i)&&i!=="children"){var s=t[i];typeof s=="function"&&(s="function "+(s.displayName||s.name)+"() {}"),s=Object(s)!==s||s.toString?s+"":Object.prototype.toString.call(s),n+=" "+i+"="+JSON.stringify(s)}var o=t.children;return"<"+r+n+(o&&o.length?">..</"+r+">":" />")}Ve.prototype.forceUpdate=function(e){return this.__v==null?console.warn(`Calling "this.forceUpdate" inside the constructor of a component is a no-op and might be a bug in your application.

`+Ee(Nd())):this.__P==null&&console.warn(`Can't call "this.forceUpdate" on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in the componentWillUnmount method.

`+Ee(this.__v)),_b.call(this,e)},z.__m=function(e,t){var r=e.type,n=t.map(function(i){return i&&i.localName}).filter(Boolean);console.error('Expected a DOM node of type "'+r+'" but found "'+n.join(", ")+`" as available DOM-node(s), this is caused by the SSR'd HTML containing different DOM-nodes compared to the hydrated one.

`+Ee(e))},(function(){(function(){var g=z.__b,y=z.diffed,_=z.__,b=z.vnode,w=z.__r;z.diffed=function(k){_a(k)&&Zr.pop(),Wn.pop(),y&&y(k)},z.__b=function(k){_a(k)&&Wn.push(k),g&&g(k)},z.__=function(k,x){Zr=[],_&&_(k,x)},z.vnode=function(k){k.__o=Zr.length>0?Zr[Zr.length-1]:null,b&&b(k)},z.__r=function(k){_a(k)&&Zr.push(k),w&&w(k)}})();var e=!1,t=z.__b,r=z.diffed,n=z.vnode,i=z.__r,s=z.__e,o=z.__,a=z.__h,l=mb?{useEffect:new WeakMap,useLayoutEffect:new WeakMap,lazyPropTypes:new WeakMap}:null,c=[];z.__e=function(g,y,_,b){if(y&&y.__c&&typeof g.then=="function"){var w=g;g=new Error("Missing Suspense. The throwing component was: "+kt(y));for(var k=y;k;k=k.__)if(k.__c&&k.__c.__c){g=w;break}if(g instanceof Error)throw g}try{(b=b||{}).componentStack=Ee(y),s(g,y,_,b),typeof g.then!="function"&&setTimeout(function(){throw g})}catch(x){throw x}},z.__=function(g,y){if(!y)throw new Error(`Undefined parent passed to render(), this is the second argument.
Check if the element is available in the DOM/has the correct id.`);var _;switch(y.nodeType){case 1:case 11:case 9:_=!0;break;default:_=!1}if(!_){var b=kt(g);throw new Error("Expected a valid HTML node as a second argument to render.	Received "+y+" instead: render(<"+b+" />, "+y+");")}o&&o(g,y)},z.__b=function(g){var y=g.type;if(e=!0,y===void 0)throw new Error(`Undefined component passed to createElement()

You likely forgot to export your component or might have mixed up default and named imports`+it(g)+`

`+Ee(g));if(y!=null&&typeof y=="object")throw y.__k!==void 0&&y.__e!==void 0?new Error("Invalid type passed to createElement(): "+y+`

Did you accidentally pass a JSX literal as JSX twice?

  let My`+kt(g)+" = "+it(y)+`;
  let vnode = <My`+kt(g)+` />;

This usually happens when you export a JSX literal and not the component.

`+Ee(g)):new Error("Invalid type passed to createElement(): "+(Array.isArray(y)?"array":y));if(g.ref!==void 0&&typeof g.ref!="function"&&typeof g.ref!="object"&&!("$$typeof"in g))throw new Error(`Component's "ref" property should be a function, or an object created by createRef(), but got [`+typeof g.ref+`] instead
`+it(g)+`

`+Ee(g));if(typeof g.type=="string"){for(var _ in g.props)if(_[0]==="o"&&_[1]==="n"&&typeof g.props[_]!="function"&&g.props[_]!=null)throw new Error(`Component's "`+_+'" property should be a function, but got ['+typeof g.props[_]+`] instead
`+it(g)+`

`+Ee(g))}if(typeof g.type=="function"&&g.type.propTypes){if(g.type.displayName==="Lazy"&&l&&!l.lazyPropTypes.has(g.type)){var b="PropTypes are not supported on lazy(). Use propTypes on the wrapped component itself. ";try{var w=g.type();l.lazyPropTypes.set(g.type,!0),console.warn(b+"Component wrapped in lazy() is "+kt(w))}catch{console.warn(b+"We will log the wrapped component's name once it is loaded.")}}var k=g.props;g.type.__f&&delete(k=(function(x,E){for(var $ in E)x[$]=E[$];return x})({},k)).ref,(function(x,E,$,S,I){Object.keys(x).forEach(function(P){var C;try{C=x[P](E,P,S,"prop",null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(R){C=R}C&&!(C.message in Td)&&(Td[C.message]=!0,console.error("Failed prop type: "+C.message+(I&&`
`+I()||"")))})})(g.type.propTypes,k,0,kt(g),function(){return Ee(g)})}t&&t(g)};var u,d=0;z.__r=function(g){i&&i(g),e=!0;var y=g.__c;if(y===u?d++:d=1,d>=25)throw new Error("Too many re-renders. This is limited to prevent an infinite loop which may lock up your browser. The component causing this is: "+kt(g));u=y},z.__h=function(g,y,_){if(!g||!e)throw new Error("Hook can only be invoked from render methods.");a&&a(g,y,_)};var f=function(g,y){return{get:function(){var _="get"+g+y;c&&c.indexOf(_)<0&&(c.push(_),console.warn("getting vnode."+g+" is deprecated, "+y))},set:function(){var _="set"+g+y;c&&c.indexOf(_)<0&&(c.push(_),console.warn("setting vnode."+g+" is not allowed, "+y))}}},p={nodeName:f("nodeName","use vnode.type"),attributes:f("attributes","use vnode.props"),children:f("children","use vnode.props.children")},m=Object.create({},p);z.vnode=function(g){var y=g.props;if(g.type!==null&&y!=null&&("__source"in y||"__self"in y)){var _=g.props={};for(var b in y){var w=y[b];b==="__source"?g.__source=w:b==="__self"?g.__self=w:_[b]=w}}g.__proto__=m,n&&n(g)},z.diffed=function(g){var y,_=g.type,b=g.__;if(g.__k&&g.__k.forEach(function(L){if(typeof L=="object"&&L&&L.type===void 0){var J=Object.keys(L).join(",");throw new Error("Objects are not valid as a child. Encountered an object with the keys {"+J+`}.

`+Ee(g))}}),g.__c===u&&(d=0),typeof _=="string"&&(va(_)||_==="p"||_==="a"||_==="button")){var w=Fd(b);if(w!==""&&va(_))_==="table"&&w!=="td"&&va(w)?console.error("Improper nesting of table. Your <table> should not have a table-node parent."+it(g)+`

`+Ee(g)):_!=="thead"&&_!=="tfoot"&&_!=="tbody"||w==="table"?_==="tr"&&w!=="thead"&&w!=="tfoot"&&w!=="tbody"?console.error("Improper nesting of table. Your <tr> should have a <thead/tbody/tfoot> parent."+it(g)+`

`+Ee(g)):_==="td"&&w!=="tr"?console.error("Improper nesting of table. Your <td> should have a <tr> parent."+it(g)+`

`+Ee(g)):_==="th"&&w!=="tr"&&console.error("Improper nesting of table. Your <th> should have a <tr>."+it(g)+`

`+Ee(g)):console.error("Improper nesting of table. Your <thead/tbody/tfoot> should have a <table> parent."+it(g)+`

`+Ee(g));else if(_==="p"){var k=ba(g).filter(function(L){return yb.test(L)});k.length&&console.error("Improper nesting of paragraph. Your <p> should not have "+k.join(", ")+" as child-elements."+it(g)+`

`+Ee(g))}else _!=="a"&&_!=="button"||ba(g).indexOf(_)!==-1&&console.error("Improper nesting of interactive content. Your <"+_+"> should not have other "+(_==="a"?"anchor":"button")+" tags as child-elements."+it(g)+`

`+Ee(g))}if(e=!1,r&&r(g),g.__k!=null)for(var x=[],E=0;E<g.__k.length;E++){var $=g.__k[E];if($&&$.key!=null){var S=$.key;if(x.indexOf(S)!==-1){console.error('Following component has two or more children with the same key attribute: "'+S+`". This may cause glitches and misbehavior in rendering process. Component: 

`+it(g)+`

`+Ee(g));break}x.push(S)}}if(g.__c!=null&&g.__c.__H!=null){var I=g.__c.__H.__;if(I)for(var P=0;P<I.length;P+=1){var C=I[P];if(C.__H){for(var R=0;R<C.__H.length;R++)if((y=C.__H[R])!=y){var M=kt(g);console.warn("Invalid argument passed to hook. Hooks should not be called with NaN in the dependency array. Hook index "+P+" in component "+M+" was called with NaN.")}}}}}})();const Ld=Pe(({rootElement:e,children:t})=>{const[r]=F(()=>fu({key:"mmpc",container:e,speedy:!1}));return h(Yg,{value:r,children:t})}),bb=()=>[{name:"tap_action",label:"Tap Action",selector:{ui_action:{}}},{name:"hold_action",label:"Hold Action",selector:{ui_action:{}}},{name:"double_tap_action",label:"Double Tap Action",selector:{ui_action:{}}}],vb=({hass:e,value:t,onChange:r,disabled:n=!1})=>{const i=ge(null),s=V(()=>t?{...t}:{action:"none"},[t]),o=O(a=>{const c=a.detail.value;r(c)},[r]);return ee(()=>{const a=i.current;return a&&a.addEventListener("value-changed",o),()=>{a&&a.removeEventListener("value-changed",o)}},[i.current,o]),h("ha-form",{ref:i,hass:e,data:s,schema:bb(),computeLabel:a=>a.label||a.name,disabled:n})},er={formGroup:v({marginBottom:"16px",display:"flex",flexDirection:"column",gap:8}),label:v({display:"block",marginBottom:"16px",fontWeight:500}),buttonsContainer:v({display:"flex",flexDirection:"column"}),button:v({alignSelf:"flex-start"}),inputGroup:v({display:"flex",flexDirection:"column",marginBottom:"16px"}),toggleContainer:v({display:"flex",alignItems:"center"}),toggleLabel:v({marginLeft:"8px",fontWeight:"normal"}),toggle:v({cursor:"pointer"}),errorMessage:v({color:"var(--error-color, #ff5252)",marginTop:"8px",fontSize:"14px"})},Mt=e=>h("div",{css:er.formGroup,...e}),Xi=e=>h("label",{css:er.label,...e}),Hn=({children:e,size:t="small",variant:r="brand",appearance:n="accent",onClick:i})=>h("ha-button",{variant:r,appearance:n,size:t,css:er.button,onClick:i,children:e}),wb=e=>h("div",{css:er.inputGroup,...e}),xb=e=>h("div",{css:er.toggleContainer,...e}),kb=e=>h("label",{css:er.toggleLabel,...e}),Mb=e=>h("input",{type:"checkbox",css:er.toggle,...e}),wa=e=>h("div",{css:er.errorMessage,...e}),Xr=e=>{const{hass:t,value:r,onChange:n,label:i,domains:s,required:o=!1,disabled:a=!1,allowCustomEntity:l=!1,error:c}=e,u=ge(null),d=O(f=>{const m=f.detail.value;n(m)},[n]);return ee(()=>{const f=u.current;return f&&f.addEventListener("value-changed",d),()=>{f&&f.removeEventListener("value-changed",d)}},[u.current,d]),A("div",{children:[h("ha-entity-picker",{ref:u,hass:t,value:r,label:i,includeDomains:s,disabled:a,required:o,"allow-custom-entity":l}),!!c&&h(wa,{children:c})]})},Sb={root:v({display:"flex",flexDirection:"column"})},Jn=({hass:e,value:t,onChange:r,label:n,error:i,required:s=!1,disabled:o=!1,isIconInput:a=!1})=>{const l=O(u=>{r(u.detail.value)},[r]),c=()=>a?h("ha-icon-picker",{label:n||"Icon",hass:e,value:t,disabled:o,required:s,"onvalue-changed":l}):h("ha-textfield",{label:n||"Text",value:t,disabled:o,required:s,onchange:u=>r(u.target.value)});return A("div",{css:Sb.root,children:[c(),!!i&&h(wa,{children:i})]})},Dd={root:v({display:"flex",flexDirection:"column",gap:"8px"}),entityPickedWrap:v({display:"grid",gridTemplateColumns:"auto auto",gap:"8px"})},$b=({hass:e,value:t,onChange:r,label:n,domains:i,disabled:s=!1,allowCustomEntity:o=!1})=>{const a=V(()=>(t?.filter(Boolean)||[]).map(f=>typeof f=="string"?{entity:f,name:null}:f),[t]),l=O((d,f)=>{const p=[...a];!d&&f<a.length?p.splice(f,1):f<a.length?p[f].entity=d||"":d&&p.push({entity:d,name:null}),u(p.filter(Boolean))},[a,r]),c=O((d,f)=>{const p=[...a];f<a.length&&(p[f].name=d||null,u(p.filter(Boolean)))},[a,r]),u=O(d=>{r(d?.map(f=>typeof f=="string"?f:f.name?{entity:f.entity,name:f.name}:f.entity))},[r]);return A("div",{css:Dd.root,className:"entities-picker",children:[n&&h("label",{children:n}),a.map((d,f)=>A("div",{css:Dd.entityPickedWrap,children:[h(Jn,{value:d.name??"",onChange:p=>c(p,f),disabled:s,label:"Name"}),h(Xr,{hass:e,value:d.entity,onChange:p=>l(p,f),domains:i,disabled:s,required:!1,allowCustomEntity:o})]},`entity-${f}`)),h(Xr,{hass:e,value:"",onChange:d=>l(d,a.length),domains:i,disabled:s,required:!1,allowCustomEntity:o},"entity-new")]})},xa=({options:e,onSelected:t,selected:r})=>h("select",{value:r,onChange:n=>t(n.target.value),children:e.map(n=>h("option",{value:n.value,children:n.name},n.value))}),Vd=({hass:e,value:t={},onChange:r})=>h(vb,{hass:e,value:t,onChange:r}),Cb=({children:e})=>{const[t,r]=F(!1);return ee(()=>{customElements.get("hui-glance-card").getConfigElement().then(()=>{r(!0)})},[]),t?e:null},zd={root:v({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),speakerChip:v({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}})},es=({config:e,showGrouped:t,layout:r})=>{const n=$e(),{entity_id:i,speaker_group:s}=e,[o,a]=F([]),l=s?.entity_id||i,c=n.states[l],u=V(()=>{if(!s?.entities?.length)return[];const p=m=>typeof m=="string"?m:m.entity;return s.entities.filter(m=>p(m)!==l).filter(m=>n.states[p(m)]).map(m=>({entity_id:p(m),name:typeof m!="string"&&m.name?m.name:n.states[p(m)].attributes.friendly_name??p(m),volume:n.states[p(m)].attributes.volume_level||0,muted:n.states[p(m)].attributes.is_volume_muted||!1,isGrouped:c?.attributes?.group_members?.includes(p(m))||!1})).filter(m=>t?!0:!m.isGrouped).sort((m,g)=>m.entity_id===l?-1:g.entity_id===l?1:m.name.localeCompare(g.name)).sort((m,g)=>m.isGrouped&&!g.isGrouped?-1:!m.isGrouped&&g.isGrouped?1:0)},[n.states,s,t]),d=O(async p=>{const m=(c?.attributes?.group_members||[]).filter(g=>g!==l);await n.callService("media_player","join",{entity_id:l,group_members:[p,...m]})},[n,l,c]),f=O(async(p,m,g=0)=>{if(!o.includes(p)){a(y=>[...y,p]);try{const y=n.states[p];m?await n.callService("media_player","unjoin",{entity_id:p}):(y.state==="off"&&await n.callService("media_player","turn_on",{entity_id:p}),await d(p))}catch(y){console.error(y),g<1&&setTimeout(()=>f(p,m,g+1),1e3)}a(y=>y.filter(_=>_!==p))}},[l,o,n]);return h("div",{css:zd.root,id:"mmpc-group-chips-controller",children:u.map(p=>h(Ze,{css:zd.speakerChip,loading:o.includes(p.entity_id),onClick:()=>f(p.entity_id,p.isGrouped),icon:p.isGrouped?"mdi:close":"mdi:plus",iconPosition:"right",style:{"--mmpc-chip-horizontal-margin":`${r?.horizontalMargin??0}px`},children:p.name},p.entity_id))})},qt={speakersTable:v({width:"100%",borderCollapse:"collapse",tableLayout:"fixed"}),speakerRow:v({width:"100%",height:"32px"}),nameCell:v({color:j.colors.onCard,paddingRight:"8px",fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),nameCellMainSpeaker:v({fontWeight:500}),controlsCell:v({padding:"0px 4px"}),buttonCell:v({width:"28px",whiteSpace:"nowrap"}),controlsContainer:v({display:"flex",alignItems:"center",width:"100%"})},ka=({config:e,syncMainSpeaker:t,className:r})=>{const{speaker_group:n,entity_id:i}=e,s=$e(),[o,a]=F([]),l=n?.entity_id||i,c=s.states[l],u=V(()=>{if(!n?.entities?.length&&!c)return[];const y=[...n?.entities||[]];c&&!y.find(b=>(typeof b=="string"?b:b.entity)===l)&&y.push(l);const _=b=>typeof b=="string"?b:b.entity;return y.filter(b=>s.states[_(b)]).map(b=>({entity_id:_(b),name:typeof b!="string"&&b.name?b.name:s.states[_(b)].attributes.friendly_name??_(b),volume:s.states[_(b)].attributes.volume_level||0,muted:s.states[_(b)].attributes.is_volume_muted||!1,isOff:s.states[_(b)].state==="off",isGrouped:c?.attributes?.group_members?.includes(_(b))||!1,isMainSpeaker:c?.attributes?.group_members?.[0]===_(b)||!1})).sort((b,w)=>b.entity_id===l?-1:w.entity_id===l?1:b.name.localeCompare(w.name))},[s.states,n,l,c]),d=O(async y=>{const _=(c?.attributes?.group_members||[]).filter(b=>b!==l);await s.callService("media_player","join",{entity_id:l,group_members:[y,..._]})},[s,l,c]),f=O(async(y,_,b=0)=>{if(!o.includes(y)){a(w=>[...w,y]);try{const w=s.states[y];_?await s.callService("media_player","unjoin",{entity_id:y}):(w.state==="off"&&await s.callService("media_player","turn_on",{entity_id:y}),await d(y))}catch(w){console.error(w),b<1&&setTimeout(()=>f(y,_,b+1),1e3)}a(w=>w.filter(k=>k!==y))}},[l,o,s]),p=O((y,_)=>{K().callService("media_player","volume_mute",{entity_id:y,is_volume_muted:!_})},[]),m=O(y=>{K().callService("media_player","turn_on",{entity_id:y})},[]),g=(y,_,b)=>{const{entity_id:w,name:k,volume:x,muted:E,isGrouped:$,isMainSpeaker:S,isOff:I}=y,C=o.includes(w)||S&&!$;return A("tr",{css:qt.speakerRow,children:[h("td",{css:[qt.nameCell,S&&qt.nameCellMainSpeaker],children:k}),I?h("td",{css:qt.buttonCell,children:h(B,{size:"x-small",onClick:()=>m(w),icon:"mdi:power",disabled:C})}):h("td",{css:qt.buttonCell,children:h(B,{size:"x-small",onClick:()=>p(w,E),icon:Yr(x,E)})}),h("td",{css:qt.controlsCell,children:h("div",{css:qt.controlsContainer,children:h(Qs,{entityId:w,syncGroupChildren:S&&t,sliderSize:"small",showStepButtons:e.options?.show_volume_step_buttons??!1,useVolumeUpDownForSteps:e.options?.use_volume_up_down_for_step_buttons??!1})})}),h("td",{css:qt.buttonCell,children:h(B,{size:"x-small",onClick:()=>f(w,$),icon:$?"mdi:close":"mdi:plus",disabled:C})})]},w)};return h("div",{className:r,children:h("table",{css:qt.speakersTable,children:h("tbody",{children:u.filter(y=>y.isGrouped).map((y,_,b)=>g(y))})})})},Ab={root:v({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gridGap:"8px",padding:"0px var(--mmpc-search-padding, 0px)"})},en=({numberOfColumns:e=3,children:t})=>h("div",{css:Ab.root,style:{gridTemplateColumns:`repeat(${e}, minmax(0, 1fr))`},children:t}),Eb=br`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ib={spinner:v({animation:`${Eb} 1s linear infinite`,"--mdc-icon-size":"var(--mmpc-spinner-size)",width:"var(--mmpc-spinner-size)",display:"flex",pointerEvents:"none"})},vr=e=>h(be,{icon:"mdi:loading",css:Ib.spinner,...e}),Pb=br({"0%":{opacity:1,transform:"translateY(0px)"},"85%":{opacity:1,transform:"translateY(0px)"},"100%":{opacity:0,transform:"translateY(-20px)"}}),St={root:v({width:"100%","&::before":{content:'""',display:"block",paddingTop:"100%"},borderRadius:"4px","--icon-primary-color":"var(--card-background-color)",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),image:v({position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",opacity:0}),imageLoaded:v({animation:`${Sd} 0.3s ease forwards`}),icon:v({position:"absolute","--icon-primary-color":"var(--primary-text-color, #333)",backgroundColor:"var(--card-background-color)",borderRadius:"50%",padding:"2px",width:ha("x-small")+4,height:ha("x-small")+4}),iconNoBackground:v({backgroundColor:"transparent"}),done:v({animation:`${Pb} 3s forwards`})},Ma=Pe(({imageUrl:e,mdiIcon:t,loading:r,done:n,className:i})=>{const[s,o]=F(!1),[a,l]=F(!1),[c,u]=F(null),d=ge(null);ee(()=>{d.current!==e&&(d.current=e,f(e))},[e]);const f=O((p,m=0)=>{if(!p)return l(!1),o(!1),u(null),null;u(null);const g=new Image;g.onerror=()=>{if(d.current===p){if(m===0){f(p,1);return}o(!0)}},g.onloadstart=()=>{d.current===p&&(l(!1),o(!1))},g.onload=()=>{d.current===p&&l(!0)},g.src=K().hassUrl(p),u(g)},[]);return A("div",{css:St.root,className:i,children:[c?.src&&!s&&h("img",{src:c?.src,css:[St.image,a&&St.imageLoaded],alt:""}),!c?.src&&t&&!s&&h(be,{icon:t,size:"medium",css:[St.icon,St.iconNoBackground]}),!!s&&h(be,{icon:t??"mdi:image-broken-variant",size:"medium",css:[St.icon,St.iconNoBackground]}),r&&h(vr,{css:St.icon,size:"x-small"}),!r&&n&&h(be,{icon:"mdi:check",size:"x-small",css:[St.icon,St.done]})]})}),Yn={root:v({border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",transition:"transform 0.2s",borderRadius:"8px",padding:"8px",background:"rgba(255, 255, 255, 0.05)","&:hover":{transform:"translateY(-4px)"}}),rootLight:v({background:"rgba(0, 0, 0, 0.05)"}),name:v({fontSize:"14px",fontWeight:500,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%",color:"var(--primary-text-color)"}),artist:v({fontSize:"12px",color:"var(--secondary-text-color)",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",width:"100%"}),mediaImage:v({marginBottom:8})},tn=Rt(({imageUrl:e,mdiIcon:t,name:r,artist:n,onClick:i,...s},o)=>{const[a,l]=F(!1),[c,u]=F(!1),d=O(async f=>{if(i)if(typeof i=="function"&&i.constructor.name==="AsyncFunction"){u(!1),l(!0);try{await i(f),u(!0)}catch(p){console.error("Error in MediaItem onClick:",p)}l(!1)}else i(f)},[i]);return A("button",{css:[Yn.root,!Bt()&&Yn.rootLight],onClick:d,...s,ref:o,children:[h(Ma,{css:Yn.mediaImage,imageUrl:e,mdiIcon:t,loading:a,done:c}),h("div",{css:Yn.name,children:r}),h("div",{css:Yn.artist,children:n})]})}),Bd={root:v({display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",margin:"0 4px",padding:"4px var(--mmpc-search-padding, 0px)"}),title:v({fontSize:"16px",fontWeight:500,color:"var(--primary-text-color)",margin:0})},qd=({children:e,onClick:t})=>A("div",{css:Bd.root,onClick:t,children:[h("h3",{css:Bd.title,children:e}),!!t&&h(be,{icon:"mdi:chevron-right",size:"small"})]}),$t={root:v({border:"none",cursor:"pointer",display:"grid",textAlign:"left",gridTemplateColumns:"50px 1fr auto",alignItems:"center",gap:10,padding:"8px 8px",borderRadius:`max(${j.sizes.cardBorderRadius}, 12px)`,gridColumn:"1/-1",background:"rgba(255, 255, 255, 0.05)","&:hover":{background:"rgba(255, 255, 255, 0.1)"},containerType:"inline-size"}),rootLight:v({background:"rgba(0, 0, 0, 0.05)","&:hover":{background:"rgba(0, 0, 0, 0.01)"}}),trackInfo:v({display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",justifyContent:"space-evenly"}),trackName:v({fontSize:"14px",fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--primary-text-color)"}),trackArtist:v({fontSize:"12px",color:"var(--secondary-text-color)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),mediaImage:v({width:50,height:50,borderRadius:"var(--ha-border-radius-md, 8px)"}),buttons:v({display:"flex",gap:6,marginRight:"8px",alignItems:"center",opacity:.7,":hover &":{opacity:1}}),button:v({display:"flex",flexShrink:0}),buttonPriority2:v({"@container (max-width: 300px)":{display:"none"}}),buttonPriority3:v({"@container (max-width: 350px)":{display:"none"}})},wr=Rt(({imageUrl:e,title:t,artist:r,mdiIcon:n,buttonIconSize:i="x-small",onClick:s,buttons:o=[],...a},l)=>{const[c,u]=F(!1),[d,f]=F(!1),p=O(async m=>{if(s)if(typeof s=="function"&&s.constructor.name==="AsyncFunction"){f(!1),u(!0);try{await s(m),f(!0)}catch(g){console.error("Error in MediaItem onClick:",g)}u(!1)}else s(m)},[s]);return A("button",{css:[$t.root,!Bt()&&$t.rootLight],onClick:p,...a,ref:l,children:[h(Ma,{css:$t.mediaImage,imageUrl:e,loading:c,mdiIcon:n,done:d}),A("div",{css:$t.trackInfo,children:[h("div",{css:$t.trackName,children:t}),!!r&&h("div",{css:$t.trackArtist,children:r})]}),o.length>0&&h("div",{css:$t.buttons,children:o.map((m,g)=>h(B,{css:[$t.button,m.priority===3?$t.buttonPriority3:m.priority===2?$t.buttonPriority2:void 0],disabled:m.disabled,icon:m.icon,onClick:y=>{y.preventDefault(),y.stopPropagation(),!m.disabled&&m.onClick()},type:"button",size:m.size??i},g+m.icon))})]})}),Le={root:v({display:"flex",flexDirection:"column",gap:"12px",overflow:"hidden"}),rootSearchBarBottom:v({overflow:"hidden"}),searchBarContainer:v({display:"flex",flexDirection:"column",gap:12,marginBottom:12}),filterContainer:v({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:v({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}}),verticalChipSeperator:v({height:"28px",alignSelf:"center",borderRight:"1px solid var(--divider-color)",marginRight:"6px"}),mediaEmptyText:v({color:j.colors.onCard,padding:"0px var(--mmpc-search-padding, 0px)"}),resultsContainerSearchBarBottom:v({overflowY:"auto"}),inputRow:v({display:"flex",flexDirection:"row",gap:"8px",padding:"1px var(--mmpc-search-padding, 0px)"}),input:v({flexGrow:1})},Sa=(e,t,r)=>{const{t:n}=Fe(),i=V(()=>{const l=zr(e,t);return r?[...l,{entity_id:r,name:"Music Assistant"}]:l},[e,t,r]),[s,o]=F(i[0]?.entity_id??void 0),a=V(()=>{if(i.length<=1)return[];const l=[{type:"title",label:n({id:"Search.search_provider.title",defaultMessage:"Search using.."})}],c=K();return i.forEach(u=>{l.push({type:"item",label:u.name??c.states[u.entity_id]?.attributes.friendly_name??u.entity_id,onClick:()=>o(u.entity_id),selected:s===u.entity_id})}),l},[r,e,t,s,n]);return V(()=>({searchProvidersMenu:a,selectedSearchProviderEntityId:s,selectedSearchProvider:i.find(l=>l.entity_id===s)}),[a,s])},Ob=(e,t,r)=>{const[n,i]=F(null),[s,o]=F(!1),[a,l]=F(null),c=ge(null);ee(()=>{if(e==="")return;const d=e+(t??"all");c.current=d;const f={type:"call_service",domain:"media_player",service:"search_media",service_data:{search_query:e,entity_id:r,media_content_type:t==="all"?void 0:t},return_response:!0},p=K();o(!0),p.connection.sendMessagePromise(f).then(m=>{const g=m;d===c.current&&g.response[r]&&(o(!1),i(g.response[r]),l(null))}).catch(m=>{console.error("Error fetching search results:",m),o(!1),l("Error fetching search results: "+m.message),i(null)})},[e,r,t]);const u=O(async(d,f,p)=>K().callService("media_player","play_media",{entity_id:f,media_content_type:d.media_content_type,media_content_id:d.media_content_id,enqueue:p}),[]);return V(()=>({results:n?.result??[],loading:s,playItem:u,error:a}),[n,s,a])},Tb=(e,t="favorites",r=!1)=>{const[n,i]=F([]),[s,o]=F(!1);return ee(()=>{if(!r){i([]);return}const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:e,media_content_type:t},return_response:!0},l=K();o(!0),l.connection.sendMessagePromise(a).then(c=>{const u=c;u.response[e]&&(o(!1),i(u.response[e].children.filter(d=>d.can_play)))}).catch(c=>{console.error("Error fetching search results:",c),o(!1),i([])})},[e,r,t]),V(()=>({mediaBrowserItems:n,isFetching:s}),[n,s])};function rn(e,t,r){let n=r.initialDeps??[],i,s=!0;function o(){var a,l,c;let u;r.key&&((a=r.debug)!=null&&a.call(r))&&(u=Date.now());const d=e();if(!(d.length!==n.length||d.some((m,g)=>n[g]!==m)))return i;n=d;let p;if(r.key&&((l=r.debug)!=null&&l.call(r))&&(p=Date.now()),i=t(...d),r.key&&((c=r.debug)!=null&&c.call(r))){const m=Math.round((Date.now()-u)*100)/100,g=Math.round((Date.now()-p)*100)/100,y=g/16,_=(b,w)=>{for(b=String(b);b.length<w;)b=" "+b;return b};console.info(`%c ${_(g,5)} /${_(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,r?.key)}return r?.onChange&&!(s&&r.skipInitialOnChange)&&r.onChange(i),s=!1,i}return o.updateDeps=a=>{n=a},o}function jd(e,t){if(e===void 0)throw new Error("Unexpected undefined");return e}const Nb=(e,t)=>Math.abs(e-t)<1.01,Rb=(e,t,r)=>{let n;return function(...i){e.clearTimeout(n),n=e.setTimeout(()=>t.apply(this,i),r)}};var xr={};const Ud=e=>{const{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}},Fb=e=>e,Lb=e=>{const t=Math.max(e.startIndex-e.overscan,0),r=Math.min(e.endIndex+e.overscan,e.count-1),n=[];for(let i=t;i<=r;i++)n.push(i);return n},Db=(e,t)=>{const r=e.scrollElement;if(!r)return;const n=e.targetWindow;if(!n)return;const i=o=>{const{width:a,height:l}=o;t({width:Math.round(a),height:Math.round(l)})};if(i(Ud(r)),!n.ResizeObserver)return()=>{};const s=new n.ResizeObserver(o=>{const a=()=>{const l=o[0];if(l?.borderBoxSize){const c=l.borderBoxSize[0];if(c){i({width:c.inlineSize,height:c.blockSize});return}}i(Ud(r))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return s.observe(r,{box:"border-box"}),()=>{s.unobserve(r)}},Kd={passive:!0},Gd=typeof window>"u"?!0:"onscrollend"in window,Vb=(e,t)=>{const r=e.scrollElement;if(!r)return;const n=e.targetWindow;if(!n)return;let i=0;const s=e.options.useScrollendEvent&&Gd?()=>{}:Rb(n,()=>{t(i,!1)},e.options.isScrollingResetDelay),o=u=>()=>{const{horizontal:d,isRtl:f}=e.options;i=d?r.scrollLeft*(f&&-1||1):r.scrollTop,s(),t(i,u)},a=o(!0),l=o(!1);r.addEventListener("scroll",a,Kd);const c=e.options.useScrollendEvent&&Gd;return c&&r.addEventListener("scrollend",l,Kd),()=>{r.removeEventListener("scroll",a),c&&r.removeEventListener("scrollend",l)}},zb=(e,t,r)=>{if(t?.borderBoxSize){const n=t.borderBoxSize[0];if(n)return Math.round(n[r.options.horizontal?"inlineSize":"blockSize"])}return e[r.options.horizontal?"offsetWidth":"offsetHeight"]},Bb=(e,{adjustments:t=0,behavior:r},n)=>{var i,s;const o=e+t;(s=(i=n.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[n.options.horizontal?"left":"top"]:o,behavior:r})};class qb{constructor(t){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const n=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(i=>{i.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var i;(i=n())==null||i.disconnect(),r=null},observe:i=>{var s;return(s=n())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=n())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([n,i])=>{typeof i>"u"&&delete r[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Fb,rangeExtractor:Lb,onChange:()=>{},measureElement:zb,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var n,i;(i=(n=this.options).onChange)==null||i.call(n,this,r)},this.maybeNotify=rn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:xr.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=s,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,n)=>{const i=new Map,s=new Map;for(let o=n-1;o>=0;o--){const a=r[o];if(i.has(a.lane))continue;const l=s.get(a.lane);if(l==null||a.end>l.end?s.set(a.lane,a):a.end<l.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurementOptions=rn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(r,n,i,s,o,a)=>(this.prevLanes!==void 0&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:n,scrollMargin:i,getItemKey:s,enabled:o,lanes:a}),{key:!1}),this.getMeasurements=rn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:n,scrollMargin:i,getItemKey:s,enabled:o,lanes:a},l)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>r)for(const f of this.laneAssignments.keys())f>=r&&this.laneAssignments.delete(f);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(f=>{this.itemSizeCache.set(f.key,f.size)}));const c=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===r&&(this.lanesSettling=!1);const u=this.measurementsCache.slice(0,c),d=new Array(a).fill(void 0);for(let f=0;f<c;f++){const p=u[f];p&&(d[p.lane]=f)}for(let f=c;f<r;f++){const p=s(f),m=this.laneAssignments.get(f);let g,y;if(m!==void 0&&this.options.lanes>1){g=m;const k=d[g],x=k!==void 0?u[k]:void 0;y=x?x.end+this.options.gap:n+i}else{const k=this.options.lanes===1?u[f-1]:this.getFurthestMeasurement(u,f);y=k?k.end+this.options.gap:n+i,g=k?k.lane:f%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(f,g)}const _=l.get(p),b=typeof _=="number"?_:this.options.estimateSize(f),w=y+b;u[f]={index:f,start:y,size:b,end:w,key:p,lane:g},d[g]=f}return this.measurementsCache=u,u},{key:xr.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=rn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,n,i,s)=>this.range=r.length>0&&n>0?jb({measurements:r,outerSize:n,scrollOffset:i,lanes:s}):null,{key:xr.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getVirtualIndexes=rn(()=>{let r=null,n=null;const i=this.calculateRange();return i&&(r=i.startIndex,n=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,n]},(r,n,i,s,o)=>s===null||o===null?[]:r({startIndex:s,endIndex:o,overscan:n,count:i}),{key:xr.NODE_ENV!=="production"&&"getVirtualIndexes",debug:()=>this.options.debug}),this.indexFromElement=r=>{const n=this.options.indexAttribute,i=r.getAttribute(n);return i?parseInt(i,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(r,n)=>{const i=this.indexFromElement(r),s=this.measurementsCache[i];if(!s)return;const o=s.key,a=this.elementsCache.get(o);a!==r&&(a&&this.observer.unobserve(a),this.observer.observe(r),this.elementsCache.set(o,r)),r.isConnected&&this.resizeItem(i,this.options.measureElement(r,n,this))},this.resizeItem=(r,n)=>{const i=this.measurementsCache[r];if(!i)return;const s=this.itemSizeCache.get(i.key)??i.size,o=n-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,o,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&(xr.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",o),this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,n)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((n,i)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(i))});return}this._measureElement(r,void 0)},this.getVirtualItems=rn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,n)=>{const i=[];for(let s=0,o=r.length;s<o;s++){const a=r[s],l=n[a];i.push(l)}return i},{key:xr.NODE_ENV!=="production"&&"getVirtualItems",debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const n=this.getMeasurements();if(n.length!==0)return jd(n[Wd(0,n.length-1,i=>jd(n[i]).start,r)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const r=this.scrollElement.document.documentElement;return this.options.horizontal?r.scrollWidth-this.scrollElement.innerWidth:r.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(r,n,i=0)=>{if(!this.scrollElement)return 0;const s=this.getSize(),o=this.getScrollOffset();n==="auto"&&(n=r>=o+s?"end":"start"),n==="center"?r+=(i-s)/2:n==="end"&&(r-=s);const a=this.getMaxScrollOffset();return Math.max(Math.min(a,r),0)},this.getOffsetForIndex=(r,n="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const i=this.measurementsCache[r];if(!i)return;const s=this.getSize(),o=this.getScrollOffset();if(n==="auto")if(i.end>=o+s-this.options.scrollPaddingEnd)n="end";else if(i.start<=o+this.options.scrollPaddingStart)n="start";else return[o,n];if(n==="end"&&r===this.options.count-1)return[this.getMaxScrollOffset(),n];const a=n==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n,i.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:n="start",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,n),{adjustments:void 0,behavior:i})},this.scrollToIndex=(r,{align:n="auto",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1)),this.currentScrollToIndex=r;let s=0;const o=10,a=c=>{if(!this.targetWindow)return;const u=this.getOffsetForIndex(r,c);if(!u){console.warn("Failed to get offset for index:",r);return}const[d,f]=u;this._scrollToOffset(d,{adjustments:void 0,behavior:i}),this.targetWindow.requestAnimationFrame(()=>{const p=()=>{if(this.currentScrollToIndex!==r)return;const m=this.getScrollOffset(),g=this.getOffsetForIndex(r,f);if(!g){console.warn("Failed to get offset for index:",r);return}Nb(g[0],m)||l(f)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(p):p()})},l=c=>{this.targetWindow&&this.currentScrollToIndex===r&&(s++,s<o?(xr.NODE_ENV!=="production"&&this.options.debug&&console.info("Schedule retry",s,o),this.targetWindow.requestAnimationFrame(()=>a(c))):console.warn(`Failed to scroll to index ${r} after ${o} attempts.`))};a(n)},this.scrollBy=(r,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var r;const n=this.getMeasurements();let i;if(n.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((r=n[n.length-1])==null?void 0:r.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=n.length-1;for(;o>=0&&s.some(a=>a===null);){const a=n[o];s[a.lane]===null&&(s[a.lane]=a.end),o--}i=Math.max(...s.filter(a=>a!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:n,behavior:i})=>{this.options.scrollToFn(r,{behavior:i,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(t)}}const Wd=(e,t,r,n)=>{for(;e<=t;){const i=(e+t)/2|0,s=r(i);if(s<n)e=i+1;else if(s>n)t=i-1;else return i}return e>0?e-1:0};function jb({measurements:e,outerSize:t,scrollOffset:r,lanes:n}){const i=e.length-1,s=l=>e[l].start;if(e.length<=n)return{startIndex:0,endIndex:i};let o=Wd(0,i,s,r),a=o;if(n===1)for(;a<i&&e[a].end<r+t;)a++;else if(n>1){const l=Array(n).fill(0);for(;a<i&&l.some(u=>u<r+t);){const u=e[a];l[u.lane]=u.end,a++}const c=Array(n).fill(r+t);for(;o>=0&&c.some(u=>u>=r);){const u=e[o];c[u.lane]=u.start,o--}o=Math.max(0,o-o%n),a=Math.min(i,a+(n-1-a%n))}return{startIndex:o,endIndex:a}}const Hd=typeof document<"u"?Nt:ee;function Ub({useFlushSync:e=!0,...t}){const r=Nn(()=>({}),{})[1],n={...t,onChange:(s,o)=>{var a;e&&o?Ao(r):r(),(a=t.onChange)==null||a.call(t,s,o)}},[i]=F(()=>new qb(n));return i.setOptions(n),Hd(()=>i._didMount(),[]),Hd(()=>i._willUpdate()),i}function Kb(e){return Ub({observeElementRect:Db,observeElementOffset:Vb,scrollToFn:Bb,...e})}const Jd={container:v({height:"100%",overflowX:"hidden",overflowY:"auto",boxSizing:"border-box","@media (hover: hover) and (pointer: fine)":{paddingRight:"2px",scrollbarWidth:"thin",scrollbarColor:`${j.colors.onCardDivider} transparent`,"&::-webkit-scrollbar":{width:"8px",background:"transparent"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:j.colors.onCardDivider,borderRadius:"8px",minHeight:"24px",border:`2px solid ${j.colors.onCardDivider}`},"&::-webkit-scrollbar-thumb:hover":{background:j.colors.onCard,opacity:.8}}}),item:v({padding:"4px 0"})},ts=({onLayout:e,data:t,renderItem:r,renderHeader:n,renderEmpty:i,keyExtractor:s,estimateSize:o=80,maxHeight:a=300,overscan:l=5,className:c,style:u={}})=>{const d=ge(null),[f,{width:p}]=pa();ee(()=>{e&&p!==null&&e({width:p??0})},[e,p]);const m=V(()=>t?.length===0?["empty"]:t,[t]),g=Kb({count:m.length,getScrollElement:()=>d.current,estimateSize:()=>o,getItemKey:s&&t.length>0?y=>s(t[y],y):void 0,overscan:l});return h("div",{ref:d,style:{...u,maxHeight:a},css:Jd.container,className:c,children:h("div",{ref:f,style:{height:`${g.getTotalSize()}px`,width:"100%",position:"relative"},children:g.getVirtualItems().map(y=>A("div",{"data-index":y.index,css:Jd.item,ref:g.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${y.start}px)`},children:[y.index===0&&n&&n(),m[y.index]==="empty"&&i&&i(),m[y.index]!=="empty"&&r(t[y.index],y.index)]},y.key))})})};var Xe=(e=>(e.Favorites="favorites",e.Artists="artists",e.Albums="albums",e.Tracks="tracks",e.Playlists="playlists",e.Genres="genres",e.NewMusic="new music",e.AlbumArtists="album artists",e.Apps="apps",e.Radios="radios",e.App="app",e.Track="track",e))(Xe||{}),st=(e=>(e.Track="track",e.Artist="artist",e.Album="album",e.Playlist="playlist",e.Genre="genre",e.Music="music",e.Podcast="podcast",e.App="app",e.Directory="directory",e))(st||{});const Qn=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},tr=e=>{if(e.thumbnail)return null;switch(e.media_content_type){case Xe.Albums:return"mdi:album";case Xe.Artists:return"mdi:account-music";case Xe.Tracks:return"mdi:music-note";case Xe.Playlists:return"mdi:playlist-music";case Xe.Genres:return"mdi:music-box-multiple";case Xe.App:return"mdi:application";case Xe.Favorites:return"mdi:star";case Xe.NewMusic:case Xe.AlbumArtists:case Xe.Radios:}switch(e.children_media_class??e.media_class){case st.Album:return"mdi:album";case st.Artist:return"mdi:account-music";case st.Track:return"mdi:music-note";case st.Playlist:return"mdi:playlist-music";case st.Genre:return"mdi:music-box-multiple";case st.App:return"mdi:application";case st.Music:return"mdi:music";case st.Podcast:return"mdi:podcast";case st.Directory:return"mdi:folder";default:return"mdi:folder"}},Gb=({data:e,onItemClick:t,onHeaderClick:r,filterConfig:n,loading:i=!1,hideEmpty:s=!1,error:o=null,...a})=>{const{t:l}=Fe(),[c,u]=F(4),{items:d,hasNoArtwork:f}=V(()=>{let m=!0;const g=[],y={};return e.forEach(_=>{const b=_.media_content_type;typeof _.thumbnail=="string"&&(m=!1),y[b]||(y[b]=[]),y[b].push(_)}),Object.entries(y).forEach(([_,b])=>{if(Object.keys(y).length>1&&g.push({type:"header",mediaType:_}),b[0]?.media_class==="track"&&b[0]?.media_content_type!=="favorite")b.forEach(w=>{g.push({type:"item",item:w})});else for(let w=0;w<b.length;w+=c){const k=b.slice(w,w+c);g.push({type:"itemsRow",items:k})}}),{items:g,hasNoArtwork:m}},[e,c]),p=m=>{switch(m.type){case"header":{const g=n.find(_=>_.media_type===m.mediaType||_.media_type.slice(0,-1)===m.mediaType),y=g?.name??m.mediaType.charAt(0).toUpperCase()+m.mediaType.slice(1);return h(qd,{onClick:g?()=>r?.(g.media_type):void 0,children:l({id:`Search.categories.${y}`,defaultMessage:y})})}case"item":{const{item:g}=m,y=async()=>{await t(g)};return h(en,{numberOfColumns:c,children:g.media_class==="track"&&g.media_content_type!=="favorite"||f?h(wr,{imageUrl:g.thumbnail,title:g.title,mdiIcon:tr(g),onClick:y},g.media_content_id):h(tn,{imageUrl:g.thumbnail,name:g.title,mdiIcon:tr(g),onClick:y},g.media_content_id)})}case"itemsRow":return h(en,{numberOfColumns:c,children:m.items.map(g=>{const y=async()=>{await t(g)};return g.media_class==="track"&&g.media_content_type!=="favorite"||f?h(wr,{imageUrl:g.thumbnail,title:g.title,mdiIcon:tr(g),onClick:y},g.media_content_id):h(tn,{imageUrl:g.thumbnail,name:g.title,mdiIcon:tr(g),onClick:y},g.media_content_id)})});default:return null}};return i?h(vr,{}):h(ts,{onLayout:({width:m})=>{m>800?u(6):m>390?u(4):u(3)},data:d,renderItem:p,renderEmpty:()=>h(Q,{children:o?h("p",{css:Le.mediaEmptyText,children:o}):s?null:h("p",{css:Le.mediaEmptyText,children:l({id:"Search.no_results",defaultMessage:"No results found."})})}),...a})},Wb=[{media_type:"artists",name:"Artists",icon:"mdi:account-music"},{media_type:"albums",name:"Albums",icon:"mdi:album"},{media_type:"tracks",name:"Tracks",icon:"mdi:music-note"},{media_type:"playlists",name:"Playlists",icon:"mdi:playlist-music"}],$a=({entityId:e,showFavorites:t,horizontalPadding:r,searchBarPosition:n="top",maxHeight:i=300,filterConfig:s=Wb,additionalOptions:o=[],renderHeader:a})=>{const{t:l}=Fe(),[c,u]=F(""),[d,f]=F("replace"),p=$d(c,600),[m,g]=F("all"),{results:y,loading:_,error:b,playItem:w}=Ob(p,m,e),{mediaBrowserItems:k}=Tb(e,m==="all"?"favorites":m,(m==="all"&&t||m!=="all")&&c===""),x=()=>A("div",{css:Le.searchBarContainer,children:[!!a&&a(),A("div",{css:Le.inputRow,children:[h(Ca,{placeholder:l({id:"Search.input_placeholder"}),onChange:u,value:c,loading:_,css:Le.input}),h(nt,{align:"end",side:"bottom",menuItems:[...o,{type:"title",label:l({id:"Search.enqueue_mode.title",defaultMessage:"Enqueue Mode"})},{label:l({id:"Search.enqueue_mode.play",defaultMessage:"Play"}),selected:d==="play",icon:Zn("play"),onClick:()=>f("play")},{label:l({id:"Search.enqueue_mode.replace",defaultMessage:"Replace Queue"}),selected:d==="replace",icon:Zn("replace"),onClick:()=>f("replace")},{label:l({id:"Search.enqueue_mode.next",defaultMessage:"Add Next"}),selected:d==="next",icon:Zn("next"),onClick:()=>f("next")},{label:l({id:"Search.enqueue_mode.add",defaultMessage:"Add to Queue"}),selected:d==="add",icon:Zn("add"),onClick:()=>f("add")}],renderTrigger:$=>h(B,{size:"x-small",icon:!o||o.length===0?Zn(d):"mdi:cog",...$})})]}),h("div",{css:Le.filterContainer,children:E()})]}),E=()=>[{media_type:"all",name:"All",icon:"mdi:all-inclusive"},...s].map($=>h(Ze,{css:Le.chip,style:{"--mmpc-chip-horizontal-margin":`${r}px`,opacity:m===$.media_type?1:.6,fontWeight:m===$.media_type?"bold":"normal"},onClick:()=>g($.media_type),icon:$.icon,children:l({id:`Search.categories.${$.name}`,defaultMessage:$.name})},$.media_type));return A("div",{css:Le.root,style:{"--mmpc-search-padding":`${r}px`},children:[h(Gb,{renderHeader:n==="top"?x:void 0,data:c===""&&k.length>0?k:y,error:b,hideEmpty:c===""&&m==="all"&&!t,onItemClick:$=>w($,e,d),style:{"--mmpc-search-padding":`${r}px`},maxHeight:i,filterConfig:s,onHeaderClick:g}),n==="bottom"&&x()]})},Zn=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},Yd=_t({}),Qd=Pe(({hass:e,children:t})=>h(Yd.Provider,{value:{hass:e},children:t})),$e=()=>te(Yd).hass,rs={root:v({position:"relative",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"background-color 0.2s",padding:4,minWidth:"var(--mmpc-icon-button-size)",minHeight:"var(--mmpc-icon-button-size)",aspectRatio:"1",color:j.colors.onCard,touchAction:"manipulation","-webkit-tap-highlight-color":"transparent","@media (hover: hover)":{"&:hover":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.2))"},"&:active":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))"}},"> ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-button-size)",width:"var(--mmpc-icon-button-size)",display:"flex",pointerEvents:"none"}}),rootSelected:v({backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))",margin:-4,padding:8}),rootDisabled:v({cursor:"not-allowed",color:"var(--disabled-text-color, #999)",opacity:.5}),rootXxsmall:v({padding:0})},B=Rt(({icon:e,size:t="medium",disabled:r=!1,loading:n=!1,selected:i=!1,style:s={},className:o,renderLongPressIndicator:a,...l},c)=>A("button",{disabled:r,css:[rs.root,r&&rs.rootDisabled,t==="xx-small"&&rs.rootXxsmall,i&&rs.rootSelected],style:{"--mmpc-icon-button-size":`${Hb(t)}px`,...typeof s=="object"?s:{}},className:o,...l,ref:c,children:[n?h(vr,{size:t}):h("ha-icon",{icon:e}),a&&a()]})),Hb=e=>{switch(e){case"xxx-small":return 8;case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}},Jb=br({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),ns={root:v({display:"flex",position:"relative"}),label:v({display:"block",marginBottom:"8px",color:j.colors.onCard,fontSize:"14px",fontWeight:500}),input:v({"--input-text-color":"var(--primary-text-color)","--input-bg-color":"var(--secondary-background-color)","--input-border-color":"var(--divider-color)","--input-focus-border-color":"var(--secondary-text-color)","--input-disabled-bg-color":"var(--disabled-color)","--input-disabled-text-color":"var(--disabled-text-color)",width:"100%",padding:"8px 12px",color:"var(--input-text-color)",backgroundColor:"var(--input-bg-color)",border:"none",boxShadow:"0 0 1px 1px var(--input-border-color)",borderRadius:"6px",fontSize:"14px","&:focus":{outline:"none",boxShadow:"0 0 1px 1px var(--input-focus-border-color)"},"&:disabled":{backgroundColor:"var(--input-disabled-bg-color)",color:"var(--input-disabled-text-color)",cursor:"not-allowed"}}),icon:v({position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)","& ha-icon":{pointerEvents:"none",animation:`${Jb} 1s linear infinite`}})},Ca=({value:e="",placeholder:t,onChange:r,disabled:n,type:i="text",label:s,name:o,loading:a=!1,className:l,style:c})=>{const u=d=>{r?.(d.target.value)};return A("div",{css:ns.root,className:l,style:c,children:[s&&h("label",{css:ns.label,children:s}),h("input",{css:ns.input,value:e,placeholder:t,onChange:u,disabled:n,type:i,name:o}),a&&h(be,{size:"x-small",icon:"mdi:loading",css:ns.icon})]})};function is(e,t){const[r,n]=F(null),[i,s]=F(!1),[o,a]=F(null),l=ge(""),c=O(async d=>{if(!e||t?.enabled===!1||d?.enabled===!1)return;const f=JSON.stringify(e);l.current=f,s(!0),a(null);try{const p=await da(e,{...t,...d});return l.current===f&&(n(p?.response??null),s(!1),a(null)),p}catch(p){return l.current===f&&(a(p&&typeof p=="object"&&"message"in p?p.message:"Unknown error"),s(!1),n(null)),null}},[e,t,i]),u=O(()=>c({forceRefresh:!0}),[c]);return ee(()=>{e&&t?.enabled!==!1&&c()},[JSON.stringify(e),t?.staleTime,t?.enabled]),V(()=>({data:r,loading:i,error:o,refetch:u}),[r,i,o,u])}const Yb=(e,t)=>{const[r,n]=F(null);ee(()=>{K().callApi("GET","config/config_entries/entry").then(l=>{const u=l.filter(d=>d.domain==="music_assistant").find(d=>d.state==="loaded");u&&n(u.entry_id)})},[]);const{data:i,loading:s}=is({type:"call_service",domain:"music_assistant",service:"search",service_data:{name:e,config_entry_id:r,media_type:t==="all"?void 0:t,limit:t==="all"?8:100},return_response:!0},{enabled:e!==""&&!!r,staleTime:12e4}),o=O(async(a,l,c)=>K().callService("music_assistant","play_media",{entity_id:l,media_type:a.media_type,media_id:a.uri,enqueue:c}),[]);return V(()=>({results:i,loading:s,playItem:o}),[i,s])},Qb=[{type:"all",label:"All",icon:"mdi:all-inclusive"},{type:"artist",label:"Artists",icon:"mdi:account-music"},{type:"album",label:"Albums",icon:"mdi:album"},{type:"track",label:"Tracks",icon:"mdi:music-note"},{type:"playlist",label:"Playlists",icon:"mdi:playlist-music"},{type:"radio",label:"Radio",icon:"mdi:radio"},{type:"audiobook",label:"Audiobooks",icon:"mdi:book"},{type:"podcast",label:"Podcasts",icon:"mdi:podcast"}],Zd={artists:"artist",albums:"album",tracks:"track",playlists:"playlist",radio:"radio",audiobooks:"audiobook",podcasts:"podcast"},Xd={artist:"Artists",album:"Albums",track:"Tracks",playlist:"Playlists",radio:"Radio",audiobook:"Audiobooks",podcast:"Podcasts"},Zb=(e,t)=>{const[r,n]=F(null),[i,s]=F(),[o,a]=F(!1);return ee(()=>{K().callApi("GET","config/config_entries/entry").then(c=>{const d=c.filter(f=>f.domain==="music_assistant").find(f=>f.state==="loaded");d&&n(d.entry_id)})},[]),ee(()=>{if(!r||!t){s(null);return}a(!0);const l={artists:[],albums:[],tracks:[],playlists:[],radio:[],podcasts:[],audiobooks:[]},c=async u=>{const d={type:"call_service",domain:"music_assistant",service:"get_library",service_data:{config_entry_id:r,media_type:u,favorite:!0,limit:e==="all"?8:20},return_response:!0};try{const f=await da(d,{staleTime:12e4});if(!f.response)return;l[Xb[u]]=f.response.items??[]}catch(f){return console.error("Error fetching favorites:",u,f),Promise.reject(f)}};e==="all"?Promise.all(Object.values(Zd).map(u=>c(u))).then(()=>{a(!1),s(l)}):c(e).then(()=>{a(!1),s(l)})},[r,e]),V(()=>({favorites:i,loading:o}),[i,o])},Xb={artist:"artists",album:"albums",track:"tracks",playlist:"playlists",radio:"radio",audiobook:"audiobooks",podcast:"podcasts"},ev=({onItemClick:e,onHeaderClick:t,loading:r=!1,error:n=null,results:i,...s})=>{const{t:o}=Fe(),[a,l]=F(4),c=V(()=>{const d=[];if(!i)return d;const f=Object.entries(i).map(([p,m])=>({mediaType:Zd[p],items:m})).filter(p=>p.items.length>0);return f.forEach(({mediaType:p,items:m})=>{if(m.length!==0)if(f.length>1&&d.push({type:"header",mediaType:p}),m[0].media_type==="track")m.forEach(g=>{d.push({type:"item",item:g})});else for(let g=0;g<m.length;g+=a){const y=m.slice(g,g+a);d.push({type:"itemsRow",items:y})}}),d},[i,a]),u=d=>{switch(d.type){case"header":return h(qd,{onClick:()=>t?.(d.mediaType),children:o({id:`Search.categories.${Xd[d.mediaType]}`,defaultMessage:Xd[d.mediaType]})});case"item":{const{item:f}=d,p=async()=>{await e(f)};return h(en,{numberOfColumns:a,children:f.media_type==="track"?h(wr,{imageUrl:f.image??f.album?.image,title:f.name,artist:f.artists.map(m=>m.name).join(", "),onClick:p},f.uri):h(tn,{imageUrl:f.image,name:f.name,artist:"artists"in f?f.artists.map(m=>m.name).join(", "):void 0,onClick:p},f.uri)})}case"itemsRow":return h(en,{numberOfColumns:a,children:d.items.map(f=>{const p=async()=>{await e(f)};return f.media_type==="track"?h(wr,{imageUrl:f.image??f.album?.image,title:f.name,artist:f.artists.map(m=>m.name).join(", "),onClick:p},f.uri):h(tn,{imageUrl:f.image,name:f.name,artist:"artists"in f?f.artists.map(m=>m.name).join(", "):void 0,onClick:p},f.uri)})});default:return null}};return r?h(vr,{}):n?h("p",{css:Le.mediaEmptyText,children:n}):h(ts,{onLayout:({width:d})=>{d>800?l(6):d>390?l(4):l(3)},data:c,renderItem:u,renderEmpty:()=>h("p",{css:Le.mediaEmptyText,children:o({id:"Search.no_results",defaultMessage:"No results found."})}),...s})},Aa=({maEntityId:e,horizontalPadding:t,searchBarPosition:r="top",additionalOptions:n=[],maxHeight:i=300,renderHeader:s})=>{const{t:o}=Fe(),[a,l]=F(""),[c,u]=F("play"),d=$d(a,600),[f,p]=F("all"),{results:m,loading:g,playItem:y}=Yb(d,f),{favorites:_}=Zb(f,a===""),b=()=>A("div",{css:Le.searchBarContainer,children:[!!s&&s(),A("div",{css:Le.inputRow,children:[h(Ca,{placeholder:o({id:"Search.input_placeholder"}),onChange:l,value:a,loading:g,css:Le.input}),h(nt,{align:"end",side:"bottom",menuItems:[...n,{type:"title",label:o({id:"Search.enqueue_mode.title",defaultMessage:"Enqueue Mode"})},{label:o({id:"Search.enqueue_mode.play",defaultMessage:"Play"}),selected:c==="play",icon:nn("play"),onClick:()=>u("play")},{label:o({id:"Search.enqueue_mode.replace",defaultMessage:"Replace Queue"}),selected:c==="replace",icon:nn("replace"),onClick:()=>u("replace")},{label:o({id:"Search.enqueue_mode.next",defaultMessage:"Add Next"}),selected:c==="next",icon:nn("next"),onClick:()=>u("next")},{label:o({id:"Search.enqueue_mode.replace_next",defaultMessage:"Replace Next"}),selected:c==="replace_next",icon:nn("replace_next"),onClick:()=>u("replace_next")},{label:o({id:"Search.enqueue_mode.add",defaultMessage:"Add to Queue"}),selected:c==="add",icon:nn("add"),onClick:()=>u("add")}],renderTrigger:k=>h(B,{size:"x-small",icon:!n||n.length===0?nn(c):"mdi:cog",...k})})]}),h("div",{css:Le.filterContainer,children:w()})]}),w=()=>Qb.map(k=>h(Ze,{css:Le.chip,style:{"--mmpc-chip-horizontal-margin":`${t}px`,opacity:f===k.type?1:.6,fontWeight:f===k.type?"bold":"normal"},onClick:()=>p(k.type),icon:k.icon,children:o({id:`Search.categories.${k.label}`,defaultMessage:k.label})},k.type));return A("div",{css:Le.root,style:{"--mmpc-search-padding":`${t}px`},children:[h(ev,{renderHeader:r==="top"?b:void 0,results:a!==""&&m?m:_||void 0,onItemClick:k=>y(k,e,c),style:{"--mmpc-search-padding":`${t}px`},maxHeight:i,onHeaderClick:p}),r==="bottom"&&b()]})},nn=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"replace_next":return"mdi:playlist-edit";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},ht={header:v({marginBottom:16}),navigationBar:v({display:"flex",flexDirection:"row",alignItems:"center",padding:"8px 16px",color:"var(--primary-text-color, #fff)",borderBottom:"0.5px solid var(--divider-color, rgba(0, 0, 0, 0.12))"}),breadCrumbs:v({display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center",overflowX:"auto",maxWidth:"calc(100% - 40px)",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),breadCrumbItem:v({background:"none",border:"none",color:"var(--primary-text-color, #fff)",cursor:"pointer",padding:"2px 4px",whiteSpace:"nowrap",fontSize:"0.9rem","&:hover":{textDecoration:"underline"}}),breadCrumbSeparator:v({color:"var(--secondary-text-color)"}),noMediaText:v({padding:"16px",paddingBottom:"32px",color:"var(--secondary-text-color)",textAlign:"center"}),itemFilter:v({marginTop:"8px",marginBottom:"16px"}),mediaBrowserEntrySelector:v({marginLeft:"auto"}),mediaItemHeaderMenuImage:v({width:16,height:16,borderRadius:8,marginRight:2,marginLeft:-4})},Ea=({mediaBrowserEntryArray:e,horizontalPadding:t,maxHeight:r,renderHeader:n})=>{const{t:i}=Fe(),[s,o]=F(e[0]),[a,l]=F([]),[c,u]=F([]),[d,f]=F(!1),[p,m]=F(4),[g,y]=F(""),_=V(()=>e.map(M=>({label:M.name??M.entity_id,selected:M.entity_id===s.entity_id,onClick:()=>{o(M)}})),[e,s.entity_id]),{items:b,hasNoArtwork:w}=V(()=>{let M=!0;const L=[],J={track:[],expandable:[]};return(g===""?a:a.filter(xe=>xe.title.toLowerCase().includes(g.toLowerCase()))).forEach(xe=>{typeof xe.thumbnail=="string"&&(M=!1);const Ne=(xe.media_content_type===Xe.Tracks||xe.media_class===st.Track)&&xe.media_content_type!=="favorite"&&c.length!==0?"track":"expandable";J[Ne]||(J[Ne]=[]),J[Ne].push(xe)}),Object.entries(J).forEach(([xe,et])=>{if(xe==="track"&&c.length!==0)et.forEach(Ne=>{L.push([Ne])});else for(let Ne=0;Ne<et.length;Ne+=p){const An=et.slice(Ne,Ne+p);L.push(An)}}),{items:L,hasNoArtwork:M}},[a,p,g]);ee(()=>{y(""),(async()=>{f(!0);try{const J=await K().callWS({type:"media_player/browse_media",entity_id:s.entity_id,...c.length>0?{media_content_id:c[c.length-1].media_content_id,media_content_type:c[c.length-1].media_content_type}:{}});J&&J.children?l(J.children):l([])}catch(L){console.error("Error fetching media items:",L),l([])}f(!1)})()},[c,s]);const k=O((M,L)=>{try{K().callService("media_player","play_media",{entity_id:s.entity_id,media_content_type:M.media_content_type,media_content_id:M.media_content_id,enqueue:L})}catch(J){console.error("Error playing media item:",{entity_id:s.entity_id,media_content_type:M.media_content_type,media_content_id:M.media_content_id},J)}},[s.entity_id]),x=O(M=>{if(!d&&M.can_expand&&M.media_content_id!==c[c.length-1]?.media_content_id){u(L=>[...L,M]);return}},[c,d]),E=O(()=>{d||c.length>0&&u(M=>M.slice(0,-1))},[d]),$=O(M=>{d||u(L=>L.slice(0,M+1))},[d]),S=O((M,L=!1)=>{const J=[];return M.can_play&&(J.push({label:i({id:"MediaBrowser.media_item_menu.enqueue_mode.play",defaultMessage:"Play"}),icon:Qn("play"),onClick:()=>k(M)}),J.push({label:i({id:"MediaBrowser.media_item_menu.enqueue_dropdown_label",defaultMessage:"Enqueue"}),icon:Qn("next"),children:[{label:i({id:"MediaBrowser.media_item_menu.enqueue_mode.next",defaultMessage:"Play Next"}),icon:Qn("next"),onClick:()=>k(M,"next")},{label:i({id:"MediaBrowser.media_item_menu.enqueue_mode.replace",defaultMessage:"Replace Queue"}),icon:Qn("replace"),onClick:()=>k(M,"replace")},{label:i({id:"MediaBrowser.media_item_menu.enqueue_mode.add",defaultMessage:"Add to Queue"}),icon:Qn("add"),onClick:()=>k(M,"add")}]})),M.can_expand&&!L&&J.push({label:i({id:"MediaBrowser.media_item_menu.browse",defaultMessage:"Browse"}),icon:"mdi:folder-outline",onClick:()=>x(M)}),J},[s]),I=V(()=>c[c.length-1]?S(c[c.length-1],!0):[],[c]),P=M=>c.length===0?C(M):h(nt,{menuItems:S(M),renderTrigger:L=>h(wr,{title:M.title,imageUrl:M.thumbnail,mdiIcon:tr(M),...L},M.media_content_id+c.length)}),C=M=>!M.can_play||M.can_expand&&c.length===0?h(tn,{name:M.title,imageUrl:M.thumbnail,mdiIcon:tr(M),onClick:()=>x(M)},M.media_content_id+c.length):h(nt,{menuItems:S(M),renderTrigger:L=>h(tn,{name:M.title,imageUrl:M.thumbnail,mdiIcon:tr(M),...L},M.media_content_id+c.length)}),R=M=>h(en,{numberOfColumns:p,children:M.map(L=>w||(M[0].media_class===st.Track||M[0].media_content_type===Xe.Track)&&L.media_content_type!=="favorite"?P(L):C(L))});return h("div",{css:Le.root,style:{"--mmpc-search-padding":`${t}px`},children:h(ts,{onLayout:({width:M})=>{M>800?m(6):M>390?m(4):m(3)},maxHeight:r,renderItem:R,renderHeader:()=>A(Q,{children:[n&&n(),h("div",{css:ht.header,children:c.length>0||e.length>1?h(Q,{children:A("div",{css:ht.navigationBar,children:[c.length>0?h(B,{icon:"mdi:arrow-left",size:"x-small",onClick:E,disabled:c.length===0}):h(be,{icon:"mdi:home",size:"x-small"}),A("div",{css:ht.breadCrumbs,children:[h("button",{css:ht.breadCrumbItem,onClick:()=>u([]),children:c.length===0?i({id:"MediaBrowser.breadcrumb_home",defaultMessage:"Home"}):h(be,{icon:"mdi:home",size:"x-small"})}),c.map((M,L)=>A(Q,{children:[h("span",{css:ht.breadCrumbSeparator,children:"/"}),h("button",{css:ht.breadCrumbItem,onClick:()=>$(L),children:M.title})]},`breadcrumb-${L}-${M.title}`))]}),e.length>1&&c.length===0&&h(nt,{menuItems:_,side:"bottom",align:"end",renderTrigger:M=>A(Ze,{icon:"mdi:import",size:"small",invertedColors:!0,border:!0,css:ht.mediaBrowserEntrySelector,...M,children:[s.name??s.entity_id,h(be,{size:"x-small",icon:"mdi:chevron-down"})]})}),I.length>0&&h(nt,{menuItems:I,side:"bottom",align:"end",renderTrigger:M=>A(Ze,{size:"small",invertedColors:!0,border:!0,css:ht.mediaBrowserEntrySelector,...M,children:[c[c.length-1].thumbnail?h(Ma,{css:ht.mediaItemHeaderMenuImage,imageUrl:c[c.length-1].thumbnail,mdiIcon:tr(c[c.length-1])}):h(be,{size:"x-small",icon:"mdi:play"}),i({id:"MediaBrowser.media_item_menu.enqueue_mode.play",defaultMessage:"Play"}),h(be,{size:"x-small",icon:"mdi:chevron-down"})]})})]})}):null}),a.length>3&&c.length>0&&h(Ca,{placeholder:i({id:"MediaBrowser.filter_placeholder",defaultMessage:"Filter items..."}),onChange:y,value:g,css:ht.itemFilter,style:{marginLeft:t,marginRight:t}})]}),renderEmpty:()=>d?h(vr,{}):!d&&a.length===0?h("div",{css:ht.noMediaText,children:i({id:"MediaBrowser.empty_text",defaultMessage:"No media items available."})}):null,data:b},c[c.length-1]?.media_content_id||"root")})},tv={root:v({display:"contents","--mmpc-chip-background":"var(--card-background-color)","--mmpc-chip-foreground":"var(--primary-text-color)"})},rv=()=>{const{config:e}=te(de);return h("div",{css:tv.root,children:h(es,{config:{entity_id:e.entity_id,speaker_group:{entities:e.entities}},showGrouped:!0})})};function jt({actionConfig:e,rootElement:t,overrideCallback:r}){const n=V(()=>({onTap:e?.tap_action?()=>zo(t,e,"tap",K()):void 0,onLongPress:e?.hold_action?()=>zo(t,e,"hold",K()):void 0,onDoubleTap:e?.double_tap_action?()=>zo(t,e,"double_tap",K()):void 0,...r??{}}),[e,r]),i=Cv(n);return V(()=>i,[i])}class nv{constructor(t,r){this.pixels=t,this.opts=r;const{sigBits:n}=r,i=(k,x,E)=>(k<<2*n)+(x<<n)+E;this.getColorIndex=i;const s=8-n,o=1<<3*n,a=new Uint32Array(o);let l,c,u,d,f,p,m,g,y,_;l=u=f=0,c=d=p=Number.MAX_VALUE;const b=t.length/4;let w=0;for(;w<b;){const k=w*4;if(w++,m=t[k+0],g=t[k+1],y=t[k+2],_=t[k+3],_===0)continue;m=m>>s,g=g>>s,y=y>>s;const x=i(m,g,y);a[x]===void 0&&(a[x]=0),a[x]+=1,m>l&&(l=m),m<c&&(c=m),g>u&&(u=g),g<d&&(d=g),y>f&&(f=y),y<p&&(p=y)}this._colorCount=a.reduce((k,x)=>x>0?k+1:k,0),this.hist=a,this.rmax=l,this.rmin=c,this.gmax=u,this.gmin=d,this.bmax=f,this.bmin=p}get colorCount(){return this._colorCount}}class iv{scaleDown(t){const r=this.getWidth(),n=this.getHeight();let i=1;if(t.maxDimension>0){const s=Math.max(r,n);s>t.maxDimension&&(i=t.maxDimension/s)}else i=1/t.quality;i<1&&this.resize(r*i,n*i,i)}}function sv(e,t){var r;if(t.length>0){const n=e.data,i=n.length/4;let s,o,a,l,c;for(let u=0;u<i;u++){s=u*4,o=n[s+0],a=n[s+1],l=n[s+2],c=n[s+3];for(let d=0;d<t.length;d++)if(!((r=t[d])!=null&&r.call(t,o,a,l,c))){n[s+3]=0;break}}}return e}function ov(e){const t=new URL(e,location.href);return t.protocol===location.protocol&&t.host===location.host&&t.port===location.port}function av(e,t){const r=new URL(e),n=new URL(t);return r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port}class lv extends iv{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const t=this.image;if(!t)throw new Error("Image is not initialized");const r=this._canvas=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new ReferenceError("Failed to create canvas context");this._context=n,r.className="@vibrant/canvas",r.style.display="none",this._width=r.width=t.width,this._height=r.height=t.height,n.drawImage(t,0,0),document.body.appendChild(r)}load(t){let r,n;if(typeof t=="string")r=document.createElement("img"),n=t,!ov(n)&&!av(window.location.href,n)&&(r.crossOrigin="anonymous"),r.src=n;else if(t instanceof HTMLImageElement)r=t,n=t.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=r,new Promise((i,s)=>{const o=()=>{this._initCanvas(),i(this)};r.complete?o():(r.onload=o,r.onerror=a=>s(new Error(`Fail to load image: ${n}`)))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(t){this._getContext().putImageData(t,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(t,r,n){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=t,this._height=this._getCanvas().height=r,this._getContext().scale(n,n),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function Xn(e,...t){return t.forEach(r=>{if(r){for(const n in r)if(r.hasOwnProperty(n)){const i=r[n];Array.isArray(i)?e[n]=i.slice(0):typeof i=="object"?(e[n]||(e[n]={}),Xn(e[n],i)):e[n]=i}}}),e}function cv(e,t){const{colorCount:r,quantizer:n,generators:i,filters:s}=e,o={colorCount:r},a=typeof n=="string"?{name:n,options:{}}:n;return a.options=Xn({},o,a.options),Xn({},{quantizer:a,generators:i,filters:s},t)}class uv{constructor(t,r={}){this._src=t,this._opts=Xn({},rr.DefaultOpts,r)}maxColorCount(t){return this._opts.colorCount=t,this}maxDimension(t){return this._opts.maxDimension=t,this}addFilter(t){return this._opts.filters?this._opts.filters.push(t):this._opts.filters=[t],this}removeFilter(t){if(this._opts.filters){const r=this._opts.filters.indexOf(t);r>0&&this._opts.filters.splice(r)}return this}clearFilters(){return this._opts.filters=[],this}quality(t){return this._opts.quality=t,this}useImageClass(t){return this._opts.ImageClass=t,this}useGenerator(t,r){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(r?{name:t,options:r}:t),this}useQuantizer(t,r){return this._opts.quantizer=r?{name:t,options:r}:t,this}build(){return new rr(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class Ia{constructor(t){this.pipeline=t,this._map={}}names(){return Object.keys(this._map)}has(t){return!!this._map[t]}get(t){return this._map[t]}register(t,r){return this._map[t]=r,this.pipeline}}class dv{constructor(){this.filter=new Ia(this),this.quantizer=new Ia(this),this.generator=new Ia(this)}_buildProcessTasks({filters:t,quantizer:r,generators:n}){return n.length===1&&n[0]==="*"&&(n=this.generator.names()),{filters:t.map(s=>i(this.filter,s)),quantizer:i(this.quantizer,r),generators:n.map(s=>i(this.generator,s))};function i(s,o){let a,l;return typeof o=="string"?a=o:(a=o.name,l=o.options),{name:a,fn:s.get(a),options:l}}}async process(t,r){const{filters:n,quantizer:i,generators:s}=this._buildProcessTasks(r),o=await this._filterColors(n,t),a=await this._generateColors(i,o),l=await this._generatePalettes(s,a);return{colors:a,palettes:l}}_filterColors(t,r){return Promise.resolve(sv(r,t.map(({fn:n})=>n)))}_generateColors(t,r){return Promise.resolve(t.fn(r.data,t.options))}async _generatePalettes(t,r){const n=await Promise.all(t.map(({fn:i,options:s})=>Promise.resolve(i(r,s))));return Promise.resolve(n.reduce((i,s,o)=>(i[t[o].name]=s,i),{}))}}function fv(e,t,r){return"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1,7)}function hv(e,t,r){e/=255,t/=255,r/=255;const n=Math.max(e,t,r),i=Math.min(e,t,r);let s=0,o=0;const a=(n+i)/2;if(n!==i){const l=n-i;switch(o=a>.5?l/(2-n-i):l/(n+i),n){case e:s=(t-r)/l+(t<r?6:0);break;case t:s=(r-e)/l+2;break;case r:s=(e-t)/l+4;break}s/=6}return[s,o,a]}function Ut(e,t,r){let n,i,s;function o(a,l,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+(l-a)*6*c:c<1/2?l:c<2/3?a+(l-a)*(2/3-c)*6:a}if(t===0)n=i=s=r;else{const a=r<.5?r*(1+t):r+t-r*t,l=2*r-a;n=o(l,a,e+1/3),i=o(l,a,e),s=o(l,a,e-1/3)}return[n*255,i*255,s*255]}class ot{static applyFilters(t,r){return r.length>0?t.filter(({r:n,g:i,b:s})=>{var o;for(let a=0;a<r.length;a++)if(!((o=r[a])!=null&&o.call(r,n,i,s,255)))return!1;return!0}):t}static clone(t){return new ot(t._rgb,t._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[t,r,n]=this._rgb;this._hsl=hv(t,r,n)}return this._hsl}get hex(){if(!this._hex){const[t,r,n]=this._rgb;this._hex=fv(t,r,n)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const t=this._rgb;this._yiq=(t[0]*299+t[1]*587+t[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(t,r){this._rgb=t,this._population=r}}const ef=class Xl{constructor(t,r){this._src=t,this.opts=Xn({},Xl.DefaultOpts,r)}static use(t){this._pipeline=t}static from(t){return new uv(t)}get result(){return this._result}_process(t,r){t.scaleDown(this.opts);const n=cv(this.opts,r);return Xl._pipeline.process(t.getImageData(),n)}async getPalette(){const t=new this.opts.ImageClass;try{const r=await t.load(this._src),n=await this._process(r,{generators:["default"]});this._result=n;const i=n.palettes.default;if(!i)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return t.remove(),i}catch(r){return t.remove(),Promise.reject(r)}}async getPalettes(){const t=new this.opts.ImageClass;try{const r=await t.load(this._src),n=await this._process(r,{generators:["*"]});this._result=n;const i=n.palettes;return t.remove(),i}catch(r){return t.remove(),Promise.reject(r)}}};ef.DefaultOpts={colorCount:64,quality:5,filters:[]};let rr=ef;rr.DefaultOpts.quantizer="mmcq",rr.DefaultOpts.generators=["default"],rr.DefaultOpts.filters=["default"],rr.DefaultOpts.ImageClass=lv;const Pa=5,Oa=8-Pa;class ss{constructor(t,r,n,i,s,o,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:t,r2:r,g1:n,g2:i,b1:s,b2:o}}static build(t){const r=new nv(t,{sigBits:Pa}),{rmin:n,rmax:i,gmin:s,gmax:o,bmin:a,bmax:l}=r;return new ss(n,i,s,o,a,l,r)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:t,r2:r,g1:n,g2:i,b1:s,b2:o}=this.dimension;this._volume=(r-t+1)*(i-n+1)*(o-s+1)}return this._volume}count(){if(this._count<0){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:s,g2:o,b1:a,b2:l}=this.dimension;let c=0;for(let u=n;u<=i;u++)for(let d=s;d<=o;d++)for(let f=a;f<=l;f++){const p=r(u,d,f);t[p]&&(c+=t[p])}this._count=c}return this._count}clone(){const{histogram:t}=this,{r1:r,r2:n,g1:i,g2:s,b1:o,b2:a}=this.dimension;return new ss(r,n,i,s,o,a,t)}avg(){if(!this._avg){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:s,g2:o,b1:a,b2:l}=this.dimension;let c=0;const u=1<<8-Pa;let d,f,p;d=f=p=0;for(let m=n;m<=i;m++)for(let g=s;g<=o;g++)for(let y=a;y<=l;y++){const _=r(m,g,y),b=t[_];b&&(c+=b,d+=b*(m+.5)*u,f+=b*(g+.5)*u,p+=b*(y+.5)*u)}c?this._avg=[~~(d/c),~~(f/c),~~(p/c)]:this._avg=[~~(u*(n+i+1)/2),~~(u*(s+o+1)/2),~~(u*(a+l+1)/2)]}return this._avg}contains(t){let[r,n,i]=t;const{r1:s,r2:o,g1:a,g2:l,b1:c,b2:u}=this.dimension;return r>>=Oa,n>>=Oa,i>>=Oa,r>=s&&r<=o&&n>=a&&n<=l&&i>=c&&i<=u}split(){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:s,g2:o,b1:a,b2:l}=this.dimension,c=this.count();if(!c)return[];if(c===1)return[this.clone()];const u=i-n+1,d=o-s+1,f=l-a+1,p=Math.max(u,d,f);let m=null,g,y;g=y=0;let _=null;if(p===u){_="r",m=new Uint32Array(i+1);for(let E=n;E<=i;E++){g=0;for(let $=s;$<=o;$++)for(let S=a;S<=l;S++){const I=r(E,$,S);t[I]&&(g+=t[I])}y+=g,m[E]=y}}else if(p===d){_="g",m=new Uint32Array(o+1);for(let E=s;E<=o;E++){g=0;for(let $=n;$<=i;$++)for(let S=a;S<=l;S++){const I=r($,E,S);t[I]&&(g+=t[I])}y+=g,m[E]=y}}else{_="b",m=new Uint32Array(l+1);for(let E=a;E<=l;E++){g=0;for(let $=n;$<=i;$++)for(let S=s;S<=o;S++){const I=r($,S,E);t[I]&&(g+=t[I])}y+=g,m[E]=y}}let b=-1;const w=new Uint32Array(m.length);for(let E=0;E<m.length;E++){const $=m[E];$&&(b<0&&$>y/2&&(b=E),w[E]=y-$)}const k=this;function x(E){const $=E+"1",S=E+"2",I=k.dimension[$];let P=k.dimension[S];const C=k.clone(),R=k.clone(),M=b-I,L=P-b;for(M<=L?(P=Math.min(P-1,~~(b+L/2)),P=Math.max(0,P)):(P=Math.max(I,~~(b-1-M/2)),P=Math.min(k.dimension[S],P));!m[P];)P++;let J=w[P];for(;!J&&m[P-1];)J=w[--P];return C.dimension[S]=P,R.dimension[$]=P+1,[C,R]}return x(_)}}class tf{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(t){this._comparator=t,this.contents=[],this._sorted=!1}push(t){this.contents.push(t),this._sorted=!1}peek(t){return this._sort(),t=typeof t=="number"?t:this.contents.length-1,this.contents[t]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this._sort(),this.contents.map(t)}}const pv=.75;function rf(e,t){let r=e.size();for(;e.size()<t;){const n=e.pop();if(n&&n.count()>0){const[i,s]=n.split();if(!i||(e.push(i),s&&s.count()>0&&e.push(s),e.size()===r))break;r=e.size()}else break}}const mv=(e,t)=>{if(e.length===0||t.colorCount<2||t.colorCount>256)throw new Error("Wrong MMCQ parameters");const r=ss.build(e);r.histogram.colorCount;const n=new tf((s,o)=>s.count()-o.count());n.push(r),rf(n,pv*t.colorCount);const i=new tf((s,o)=>s.count()*s.volume()-o.count()*o.volume());return i.contents=n.contents,rf(i,t.colorCount-i.size()),gv(i)};function gv(e){const t=[];for(;e.size();){const r=e.pop(),n=r.avg();t.push(new ot(n,r.count()))}return t}const yv={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function _v(e){let t=0;return e.forEach(r=>{t=Math.max(t,r.population)}),t}function bv(e,t){return e.Vibrant===t||e.DarkVibrant===t||e.LightVibrant===t||e.Muted===t||e.DarkMuted===t||e.LightMuted===t}function vv(e,t,r,n,i,s,o){function a(...c){let u=0,d=0;for(let f=0;f<c.length;f+=2){const p=c[f],m=c[f+1];!p||!m||(u+=p*m,d+=m)}return u/d}function l(c,u){return 1-Math.abs(c-u)}return a(l(e,t),o.weightSaturation,l(r,n),o.weightLuma,i/s,o.weightPopulation)}function sn(e,t,r,n,i,s,o,a,l,c){let u=null,d=0;return t.forEach(f=>{const[,p,m]=f.hsl;if(p>=a&&p<=l&&m>=i&&m<=s&&!bv(e,f)){const g=vv(p,o,m,n,f.population,r,c);(u===null||g>d)&&(u=f,d=g)}}),u}function wv(e,t,r){const n={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return n.Vibrant=sn(n,e,t,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.LightVibrant=sn(n,e,t,r.targetLightLuma,r.minLightLuma,1,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.DarkVibrant=sn(n,e,t,r.targetDarkLuma,0,r.maxDarkLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.Muted=sn(n,e,t,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.LightMuted=sn(n,e,t,r.targetLightLuma,r.minLightLuma,1,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.DarkMuted=sn(n,e,t,r.targetDarkLuma,0,r.maxDarkLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n}function xv(e,t,r){if(!e.Vibrant&&!e.DarkVibrant&&!e.LightVibrant){if(!e.DarkVibrant&&e.DarkMuted){let[n,i,s]=e.DarkMuted.hsl;s=r.targetDarkLuma,e.DarkVibrant=new ot(Ut(n,i,s),0)}if(!e.LightVibrant&&e.LightMuted){let[n,i,s]=e.LightMuted.hsl;s=r.targetDarkLuma,e.DarkVibrant=new ot(Ut(n,i,s),0)}}if(!e.Vibrant&&e.DarkVibrant){let[n,i,s]=e.DarkVibrant.hsl;s=r.targetNormalLuma,e.Vibrant=new ot(Ut(n,i,s),0)}else if(!e.Vibrant&&e.LightVibrant){let[n,i,s]=e.LightVibrant.hsl;s=r.targetNormalLuma,e.Vibrant=new ot(Ut(n,i,s),0)}if(!e.DarkVibrant&&e.Vibrant){let[n,i,s]=e.Vibrant.hsl;s=r.targetDarkLuma,e.DarkVibrant=new ot(Ut(n,i,s),0)}if(!e.LightVibrant&&e.Vibrant){let[n,i,s]=e.Vibrant.hsl;s=r.targetLightLuma,e.LightVibrant=new ot(Ut(n,i,s),0)}if(!e.Muted&&e.Vibrant){let[n,i,s]=e.Vibrant.hsl;s=r.targetMutesSaturation,e.Muted=new ot(Ut(n,i,s),0)}if(!e.DarkMuted&&e.DarkVibrant){let[n,i,s]=e.DarkVibrant.hsl;s=r.targetMutesSaturation,e.DarkMuted=new ot(Ut(n,i,s),0)}if(!e.LightMuted&&e.LightVibrant){let[n,i,s]=e.LightVibrant.hsl;s=r.targetMutesSaturation,e.LightMuted=new ot(Ut(n,i,s),0)}}const kv=(e,t)=>{t=Object.assign({},yv,t);const r=_v(e),n=wv(e,r,t);return xv(n,r,t),n},Mv=new dv().filter.register("default",(e,t,r,n)=>n>=125&&!(e>250&&t>250&&r>250)).quantizer.register("mmcq",mv).generator.register("default",kv);rr.use(Mv);function Ta(){const{attributes:{entity_picture:e,entity_picture_local:t}}=ye(),r=t||e,n=ge(null),[i,s]=F(null),[o,a]=F(Bt()),l=O(()=>{r&&r!==n.current&&(n.current=r,setTimeout(()=>{n.current===r&&rr.from(r).getPalette().then(p=>{s(p)}).catch(p=>{s(null),console.error("Error getting color with Vibrant:",p)})},800))},[r]);ee(()=>{r&&l()},[r]),ee(()=>{const p=window.matchMedia("(prefers-color-scheme: dark)"),m=()=>a(Bt());if(a(Bt()),p.addEventListener)return p.addEventListener("change",m),()=>p.removeEventListener("change",m)},[]);const c=O(p=>{const m=eb(p);if(m){const g=Z_(m);return g?{h:g[0],s:g[1],l:g[2],a:g[3]??1}:null}return null},[]),u=V(()=>{const p=c("--card-background-color"),m=c("--ha-dialog-surface-background")??c("--mdc-theme-surface")??{h:0,s:0,l:o?0:100,a:1},g=c("--primary-color"),y=c("--secondary-background-color"),_=c("--divider-color");return{cardBackgroundColor:p,haDialogSurfaceBackground:m,primaryColor:g,secondaryBackgroundColor:y,dividerColor:_}},[o,c]),d=V(()=>{if(o||!i)return null;const p=i.Vibrant,m=i.LightVibrant??i.Vibrant,g=i.DarkVibrant??i.Muted;if(!m||!g||!p)return null;const y=on(m.hsl),_={...y,s:u.primaryColor?.s??y.s,l:u.primaryColor?.l??50},b={..._,s:u.cardBackgroundColor?.s??4.35,l:u.cardBackgroundColor?.l??95.49},w={...nf(b)};return{artVars:{"--art-color":`${me(on(p.hsl))}`,"--art-alternative-color":`${me(on(g.hsl))}`,"--art-surface-color":`${me(b)}`},haVars:{"--primary-color":`${me(_)}`,"--ha-card-background":`${me(b)}`,"--card-background-color":`${me(b)}`,"--primary-text-color":`${me(w)}`,"--secondary-text-color":`${me({...w,l:w.l*1.1})}`,"--icon-primary-color":`${me(w)}`,"--divider-color":`${me({...b,s:u.dividerColor?.s??b.s,l:u.dividerColor?.l??88,a:u.dividerColor?.a??.2})}`,"--clear-background-color":`${me({...b,l:10})}`,"--secondary-background-color":`${me({...w,s:u.secondaryBackgroundColor?.s??w.s,l:u.secondaryBackgroundColor?.l??95})}`,"--ha-dialog-surface-background":`${me({...u.haDialogSurfaceBackground,h:_.h,a:1})}`}}},[i,o,u]),f=V(()=>{if(!o||!i)return null;const p=i.Vibrant,m=i.DarkVibrant??i.Vibrant,g=i.LightVibrant??i.Muted;if(!m||!g||!p)return null;const y=on(m.hsl),_={...y,s:u.primaryColor?.s??y.s,l:u.primaryColor?.l??50,a:u.primaryColor?.a??1},b={..._,s:u.cardBackgroundColor?.s??2.91,l:u.cardBackgroundColor?.l??20.2,a:u.cardBackgroundColor?.a??1},w={...nf(b)};return{artVars:{"--art-color":`${me(on(p.hsl))}`,"--art-alternative-color":`${me(on(g.hsl))}`,"--art-surface-color":`${me(b)}`},haVars:{"--primary-color":`${me(_)}`,"--ha-card-background":`${me(b)}`,"--card-background-color":`${me(b)}`,"--primary-text-color":`${me(w)}`,"--secondary-text-color":`${me({...w,l:w.l*.9})}`,"--icon-primary-color":`${me(w)}`,"--divider-color":`${me({...b,s:u.dividerColor?.s??b.s,l:u.dividerColor?.l??25,a:u.dividerColor?.a??.2})}`,"--clear-background-color":`${me({...b,l:0})}`,"--secondary-background-color":`${me({...b,s:u.secondaryBackgroundColor?.s??w.s,l:u.secondaryBackgroundColor?.l??19})}`,"--ha-dialog-surface-background":`${me({...u.haDialogSurfaceBackground,h:_.h,a:1})}`}}},[i,o]);return V(()=>({artVars:o?f?.artVars:d?.artVars,haVars:o?f?.haVars:d?.haVars}),[f,d])}const on=e=>{const t=Math.round(e[0]*360),r=Math.round(e[1]*100),n=Math.round(e[2]*100);return{h:t,s:r,l:n}},nf=({h:e,s:t,l:r})=>{const n=(e+180)%360,i=100-r;return{h:n,s:t,l:i}},me=({h:e,s:t,l:r,a:n})=>`hsla(${e}deg, ${t}%, ${r}%, ${n||1})`,Sv="ontouchstart"in window,$v={longPressIndicator:v({position:"fixed",width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"var(--primary-color, rgba(7, 114, 244))",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:9,animation:"pulse 1s infinite",transform:"translate(-50%, -50%)","@keyframes pulse":{"0%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6},"50%":{transform:"translate(-50%, -50%) scale(1)",opacity:.8},"100%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6}}})};function Cv({onTap:e,onLongPress:t,onDoubleTap:r}){const n=ge(null),i=ge(0),s=ge(null),o=ge(null),[a,l]=F(!1),[c,u]=F(!1),[d,f]=F({x:0,y:0}),p=ge(null),m=O(()=>{s.current&&clearTimeout(s.current),o.current&&clearTimeout(o.current),u(!1),n.current=null,i.current=0,p.current=null},[u]),g=O(()=>c?h("div",{css:$v.longPressIndicator,style:{left:`${d.x}px`,top:`${d.y}px`}}):null,[c,d]),y=O(()=>{const C=Date.now();return!!(n.current&&C-n.current>=500)},[]),_=O((C,R)=>{f({x:C,y:R})},[]),b=O((C,R)=>{n.current=Date.now(),_(C,R),o.current=setTimeout(()=>{u(!0)},500)},[_]),w=O((C,R)=>{c&&_(C,R)},[c,_]),k=O(()=>{s.current&&clearTimeout(s.current),o.current&&(clearTimeout(o.current),u(!1)),i.current+=1,s.current=setTimeout(async()=>{l(!0);try{i.current>1?await r?.():y()?await t?.():await e?.()}catch(C){console.error("Error in button callback:",C)}l(!1),n.current=null,i.current=0},250)},[y,r,t,e]),x=O(C=>{b(C.clientX,C.clientY),p.current={x:C.screenX,y:C.screenY}},[b]),E=O(C=>{w(C.clientX,C.clientY)},[w]),$=O(()=>{k()},[k]),S=O(C=>{if(C.touches.length>0){const R=C.touches[0];b(R.clientX,R.clientY),p.current={x:R.screenX,y:R.screenY}}},[b]),I=O(C=>{if(C.touches.length>0){const R=C.touches[0];w(R.clientX,R.clientY)}},[w]),P=O(C=>{if(C.changedTouches.length>0){const R=C.changedTouches[0];if(p.current?.y&&Math.abs(R.screenY-p.current.y)>20){m();return}}k()},[k]);return V(()=>({...Sv?{onTouchStart:S,onTouchMove:I,onTouchEnd:P,onTouchCancel:m,loading:a}:{onMouseDown:x,onMouseMove:E,onMouseUp:$,onMouseOut:m,loading:a},renderLongPressIndicator:g}),[x,E,k,m,S,I,g])}const Na=({ma_entity_id:e,lms_entity_id:t})=>{const r=ye();return V(()=>{const i=t&&Hi(r,t)&&_d(),s=e&&_r(r)&&bd();return!!i||!!s},[r,t,e])},Av=(e,t)=>{const r=ye(),{data:n,loading:i,error:s,refetch:o}=is({type:"call_service",domain:"mass_queue",service:"get_queue_items",service_data:{entity:e},return_response:!0},{enabled:t,staleTime:3e4}),a=O(async f=>{await K().callService("mass_queue","play_queue_item",{entity:e,queue_item_id:f})},[e]),l=O(async f=>{await K().callService("mass_queue","remove_queue_item",{entity:e,queue_item_id:f}),o()},[e,o]),c=O(async f=>{await K().callService("mass_queue","move_queue_item_up",{entity:e,queue_item_id:f}),await new Promise(p=>setTimeout(p,100)),o()},[e,o]),u=O(async f=>{await K().callService("mass_queue","move_queue_item_down",{entity:e,queue_item_id:f}),await new Promise(p=>setTimeout(p,100)),o()},[e,o]),d=V(()=>{const f=n?.[e]?.map((m,g,y)=>({id:m.queue_item_id,title:m.media_title,artist:m.media_artist,album:m.media_album_name,artworkUrl:m.media_image,isFirst:g===0,isLast:g===y.length-1,playlistIndex:g,isPlaying:r.title===m.media_title,skipToItem:()=>a(m.queue_item_id),deleteItem:()=>l(m.queue_item_id),moveItemUp:()=>c(m.queue_item_id),moveItemDown:()=>u(m.queue_item_id)}))||[],p=f.findIndex(m=>m.isPlaying);return f.slice(p>=0?p:0)},[n,a,l,c,u,r.title]);return ee(()=>{n&&o()},[r.title]),V(()=>({queue:d,loading:i,error:s,refetch:o}),[d,i,s,o])},Ev=(e,t)=>{const r=ye(),{data:n}=is({type:"call_service",domain:"lyrion_cli",service:"query",service_data:{command:"serverstatus",entity_id:e,parameters:["-"]},return_response:!0},{enabled:t,staleTime:6e5}),{data:i,loading:s,error:o,refetch:a}=is({type:"call_service",domain:"lyrion_cli",service:"query",service_data:{command:"status",entity_id:e,parameters:["-"]},return_response:!0},{enabled:t&&!!n,staleTime:3e4}),l=O(async(g,y)=>{await K().callService("lyrion_cli","method",{command:"playlist",entity_id:e,parameters:["move",g,y]}),a()},[e,a]),c=O(async g=>{await K().callService("lyrion_cli","method",{command:"playlist",entity_id:e,parameters:["index",g]})},[e]),u=O(async g=>{await K().callService("lyrion_cli","method",{command:"playlist",entity_id:e,parameters:["delete",g]}),a()},[e,a]),[d,f]=F([]),p=ge(),m=O(async()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{if(i?.playlist_loop){const g=[],y=i.playlist_cur_index?Number(i.playlist_cur_index):-1;let _=i.playlist_loop.map((b,w)=>({id:b.id,title:b.title,artist:"-",playlistIndex:b["playlist index"],isPlaying:b["playlist index"]===y,isFirst:w===0,isLast:w===i.playlist_loop.length-1,moveItem:k=>l(b["playlist index"],k),skipToItem:()=>c(b["playlist index"]),deleteItem:()=>u(b["playlist index"])}));_=_.slice(_.findIndex(b=>!b.isPlaying)).filter(b=>!b.isPlaying),d.length===0&&f(_);for(const b of _){let w=b;const k=await da({type:"call_service",domain:"lyrion_cli",service:"query",service_data:{command:"songinfo",entity_id:e,parameters:[0,100,`track_id:${b.id}`]},return_response:!0},{staleTime:864e5});if(k.response&&k.response.songinfo_loop&&k.response.songinfo_loop.length>0){const x=Object.assign({},...k.response.songinfo_loop);w={...w,album:x.album,artist:x.artist};const E=`http://${n?.ip}:${n?.httpport}`;x.artwork_url&&i.player_ip?w={...w,artworkUrl:`${E}${x.artwork_url}`}:x.artwork_track_id&&(w={...w,artworkUrl:`${E}/music/${x.artwork_track_id}/cover_50x50_o`})}g.push(w)}f(g)}},250)},[i,e,l,c,u,f]);return ee(()=>{m()},[i]),ee(()=>{i&&a()},[r.title]),V(()=>({queue:d,loading:s,error:o,refetch:a}),[d,s,o,a])};function os(){const{attributes:e,state:t}=ye(),r=ib(t,e);return V(()=>r,[r.supportPreviousTrack,r.supportNextTrack,r.supportsShuffle,r.supportsRepeat,r.supportsTogglePlayPause,r.supportsStop])}const sf={root:v({display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:"2px",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:v({"&:first-child":{marginLeft:"16px"},"&:last-child":{marginRight:"16px"}})},Iv=()=>{const{config:e}=te(de),{custom_buttons:t}=e;return h("div",{css:sf.root,children:t?.map((r,n)=>h(Pv,{button:r},n))})},Pv=({button:e})=>{const{rootElement:t,config:r}=te(de),{icon:n,name:i,...s}=e,o=jt({rootElement:t,actionConfig:{...s,entity:r.entity_id}});return A(Ze,{css:sf.chip,icon:n,...o,children:[!!i&&h("span",{children:i}),o.renderLongPressIndicator()]})},Ra=()=>{const{entity_id:e,attributes:{shuffle:t,repeat:r}}=ye(),n=O(()=>{K().callService("media_player","media_stop",{entity_id:e})},[e]),i=O(()=>{K().callService("media_player","media_play_pause",{entity_id:e})},[e]),s=O(()=>{K().callService("media_player","media_next_track",{entity_id:e})},[e]),o=O(()=>{K().callService("media_player","media_previous_track",{entity_id:e})},[e]),a=O(()=>{K().callService("media_player","shuffle_set",{entity_id:e,shuffle:!t})},[e,t]),l=O(()=>{const u=r==="off"?"one":r==="one"?"all":"off";K().callService("media_player","repeat_set",{entity_id:e,repeat:u})},[e,r]),c=O(()=>{K().callService("media_player","toggle",{entity_id:e})},[e]);return V(()=>({stop:n,togglePlayback:i,nextTrack:s,previousTrack:o,toggleShuffle:a,toggleRepeat:l,togglePower:c}),[n,i,s,o,a,l,c])},Ov={root:v({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around",width:"100%",maxWidth:"480px",paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)"})},Tv=()=>{const{attributes:{shuffle:e,repeat:t},state:r}=ye(),n=r==="playing",{supportPreviousTrack:i,supportNextTrack:s,supportsShuffle:o,supportsRepeat:a,supportsTogglePlayPause:l,supportsStop:c}=os(),{togglePlayback:u,toggleRepeat:d,toggleShuffle:f,previousTrack:p,nextTrack:m,stop:g}=Ra();return A("div",{css:Ov.root,children:[o&&h(B,{size:"small",onClick:f,icon:e?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),i&&h(B,{size:"large",onClick:p,icon:"mdi:skip-previous"}),l?h(B,{size:"x-large",onClick:u,icon:n?"mdi:pause-circle":"mdi:play-circle"}):c?h(B,{size:"x-large",onClick:g,icon:"mdi:stop"}):null,s&&h(B,{size:"large",onClick:m,icon:"mdi:skip-next"}),a&&h(B,{size:"small",onClick:d,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},of={root:v({display:"flex",alignItems:"center",flex:1,maxHeight:"36px",marginTop:"auto",gap:"8px"}),buttonMuted:v({opacity:.8})},Nv=()=>{const{config:e}=te(de),{speaker_group:t}=e,r=ye(),n=r.entity_id,i=r.attributes?.volume_level??0,s=r.attributes?.is_volume_muted??!1,o=O(()=>{K().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!s})},[s]),a=V(()=>Yr(i,s),[i,s]);return A("div",{css:of.root,children:[h(B,{css:s?of.buttonMuted:{},size:"small",onClick:o,icon:a}),h(Qs,{entityId:t?.entity_id??n,syncGroupChildren:!0,sliderSize:"medium",showStepButtons:e.options?.show_volume_step_buttons??!1,useVolumeUpDownForSteps:e.options?.use_volume_up_down_for_step_buttons??!1})]})},Rv=({onClick:e})=>{const t=ye(),r=t.attributes?.volume_level??0,n=t.attributes?.is_volume_muted??!1,i=Yr(r,n);return h(B,{size:"small",onClick:e,icon:i})},as={root:v({display:"flex",flexDirection:"column",gap:"18px"}),speakerList:v({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),syncContainer:v({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",opacity:.8,position:"absolute",right:"56px",top:"12px"}),syncText:v({fontSize:"12px"})},Fv=()=>{const{t:e}=Fe(),t=$e(),{config:r}=te(de),{entity_id:n,speaker_group:i}=r,[s,o]=F(!0),a=i?.entity_id||n,l=t.states[a];return A("div",{css:as.root,children:[l?.attributes?.group_members?.length>1&&A("div",{children:[A("div",{css:as.syncContainer,children:[h("span",{css:as.syncText,onClick:()=>o(!s),children:e({id:"MediocreMassiveMediaPlayerCard.SpeakerGrouping.link_volume"})}),h(B,{icon:s?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>o(!s)})]}),h("div",{css:as.speakerList,children:h(ka,{config:r,syncMainSpeaker:s})})]}),h(es,{config:{entity_id:n,speaker_group:i},showGrouped:!1,layout:{horizontalMargin:16}})]})},Lv=()=>{const{config:e}=te(de),{ma_entity_id:t,search:r,entity_id:n}=e,{selectedSearchProvider:i,searchProvidersMenu:s}=Sa(r,n,t);return i?i.entity_id===t?h(Aa,{maEntityId:t,horizontalPadding:16,additionalOptions:s,searchBarPosition:"bottom"}):h($a,{entityId:i.entity_id,showFavorites:!0,horizontalPadding:16,filterConfig:i.media_types,additionalOptions:s,searchBarPosition:"bottom"}):null},Dv=br`
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`,ls={root:v({backgroundColor:"var(--mmpc-surface-higher)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderRadius:"12px",padding:"12px",width:"100%",position:"relative",boxSizing:"border-box","--mmpc-surface-shadow":"hsl(from var(--mmpc-surface-higher) h calc(s / 2) calc(l - 10))",boxShadow:"0px 0px 20px var(--mmpc-surface-shadow)"}),modalRoot:v({position:"absolute",bottom:"calc(100% + 12px)",left:0,width:"100%",backgroundColor:"var(--mmpc-surface-higher)",borderRadius:"12px",boxSizing:"border-box",animation:`${Dv} 0.3s ease forwards`,boxShadow:"0px 0px 20px var(--mmpc-surface-shadow)"}),modalHeader:v({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",color:"var(--primary-text-color, #fff)",borderBottom:`0.5px solid ${j.colors.onCardDivider}`,"> h4":{margin:0}}),modalContent:v({display:"flex",flexDirection:"column",gap:"12px",maxHeight:"400px",padding:"var(--mmpc-modal-padding, 16px)"})},Vv=()=>{const{t:e}=Fe(),{config:t}=te(de),{entity_id:r,custom_buttons:n,speaker_group:i,ma_entity_id:s,search:o,media_browser:a,ma_favorite_button_entity_id:l,lms_entity_id:c,options:{always_show_power_button:u}={}}=t,d=ye(),{state:f}=d,p=f!=="off"&&f!=="unavailable",m=ca(o,s),g=Wi(a),y=Na({ma_entity_id:s,lms_entity_id:c}),[_,b]=F(),w=O(x=>{b(_===x?void 0:x)},[_]),k=O(()=>{K().callService("media_player","toggle",{entity_id:r})},[r]);return A("div",{css:ls.root,children:[h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.volume_modal_title",defaultMessage:"Volume"}),isOpen:_==="volume",onClose:()=>b(void 0),children:h(Nv,{})}),h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.speaker_grouping_modal_title",defaultMessage:"Speaker Grouping"}),isOpen:_==="speaker-grouping",onClose:()=>b(void 0),padding:"16px 0px 16px 0px",children:h(Fv,{})}),h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.media_browser_modal_title",defaultMessage:"Media Browser"}),isOpen:_==="media-browser",onClose:()=>b(void 0),padding:"0px",children:h(Ea,{mediaBrowserEntryArray:fa(a,r),horizontalPadding:16})}),h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.queue_view_modal_title",defaultMessage:"Up Next"}),isOpen:_==="queue",onClose:()=>b(void 0),padding:"6px 16px",children:h(Jl,{lms_entity_id:c,ma_entity_id:s})}),h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.search_modal_title",defaultMessage:"Search"}),isOpen:_==="search",onClose:()=>b(void 0),padding:"16px 0px 16px 0px",children:h(Lv,{})}),!!i&&h(B,{size:"small",icon:"mdi:speaker-multiple",onClick:()=>w("speaker-grouping")}),n&&n.length===1?h(zv,{button:n[0]}):n&&n.length>1?A(Q,{children:[h(B,{size:"small",icon:"mdi:dots-horizontal",onClick:()=>w("custom-buttons")}),h(an,{title:e({id:"MediocreMassiveMediaPlayerCard.PlayerActions.shortcuts_modal_title",defaultMessage:"Shortcuts"}),isOpen:_==="custom-buttons",onClose:()=>b(void 0),padding:"16px 0px 16px 0px",children:h(Iv,{})})]}):null,h(Pd,{ma_entity_id:s??void 0,ma_favorite_button_entity_id:l??void 0,lms_entity_id:t.lms_entity_id??void 0,noSourceSelection:!0,side:"top",align:"center",renderTrigger:x=>h(B,{icon:"mdi:dots-vertical",size:"small",...x})}),m&&h(B,{size:"small",icon:"mdi:magnify",onClick:()=>w("search")}),g&&h(B,{size:"small",icon:"mdi:folder-music",onClick:()=>w("media-browser")}),y&&h(B,{size:"small",icon:"mdi:playlist-music",onClick:()=>w("queue")}),(!p||u)&&h(B,{size:"x-small",onClick:k,icon:"mdi:power"}),h(Rv,{onClick:()=>w("volume")})]})},an=({children:e,title:t,isOpen:r,padding:n,onClose:i})=>r?A("div",{css:ls.modalRoot,children:[A("div",{css:ls.modalHeader,children:[h("h4",{children:t}),h(B,{type:"button",size:"small",icon:"mdi:close",onClick:i})]}),h("div",{css:ls.modalContent,style:{"--mmpc-modal-padding":n??"16px"},children:e})]}):null,zv=({button:e})=>{const{rootElement:t,config:r}=te(de),{icon:n,name:i,...s}=e,o=jt({rootElement:t,actionConfig:{...s,entity:r.entity_id}});return h(B,{icon:e.icon??"mdi:dots-vertical",size:"small",...o})},Fa={root:v({display:"flex",flexDirection:"column",alignItems:"center",width:"100%",gap:"8px",textAlign:"center",color:j.colors.onDialog,paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)","> h2, > h3":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"}}),titleH2:v({margin:0}),titleH3:v({margin:0,fontWeight:"normal",color:j.colors.onDialogMuted})},Bv=()=>{const{title:e,subtitle:t}=ye();return A("div",{css:Fa.root,children:[!!e&&h("h2",{css:Fa.titleH2,children:e}),!!t&&h("h3",{css:Fa.titleH3,children:t})]})},cs={root:v({paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)",width:"100%"}),timeWrap:v({display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:"4px",color:j.colors.onDialogMuted,height:"20px",marginBottom:"-4px"}),timeWrapNoSource:v({marginBottom:"-20px"}),sourceSelect:v({background:"none",border:"none",color:j.colors.onDialogMuted,fontSize:"13px",fontWeight:500,cursor:"pointer",padding:0,display:"flex",gap:"4px",alignItems:"center",marginLeft:"auto",marginRight:"auto",opacity:.8,"&:hover":{opacity:1}})},qv=()=>{const e=ye(),[t,r]=F(0),n=e.state==="playing";ee(()=>{if(!n)return;const o=setInterval(()=>{r(a=>a+1)},1e3);return()=>clearInterval(o)},[n]);const i=V(()=>{const o=e.attributes?.media_position??null,a=e.attributes?.media_position_updated_at??null,l=e.attributes?.media_duration??null;if(o===null||o<0||l===null||a===null)return null;const c=new Date,u=new Date(a),f=(c.getTime()-u.getTime())/1e3+o,p=m=>{const g=Math.floor(m/60).toString().padStart(2,"0"),y=Math.round(m-Number(g)*60).toString().padStart(2,"0");return`${g}:${y}`};return{currentPosition:f,mediaDuration:l,prettyNow:p(f),prettyEnd:p(l)}},[e,t]),s=V(()=>(e.attributes.source_list??[]).map(o=>({label:o,onClick:()=>{K().callService("media_player","select_source",{entity_id:e.entity_id,source:o})}})),[e.attributes.source_list,e.attributes.source]);return A("div",{css:cs.root,children:[i&&h(JS,{value:i.currentPosition,min:0,max:i.mediaDuration}),A("div",{css:[cs.timeWrap,!e.attributes.source&&cs.timeWrapNoSource],children:[i&&h("span",{children:i.prettyNow}),s.length>0&&e.attributes.source&&h(nt,{align:"center",menuItems:s,renderTrigger:o=>A("button",{...o,css:cs.sourceSelect,children:[h(be,{size:"xx-small",icon:Ji({source:e.attributes.source??"",fallbackIcon:"mdi:import"})}),e.attributes.source,h(be,{size:"xx-small",icon:"mdi:chevron-down"})]})}),i&&h("span",{children:i.prettyEnd})]})]})},pt={root:v({display:"flex",justifyContent:"center",alignItems:"center","--mmpc-extra-horizontal-padding":"0px",boxSizing:"border-box","*":{boxSizing:"border-box"},"--mmpc-surface-higher":`hsl(from ${j.colors.card} h s calc(l ${Bt()?"+":"-"} 5))`}),rootPanelMode:v({width:"100%",height:"100%",background:"linear-gradient(var(--app-header-background-color), rgba(255, 255, 255, 0))",maxHeight:"calc(100vh - var(--header-height, 16px))"}),rootPopupMode:v({"--mmpc-extra-horizontal-padding":"12px","--mmpc-surface-higher":`hsl(from ${j.colors.dialog} h s calc(l ${Bt()?"+":"-"}  5))`}),rootMultiMode:v({width:"100%",height:"100%"}),card:v({overflow:"hidden"}),artBackground:v({background:`
      radial-gradient( circle at bottom right, var(--art-alternative-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top center, var(--art-alternative-color, transparent) -500%, transparent 80%),
      radial-gradient( circle at bottom center, var(--art-alternative-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top left, var(--art-alternative-color, transparent) -500%, transparent 40% )`}),wrap:v({display:"flex",flex:1,flexDirection:"column",gap:"16px",justifyContent:"space-evenly",alignItems:"center",paddingTop:"16px",paddingBottom:"16px",height:"100%"}),wrapPanelMode:v({width:"100%",maxWidth:"480px",padding:"16px"}),wrapMultiMode:v({width:"100%",padding:0}),wrapPopupMode:v({maxWidth:"100%",padding:"16px",paddingBottom:"max(calc(env(safe-area-inset-bottom) + 8px), 16px)"}),wrapCardMode:v({width:"100%",padding:"16px"})},La=({className:e,onClick:t})=>{const{config:r,rootElement:n}=te(de),{mode:i,use_art_colors:s,action:o}=r,{artVars:a,haVars:l}=Ta(),u=jt({rootElement:n,actionConfig:{...o??{tap_action:{action:"more-info"}},entity:r.entity_id},overrideCallback:t?{onTap:t}:void 0}),d=()=>h("div",{className:e,css:[pt.root,i==="panel"&&pt.rootPanelMode,i==="popup"&&pt.rootPopupMode,i==="multi"&&pt.rootMultiMode,s&&i!=="popup"&&i!=="multi"&&pt.artBackground],style:i!=="card"?{...a??{},...l&&s?l:{}}:{},children:A("div",{css:[pt.wrap,i==="panel"&&pt.wrapPanelMode,i==="card"&&pt.wrapCardMode,i==="popup"&&pt.wrapPopupMode,i==="multi"&&pt.wrapMultiMode],children:[h(Od,{iconSize:"x-large",borderRadius:8,...u}),h(Bv,{}),h(qv,{}),h(Tv,{}),i!=="multi"&&h(Vv,{})]})});return i==="card"?h("ha-card",{css:pt.card,style:{...a??{},...l&&s?l:{}},children:d()}):d()},ei=e=>Array.isArray(e)?e:[e],jv=(e,t)=>{const r=[[],[]];for(const n of e)t(n)?r[0].push(n):r[1].push(n);return r},af=Array,Kt=(e,t)=>e.includes(t),Uv=(e,t=0)=>[...new Array(e)].map((r,n)=>n+t),fe=(e,t,r)=>e===void 0?t===void 0?[]:Array.isArray(t)?t:[t]:(Array.isArray(t)?e.push(...t):e.push(t),e),kr=(e,t)=>t==null?e??[]:e==null?ei(t):e.concat(t),Kv=(...e)=>e.reduce(kr,[]),Mr=(e,t,r)=>{if(e===void 0)return Array.isArray(t)?t:[t];const n=r?.isEqual??((i,s)=>i===s);for(const i of ei(t))e.some(s=>n(s,i))||e.push(i);return e},Gv=(e,t)=>e.reduce((r,n)=>{const i=n[t];return r[i]=fe(r[i],n),r},{}),ln=(e,t,r)=>e.length===t.length&&e.every(r?.isEqual?(n,i)=>r.isEqual(n,t[i]):(n,i)=>n===t[i]),Sr=(e,t)=>mt(e)===t,mt=e=>{const t=typeof e;return t==="object"?e===null?"null":"object":t==="function"?"object":t},Gt={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},Wv={...Gt,function:"a function"};class Hv extends Error{}const Ce=e=>cn(e,Hv),cn=(e,t=Error)=>{throw new t(e)};class Jv extends Error{name="ParseError"}const N=e=>cn(e,Jv),lf=e=>` ${e}`,Yv="",he=(e,t)=>{const r={},n=Array.isArray(e);let i=!1;for(const[s,o]of Object.entries(e).entries()){const a=n?t(s,o[1]):t(...o,s);i||=typeof a[0]=="number";const l=Array.isArray(a[0])||a.length===0?a:[a];for(const[c,u]of l)typeof c=="object"?r[c.group]=fe(r[c.group],u):r[c]=u}return i?Object.values(r):r},cf=Object.entries,Ct=(e,t)=>e in t,Da=(e,t)=>t in e;class Qv{constructor(t){Object.assign(this,t)}}const Zv=class{};class uf extends Zv{}const Xv=(e,t)=>{const r={},n={};let i;for(i in e)i in t?r[i]=e[i]:n[i]=e[i];return[r,n]},df=(e,t)=>Xv(e,t)[1],ti=e=>Object.keys(e).length===0,us=e=>[...Object.entries(e),...Object.getOwnPropertySymbols(e).map(t=>[t,e[t]])],e0=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),t0=e=>{const t=Object.keys(e).sort(),r={};for(let n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r},At=lf(`unset${Yv}`),r0=e=>Object.values(e).filter(t=>typeof t=="number"?!0:typeof e[t]!="number"),ff={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},hf=globalThis.File??Blob,pf={ArrayBuffer,Blob,File:hf,FormData,Headers,Request,Response,URL},un={...ff,...pf,...{Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},String,Number,Boolean},Va=e=>{let t=Object.getPrototypeOf(e);for(;t?.constructor&&(!Ct(t.constructor.name,un)||!(e instanceof un[t.constructor.name]));)t=Object.getPrototypeOf(t);const r=t?.constructor?.name;if(!(r===void 0||r==="Object"))return r},za=e=>typeof e=="object"&&e!==null?Va(e)??"object":mt(e),je=Array.isArray,n0={...{Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},...{ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},...{Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"}},Ba=e=>{const t=Object(e).name??null;return t&&Ct(t,un)&&un[t]===e?t:null},mf=(e,t)=>{let r=e.prototype;for(;r!==null;){if(r===t.prototype)return!0;r=Object.getPrototypeOf(r)}return!1},i0=e=>gf(e,new Map),gf=(e,t)=>{if(typeof e!="object"||e===null)return e;if(t?.has(e))return t.get(e);const r=Ba(e.constructor);if(r==="Date")return new Date(e.getTime());if(r&&r!=="Array")return e;const n=Array.isArray(e)?e.slice():Object.create(Object.getPrototypeOf(e)),i=Object.getOwnPropertyDescriptors(e);if(t){t.set(e,n);for(const s in i){const o=i[s];"get"in o||"set"in o||(o.value=gf(o.value,t))}}return Object.defineProperties(n,i),n},s0=e=>{let t=At;return()=>t===At?t=e():t},ds=e=>typeof e=="function"&&e.length===0,o0=class extends Function{constructor(...e){const t=e.slice(0,-1),r=e[e.length-1];try{super(...t,r)}catch(n){return Ce(`Encountered an unexpected error while compiling your definition:
                Message: ${n} 
                Source: (${e.slice(0,-1)}) => {
                    ${e[e.length-1]}
                }`)}}};class nr{constructor(t,...[r]){return Object.assign(Object.setPrototypeOf(t.bind(r?.bind??this),this.constructor.prototype),r?.attach)}}const a0=s0(()=>{try{return new Function("return false")()}catch{return!0}});class Et{constructor(){}}const l0=()=>{try{return((new Error().stack?.split(`
`)[2]?.trim()||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/)?.[1]||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},c0=globalThis.process?.env??{},u0={fileName:l0,env:c0},d0=e=>e[0].toUpperCase()+e.slice(1),f0=e=>e[0].toLowerCase()+e.slice(1),yf=e=>new RegExp(h0(e),typeof e=="string"?"":e.flags),h0=e=>`^(?:${typeof e=="string"?e:e.source})$`,ir={negativeLookahead:e=>`(?!${e})`,nonCapturingGroup:e=>`(?:${e})`},ri="\\",fs={" ":1,"\n":1,"	":1},p0=/^-0\.?0*$/.source,_f=/[1-9]\d*/.source,m0=/\.\d+/.source,g0=/\.\d*[1-9]/.source,bf=e=>yf(ir.negativeLookahead(p0)+ir.nonCapturingGroup("-?"+ir.nonCapturingGroup(ir.nonCapturingGroup("0|"+_f)+ir.nonCapturingGroup(e.decimalPattern)+"?")+(e.allowDecimalOnly?"|"+e.decimalPattern:"")+"?")),vf=bf({decimalPattern:g0,allowDecimalOnly:!1}),y0=vf.test.bind(vf),qa=bf({decimalPattern:m0,allowDecimalOnly:!0});qa.test.bind(qa);const _0=/^-?\d*\.?\d*$/,b0=e=>e.length!==0&&_0.test(e),hs=yf(ir.negativeLookahead("^-0$")+"-?"+ir.nonCapturingGroup(ir.nonCapturingGroup("0|"+_f))),v0=hs.test.bind(hs),ja=/^-?\d+$/,w0=ja.test.bind(ja),wf={number:"a number",bigint:"a bigint",integer:"an integer"},xf=(e,t)=>`'${e}' was parsed as ${wf[t]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,x0=(e,t)=>t==="number"?y0(e):v0(e),k0=(e,t)=>t==="number"?Number(e):Number.parseInt(e),M0=(e,t)=>t==="number"?b0(e):w0(e),S0=(e,t)=>Ua(e,"number",t),$0=(e,t)=>Ua(e,"number",{...t,strict:!0}),C0=(e,t)=>Ua(e,"integer",t),Ua=(e,t,r)=>{const n=k0(e,t);return!Number.isNaN(n)&&M0(e,t)?r?.strict?x0(e,t)?n:N(xf(e,t)):n:r?.errorOnFail?N(r?.errorOnFail===!0?`Failed to parse ${wf[t]} from '${e}'`:r?.errorOnFail):void 0},A0=e=>{if(e[e.length-1]!=="n")return;const t=e.slice(0,-1);let r;try{r=BigInt(t)}catch{return}if(hs.test(t))return r;if(ja.test(t))return N(xf(e,"bigint"))},ni={version:"0.56.0",filename:u0.fileName(),FileConstructor:hf},kf=new Map,Ka=Object.create(null),Ga=e=>{const t=kf.get(e);if(t)return t;let r=E0(e);return Ka[r]?r=`${r}${Ka[r]++}`:Ka[r]=1,ni[r]=e,kf.set(e,r),r},ii=e=>/^[$A-Z_a-z][\w$]*$/.test(e),E0=e=>{switch(typeof e){case"object":{if(e===null)break;const t=Va(e)??"object";return t[0].toLowerCase()+t.slice(1)}case"function":return ii(e.name)?e.name:"fn";case"symbol":return e.description&&ii(e.description)?e.description:"symbol"}return Ce(`Unexpected attempt to register serializable value of type ${mt(e)}`)},Wa=e=>typeof e=="string"?JSON.stringify(e):typeof e=="bigint"?`${e}n`:`${e}`,I0=(e,t={})=>si(e,{onUndefined:"$ark.undefined",onBigInt:r=>`$ark.bigint-${r}`,...t},[]),ce=(e,t)=>{switch(mt(e)){case"object":const r=e,n=r.constructor?.name??"Object";return n==="Object"||n==="Array"?t?.quoteKeys===!1?ps(r,t?.indent??0,""):JSON.stringify(si(r,dn,[]),null,t?.indent):ps(r,t?.indent??0,"");case"symbol":return dn.onSymbol(e);default:return Wa(e)}},ps=(e,t,r)=>{if(typeof e=="function")return dn.onFunction(e);if(typeof e!="object"||e===null)return Wa(e);const n=r+" ".repeat(t);if(Array.isArray(e)){if(e.length===0)return"[]";const s=e.map(o=>ps(o,t,n)).join(`,
`+n);return t?`[
${n}${s}
${r}]`:`[${s}]`}const i=e.constructor?.name??"Object";if(i==="Object"){const s=us(e).map(([o,a])=>{const l=typeof o=="symbol"?dn.onSymbol(o):ii(o)?o:JSON.stringify(o),c=ps(a,t,n);return`${n}${l}: ${c}`});return s.length===0?"{}":t?`{
${s.join(`,
`)}
${r}}`:`{${s.join(", ")}}`}return e instanceof Date?oi(e):"expression"in e&&typeof e.expression=="string"?e.expression:i},dn={onCycle:()=>"(cycle)",onSymbol:e=>`Symbol(${Ga(e)})`,onFunction:e=>`Function(${Ga(e)})`},si=(e,t,r)=>{switch(mt(e)){case"object":{const n=e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();if(typeof n=="function")return dn.onFunction(n);if(r.includes(n))return"(cycle)";const i=[...r,n];if(Array.isArray(n))return n.map(o=>si(o,t,i));if(n instanceof Date)return n.toDateString();const s={};for(const o in n)s[o]=si(n[o],t,i);for(const o of Object.getOwnPropertySymbols(n))s[t.onSymbol?.(o)??o.toString()]=si(n[o],t,i);return s}case"symbol":return dn.onSymbol(e);case"bigint":return t.onBigInt?.(e)??`${e}n`;case"undefined":return t.onUndefined??"undefined";case"string":return e.replace(/\\/g,"\\\\");default:return e}},oi=e=>{const t=e.getFullYear(),r=e.getMonth(),n=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),a=e.getMilliseconds();if(r===0&&n===1&&i===0&&s===0&&o===0&&a===0)return`${t}`;const l=`${P0[r]} ${n}, ${t}`;if(i===0&&s===0&&o===0&&a===0)return l;let c=e.toLocaleTimeString();const u=c.endsWith(" AM")||c.endsWith(" PM")?c.slice(-3):"";return u&&(c=c.slice(0,-u.length)),a?c+=`.${T0(a,3)}`:O0.test(c)&&(c=c.slice(0,-3)),`${c+u}, ${l}`},P0=["January","February","March","April","May","June","July","August","September","October","November","December"],O0=/:\d\d:00$/,T0=(e,t)=>String(e).padStart(t,"0"),Mf=(e,t,...[r])=>{const n=r?.stringifySymbol??ce;let i=e;switch(typeof t){case"string":i=ii(t)?e===""?t:`${e}.${t}`:`${e}[${JSON.stringify(t)}]`;break;case"number":i=`${e}[${t}]`;break;case"symbol":i=`${e}[${n(t)}]`;break;default:r?.stringifyNonKey?i=`${e}[${r.stringifyNonKey(t)}]`:N(`${ce(t)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},ai=(e,...t)=>e.reduce((r,n)=>Mf(r,n,...t),"");class Sf extends af{cache={};constructor(...t){super(),this.push(...t)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let t=0;t<this.length;t++)this.cache.json.push(typeof this[t]=="symbol"?ce(this[t]):this[t]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=ai(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let t="";const r=[t];for(const n of this)t=Mf(t,n),r.push(t);return this.cache.stringifyAncestors=r}}class $f{chars;i;def;constructor(t){this.def=t,this.chars=[...t],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(t){let r="";for(;this.lookahead&&!t(this,r);)r+=this.shift();return r}shiftUntilEscapable(t){let r="";for(;this.lookahead;)if(this.lookahead===ri)this.shift(),t(this,r)?r+=this.shift():this.lookahead===ri?r+=this.shift():r+=`${ri}${this.shift()}`;else{if(t(this,r))break;r+=this.shift()}return r}shiftUntilLookahead(t){return typeof t=="string"?this.shiftUntil(r=>r.lookahead===t):this.shiftUntil(r=>r.lookahead in t)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in fs))}jumpToIndex(t){this.i=t<0?this.length+t:t}jumpForward(t){this.i+=t}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(t,r){return this.chars.slice(t,r).join("")}lookaheadIs(t){return this.lookahead===t}lookaheadIsIn(t){return this.lookahead in t}}const N0=(e,t)=>`Unmatched ${e}${t===""?"":` before ${t}`}`,Cf=e=>`Missing ${e}`;let Ha="$ark",R0=2;for(;Ha in globalThis;)Ha=`$ark${R0++}`;const Af=Ha;globalThis[Af]=ni;const D=ni,F0=e=>`${Af}.${e}`,Ge=e=>F0(Ga(e));class Ef extends uf{argNames;body="";constructor(...t){super(),this.argNames=t;for(const r of t){if(r in this)throw new Error(`Arg name '${r}' would overwrite an existing property on FunctionBody`);this[r]=r}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(t,r=!1){return If(t,r)}index(t,r=!1){return Pf(`${t}`,r)}line(t){return this.body+=`${" ".repeat(this.indentation)}${t}
`,this}const(t,r){return this.line(`const ${t} = ${r}`),this}let(t,r){return this.line(`let ${t} = ${r}`)}set(t,r){return this.line(`${t} = ${r}`)}if(t,r){return this.block(`if (${t})`,r)}elseIf(t,r){return this.block(`else if (${t})`,r)}else(t){return this.block("else",t)}for(t,r,n=0){return this.block(`for (let i = ${n}; ${t}; i++)`,r)}forIn(t,r){return this.block(`for (const k in ${t})`,r)}block(t,r,n=""){return this.line(`${t} {`),this.indent(),r(this),this.dedent(),this.line(`}${n}`)}return(t=""){return this.line(`return ${t}`)}write(t="anonymous",r=0){return`${t}(${this.argNames.join(", ")}) { ${r?this.body.split(`
`).map(n=>" ".repeat(r)+`${n}`).join(`
`):this.body} }`}compile(){return new o0(...this.argNames,this.body)}}const fn=e=>Sr(e,"object")||typeof e=="symbol"?Ge(e):Wa(e),If=(e,t=!1)=>typeof e=="string"&&ii(e)?`${t?"?":""}.${e}`:Pf(L0(e),t),L0=e=>typeof e=="symbol"?Ge(e):JSON.stringify(e),Pf=(e,t=!1)=>`${t?"?.":""}[${e}]`;class Ja extends Ef{traversalKind;optimistic;constructor(t){super("data","ctx"),this.traversalKind=t.kind,this.optimistic=t.optimistic===!0}invoke(t,r){const n=r?.arg??this.data,i=typeof t=="string"?!0:this.requiresContextFor(t),s=typeof t=="string"?t:t.id;return i?`${this.referenceToId(s,r)}(${n}, ${this.ctx})`:`${this.referenceToId(s,r)}(${n})`}referenceToId(t,r){const n=r?.kind??this.traversalKind,i=`this.${t}${n}`;return r?.bind?`${i}.bind(${r?.bind})`:i}requiresContextFor(t){return this.traversalKind==="Apply"||t.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(t,r,n){const i=this.requiresContextFor(n);return i&&this.line(`${this.ctx}.path.push(${t})`),this.check(n,{arg:r}),i&&this.line(`${this.ctx}.path.pop()`),this}check(t,r){return this.traversalKind==="Allows"?this.if(`!${this.invoke(t,r)}`,()=>this.return(!1)):this.line(this.invoke(t,r))}}const Of=e=>he(e,(t,r)=>[t,je(r)?[...r]:r]),Wt=lf("arkKind"),G=(e,t)=>e?.[Wt]===t,We=e=>G(e,"root")||G(e,"constraint"),D0=["unit","proto","domain"],ms=["required","optional","index","sequence"],Tf=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Nf=[...Tf,"structure","predicate"],Ya=[...Nf,...ms],gs=["alias","union","morph","unit","intersection","proto","domain"],V0=[...gs,...Ya],Rf=he(Ya,(e,t)=>[t,1]),z0=he([...ms,"undeclared"],(e,t)=>[t,1]),Ff=he(V0,(e,t)=>[t,e]),ys=e=>typeof e=="string"&&e in Ff,_s=e=>Ff[e],Qa=e=>gs.slice(_s(e)+1);[...Qa("union")],[...Qa("morph")];const $r=e=>typeof e=="string"||typeof e=="boolean"||e===null?e:typeof e=="number"?Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e:fn(e),bs=e=>{let t="{ ";for(const[r,n]of Object.entries(e))t+=`${r}: ${fn(n)}, `;return t+" }"},we=e=>{const t=e;return t.hasAssociatedError&&(t.defaults.expected??=r=>"description"in r?r.description:t.defaults.description(r),t.defaults.actual??=r=>ce(r),t.defaults.problem??=r=>`must be ${r.expected}${r.actual?` (was ${r.actual})`:""}`,t.defaults.message??=r=>{if(r.path.length===0)return r.problem;const n=`${r.propString} ${r.problem}`;return n[0]==="["?`value at ${n}`:n}),t};class B0 extends Error{name="ToJsonSchemaError";code;context;constructor(t,r){super(ce(r,{quoteKeys:!1,indent:4})),this.code=t,this.context=r}hasCode(t){return this.code===t}}const Ie={Error:B0,throw:(...e)=>{throw new Ie.Error(...e)},throwInternalOperandError:(e,t)=>Ce(`Unexpected JSON Schema input for ${e}: ${ce(t)}`),defaultConfig:{target:"draft-2020-12",dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:e=>Ie.throw("arrayObject",e),arrayPostfix:e=>Ie.throw("arrayPostfix",e),defaultValue:e=>Ie.throw("defaultValue",e),domain:e=>Ie.throw("domain",e),morph:e=>Ie.throw("morph",e),patternIntersection:e=>Ie.throw("patternIntersection",e),predicate:e=>Ie.throw("predicate",e),proto:e=>Ie.throw("proto",e),symbolKey:e=>Ie.throw("symbolKey",e),unit:e=>Ie.throw("unit",e),date:e=>Ie.throw("date",e)}}};D.config??={};const Za=(e,t)=>{if(!t)return e;const r={...e};let n;for(n in t){const i={...e.keywords};if(n==="keywords"){for(const s in t[n]){const o=t.keywords[s];o!==void 0&&(i[s]=typeof o=="string"?{description:o}:o)}r.keywords=i}else n==="toJsonSchema"?r[n]=Lf(e.toJsonSchema,t.toJsonSchema):ys(n)?r[n]={...e[n],...t[n]}:r[n]=t[n]}return r},q0={"draft-2020-12":"https://json-schema.org/draft/2020-12/schema","draft-07":"http://json-schema.org/draft-07/schema#"},Lf=((e,t)=>{if(!e)return Df(t??{},void 0);if(!t)return e;const r={...e};let n;for(n in t)n==="fallback"?r.fallback=j0(e.fallback,t.fallback):r[n]=t[n];return Df(r,t)}),Df=(e,t)=>t?.dialect!==void 0?e:t?.target!==void 0?{...e,dialect:q0[t.target]}:e,j0=(e,t)=>{e=Vf(e),t=Vf(t);const r={};let n;for(n in Ie.defaultConfig.fallback)r[n]=t[n]??t.default??e[n]??e.default??Ie.defaultConfig.fallback[n];return r},Vf=e=>typeof e=="function"?{default:e}:e??{};class hn extends uf{[Wt]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:t,relativePath:r,...n},i){super(),this.input=n,this.ctx=i,e0(this,n);const s=i.data;n.code==="union"&&(n.errors=n.errors.flatMap(a=>{const l=a.hasCode("union")?a.errors:[a];return!t&&!r?l:l.map(c=>c.transform(u=>({...u,path:Kv(t,u.path,r)})))})),this.nodeConfig=i.config[this.code];const o=[...n.path??i.path];r&&o.push(...r),t&&o.unshift(...t),this.path=new Sf(...o),this.data="data"in n?n.data:s}transform(t){return new hn(t({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(t){return this.code===t}get propString(){return ai(this.path)}get expected(){if(this.input.expected)return this.input.expected;const t=this.meta?.expected??this.nodeConfig.expected;return typeof t=="function"?t(this.input):t}get actual(){if(this.input.actual)return this.input.actual;const t=this.meta?.actual??this.nodeConfig.actual;return typeof t=="function"?t(this.data):t}get problem(){if(this.input.problem)return this.input.problem;const t=this.meta?.problem??this.nodeConfig.problem;return typeof t=="function"?t(this):t}get message(){if(this.input.message)return this.input.message;const t=this.meta?.message??this.nodeConfig.message;return typeof t=="function"?t(this):t}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class sr extends af{[Wt]="errors";ctx;constructor(t){super(),this.ctx=t}byPath=Object.create(null);get flatByPath(){return he(this.byPath,(t,r)=>[t,r.flat])}get flatProblemsByPath(){return he(this.byPath,(t,r)=>[t,r.flat.map(n=>n.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new U0(this)}add(t){const r=this.byPath[t.propString];if(r){if(t===r||r.hasCode("union")&&r.errors.length===0)return;const n=t.hasCode("union")&&t.errors.length===0?t:new hn({code:"intersection",errors:r.hasCode("intersection")?[...r.errors,t]:[r,t]},this.ctx),i=this.indexOf(r);this.mutable[i===-1?this.length:i]=n,this.byPath[t.propString]=n,this.addAncestorPaths(t)}else this.byPath[t.propString]=t,this.addAncestorPaths(t),this.mutable.push(t);this.count++}transform(t){const r=new sr(this.ctx);for(const n of this)r.add(t(n));return r}merge(t){for(const r of t)this.add(new hn({...r,path:[...this.ctx.path,...r.path]},this.ctx))}affectsPath(t){return this.length===0?!1:t.stringifyAncestors().some(r=>r in this.byPath)||t.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(t=>t.toJSON())]}toString(){return this.join(`
`)}addAncestorPaths(t){for(const r of t.path.stringifyAncestors())this.byAncestorPath[r]=fe(this.byAncestorPath[r],t)}}class U0 extends Error{name="TraversalError";constructor(t){t.length===1?super(t.summary):super(`
`+t.map(r=>`   ${K0(r)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:t,enumerable:!1})}}const K0=e=>e.toString().split(`
`).join(`
  `);class pn{path=[];errors=new sr(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(t,r){this.root=t,this.config=r}get data(){let t=this.root;for(const r of this.path)t=t?.[r];return t}get propString(){return ai(this.path)}reject(t){return this.error(t),!1}mustBe(t){return this.error(t),!1}error(t){const r=typeof t=="object"?t.code?t:{...t,code:"predicate"}:{code:"predicate",expected:t};return this.errorFromContext(r)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches[this.branches.length-1]}queueMorphs(t){const r={path:new Sf(...this.path),morphs:t};this.currentBranch?this.currentBranch.queuedMorphs.push(r):this.queuedMorphs.push(r)}finalize(t){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?t?t(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(t){return this.errorFromContext(t)}errorFromContext(t){const r=new hn(t,this);return this.currentBranch?this.currentBranch.error=r:this.errors.add(r),r}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const t=this.queuedMorphs;this.queuedMorphs=[];for(const{path:r,morphs:n}of t)this.errors.affectsPath(r)||this.applyMorphsAtPath(r,n)}}applyMorphsAtPath(t,r){const n=t[t.length-1];let i;if(n!==void 0){i=this.root;for(let s=0;s<t.length-1;s++)i=i[t[s]]}for(const s of r){this.path=[...t];const o=We(s),a=s(i===void 0?this.root:i[n],this);if(a instanceof hn){this.errors.includes(a)||this.errors.add(a);break}if(a instanceof sr){o||this.errors.merge(a),this.queuedMorphs=[];break}i===void 0?this.root=a:i[n]=a,this.applyQueuedMorphs()}}}const Ht=(e,t,r)=>{if(!r)return t();r.path.push(e);const n=t();return r.path.pop(),n};class zf extends nr{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(t,r){super((i,s,o=this.onFail)=>s?(this.traverseApply(i,s),s.hasError()?s.errors:s.data):this.rootApply(i,o),{attach:t}),this.attachments=t,this.$=r,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0||this.hasKind("sequence")&&this.inner.defaultables!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((i,s)=>J0(i,s.shallowReferences),[this]);const n=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let i=0;i<this.children.length;i++){if(this.includesTransform||=this.children[i].includesTransform,this.includesContextualPredicate||=this.children[i].includesContextualPredicate,this.isCyclic||=this.children[i].isCyclic,!n){const s=this.children[i].flatRefs;for(let o=0;o<s.length;o++){const a=s[o];if(!this.flatRefs.some(l=>qf(l,a))){this.flatRefs.push(a);for(const l of a.node.branches)(l.hasKind("morph")||l.hasKind("intersection")&&l.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:a.path,propString:a.propString,node:l})}}}Object.assign(this.referencesById,this.children[i].referencesById)}this.flatRefs.sort((i,s)=>i.path.length>s.path.length?1:i.path.length<s.path.length?-1:i.propString>s.propString?1:i.propString<s.propString||i.node.expression<s.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(i=>i.length===1||i.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(i=>i.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?i=>this.traverseAllows(i,new pn(i,this.$.resolvedConfig)):i=>this.traverseAllows(i)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(r,n)=>{if(this.allows(r))return r;const i=new pn(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"contextual":return(r,n)=>{const i=new pn(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const t=this.$.resolvedConfig.clone;return(r,n)=>{if(this.allows(r))return this.contextFreeMorph(t&&(typeof r=="object"&&r!==null||typeof r=="function")?t(r):r);const i=new pn(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,Ce(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=H0(this.metaJson);cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=_s(this.kind);precompilation;assert=(t,r)=>this(t,r,n=>n.throw());traverse(t,r){return this(t,r,null)}get in(){return this.cacheGetter("in",this.rawIn.isRoot()?this.$.finalize(this.rawIn):this.rawIn)}get rawIn(){return this.cacheGetter("rawIn",this.getIo("in"))}get out(){return this.cacheGetter("out",this.rawOut.isRoot()?this.$.finalize(this.rawOut):this.rawOut)}get rawOut(){return this.cacheGetter("rawOut",this.getIo("out"))}getIo(t){if(!this.includesTransform)return this;const r={};for(const[n,i]of this.innerEntries){const s=this.impl.keys[n];if(s.reduceIo)s.reduceIo(t,r,i);else if(s.child){const o=i;r[n]=je(o)?o.map(a=>t==="in"?a.rawIn:a.rawOut):t==="in"?o.rawIn:o.rawOut}else r[n]=i}return this.$.node(this.kind,r)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(t){const r=We(t)?t:this.$.parseDefinition(t);return this.innerHash===r.innerHash}ifEquals(t){return this.equals(t)?this:void 0}hasKind(t){return this.kind===t}assertHasKind(t){return this.kind!==t&&cn(`${this.kind} node was not of asserted kind ${t}`),this}hasKindIn(...t){return t.includes(this.kind)}assertHasKindIn(...t){return Kt(t,this.kind)||cn(`${this.kind} node was not one of asserted kinds ${t}`),this}isBasis(){return Kt(D0,this.kind)}isConstraint(){return Kt(Ya,this.kind)}isStructural(){return Kt(ms,this.kind)}isRefinement(){return Kt(Nf,this.kind)}isRoot(){return Kt(gs,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(t){return this.hasKind("unit")&&this.allows(t)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(t){const r=li.normalize(t);return this._select(r)}_select(t){let r=li.applyBoundary[t.boundary??"references"](this);return t.kind&&(r=r.filter(n=>n.kind===t.kind)),t.where&&(r=r.filter(t.where)),li.applyMethod[t.method??"filter"](r,this,t)}transform(t,r){return this._transform(t,this._createTransformContext(r))}_createTransformContext(t){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:t?.prereduced??!1},undeclaredKeyHandling:void 0,...t}}_transform(t,r){const n=r.bindScope??this.$;if(r.seen[this.id])return this.$.lazilyResolve(r.seen[this.id]);if(r.shouldTransform?.(this,r)===!1)return this;let i;r.seen[this.id]=()=>i,this.hasKind("structure")&&this.undeclared!==r.undeclaredKeyHandling&&(r={...r,undeclaredKeyHandling:this.undeclared});const s=he(this.inner,(u,d)=>{if(!this.impl.keys[u].child)return[u,d];const f=d;if(!je(f)){const m=f._transform(t,r);return m?[u,m]:[]}if(f.length===0)return[u,d];const p=f.flatMap(m=>m._transform(t,r)??[]);return p.length?[u,p]:[]});delete r.seen[this.id];const o=Object.assign(s,{meta:this.meta}),a=r.selected&&!r.selected.includes(this)?o:t(this.kind,o,r);if(a===null)return null;if(We(a))return i=a;const l=Object.keys(a);return(l.length===0||l.length===1&&l[0]==="meta")&&!ti(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in a)?r.undeclaredKeyHandling?{...a,value:D.intrinsic.unknown}:null:(this.kind==="morph"&&(a.in??=D.intrinsic.unknown),i=n.node(this.kind,a,r.parseOptions))}configureReferences(t,r="references"){const n=li.normalize(r),i=typeof t=="string"?(l,c)=>({...c,meta:{...c.meta,description:t}}):typeof t=="function"?(l,c)=>({...c,meta:t(c.meta)}):(l,c)=>({...c,meta:{...c.meta,...t}});if(n.boundary==="self")return this.$.node(this.kind,i(this.kind,{...this.inner,meta:this.meta}));const s=this._select(n),o=s&&ei(s),a=n.boundary==="child"?(l,c)=>c.root.children.includes(l):n.boundary==="shallow"?l=>l.kind!=="structure":()=>!0;return this.$.finalize(this.transform(i,{shouldTransform:a,selected:o}))}}const li={applyBoundary:{self:e=>[e],child:e=>[...e.children],shallow:e=>[...e.shallowReferences],references:e=>[...e.references]},applyMethod:{filter:e=>e,assertFilter:(e,t,r)=>(e.length===0&&cn(Bf(t,r)),e),find:e=>e[0],assertFind:(e,t,r)=>(e.length===0&&cn(Bf(t,r)),e[0])},normalize:e=>typeof e=="function"?{boundary:"references",method:"filter",where:e}:typeof e=="string"?Ct(e,li.applyBoundary)?{method:"filter",boundary:e}:{boundary:"references",method:"filter",kind:e}:{boundary:"references",method:"filter",...e}},Bf=(e,t)=>`${e} had no references matching ${ce(t)}.`,G0=e=>ai(e,{stringifyNonKey:t=>t.expression}),W0=/"(\$ark\.[^"]+)"/g,H0=e=>JSON.stringify(e).replace(W0,"$1"),or=(e,t)=>({path:e,node:t,propString:G0(e)}),qf=(e,t)=>e.propString===t.propString&&e.node.equals(t.node),jf=(e,t)=>Mr(e,t,{isEqual:qf}),J0=(e,t)=>Mr(e,t,{isEqual:(r,n)=>r.equals(n)});class q extends Array{static init(t,r,n,i){return new q({kind:t,l:r,r:n,path:i?.path??[],optional:i?.optional??!1})}add(t,r,n,i){return this.push({kind:t,l:r,r:n,path:i?.path??[],optional:i?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:t,l:r,r:n}=this[0],i=ai(t);return Kf(`Intersection${i&&` at ${i}`} of ${Uf(r,n)}`)}return`The following intersections result in unsatisfiable types:
 ${this.map(({path:t,l:r,r:n})=>`${t}: ${Uf(r,n)}`).join(`
 `)}`}throw(){return N(this.describeReasons())}invert(){const t=this.map(r=>({...r,l:r.r,r:r.l}));return t instanceof q?t:new q(...t)}withPrefixKey(t,r){return this.map(n=>({...n,path:[t,...n.path],optional:n.optional||r==="optional"}))}toNeverIfDisjoint(){return D.intrinsic.never}}const Uf=(e,t)=>`${Xa(e)} and ${Xa(t)}`,Xa=e=>We(e)?e.expression:je(e)?e.map(Xa).join(" | ")||"never":String(e),Kf=e=>`${e} results in an unsatisfiable type`,mn={},Jt=(e,t,r)=>Oe(e,t,{$:r,invert:!1,pipe:!1}),el=(e,t,r)=>Oe(e,t,{$:r,invert:!1,pipe:!0}),Oe=((e,t,r)=>{const n=r.pipe?"|>":"&",i=`${e.hash}${n}${t.hash}`;if(mn[i]!==void 0)return mn[i];if(!r.pipe){const a=`${t.hash}${n}${e.hash}`;if(mn[a]!==void 0){const l=mn[a],c=l instanceof q?l.invert():l;return mn[i]=c,c}}const s=!r.pipe||!e.includesTransform&&!t.includesTransform;if(s&&e.equals(t))return e;let o=s?tl(e,t,r):e.hasKindIn(...gs)?Y0(e,t,r):tl(e,t,r);return We(o)&&(e.equals(o)?o=e:t.equals(o)&&(o=t)),mn[i]=o,o}),tl=(e,t,r)=>{const n=e.precedence<t.precedence?e.kind:t.kind,i=e.impl.intersections[t.kind]??t.impl.intersections[e.kind];if(i===void 0)return null;if(n===e.kind)return i(e,t,r);{let s=i(t,e,{...r,invert:!r.invert});return s instanceof q&&(s=s.invert()),s}},Y0=(e,t,r)=>e.includesTransform||t.includesTransform?r.invert?Gf(t,e,r):Gf(e,t,r):tl(e,t,r),Gf=(e,t,r)=>e.distribute(n=>Q0(n,t,r),n=>{const i=n.filter(We);if(i.length===0)return q.init("union",e.branches,t.branches);if(i.length<e.branches.length||!e.branches.every((o,a)=>o.rawIn.equals(i[a].rawIn)))return r.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return r.$.parseSchema(s)}),Q0=(e,t,r)=>{if(e.hasKind("morph")){const i=[...e.morphs];if(e.lastMorphIfNode){const s=Oe(e.lastMorphIfNode,t,r);if(s instanceof q)return s;i[i.length-1]=s}else i.push(t);return r.$.node("morph",{morphs:i,in:e.inner.in})}if(t.hasKind("morph")){const i=Oe(e,t.rawIn,r);return i instanceof q?i:r.$.node("morph",{morphs:[t],in:i})}return r.$.node("morph",{morphs:[t],in:e})};class gn extends zf{constructor(t,r){super(t,r),Object.defineProperty(this,Wt,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(t){return Jt(this,t,this.$)}}class vs extends gn{traverseApply=(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)};compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return bs(this.errorContext)}}const Je=e=>(t,r)=>{if(je(t)){if(t.length===0)return;const i=t.map(s=>r.$.node(e,s));return e==="predicate"?i:i.sort((s,o)=>s.hash<o.hash?-1:1)}const n=r.$.node(e,t);return n.hasOpenIntersection()?[n]:n},ws=e=>{const t=e.r.shift();if(!t){let n=e.l.length===0&&e.kind==="structure"?D.intrinsic.unknown.internal:e.ctx.$.node(e.kind,Object.assign(e.baseInner,Z0(e.l)),{prereduced:!0});for(const i of e.roots){if(n instanceof q)return n;n=Oe(i,n,e.ctx)}return n}let r=!1;for(let n=0;n<e.l.length;n++){const i=Oe(e.l[n],t,e.ctx);if(i!==null){if(i instanceof q)return i;if(i.isRoot())return e.roots.push(i),e.l.splice(n),ws(e);if(!r)e.l[n]=i,r=!0;else if(!e.l.includes(i))return Ce(`Unexpectedly encountered multiple distinct intersection results for refinement ${t}`)}}if(r||e.l.push(t),e.kind==="intersection"&&t.impliedSiblings)for(const n of t.impliedSiblings)Mr(e.r,n);return ws(e)},xs=e=>Object.entries(e).flatMap(([r,n])=>r in Rf?n:[]).sort((r,n)=>r.precedence<n.precedence?-1:r.precedence>n.precedence?1:r.kind==="predicate"&&n.kind==="predicate"?0:r.hash<n.hash?-1:1),Z0=e=>{const t={};for(const r of e)if(r.hasOpenIntersection())t[r.kind]=fe(t[r.kind],r);else{if(t[r.kind])return Ce(`Unexpected intersection of closed refinements of kind ${r.kind}`);t[r.kind]=r}return t},X0=(...e)=>N(e1(...e)),e1=(e,t,r)=>{const n=r.hasKind("morph")?"a morph":r.isUnknown()?"unknown":r.exclude(t).defaultShortDescription;return`${d0(e)} operand must be ${t.description} (was ${n})`},t1=(e,t,r)=>new ks(e,t,r,r,null);class Wf extends nr{}class ks extends nr{[Wt]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(t,r,n,i,s){super((...o)=>{const a=he(this.names,(l,c)=>{const u=this.arg$.parse(o[l]);return u.extends(this.constraints[l])||N(r1(c,this.constraints[l].expression,u.expression)),[c,u]});if(this.defIsLazy()){const l=this.bodyDef(a);return this.$.parse(l)}return this.$.parse(r,{args:a})}),this.paramDefs=t,this.bodyDef=r,this.$=n,this.arg$=i,this.hkt=s,this.description=s?new s().description??`a generic type for ${s.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof Wf}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get json(){return this.cacheGetter("json",{params:this.params.map(t=>t[1].isUnknown()?t[0]:[t[0],t[1].json]),body:I0(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(t=>typeof t=="string"?[t,D.intrinsic.unknown]:[t[0],this.$.parse(t[1])]))}get names(){return this.cacheGetter("names",this.params.map(t=>t[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(t=>t[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const r1=(e,t,r)=>`${e} must be assignable to ${t} (was ${r})`,n1=we({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:e=>typeof e=="function"?{predicate:e}:e,defaults:{description:e=>`valid according to ${e.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class i1 extends gn{serializedPredicate=Ge(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=bs(this.errorContext);traverseApply=(t,r)=>{const n=r.currentErrorCount;!this.predicate(t,r.external)&&r.currentErrorCount===n&&r.errorFromNodeContext(this.errorContext)};compile(t){if(t.traversalKind==="Allows"){t.return(this.compiledCondition);return}t.initializeErrorCount(),t.if(`${this.compiledNegation} && ctx.currentErrorCount === errorCount`,()=>t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(t,r){return r.fallback.predicate({code:"predicate",base:t,predicate:this.predicate})}}const Hf={implementation:n1,Node:i1},s1=we({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:e=>Number.isInteger(e)?e:N(a1(e))}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>e.rule===1?"an integer":e.rule===2?"even":`a multiple of ${e.rule}`},intersections:{divisor:(e,t,r)=>r.$.node("divisor",{rule:Math.abs(e.rule*t.rule/l1(e.rule,t.rule))})},obviatesBasisDescription:!0});class o1 extends vs{traverseAllows=t=>t%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=D.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(t){return t.type="integer",this.rule===1||(t.multipleOf=this.rule),t}}const Jf={implementation:s1,Node:o1},a1=e=>`divisor must be an integer (was ${e})`,l1=(e,t)=>{let r,n=e,i=t;for(;i!==0;)r=i,i=n%i,n=r;return n};class yn extends vs{boundOperandKind=f1[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=h1(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${c1[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?p1(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(t){return(this.limitKind==="upper"?this.numericLimit<t.numericLimit:this.numericLimit>t.numericLimit)||this.numericLimit===t.numericLimit&&this.exclusive===!0&&!t.exclusive}overlapsRange(t){return!(this.isStricterThan(t)||this.numericLimit===t.numericLimit&&(this.exclusive||t.exclusive))}overlapIsUnit(t){return this.numericLimit===t.numericLimit&&!this.exclusive&&!t.exclusive}}const c1={"<":">=","<=":">",">":"<=",">=":"<"},u1={min:"max",minLength:"maxLength",after:"before"},Yf={parse:e=>e||void 0},Qf=e=>t=>{if(typeof t=="number")return{rule:t};const{exclusive:r,...n}=t;return r?{...n,rule:e==="minLength"?n.rule+1:n.rule-1}:n},Zf=e=>t=>{if(typeof t=="number"||typeof t=="string"||t instanceof Date)return{rule:t};const{exclusive:r,...n}=t;if(!r)return n;const i=typeof n.rule=="number"?n.rule:typeof n.rule=="string"?new Date(n.rule).valueOf():n.rule.valueOf();return r?{...n,rule:e==="after"?i+1:i-1}:n},Xf=e=>typeof e=="string"||typeof e=="number"?new Date(e):e,d1=(e,t)=>`${e} bound must be a positive integer (was ${t})`,rl=e=>t=>((!Number.isInteger(t)||t<0)&&N(d1(e,t)),t),f1={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},h1=(e,t)=>`${Ct(e,u1)?">":"<"}${t?"":"="}`,p1=e=>typeof e=="string"?e:new Date(e).toLocaleString(),m1=e=>`Bounded expression ${e} must be exactly one of number, string, Array, or Date`,g1=we({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Xf,serialize:e=>e.toISOString()}},normalize:Zf("after"),defaults:{description:e=>`${e.collapsibleLimitString} or later`,actual:oi},intersections:{after:(e,t)=>e.isStricterThan(t)?e:t}});class y1 extends yn{impliedBasis=D.intrinsic.Date.internal;collapsibleLimitString=oi(this.rule);traverseAllows=t=>t>=this.rule;reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,after:this.rule})}}const eh={implementation:g1,Node:y1},_1=we({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Xf,serialize:e=>e.toISOString()}},normalize:Zf("before"),defaults:{description:e=>`${e.collapsibleLimitString} or earlier`,actual:oi},intersections:{before:(e,t)=>e.isStricterThan(t)?e:t,after:(e,t,r)=>e.overlapsRange(t)?e.overlapIsUnit(t)?r.$.node("unit",{unit:e.rule}):null:q.init("range",e,t)}});class b1 extends yn{collapsibleLimitString=oi(this.rule);traverseAllows=t=>t<=this.rule;impliedBasis=D.intrinsic.Date.internal;reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,before:this.rule})}}const th={implementation:_1,Node:b1},v1=we({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:rl("exactLength")}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>`exactly length ${e.rule}`,actual:e=>`${e.length}`},intersections:{exactLength:(e,t,r)=>q.init("unit",r.$.node("unit",{unit:e.rule}),r.$.node("unit",{unit:t.rule}),{path:["length"]}),minLength:(e,t)=>e.rule>=t.rule?e:q.init("range",e,t),maxLength:(e,t)=>e.rule<=t.rule?e:q.init("range",e,t)}});class w1 extends vs{traverseAllows=t=>t.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=D.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t.maxLength=this.rule,t;case"array":return t.minItems=this.rule,t.maxItems=this.rule,t;default:return Ie.throwInternalOperandError("exactLength",t)}}}const rh={implementation:v1,Node:w1},x1=we({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Yf},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"negative":"non-positive":`${e.exclusive?"less than":"at most"} ${e.rule}`},intersections:{max:(e,t)=>e.isStricterThan(t)?e:t,min:(e,t,r)=>e.overlapsRange(t)?e.overlapIsUnit(t)?r.$.node("unit",{unit:e.rule}):null:q.init("range",e,t)},obviatesBasisDescription:!0});class k1 extends yn{impliedBasis=D.intrinsic.number.internal;traverseAllows=this.exclusive?t=>t<this.rule:t=>t<=this.rule;reduceJsonSchema(t){return this.exclusive?t.exclusiveMaximum=this.rule:t.maximum=this.rule,t}}const nh={implementation:x1,Node:k1},M1=we({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:rl("maxLength")}},reduce:(e,t)=>e.rule===0?t.node("exactLength",e):void 0,normalize:Qf("maxLength"),defaults:{description:e=>`at most length ${e.rule}`,actual:e=>`${e.length}`},intersections:{maxLength:(e,t)=>e.isStricterThan(t)?e:t,minLength:(e,t,r)=>e.overlapsRange(t)?e.overlapIsUnit(t)?r.$.node("exactLength",{rule:e.rule}):null:q.init("range",e,t)}});class S1 extends yn{impliedBasis=D.intrinsic.lengthBoundable.internal;traverseAllows=t=>t.length<=this.rule;reduceJsonSchema(t){switch(t.type){case"string":return t.maxLength=this.rule,t;case"array":return t.maxItems=this.rule,t;default:return Ie.throwInternalOperandError("maxLength",t)}}}const ih={implementation:M1,Node:S1},$1=we({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Yf},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"positive":"non-negative":`${e.exclusive?"more than":"at least"} ${e.rule}`},intersections:{min:(e,t)=>e.isStricterThan(t)?e:t},obviatesBasisDescription:!0});class C1 extends yn{impliedBasis=D.intrinsic.number.internal;traverseAllows=this.exclusive?t=>t>this.rule:t=>t>=this.rule;reduceJsonSchema(t){return this.exclusive?t.exclusiveMinimum=this.rule:t.minimum=this.rule,t}}const sh={implementation:$1,Node:C1},A1=we({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:rl("minLength")}},reduce:e=>e.rule===0?D.intrinsic.unknown:void 0,normalize:Qf("minLength"),defaults:{description:e=>e.rule===1?"non-empty":`at least length ${e.rule}`,actual:e=>e.length===0?"":`${e.length}`},intersections:{minLength:(e,t)=>e.isStricterThan(t)?e:t}});class E1 extends yn{impliedBasis=D.intrinsic.lengthBoundable.internal;traverseAllows=t=>t.length>=this.rule;reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t;case"array":return t.minItems=this.rule,t;default:return Ie.throwInternalOperandError("minLength",t)}}}const oh={implementation:A1,Node:E1},I1={min:sh.implementation,max:nh.implementation,minLength:oh.implementation,maxLength:ih.implementation,exactLength:rh.implementation,after:eh.implementation,before:th.implementation},P1={min:sh.Node,max:nh.Node,minLength:oh.Node,maxLength:ih.Node,exactLength:rh.Node,after:eh.Node,before:th.Node},O1=we({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:e=>typeof e=="string"?{rule:e}:e instanceof RegExp?e.flags?{rule:e.source,flags:e.flags}:{rule:e.source}:e,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:e=>`matched by ${e.rule}`},intersections:{pattern:()=>null}});class T1 extends vs{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=D.intrinsic.string.internal;reduceJsonSchema(t,r){return t.pattern?r.fallback.patternIntersection({code:"patternIntersection",base:t,pattern:this.rule}):(t.pattern=this.rule,t)}}const ah={implementation:O1,Node:T1},Ms=(e,t)=>{const r=N1(e);return t&&!t.includes(r)?N(`Root of kind ${r} should be one of ${t}`):r},N1=e=>{if(G(e,"root"))return e.kind;if(typeof e=="string")return e[0]==="$"?"alias":e in Gt?"domain":"proto";if(typeof e=="function")return"proto";if(typeof e!="object"||e===null)return N(lh(e));if("morphs"in e)return"morph";if("branches"in e||je(e))return"union";if("unit"in e)return"unit";if("reference"in e)return"alias";const t=Object.keys(e);return t.length===0||t.some(r=>r in Rf)?"intersection":"proto"in e?"proto":"domain"in e?"domain":N(lh(e))},lh=e=>`${ce(e)} is not a valid type schema`,ch={},R1=e=>je(e)?e.map(t=>t.collapsibleJson):e.collapsibleJson,at={};D.nodesByRegisteredId=at;const uh=e=>(ch[e]??=0,`${e}${++ch[e]}`),dh=e=>{const t=As[e.kind],r=t.applyConfig?.(e.def,e.$.resolvedConfig)??e.def,n={},{meta:i,...s}=r,o=i===void 0?{}:typeof i=="string"?{description:i}:i,a=cf(s).sort(([c],[u])=>ys(c)?ys(u)?_s(c)-_s(u):1:ys(u)||c<u?-1:1).filter(([c,u])=>{if(c.startsWith("meta.")){const d=c.slice(5);return o[d]=u,!1}return!0});for(const c of a){const u=c[0],d=t.keys[u];if(!d)return N(`Key ${u} is not valid on ${e.kind} schema`);const f=d.parse?d.parse(c[1],e):c[1];f!==At&&(f!==void 0||d.preserveUndefined)&&(n[u]=f)}if(t.reduce&&!e.prereduced){const c=t.reduce(n,e.$);if(c)return c instanceof q?c.throw():L1(c,o)}return nl({id:e.id,kind:e.kind,inner:n,meta:o,$:e.$})},nl=({id:e,kind:t,inner:r,meta:n,$:i,ignoreCache:s})=>{const o=As[t],a=cf(r),l=[];let c={};for(const[_,b]of a){const w=o.keys[_],k=w.serialize??(w.child?R1:$r);if(c[_]=k(b),w.child===!0){const x=b;je(x)?l.push(...x):l.push(x)}else typeof w.child=="function"&&l.push(...w.child(b))}o.finalizeInnerJson&&(c=o.finalizeInnerJson(c));let u={...c},d={};ti(n)||(d=he(n,(_,b)=>[_,_==="examples"?b:$r(b)]),u.meta=Ss(d,"description",!0)),c=Ss(c,o.collapsibleKey,!1);const f=JSON.stringify({kind:t,...c});u=Ss(u,o.collapsibleKey,!1);const p=Ss(u,o.collapsibleKey,!0),m=JSON.stringify({kind:t,...u});if(i.nodesByHash[m]&&!s)return i.nodesByHash[m];const g={id:e,kind:t,impl:o,inner:r,innerEntries:a,innerJson:c,innerHash:f,meta:n,metaJson:d,json:u,hash:m,collapsibleJson:p,children:l};if(t!=="intersection")for(const _ in r)_!=="in"&&_!=="out"&&(g[_]=r[_]);const y=new Uw[t](g,i);return i.nodesByHash[m]=y},F1=(e,t)=>e.id===t?e:(We(at[t])&&Ce(`Unexpected attempt to overwrite node id ${t}`),nl({id:t,kind:e.kind,inner:e.inner,meta:e.meta,$:e.$,ignoreCache:!0})),L1=(e,t,r)=>nl({id:uh(t.alias??e.kind),kind:e.kind,inner:e.inner,meta:t,$:e.$}),Ss=(e,t,r)=>{const n=Object.keys(e);if(n.length===1&&n[0]===t){const i=e[t];if(r||Sr(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return e},il=(e,t,r)=>{if(e.key!==t.key)return null;const n=e.key;let i=Oe(e.value,t.value,r);const s=e.required||t.required?"required":"optional";if(i instanceof q)if(s==="optional")i=D.intrinsic.never.internal;else return i.withPrefixKey(e.key,e.required&&t.required?"required":"optional");if(s==="required")return r.$.node("required",{key:n,value:i});const o=e.hasDefault()?t.hasDefault()?e.default===t.default?e.default:N(hh(e.default,t.default)):e.default:t.hasDefault()?t.default:At;return r.$.node("optional",{key:n,value:i,default:o})};class fh extends gn{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=D.intrinsic.object.internal;serializedKey=fn(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=fe(this.value.flatRefs.map(t=>or([this.key,...t.path],t.node)),or([this.key],this.value));_transform(t,r){r.path.push(this.key);const n=super._transform(t,r);return r.path.pop(),n}hasDefault(){return"default"in this.inner}traverseAllows=(t,r)=>this.key in t?Ht(this.key,()=>this.value.traverseAllows(t[this.key],r),r):this.optional;traverseApply=(t,r)=>{this.key in t?Ht(this.key,()=>this.value.traverseApply(t[this.key],r),r):this.hasKind("required")&&r.errorFromNodeContext(this.errorContext)};compile(t){t.if(`${this.serializedKey} in data`,()=>t.traverseKey(this.serializedKey,`data${t.prop(this.key)}`,this.value)),this.hasKind("required")&&t.else(()=>t.traversalKind==="Apply"?t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):t.return(!1)),t.traversalKind==="Allows"&&t.return(!0)}}const hh=(e,t)=>`Invalid intersection of default values ${ce(e)} & ${ce(t)}`,D1=we({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,t)=>t.$.parseSchema(e)},default:{preserveUndefined:!0}},normalize:e=>e,reduce:(e,t)=>{if(t.resolvedConfig.exactOptionalPropertyTypes===!1&&!e.value.allows(void 0))return t.node("optional",{...e,value:e.value.or(W.undefined)},{prereduced:!0})},defaults:{description:e=>`${e.compiledKey}?: ${e.value.description}`},intersections:{optional:il}});class V1 extends fh{constructor(...t){super(...t),"default"in this.inner&&ol(this.value,this.inner.default,this.key)}get rawIn(){const t=super.rawIn;return this.hasDefault()?this.$.node("optional",df(t.inner,{default:!0}),{prereduced:!0}):t}get outProp(){if(!this.hasDefault())return this;const{default:t,...r}=this.inner;return this.cacheGetter("outProp",this.$.node("required",r,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${ce(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=B1(this);defaultValueMorphRef=this.defaultValueMorph&&Ge(this.defaultValueMorph)}const sl={implementation:D1,Node:V1},z1={},B1=e=>{if(!e.hasDefault())return;const t=`{${e.compiledKey}: ${e.value.id} = ${$r(e.default)}}`;return z1[t]??=ph(e.key,e.value,e.default)},ph=(e,t,r)=>{if(typeof r=="function")return t.includesTransform?(i,s)=>(Ht(e,()=>t(i[e]=r(),s),s),i):i=>(i[e]=r(),i);const n=t.includesTransform?t.assert(r):r;return Sr(n,"object")?(i,s)=>(Ht(e,()=>t(i[e]=r,s),s),i):i=>(i[e]=n,i)},ol=(e,t,r)=>{const n=ds(t);Sr(t,"object")&&!n&&N(q1(r));const i=e.in(n?t():t);if(i instanceof sr){r===null&&N(`Default ${i.summary}`);const s=i.transform(o=>o.transform(a=>({...a,prefixPath:[r]})));N(`Default for ${s.summary}`)}return t},q1=e=>`Non-primitive default ${e===null?"":typeof e=="number"?`for value at [${e}] `:`for ${fn(e)} `}must be specified as a function like () => ({my: 'object'})`;class ci extends zf{constructor(t,r){super(t,r),Object.defineProperty(this,Wt,{value:"root",enumerable:!1})}get rawIn(){return super.rawIn}get rawOut(){return super.rawOut}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:t=>{const r=this(t);return r instanceof sr?r:{value:r}},jsonSchema:{input:t=>this.rawIn.toJsonSchema({target:gh(t.target),...t.libraryOptions}),output:t=>this.rawOut.toJsonSchema({target:gh(t.target),...t.libraryOptions})}}}as(){return this}brand(t){return t===""?N(j1):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(t,r){const n=this.branches.map(t);return r?.(n)??n}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(t={}){const r=Lf(this.$.resolvedConfig.toJsonSchema,t);r.useRefs||=this.isCyclic;const n=typeof r.dialect=="string"?{$schema:r.dialect}:{};if(Object.assign(n,this.toJsonSchemaRecurse(r)),r.useRefs){const i=he(this.references,(s,o)=>o.isRoot()&&!o.alwaysExpandJsonSchema?[o.id,o.toResolvedJsonSchema(r)]:[]);r.target==="draft-07"?Object.assign(n,{definitions:i}):n.$defs=i}return n}toJsonSchemaRecurse(t){return t.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/${t.target==="draft-07"?"definitions":"$defs"}/${this.id}`}:this.toResolvedJsonSchema(t)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(t){const r=this.innerToJsonSchema(t);return Object.assign(r,this.metaJson)}intersect(t){const r=this.$.parseDefinition(t),n=this.rawIntersect(r);return n instanceof q?n:this.$.finalize(n)}rawIntersect(t){return Jt(this,t,this.$)}toNeverIfDisjoint(){return this}and(t){const r=this.intersect(t);return r instanceof q?r.throw():r}rawAnd(t){const r=this.rawIntersect(t);return r instanceof q?r.throw():r}or(t){const r=this.$.parseDefinition(t);return this.$.finalize(this.rawOr(r))}rawOr(t){const r=[...this.branches,...t.branches];return this.$.node("union",r)}map(t){return this.$.schema(this.applyStructuralOperation("map",[t]))}pick(...t){return this.$.schema(this.applyStructuralOperation("pick",t))}omit(...t){return this.$.schema(this.applyStructuralOperation("omit",t))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const t=this.applyStructuralOperation("keyof",[]).reduce((r,n)=>r.intersect(n).toNeverIfDisjoint(),D.intrinsic.unknown.internal);return t.branches.length===0&&N(Kf(`keyof ${this.expression}`)),this._keyof=this.$.finalize(t)}get props(){return this.branches.length!==1?N(K1(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(t){const r=this.$.parseDefinition(t);return this.$.schema(r.distribute(n=>this.applyStructuralOperation("merge",[yh(n)??N(_h("merge",n.expression))])))}applyStructuralOperation(t,r){return this.distribute(n=>{if(n.equals(D.intrinsic.object)&&t!=="merge")return n;const i=yh(n);if(i||N(_h(t,n.expression)),t==="keyof")return i.keyof();if(t==="get")return i.get(...r);if(t==="props")return i.props;const s=t==="required"?"require":t==="partial"?"optionalize":t;return this.$.node("intersection",{domain:"object",structure:i[s](...r)})})}get(...t){return t[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",t))}extract(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(n=>n.extends(r)))}exclude(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(n=>!n.extends(r)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(t){return!(this.intersect(t)instanceof q)}extends(t){if(this.isNever())return!0;const r=this.intersect(t);return!(r instanceof q)&&this.equals(r)}ifExtends(t){return this.extends(t)?this:void 0}subsumes(t){return this.$.parseDefinition(t).extends(this)}configure(t,r="shallow"){return this.configureReferences(t,r)}describe(t,r="shallow"){return this.configure({description:t},r)}optional(){return[this,"?"]}default(t){return ol(this,t,null),[this,"=",t]}from(t){return this.assert(t)}_pipe(...t){const r=t.reduce((n,i)=>n.rawPipeOnce(i),this);return this.$.finalize(r)}tryPipe(...t){const r=t.reduce((n,i)=>n.rawPipeOnce(G(i,"root")?i:((s,o)=>{try{return i(s,o)}catch(a){return o.error({code:"predicate",predicate:i,actual:`aborted due to error:
    ${a}
`})}})),this);return this.$.finalize(r)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(t){return this.$.finalize(this.toNode(this.$.parseDefinition(t)))}toNode(t){const r=el(this,t,this.$);return r instanceof q?r.throw():r}rawPipeOnce(t){return G(t,"root")?this.toNode(t):this.distribute(r=>r.hasKind("morph")?this.$.node("morph",{in:r.inner.in,morphs:[...r.morphs,t]}):this.$.node("morph",{in:r,morphs:[t]}),this.$.parseSchema)}narrow(t){return this.constrainOut("predicate",t)}constrain(t,r){return this._constrain("root",t,r)}constrainIn(t,r){return this._constrain("in",t,r)}constrainOut(t,r){return this._constrain("out",t,r)}_constrain(t,r,n){const i=this.$.node(r,n);if(i.isRoot())return i.isUnknown()?this:Ce(`Unexpected constraint node ${i}`);const s=t==="root"?this:t==="in"?this.rawIn:this.rawOut;if(s.hasKind("morph")||i.impliedBasis&&!s.extends(i.impliedBasis))return X0(r,i.impliedBasis,this);const o=this.$.node("intersection",{[i.kind]:i}),a=t==="out"?el(this,o,this.$):Jt(this,o,this.$);return a instanceof q&&a.throw(),this.$.finalize(a)}onUndeclaredKey(t){const r=typeof t=="string"?t:t.rule,n=typeof t=="string"?!1:t.deep;return this.$.finalize(this.transform((i,s)=>i==="structure"?r==="ignore"?df(s,{undeclared:1}):{...s,undeclared:r}:s,n?void 0:{shouldTransform:i=>!Kt(ms,i.kind)}))}hasEqualMorphs(t){return!this.includesTransform&&!t.includesTransform?!0:!(!ln(this.shallowMorphs,t.shallowMorphs)||!ln(this.flatMorphs,t.flatMorphs,{isEqual:(r,n)=>r.propString===n.propString&&(r.node.hasKind("morph")&&n.node.hasKind("morph")?r.node.hasEqualMorphs(n.node):r.node.hasKind("intersection")&&n.node.hasKind("intersection")?r.node.structure?.structuralMorphRef===n.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(t){return this.onUndeclaredKey({rule:t,deep:!0})}filter(t){return this.constrainIn("predicate",t)}divisibleBy(t){return this.constrain("divisor",t)}matching(t){return this.constrain("pattern",t)}atLeast(t){return this.constrain("min",t)}atMost(t){return this.constrain("max",t)}moreThan(t){return this.constrain("min",_n(t))}lessThan(t){return this.constrain("max",_n(t))}atLeastLength(t){return this.constrain("minLength",t)}atMostLength(t){return this.constrain("maxLength",t)}moreThanLength(t){return this.constrain("minLength",_n(t))}lessThanLength(t){return this.constrain("maxLength",_n(t))}exactlyLength(t){return this.constrain("exactLength",t)}atOrAfter(t){return this.constrain("after",t)}atOrBefore(t){return this.constrain("before",t)}laterThan(t){return this.constrain("after",_n(t))}earlierThan(t){return this.constrain("before",_n(t))}}const j1="Expected a non-empty brand name after #",mh=["draft-2020-12","draft-07"],U1=e=>`JSONSchema target '${e}' is not supported (must be ${mh.map(t=>`"${t}"`).join(" or ")})`,gh=e=>(Kt(mh,e)||N(U1(e)),e),_n=e=>typeof e=="object"&&!(e instanceof Date)?{...e,exclusive:!0}:{rule:e,exclusive:!0},$s=(e,t)=>G(t,"root")?G(e,"root")?e.extends(t):t.allows(e):G(e,"root")?e.hasUnit(t):t===e,yh=e=>e.hasKind("morph")?null:e.hasKind("intersection")?e.inner.structure??(e.basis?.domain==="object"?e.$.bindReference(D.intrinsic.emptyStructure):null):e.isBasis()&&e.domain==="object"?e.$.bindReference(D.intrinsic.emptyStructure):null,K1=e=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${e}`,_h=(e,t)=>`${e} operand must be an object (was ${t})`,ui=(e,t)=>he(Qa(e),(r,n)=>[n,t]),G1=e=>typeof e=="string"?{reference:e}:e,bh=e=>e instanceof q?D.intrinsic.never.internal:e,W1=we({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:e=>e.startsWith("$")?e:`$ark.${e}`},resolve:{}},normalize:G1,defaults:{description:e=>e.reference},intersections:{alias:(e,t,r)=>r.$.lazilyResolve(()=>bh(Oe(e.resolution,t.resolution,r)),`${e.reference}${r.pipe?"=>":"&"}${t.reference}`),...ui("alias",(e,t,r)=>t.isUnknown()?e:t.isNever()?t:t.isBasis()&&!t.overlaps(D.intrinsic.object)?q.init("assignability",D.intrinsic.object,t):r.$.lazilyResolve(()=>bh(Oe(e.resolution,t,r)),`${e.reference}${r.pipe?"=>":"&"}${t.id}`))}});class H1 extends ci{expression=this.reference;structure=void 0;get resolution(){const t=this._resolve();return at[this.id]=t}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const t=this.reference;let r=at[t];const n=[];for(;G(r,"context");){if(n.includes(r.id))return N(J1(r.id,n));n.push(r.id),r=at[r.id]}return G(r,"root")?r:Ce(`Unexpected resolution for reference ${this.reference}
Seen: [${n.join("->")}] 
Resolution: ${ce(r)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const t=this.reference.slice(1),r=this.$.resolutions[t];return typeof r=="string"?r:G(r,"root")?r.id:Ce(`Unexpected resolution for reference ${this.reference}: ${ce(r)}`)}get defaultShortDescription(){return Gt.object}innerToJsonSchema(t){return this.resolution.toJsonSchemaRecurse(t)}traverseAllows=(t,r)=>{const n=r.seen[this.reference];return n?.includes(t)?!0:(r.seen[this.reference]=fe(n,t),this.resolution.traverseAllows(t,r))};traverseApply=(t,r)=>{const n=r.seen[this.reference];n?.includes(t)||(r.seen[this.reference]=fe(n,t),this.resolution.traverseApply(t,r))};compile(t){const r=this.resolutionId;t.if(`ctx.seen.${r} && ctx.seen.${r}.includes(data)`,()=>t.return(!0)),t.if(`!ctx.seen.${r}`,()=>t.line(`ctx.seen.${r} = []`)),t.line(`ctx.seen.${r}.push(data)`),t.return(t.invoke(r))}}const J1=(e,t)=>`Alias '${e}' has a shallow resolution cycle: ${[...t,e].join("->")}`,al={implementation:W1,Node:H1};class ll extends ci{traverseApply=(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return bs(this.errorContext)}compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}}const Y1=we({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:e=>typeof e=="string"?{domain:e}:Da(e,"numberAllowsNaN")&&e.domain!=="number"?N(cl.writeBadAllowNanMessage(e.domain)):e,applyConfig:(e,t)=>e.numberAllowsNaN===void 0&&e.domain==="number"&&t.numberAllowsNaN?{...e,numberAllowsNaN:!0}:e,defaults:{description:e=>Gt[e.domain],actual:e=>Number.isNaN(e)?"NaN":Gt[mt(e)]},intersections:{domain:(e,t)=>e.domain==="number"&&t.domain==="number"?e.numberAllowsNaN?t:e:q.init("domain",e,t)}});class Q1 extends ll{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?t=>typeof t=="number"&&!Number.isNaN(t):t=>mt(t)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Gt[this.domain]}innerToJsonSchema(t){return this.domain==="bigint"||this.domain==="symbol"?t.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const cl={implementation:Y1,Node:Q1,writeBadAllowNanMessage:e=>`numberAllowsNaN may only be specified with domain "number" (was ${e})`},Z1=we({kind:"intersection",hasAssociatedError:!0,normalize:e=>{if(We(e))return e;const{structure:t,...r}=e,n=!!t,i=t??{},s=he(r,(o,a)=>Ct(o,z0)?(n&&N(`Flattened structure key ${o} cannot be specified alongside a root 'structure' key.`),i[o]=a,[]):[o,a]);return(G(i,"constraint")||!ti(i))&&(s.structure=i),s},finalizeInnerJson:({structure:e,...t})=>Sr(e,"object")?{...e,...t}:t,keys:{domain:{child:!0,parse:(e,t)=>t.$.node("domain",e)},proto:{child:!0,parse:(e,t)=>t.$.node("proto",e)},structure:{child:!0,parse:(e,t)=>t.$.node("structure",e),serialize:e=>{if(!e.sequence?.minLength)return e.collapsibleJson;const{sequence:t,...r}=e.collapsibleJson,{minVariadicLength:n,...i}=t,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...r,sequence:s}}},divisor:{child:!0,parse:Je("divisor")},max:{child:!0,parse:Je("max")},min:{child:!0,parse:Je("min")},maxLength:{child:!0,parse:Je("maxLength")},minLength:{child:!0,parse:Je("minLength")},exactLength:{child:!0,parse:Je("exactLength")},before:{child:!0,parse:Je("before")},after:{child:!0,parse:Je("after")},pattern:{child:!0,parse:Je("pattern")},predicate:{child:!0,parse:Je("predicate")}},reduce:(e,t)=>wh({},e,{$:t,invert:!1,pipe:!1}),defaults:{description:e=>{if(e.children.length===0)return"unknown";if(e.structure)return e.structure.description;const t=[];if(e.basis&&!e.prestructurals.some(r=>r.impl.obviatesBasisDescription)&&t.push(e.basis.description),e.prestructurals.length){const r=e.prestructurals.slice().sort((n,i)=>n.kind==="min"&&i.kind==="max"?-1:0).map(n=>n.description);t.push(...r)}return e.inner.predicate&&t.push(...e.inner.predicate.map(r=>r.description)),t.join(" and ")},expected:e=>`   ${e.errors.map(t=>t.expected).join(`
   `)}`,problem:e=>`(${e.actual}) must be...
${e.expected}`},intersections:{intersection:(e,t,r)=>wh(e.inner,t.inner,r),...ui("intersection",(e,t,r)=>{if(e.children.length===0)return t;const{domain:n,proto:i,...s}=e.inner,o=i??n,a=o?Oe(o,t,r):t;return a instanceof q?a:e?.basis?.equals(a)?e:e.$.node("intersection",{...s,[a.kind]:a},{prereduced:!0})})}});class X1 extends ci{basis=this.inner.domain??this.inner.proto??null;prestructurals=[];refinements=this.children.filter(t=>t.isRefinement()?(Kt(Tf,t.kind)&&this.prestructurals.push(t),!0):!1);structure=this.inner.structure;expression=ew(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(t){return this.children.reduce((r,n)=>n.isBasis()?n.toJsonSchemaRecurse(t):n.reduceJsonSchema(r,t),{})}traverseAllows=(t,r)=>this.children.every(n=>n.traverseAllows(t,r));traverseApply=(t,r)=>{const n=r.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(t,r),r.currentErrorCount>n))){if(this.prestructurals.length){for(let i=0;i<this.prestructurals.length-1;i++)if(this.prestructurals[i].traverseApply(t,r),r.failFast&&r.currentErrorCount>n)return;if(this.prestructurals[this.prestructurals.length-1].traverseApply(t,r),r.currentErrorCount>n)return}if(!(this.structure&&(this.structure.traverseApply(t,r),r.currentErrorCount>n))&&this.inner.predicate){for(let i=0;i<this.inner.predicate.length-1;i++)if(this.inner.predicate[i].traverseApply(t,r),r.failFast&&r.currentErrorCount>n)return;this.inner.predicate[this.inner.predicate.length-1].traverseApply(t,r)}}};compile(t){if(t.traversalKind==="Allows"){for(const r of this.children)t.check(r);t.return(!0);return}if(t.initializeErrorCount(),this.basis&&(t.check(this.basis),this.children.length>1&&t.returnIfFail()),this.prestructurals.length){for(let r=0;r<this.prestructurals.length-1;r++)t.check(this.prestructurals[r]),t.returnIfFailFast();t.check(this.prestructurals[this.prestructurals.length-1]),(this.structure||this.inner.predicate)&&t.returnIfFail()}if(this.structure&&(t.check(this.structure),this.inner.predicate&&t.returnIfFail()),this.inner.predicate){for(let r=0;r<this.inner.predicate.length-1;r++)t.check(this.inner.predicate[r]),t.returnIfFail();t.check(this.inner.predicate[this.inner.predicate.length-1])}}}const vh={implementation:Z1,Node:X1},ew=e=>{if(e.structure?.expression)return e.structure.expression;const t=e.basis&&!e.prestructurals.some(i=>i.impl.obviatesBasisExpression)?e.basis.nestableExpression:"",r=e.prestructurals.map(i=>i.expression).join(" & "),n=`${t}${t?" ":""}${r}`;return n==="Array == 0"?"[]":n||"unknown"},wh=(e,t,r)=>{const n={},i=e.proto??e.domain,s=t.proto??t.domain,o=i?s?Oe(i,s,r):i:s;return o instanceof q?o:(o&&(n[o.kind]=o),ws({kind:"intersection",baseInner:n,l:xs(e),r:xs(t),roots:[],ctx:r}))},tw=we({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(e,t)=>t.$.parseSchema(e)},morphs:{parse:ei,serialize:e=>e.map(t=>G(t,"root")?t.json:Ge(t))},declaredIn:{child:!1,serialize:e=>e.json},declaredOut:{child:!1,serialize:e=>e.json}},normalize:e=>e,defaults:{description:e=>`a morph from ${e.rawIn.description} to ${e.rawOut?.description??"unknown"}`},intersections:{morph:(e,t,r)=>{if(!e.hasEqualMorphs(t))return N(nw(e.expression,t.expression));const n=Oe(e.rawIn,t.rawIn,r);if(n instanceof q)return n;const i={morphs:e.morphs};if(e.declaredIn||t.declaredIn){const s=Oe(e.rawIn,t.rawIn,r);if(s instanceof q)return s.throw();i.declaredIn=s}if(e.declaredOut||t.declaredOut){const s=Oe(e.rawOut,t.rawOut,r);if(s instanceof q)return s.throw();i.declaredOut=s}return n.distribute(s=>r.$.node("morph",{...i,in:s}),r.$.parseSchema)},...ui("morph",(e,t,r)=>{const n=e.inner.in?Oe(e.inner.in,t,r):t;return n instanceof q?n:n.equals(e.inner.in)?e:r.$.node("morph",{...e.inner,in:n})})}});class rw extends ci{serializedMorphs=this.morphs.map(Ge);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs[this.inner.morphs.length-1];lastMorphIfNode=G(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.rawOut:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get rawIn(){return this.declaredIn??this.inner.in?.rawIn??D.intrinsic.unknown.internal}get rawOut(){return this.declaredOut??this.introspectableOut??D.intrinsic.unknown.internal}declareIn(t){return this.$.node("morph",{...this.inner,declaredIn:t})}declareOut(t){return this.$.node("morph",{...this.inner,declaredOut:t})}expression=`(In: ${this.rawIn.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.rawOut.expression}>`;get defaultShortDescription(){return this.rawIn.meta.description??this.rawIn.defaultShortDescription}innerToJsonSchema(t){return t.fallback.morph({code:"morph",base:this.rawIn.toJsonSchemaRecurse(t),out:this.introspectableOut?.toJsonSchemaRecurse(t)??null})}compile(t){if(t.traversalKind==="Allows"){if(!this.introspectableIn)return;t.return(t.invoke(this.introspectableIn));return}this.introspectableIn&&t.line(t.invoke(this.introspectableIn)),t.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(t,r)=>!this.introspectableIn||this.introspectableIn.traverseAllows(t,r);traverseApply=(t,r)=>{this.introspectableIn&&this.introspectableIn.traverseApply(t,r),r.queueMorphs(this.morphs)};hasEqualMorphs(t){return ln(this.morphs,t.morphs,{isEqual:(r,n)=>r===n||G(r,"root")&&G(n,"root")&&r.equals(n)})}}const xh={implementation:tw,Node:rw},nw=(e,t)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${e}
Right: ${t}`,iw=we({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:e=>Ba(e)??$r(e)},dateAllowsInvalid:{}},normalize:e=>{const t=typeof e=="string"?{proto:un[e]}:typeof e=="function"?We(e)?e:{proto:e}:typeof e.proto=="string"?{...e,proto:un[e.proto]}:e;return typeof t.proto!="function"&&N(Cs.writeInvalidSchemaMessage(t.proto)),Da(t,"dateAllowsInvalid")&&t.proto!==Date&&N(Cs.writeBadInvalidDateMessage(t.proto)),t},applyConfig:(e,t)=>e.dateAllowsInvalid===void 0&&e.proto===Date&&t.dateAllowsInvalid?{...e,dateAllowsInvalid:!0}:e,defaults:{description:e=>e.builtinName?n0[e.builtinName]:`an instance of ${e.proto.name}`,actual:e=>e instanceof Date&&e.toString()==="Invalid Date"?"an invalid Date":za(e)},intersections:{proto:(e,t)=>e.proto===Date&&t.proto===Date?e.dateAllowsInvalid?t:e:mf(e.proto,t.proto)?e:mf(t.proto,e.proto)?t:q.init("proto",e,t),domain:(e,t)=>t.domain==="object"?e:q.init("domain",D.intrinsic.object.internal,t)}});class sw extends ll{builtinName=Ba(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?t=>t instanceof Date&&t.toString()!=="Invalid Date":t=>t instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(t){switch(this.builtinName){case"Array":return{type:"array"};case"Date":return t.fallback.date?.({code:"date",base:{}})??t.fallback.proto({code:"proto",base:{},proto:this.proto});default:return t.fallback.proto({code:"proto",base:{},proto:this.proto})}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const Cs={implementation:iw,Node:sw,writeBadInvalidDateMessage:e=>`dateAllowsInvalid may only be specified with constructor Date (was ${e.name})`,writeInvalidSchemaMessage:e=>`instanceOf operand must be a function (was ${mt(e)})`},ow=we({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(e,t)=>{const r=[];for(const n of e){const i=G(n,"root")?n.branches:t.$.parseSchema(n).branches;for(const s of i)if(s.hasKind("morph")){const o=r.findIndex(a=>a.hasKind("morph")&&a.hasEqualMorphs(s));if(o===-1)r.push(s);else{const a=r[o];r[o]=t.$.node("morph",{...a.inner,in:a.rawIn.rawOr(s.rawIn)})}}else r.push(s)}return t.def.ordered||r.sort((n,i)=>n.hash<i.hash?-1:1),r}}},normalize:e=>je(e)?{branches:e}:e,reduce:(e,t)=>{const r=yw(e);if(r.length===1)return r[0];if(r.length!==e.branches.length)return t.node("union",{...e,branches:r},{prereduced:!0})},defaults:{description:e=>e.distribute(t=>t.description,bn),expected:e=>{const t=Gv(e.errors,"propString"),r=Object.entries(t).map(([n,i])=>{const s=[];for(const l of i)Mr(s,l.expected);const o=bn(s),a=i.every(l=>l.actual===i[0].actual)?i[0].actual:ce(i[0].data);return`${n&&`${n} `}must be ${o}${a&&` (was ${a})`}`});return bn(r)},problem:e=>e.expected,message:e=>e.problem[0]==="["?`value at ${e.problem}`:e.problem},intersections:{union:(e,t,r)=>{if(e.isNever!==t.isNever)return q.init("presence",e,t);let n;return e.ordered?(t.ordered&&N(bw(e.expression,t.expression)),n=ul(t.branches,e.branches,r),n instanceof q&&n.invert()):n=ul(e.branches,t.branches,r),n instanceof q?n:r.$.parseSchema(e.ordered||t.ordered?{branches:n,ordered:!0}:{branches:n})},...ui("union",(e,t,r)=>{const n=ul(e.branches,[t],r);return n instanceof q?n:n.length===1?n[0]:r.$.parseSchema(e.ordered?{branches:n,ordered:!0}:{branches:n})})}});class aw extends ci{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const t=[];let r=-1;for(const n of this.branches){if(n.hasKind("unit")&&n.domain==="boolean"){r===-1?(r=t.length,t.push(n)):t[r]=D.intrinsic.boolean;continue}t.push(n)}return t}unitBranches=this.branches.filter(t=>t.rawIn.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?pw(this.discriminant):null;expression=this.distribute(t=>t.nestableExpression,gw);createBranchedOptimisticRootApply(){return(t,r)=>{const n=this.traverseOptimistic(t);if(n!==At)return n;const i=new pn(t,this.$.resolvedConfig);return this.traverseApply(t,i),i.finalize(r)}}get shallowMorphs(){return this.branches.reduce((t,r)=>Mr(t,r.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(t=>t.defaultShortDescription,bn)}innerToJsonSchema(t){if(this.branchGroups.length===1&&this.branchGroups[0].equals(D.intrinsic.boolean))return{type:"boolean"};const r=this.branchGroups.map(n=>n.toJsonSchemaRecurse(t));return r.every(n=>Object.keys(n).length===1&&Da(n,"const"))?{enum:r.map(n=>n.const)}:{anyOf:r}}traverseAllows=(t,r)=>this.branches.some(n=>n.traverseAllows(t,r));traverseApply=(t,r)=>{const n=[];for(let i=0;i<this.branches.length;i++){if(r.pushBranch(),this.branches[i].traverseApply(t,r),!r.hasError())return this.branches[i].includesTransform?r.queuedMorphs.push(...r.popBranch().queuedMorphs):r.popBranch();n.push(r.popBranch().error)}r.errorFromNodeContext({code:"union",errors:n,meta:this.meta})};traverseOptimistic=t=>{for(let r=0;r<this.branches.length;r++){const n=this.branches[r];if(n.traverseAllows(t))return n.contextFreeMorph?n.contextFreeMorph(t):t}return At};compile(t){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(t);let r=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(r=`typeof ${r} === "object" ? ${r} === null ? "null" : "object" : typeof ${r} === "function" ? "object" : typeof ${r}`);const n=this.discriminant.cases,i=Object.keys(n),{optimistic:s}=t;if(t.optimistic=!1,t.block(`switch(${r})`,()=>{for(const u in n){const d=n[u],f=u==="default"?u:`case ${u}`;let p;d===!0?p=s?"data":"true":s?d.rootApplyStrategy==="branchedOptimistic"?p=t.invoke(d,{kind:"Optimistic"}):d.contextFreeMorph?p=`${t.invoke(d)} ? ${Ge(d.contextFreeMorph)}(data) : "${At}"`:p=`${t.invoke(d)} ? data : "${At}"`:p=t.invoke(d),t.line(`${f}: return ${p}`)}return t}),t.traversalKind==="Allows"){t.return(s?`"${At}"`:!1);return}const o=bn(this.discriminant.kind==="domain"?i.map(u=>{const d=u.slice(1,-1);return d==="function"?Gt.object:Gt[d]}):i),a=this.discriminant.path.map(u=>typeof u=="symbol"?Ge(u):JSON.stringify(u)),l=JSON.stringify(o),c=this.discriminant.kind==="domain"?`${fw}[${r}]`:`${hw}(${r})`;t.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${l},
	actual: ${c},
	relativePath: [${a}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(t){if(t.traversalKind==="Apply"){t.const("errors","[]");for(const r of this.branches)t.line("ctx.pushBranch()").line(t.invoke(r)).if("!ctx.hasError()",()=>t.return(r.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");t.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:r}=t;t.optimistic=!1;for(const n of this.branches)t.if(`${t.invoke(n)}`,()=>t.return(r?n.contextFreeMorph?`${Ge(n.contextFreeMorph)}(data)`:"data":!0));t.return(r?`"${At}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const s=he(this.unitBranches,(o,a)=>[`${a.rawIn.serializedValue}`,a.hasKind("morph")?a:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:s}}const t=[];for(let s=0;s<this.branches.length-1;s++){const o=this.branches[s];for(let a=s+1;a<this.branches.length;a++){const l=this.branches[a],c=Jt(o.rawIn,l.rawIn,o.$);if(c instanceof q)for(const u of c){if(!u.kind||u.optional)continue;let d,f;if(u.kind==="domain"){const m=u.l,g=u.r;d=`"${typeof m=="string"?m:m.domain}"`,f=`"${typeof g=="string"?g:g.domain}"`}else if(u.kind==="unit")d=u.l.serializedValue,f=u.r.serializedValue;else continue;const p=t.find(m=>ln(m.path,u.path)&&m.kind===u.kind);p?(p.cases[d]?p.cases[d].branchIndices=Mr(p.cases[d].branchIndices,s):p.cases[d]??={branchIndices:[s],condition:u.l},p.cases[f]?p.cases[f].branchIndices=Mr(p.cases[f].branchIndices,a):p.cases[f]??={branchIndices:[a],condition:u.r}):t.push({kind:u.kind,cases:{[d]:{branchIndices:[s],condition:u.l},[f]:{branchIndices:[a],condition:u.r}},path:u.path})}}}const r=this.ordered?uw(t,this.branches):t;if(!r.length)return null;const n=lw(r,this),i={};for(const s in n.best.cases){const o=cw(n,s);if(o===null){i[s]=!0;continue}if(o.length===this.branches.length)return null;this.ordered&&o.sort((c,u)=>c.originalIndex-u.originalIndex);const a=o.map(c=>c.branch),l=a.length===1?a[0]:this.$.node("union",this.ordered?{branches:a,ordered:!0}:a);Object.assign(this.referencesById,l.referencesById),i[s]=l}if(n.defaultEntries.length){const s=n.defaultEntries.map(o=>o.branch);i.default=this.$.node("union",this.ordered?{branches:s,ordered:!0}:s,{prereduced:!0}),Object.assign(this.referencesById,i.default.referencesById)}return Object.assign(n.location,{cases:i})}}const lw=(e,t)=>{const n=e.sort((o,a)=>o.path.length===a.path.length?Object.keys(a.cases).length-Object.keys(o.cases).length:o.path.length-a.path.length)[0],i={kind:n.kind,path:n.path,optionallyChainedPropString:kh(n.path)},s=t.branches.map((o,a)=>({originalIndex:a,branch:o}));return{best:n,location:i,defaultEntries:s,node:t}},cw=(e,t)=>{const r=e.best.cases[t],n=dw(r.condition,e.location.path,e.node.$);let i=[];const s=[];for(let o=0;o<e.defaultEntries.length;o++){const a=e.defaultEntries[o];if(r.branchIndices.includes(a.originalIndex)){const l=Sh(e.node.branches[a.originalIndex],e.location);l===null?i=null:i?.push({originalIndex:a.originalIndex,branch:l})}else if(a.branch.hasKind("alias")&&n.hasKind("domain")&&n.domain==="object")i?.push(a);else{if(a.branch.rawIn.overlaps(n)){const l=Sh(a.branch,e.location);i?.push({originalIndex:a.originalIndex,branch:l})}s.push(a)}}return e.defaultEntries=s,i},uw=(e,t)=>e.filter(n=>{const i=Object.values(n.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const l=i[a];for(const c of o)for(const u of l)if(c>u&&t[c].overlaps(t[u]))return!1}}return!0}),dw=(e,t,r)=>{let n=e==="undefined"?r.node("unit",{unit:void 0}):e==="null"?r.node("unit",{unit:null}):e==="boolean"?r.units([!0,!1]):e;for(let i=t.length-1;i>=0;i--){const s=t[i];n=r.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...Uv(s).map(o=>({})),n]}:{domain:"object",required:[{key:s,value:n}]})}return n},kh=e=>e.reduce((t,r)=>t+If(r,!0),"data"),fw=Ge(Wv),hw=Ge(ce),Mh={implementation:ow,Node:aw},pw=e=>({kind:e.kind,path:e.path.map(t=>typeof t=="string"?t:fn(t)),cases:he(e.cases,(t,r)=>[t,r===!0?r:r.hasKind("union")&&r.discriminantJson?r.discriminantJson:r.json])}),mw={delimiter:" | ",finalDelimiter:" | "},gw=e=>bn(e,mw),bn=(e,t)=>{const r=t?.delimiter??", ",n=t?.finalDelimiter??" or ";if(e.length===0)return"never";if(e.length===1)return e[0];if(e.length===2&&e[0]==="false"&&e[1]==="true"||e[0]==="true"&&e[1]==="false")return"boolean";const i={},s=e.filter(a=>i[a]?!1:i[a]=!0),o=s.pop();return`${s.join(r)}${s.length?n:""}${o}`},ul=(e,t,r)=>{const n=t.map(()=>[]);for(let s=0;s<e.length;s++){let o={};for(let a=0;a<t.length;a++){if(n[a]===null)continue;if(e[s].equals(t[a])){n[a]=null,o={};break}const l=Oe(e[s],t[a],r);if(!(l instanceof q)){if(l.equals(e[s])){n[a].push(e[s]),o={};break}l.equals(t[a])?n[a]=null:o[a]=l}}for(const a in o)n[a][s]=o[a]}const i=n.flatMap((s,o)=>s?.flatMap(a=>a.branches)??t[o]);return i.length===0?q.init("union",e,t):i},yw=({branches:e,ordered:t})=>{if(e.length<2)return e;const r=e.map(()=>!0);for(let n=0;n<e.length;n++)for(let i=n+1;i<e.length&&r[n]&&r[i];i++){if(e[n].equals(e[i])){r[i]=!1;continue}const s=Jt(e[n].rawIn,e[i].rawIn,e[0].$);s instanceof q||(t||_w(e[n],e[i]),s.equals(e[n].rawIn)?r[n]=!!t:s.equals(e[i].rawIn)&&(r[i]=!1))}return e.filter((n,i)=>r[i])},_w=(e,t)=>{!e.includesTransform&&!t.includesTransform||(ln(e.shallowMorphs,t.shallowMorphs)||N($h(e.expression,t.expression)),ln(e.flatMorphs,t.flatMorphs,{isEqual:(r,n)=>r.propString===n.propString&&(r.node.hasKind("morph")&&n.node.hasKind("morph")?r.node.hasEqualMorphs(n.node):r.node.hasKind("intersection")&&n.node.hasKind("intersection")?r.node.structure?.structuralMorphRef===n.node.structure?.structuralMorphRef:!1)})||N($h(e.expression,t.expression)))},Sh=(e,t)=>e.transform((r,n)=>r==="domain"||r==="unit"?null:n,{shouldTransform:(r,n)=>{const i=kh(n.path);return t.optionallyChainedPropString.startsWith(i)?r.hasKind("domain")&&r.domain==="object"||(r.hasKind("domain")||t.kind==="unit")&&i===t.optionallyChainedPropString?!0:r.children.length!==0&&r.kind!=="index":!1}}),$h=(e,t)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${e}
Right: ${t}`,bw=(e,t)=>`The intersection of two ordered unions is indeterminate:
Left: ${e}
Right: ${t}`,vw=we({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:e=>e instanceof Date?e.toISOString():$r(e)}},normalize:e=>e,defaults:{description:e=>ce(e.unit),problem:({expected:e,actual:t})=>`${e===t?`must be reference equal to ${e} (serialized to the same value)`:`must be ${e} (was ${t})`}`},intersections:{unit:(e,t)=>q.init("unit",e,t),...ui("unit",(e,t)=>{if(t.allows(e.unit))return e;const r=t.hasKind("intersection")?t.basis:t;if(r){const n=r.hasKind("domain")?r:D.intrinsic.object;if(e.domain!==n.domain){const i=e.domain==="undefined"||e.domain==="null"||e.domain==="boolean"?e.domain:D.intrinsic[e.domain];return q.init("domain",i,n)}}return q.init("assignability",e,t.hasKind("intersection")?t.children.find(n=>!n.allows(e.unit)):t)})}});class ww extends ll{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=Ah(this.unit,this.serializedValue);compiledNegation=Ah(this.unit,this.serializedValue,"negated");expression=ce(this.unit);domain=mt(this.unit);get defaultShortDescription(){return this.domain==="object"?Gt.object:this.description}innerToJsonSchema(t){return this.unit===null?{type:"null"}:D.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:t.fallback.unit({code:"unit",base:{},unit:this.unit})}traverseAllows=this.unit instanceof Date?t=>t instanceof Date&&t.toISOString()===this.compiledValue:Number.isNaN(this.unit)?t=>Number.isNaN(t):t=>t===this.unit}const Ch={implementation:vw,Node:ww},Ah=(e,t,r)=>{if(e instanceof Date){const n=`data instanceof Date && data.toISOString() === ${t}`;return r?`!(${n})`:n}return Number.isNaN(e)?`${r?"!":""}Number.isNaN(data)`:`data ${r?"!":"="}== ${t}`},xw=we({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(e,t)=>{const r=t.$.parseSchema(e);if(!r.extends(D.intrinsic.key))return N(Sw(r.expression));const n=r.branches.filter(i=>i.hasKind("unit"));return n.length?N(Mw(n.map(i=>ce(i.unit)))):r}},value:{child:!0,parse:(e,t)=>t.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`[${e.signature.expression}]: ${e.value.description}`},intersections:{index:(e,t,r)=>{if(e.signature.equals(t.signature)){const n=Oe(e.value,t.value,r),i=n instanceof q?D.intrinsic.never.internal:n;return r.$.node("index",{signature:e.signature,value:i})}return e.signature.extends(t.signature)&&e.value.subsumes(t.value)?t:t.signature.extends(e.signature)&&t.value.subsumes(e.value)?e:null}}});class kw extends gn{impliedBasis=D.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=fe(this.value.flatRefs.map(t=>or([this.signature,...t.path],t.node)),or([this.signature],this.value));traverseAllows=(t,r)=>us(t).every(n=>this.signature.traverseAllows(n[0],r)?Ht(n[0],()=>this.value.traverseAllows(n[1],r),r):!0);traverseApply=(t,r)=>{for(const n of us(t))this.signature.traverseAllows(n[0],r)&&Ht(n[0],()=>this.value.traverseApply(n[1],r),r)};_transform(t,r){r.path.push(this.signature);const n=super._transform(t,r);return r.path.pop(),n}compile(){}}const Eh={implementation:xw,Node:kw},Mw=e=>`Index keys ${e.join(", ")} should be specified as named props.`,Sw=e=>`Indexed key definition '${e}' must be a string or symbol`,$w=we({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,t)=>t.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`${e.compiledKey}: ${e.value.description}`,expected:e=>e.missingValueDescription,actual:()=>"missing"},intersections:{required:il,optional:il}});class Cw extends fh{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=bs(this.errorContext)}const Ih={implementation:$w,Node:Cw},Aw=we({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(e,t)=>{if(e.length!==0)return e.map(r=>t.$.parseSchema(r))}},optionals:{child:!0,parse:(e,t)=>{if(e.length!==0)return e.map(r=>t.$.parseSchema(r))}},defaultables:{child:e=>e.map(t=>t[0]),parse:(e,t)=>{if(e.length!==0)return e.map(r=>{const n=t.$.parseSchema(r[0]);return ol(n,r[1],null),[n,r[1]]})},serialize:e=>e.map(t=>[t[0].collapsibleJson,$r(t[1])]),reduceIo:(e,t,r)=>{if(e==="in"){t.optionals=r.map(n=>n[0].rawIn);return}t.prefix=r.map(n=>n[0].rawOut)}},variadic:{child:!0,parse:(e,t)=>t.$.parseSchema(e,t)},minVariadicLength:{parse:e=>e===0?void 0:e},postfix:{child:!0,parse:(e,t)=>{if(e.length!==0)return e.map(r=>t.$.parseSchema(r))}}},normalize:e=>{if(typeof e=="string")return{variadic:e};if("variadic"in e||"prefix"in e||"defaultables"in e||"optionals"in e||"postfix"in e||"minVariadicLength"in e){if(e.postfix?.length){if(!e.variadic)return N(Tw);if(e.optionals?.length||e.defaultables?.length)return N(Th)}return e.minVariadicLength&&!e.variadic?N("minVariadicLength may not be specified without a variadic element"):e}return{variadic:e}},reduce:(e,t)=>{let r=e.minVariadicLength??0;const n=e.prefix?.slice()??[],i=e.defaultables?.slice()??[],s=e.optionals?.slice()??[],o=e.postfix?.slice()??[];if(e.variadic){for(;s[s.length-1]?.equals(e.variadic);)s.pop();if(s.length===0&&i.length===0)for(;n[n.length-1]?.equals(e.variadic);)n.pop(),r++;for(;o[0]?.equals(e.variadic);)o.shift(),r++}else s.length===0&&i.length===0&&n.push(...o.splice(0));if(r!==e.minVariadicLength||e.prefix&&e.prefix.length!==n.length)return t.node("sequence",{...e,prefix:n,defaultables:i,optionals:s,postfix:o,minVariadicLength:r},{prereduced:!0})},defaults:{description:e=>e.isVariadicOnly?`${e.variadic.nestableExpression}[]`:`[${e.tuple.map(r=>r.kind==="defaultables"?`${r.node.nestableExpression} = ${ce(r.default)}`:r.kind==="optionals"?`${r.node.nestableExpression}?`:r.kind==="variadic"?`...${r.node.nestableExpression}[]`:r.node.expression).join(", ")}]`},intersections:{sequence:(e,t,r)=>{const n=di({l:e.tuple,r:t.tuple,disjoint:new q,result:[],fixedVariants:[],ctx:r}),i=n.disjoint.length===0?[n,...n.fixedVariants]:n.fixedVariants;return i.length===0?n.disjoint:i.length===1?r.$.node("sequence",Oh(i[0].result)):r.$.node("union",i.map(s=>({proto:Array,sequence:Oh(s.result)})))}}});class Ew extends gn{impliedBasis=D.intrinsic.Array.internal;tuple=Ow(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(t=>t.kind==="defaultables"||t.kind==="optionals"?(this.defaultablesAndOptionals.push(t.node),!0):t.kind==="prefix");variadicOrPostfix=kr(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return jf(this.flatRefs,this.prevariadic.flatMap((t,r)=>fe(t.node.flatRefs.map(n=>or([`${r}`,...n.path],n.node)),or([`${r}`],t.node)))),jf(this.flatRefs,this.variadicOrPostfix.flatMap(t=>fe(t.flatRefs.map(r=>or([D.intrinsic.nonNegativeIntegerString.internal,...r.path],r.node)),or([D.intrinsic.nonNegativeIntegerString.internal],t)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=Pw(this);defaultValueMorphsReference=this.defaultValueMorphs.length?Ge(this.defaultValueMorphs):void 0;elementAtIndex(t,r){if(r<this.prevariadic.length)return this.tuple[r];const n=t.length-this.postfixLength;return r>=n?{kind:"postfix",node:this.postfix[r-n]}:{kind:"variadic",node:this.variadic??Ce(`Unexpected attempt to access index ${r} on ${this}`)}}traverseAllows=(t,r)=>{for(let n=0;n<t.length;n++)if(!this.elementAtIndex(t,n).node.traverseAllows(t[n],r))return!1;return!0};traverseApply=(t,r)=>{let n=0;for(;n<t.length;n++)Ht(n,()=>this.elementAtIndex(t,n).node.traverseApply(t[n],r),r)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(t){if(this.prefix)for(const[r,n]of this.prefix.entries())t.traverseKey(`${r}`,`data[${r}]`,n);for(const[r,n]of this.defaultablesAndOptionals.entries()){const i=`${r+this.prefixLength}`;t.if(`${i} >= data.length`,()=>t.traversalKind==="Allows"?t.return(!0):t.return()),t.traverseKey(i,`data[${i}]`,n)}if(this.variadic&&(this.postfix&&t.const("firstPostfixIndex",`data.length${this.postfix?`- ${this.postfix.length}`:""}`),t.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>t.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[r,n]of this.postfix.entries()){const i=`firstPostfixIndex + ${r}`;t.traverseKey(i,`data[${i}]`,n)}t.traversalKind==="Allows"&&t.return(!0)}_transform(t,r){r.path.push(D.intrinsic.nonNegativeIntegerString.internal);const n=super._transform(t,r);return r.path.pop(),n}expression=this.description;reduceJsonSchema(t,r){const n=r.target==="draft-07";if(this.prevariadic.length){const i=this.prevariadic.map(s=>{const o=s.node.toJsonSchemaRecurse(r);if(s.kind==="defaultables"){const a=typeof s.default=="function"?s.default():s.default;o.default=D.intrinsic.jsonData.allows(a)?a:r.fallback.defaultValue({code:"defaultValue",base:o,value:a})}return o});n?t.items=i:t.prefixItems=i}if(this.minLength&&(t.minItems=this.minLength),this.variadic){const i=this.variadic.toJsonSchemaRecurse(r);if(n&&this.prevariadic.length?t.additionalItems=i:t.items=i,this.maxLength&&(t.maxItems=this.maxLength),this.postfix){const s=this.postfix.map(o=>o.toJsonSchemaRecurse(r));t=r.fallback.arrayPostfix({code:"arrayPostfix",base:t,elements:s})}}else n?t.additionalItems=!1:t.items=!1,delete t.maxItems;return t}}const Iw={},Pw=e=>{if(!e.defaultables)return[];const t=[];let r="[";const n=e.prefixLength+e.defaultablesLength-1;for(let i=e.prefixLength;i<=n;i++){const[s,o]=e.defaultables[i-e.prefixLength];t.push(ph(i,s,o)),r+=`${i}: ${s.id} = ${$r(o)}, `}return r+="]",Iw[r]??=t},Ph={implementation:Aw,Node:Ew},Ow=e=>{const t=[];if(e.prefix)for(const r of e.prefix)t.push({kind:"prefix",node:r});if(e.defaultables)for(const[r,n]of e.defaultables)t.push({kind:"defaultables",node:r,default:n});if(e.optionals)for(const r of e.optionals)t.push({kind:"optionals",node:r});if(e.variadic&&t.push({kind:"variadic",node:e.variadic}),e.postfix)for(const r of e.postfix)t.push({kind:"postfix",node:r});return t},Oh=e=>e.reduce((t,r)=>(r.kind==="variadic"?t.variadic=r.node:r.kind==="defaultables"?t.defaultables=fe(t.defaultables,[[r.node,r.default]]):t[r.kind]=fe(t[r.kind],r.node),t),{}),Th="A postfix required element cannot follow an optional or defaultable element",Tw="A postfix element requires a variadic element",di=e=>{const[t,...r]=e.l,[n,...i]=e.r;if(!t||!n)return e;const s=r[r.length-1]?.kind==="postfix",o=i[i.length-1]?.kind==="postfix",a=t.kind==="prefix"||n.kind==="prefix"?"prefix":t.kind==="postfix"||n.kind==="postfix"?"postfix":t.kind==="variadic"&&n.kind==="variadic"?"variadic":s||o?"prefix":t.kind==="defaultables"||n.kind==="defaultables"?"defaultables":"optionals";if(t.kind==="prefix"&&n.kind==="variadic"&&o){const d=di({...e,fixedVariants:[],r:i.map(f=>({...f,kind:"prefix"}))});d.disjoint.length===0&&e.fixedVariants.push(d)}else if(n.kind==="prefix"&&t.kind==="variadic"&&s){const d=di({...e,fixedVariants:[],l:r.map(f=>({...f,kind:"prefix"}))});d.disjoint.length===0&&e.fixedVariants.push(d)}const l=Oe(t.node,n.node,e.ctx);if(l instanceof q)if(a==="prefix"||a==="postfix")e.disjoint.push(...l.withPrefixKey(a==="prefix"?e.result.length:`-${r.length+1}`,Nh(t)&&Nh(n)?"required":"optional")),e.result=[...e.result,{kind:a,node:D.intrinsic.never.internal}];else return a==="optionals"||a==="defaultables"?e:di({...e,fixedVariants:[],l:r.map(d=>({...d,kind:"prefix"})),r:r.map(d=>({...d,kind:"prefix"}))});else a==="defaultables"?(t.kind==="defaultables"&&n.kind==="defaultables"&&t.default!==n.default&&N(hh(t.default,n.default)),e.result=[...e.result,{kind:a,node:l,default:t.kind==="defaultables"?t.default:n.kind==="defaultables"?n.default:Ce(`Unexpected defaultable intersection from ${t.kind} and ${n.kind} elements.`)}]):e.result=[...e.result,{kind:a,node:l}];const c=e.l.length,u=e.r.length;return(t.kind!=="variadic"||c>=u&&(n.kind==="variadic"||u===1))&&(e.l=r),(n.kind!=="variadic"||u>=c&&(t.kind==="variadic"||c===1))&&(e.r=i),di(e)},Nh=e=>e.kind==="prefix"||e.kind==="postfix",Rh=e=>t=>{if(t.props.length||t.index){const r=t.index?.map(i=>i[e])??[];for(const i of t.props)r.push(i[e]);t.undeclared&&r.push(`+ (undeclared): ${t.undeclared}`);const n=`{ ${r.join(", ")} }`;return t.sequence?`${n} & ${t.sequence.description}`:n}return t.sequence?.description??"{}"},Nw=Rh("description"),Rw=Rh("expression"),Fh=(e,t,r)=>{const n=e.required?"required":"optional";if(!t.signature.allows(e.key))return null;const i=Jt(e.value,t.value,r);return i instanceof q?n==="optional"?r.node("optional",{key:e.key,value:D.intrinsic.never.internal}):i.withPrefixKey(e.key,e.kind):null},Fw=we({kind:"structure",hasAssociatedError:!1,normalize:e=>e,applyConfig:(e,t)=>!e.undeclared&&t.onUndeclaredKey!=="ignore"?{...e,undeclared:t.onUndeclaredKey}:e,keys:{required:{child:!0,parse:Je("required"),reduceIo:(e,t,r)=>{t.required=fe(t.required,r.map(n=>e==="in"?n.rawIn:n.rawOut))}},optional:{child:!0,parse:Je("optional"),reduceIo:(e,t,r)=>{if(e==="in"){t.optional=r.map(n=>n.rawIn);return}for(const n of r)t[n.outProp.kind]=fe(t[n.outProp.kind],n.outProp.rawOut)}},index:{child:!0,parse:Je("index")},sequence:{child:!0,parse:Je("sequence")},undeclared:{parse:e=>e==="ignore"?void 0:e,reduceIo:(e,t,r)=>{if(r==="reject"){t.undeclared="reject";return}e==="in"?delete t.undeclared:t.undeclared="reject"}}},defaults:{description:Nw},intersections:{structure:(e,t,r)=>{const n={...e.inner},i={...t.inner},s=new q;if(e.undeclared){const l=e.keyof();for(const c of t.requiredKeys)l.allows(c)||s.add("presence",D.intrinsic.never.internal,t.propsByKey[c].value,{path:[c]});i.optional&&(i.optional=i.optional.filter(c=>l.allows(c.key))),i.index&&(i.index=i.index.flatMap(c=>{if(c.signature.extends(l))return c;const u=Jt(l,c.signature,r.$);if(u instanceof q)return[];const d=fl(u,c.value,r.$);return d.required&&(i.required=kr(i.required,d.required)),d.optional&&(i.optional=kr(i.optional,d.optional)),d.index??[]}))}if(t.undeclared){const l=t.keyof();for(const c of e.requiredKeys)l.allows(c)||s.add("presence",e.propsByKey[c].value,D.intrinsic.never.internal,{path:[c]});n.optional&&(n.optional=n.optional.filter(c=>l.allows(c.key))),n.index&&(n.index=n.index.flatMap(c=>{if(c.signature.extends(l))return c;const u=Jt(l,c.signature,r.$);if(u instanceof q)return[];const d=fl(u,c.value,r.$);return d.required&&(n.required=kr(n.required,d.required)),d.optional&&(n.optional=kr(n.optional,d.optional)),d.index??[]}))}const o={};(e.undeclared||t.undeclared)&&(o.undeclared=e.undeclared==="reject"||t.undeclared==="reject"?"reject":"delete");const a=ws({kind:"structure",baseInner:o,l:xs(n),r:xs(i),roots:[],ctx:r});return a instanceof q&&s.push(...a),s.length?s:a}},reduce:(e,t)=>{if(!e.required&&!e.optional)return;const r={};let n=!1;const i=e.optional?[...e.optional]:[];if(e.required)for(let s=0;s<e.required.length;s++){const o=e.required[s];if(o.key in r&&N(Vh(o.key)),r[o.key]=!0,e.index)for(const a of e.index){const l=Fh(o,a,t);if(l instanceof q)return l}}if(e.optional)for(let s=0;s<e.optional.length;s++){const o=e.optional[s];if(o.key in r&&N(Vh(o.key)),r[o.key]=!0,e.index)for(const a of e.index){const l=Fh(o,a,t);if(l instanceof q)return l;l!==null&&(i[s]=l,n=!0)}}if(n)return t.node("structure",{...e,optional:i},{prereduced:!0})}});class Lw extends gn{impliedBasis=D.intrinsic.object.internal;impliedSiblings=this.children.flatMap(t=>t.impliedSiblings??[]);props=kr(this.required,this.optional);propsByKey=he(this.props,(t,r)=>[r.key,r]);propsByKeyReference=Ge(this.propsByKey);expression=Rw(this);requiredKeys=this.required?.map(t=>t.key)??[];optionalKeys=this.optional?.map(t=>t.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let t=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:r}of this.index)t=t.concat(r.branches);return this._keyof=this.$.node("union",t)}map(t){return this.$.node("structure",this.props.flatMap(t).reduce((r,n)=>{const i=this.propsByKey[n.key];if(We(n))return n.kind!=="required"&&n.kind!=="optional"?N(`Map result must have kind "required" or "optional" (was ${n.kind})`):(r[n.kind]=fe(r[n.kind],n),r);const s=n.kind??i?.kind??"required",o=he(n,(a,l)=>a in sl.implementation.keys?[a,l]:[]);return r[s]=fe(r[s],this.$.node(s,o)),r},{}))}assertHasKeys(t){const r=t.filter(n=>!$s(n,this.keyof()));if(r.length)return N(Dh(this.expression,r))}get(t,...r){let n,i=!1;const s=Bw(t);if((typeof s=="string"||typeof s=="symbol")&&this.propsByKey[s]&&(n=this.propsByKey[s].value,i=this.propsByKey[s].required),this.index)for(const a of this.index)$s(s,a.signature)&&(n=n?.and(a.value)??a.value);if(this.sequence&&$s(s,D.intrinsic.nonNegativeIntegerString))if(G(s,"root"))this.sequence.variadic&&(n=n?.and(this.sequence.element)??this.sequence.element);else{const a=Number.parseInt(s);if(a<this.sequence.prevariadic.length){const l=this.sequence.prevariadic[a].node;n=n?.and(l)??l,i||=a<this.sequence.prefixLength}else if(this.sequence.variadic){const l=this.$.node("union",this.sequence.variadicOrPostfix);n=n?.and(l)??l}}if(!n)return this.sequence?.variadic&&G(s,"root")&&s.extends(D.intrinsic.number)?N(qw(s.expression,this.sequence.expression)):N(Dh(this.expression,[s]));const o=n.get(...r);return i?o:o.or(D.intrinsic.undefined)}pick(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("pick",t))}omit(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("omit",t))}optionalize(){const{required:t,...r}=this.inner;return this.$.node("structure",{...r,optional:this.props.map(n=>n.hasKind("required")?this.$.node("optional",n.inner):n)})}require(){const{optional:t,...r}=this.inner;return this.$.node("structure",{...r,required:this.props.map(n=>n.hasKind("optional")?{key:n.key,value:n.value}:n)})}merge(t){const r=this.filterKeys("omit",[t.keyof()]);return t.required&&(r.required=fe(r.required,t.required)),t.optional&&(r.optional=fe(r.optional,t.optional)),t.index&&(r.index=fe(r.index,t.index)),t.sequence&&(r.sequence=t.sequence),t.undeclared?r.undeclared=t.undeclared:delete r.undeclared,this.$.node("structure",r)}filterKeys(t,r){const n=Of(this.inner),i=s=>{const o=r.some(a=>$s(s,a));return t==="pick"?o:!o};return n.required&&(n.required=n.required.filter(s=>i(s.key))),n.optional&&(n.optional=n.optional.filter(s=>i(s.key))),n.index&&(n.index=n.index.filter(s=>i(s.signature))),n}traverseAllows=(t,r)=>this._traverse("Allows",t,r);traverseApply=(t,r)=>this._traverse("Apply",t,r);_traverse=(t,r,n)=>{const i=n?.currentErrorCount??0;for(let s=0;s<this.props.length;s++)if(t==="Allows"){if(!this.props[s].traverseAllows(r,n))return!1}else if(this.props[s].traverseApply(r,n),n.failFast&&n.currentErrorCount>i)return!1;if(this.sequence){if(t==="Allows"){if(!this.sequence.traverseAllows(r,n))return!1}else if(this.sequence.traverseApply(r,n),n.failFast&&n.currentErrorCount>i)return!1}if(this.index||this.undeclared==="reject"){const s=Object.keys(r);s.push(...Object.getOwnPropertySymbols(r));for(let o=0;o<s.length;o++){const a=s[o];if(this.index){for(const l of this.index)if(l.signature.traverseAllows(a,n)){if(t==="Allows"){if(!Ht(a,()=>l.value.traverseAllows(r[a],n),n))return!1}else if(Ht(a,()=>l.value.traverseApply(r[a],n),n),n.failFast&&n.currentErrorCount>i)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(a)&&(t==="Allows"||(n.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[a],meta:this.meta}),n.failFast)))return!1}}return this.structuralMorph&&n&&!n.hasError()&&n.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(t=>t.hasDefault())??[])}declaresKey=t=>t in this.propsByKey||this.index?.some(r=>r.signature.allows(t))||this.sequence!==void 0&&D.intrinsic.nonNegativeIntegerString.allows(t);_compileDeclaresKey(t){const r=[];if(this.props.length&&r.push(`k in ${this.propsByKeyReference}`),this.index)for(const n of this.index)r.push(t.invoke(n.signature,{kind:"Allows",arg:"k"}));return this.sequence&&r.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),r.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",Vw(this))}structuralMorphRef=this.structuralMorph&&Ge(this.structuralMorph);compile(t){t.traversalKind==="Apply"&&t.initializeErrorCount();for(const r of this.props)t.check(r),t.traversalKind==="Apply"&&t.returnIfFailFast();if(this.sequence&&(t.check(this.sequence),t.traversalKind==="Apply"&&t.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(t.const("keys","Object.keys(data)"),t.line("keys.push(...Object.getOwnPropertySymbols(data))"),t.for("i < keys.length",()=>this.compileExhaustiveEntry(t))),t.traversalKind==="Allows")return t.return(!0);this.structuralMorphRef&&t.if("ctx && !ctx.hasError()",()=>(t.line("ctx.queueMorphs(["),zw(t,this),t.line("])")))}compileExhaustiveEntry(t){if(t.const("k","keys[i]"),this.index)for(const r of this.index)t.if(`${t.invoke(r.signature,{arg:"k",kind:"Allows"})}`,()=>t.traverseKey("k","data[k]",r.value));return this.undeclared==="reject"&&t.if(`!(${this._compileDeclaresKey(t)})`,()=>t.traversalKind==="Allows"?t.return(!1):t.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>t.return())),t}reduceJsonSchema(t,r){switch(t.type){case"object":return this.reduceObjectJsonSchema(t,r);case"array":const n=this.sequence?.reduceJsonSchema(t,r)??t;return this.props.length||this.index?r.fallback.arrayObject({code:"arrayObject",base:n,object:this.reduceObjectJsonSchema({type:"object"},r)}):n;default:return Ie.throwInternalOperandError("structure",t)}}reduceObjectJsonSchema(t,r){if(this.props.length){t.properties={};for(const n of this.props){const i=n.value.toJsonSchemaRecurse(r);if(typeof n.key=="symbol"){r.fallback.symbolKey({code:"symbolKey",base:t,key:n.key,value:i,optional:n.optional});continue}if(n.hasDefault()){const s=typeof n.default=="function"?n.default():n.default;i.default=D.intrinsic.jsonData.allows(s)?s:r.fallback.defaultValue({code:"defaultValue",base:i,value:s})}t.properties[n.key]=i}this.requiredKeys.length&&t.properties&&(t.required=this.requiredKeys.filter(n=>typeof n=="string"&&n in t.properties))}if(this.index)for(const n of this.index){const i=n.value.toJsonSchemaRecurse(r);if(n.signature.equals(D.intrinsic.string)){t.additionalProperties=i;continue}for(const s of n.signature.branches){if(!s.extends(D.intrinsic.string)){t=r.fallback.symbolKey({code:"symbolKey",base:t,key:null,value:i,optional:!1});continue}let o={type:"string"};if(s.hasKind("morph")&&(o=r.fallback.morph({code:"morph",base:s.rawIn.toJsonSchemaRecurse(r),out:s.rawOut.toJsonSchemaRecurse(r)})),!s.hasKind("intersection"))return Ce(`Unexpected index branch kind ${s.kind}.`);const{pattern:a}=s.inner;if(a){const l=Object.assign(o,{pattern:a[0].rule});for(let c=1;c<a.length;c++)o=r.fallback.patternIntersection({code:"patternIntersection",base:l,pattern:a[c].rule});t.patternProperties??={},t.patternProperties[l.pattern]=i}}}return this.undeclared&&!t.additionalProperties&&(t.additionalProperties=!1),t}}const dl={},Dw=e=>{let t="";for(let r=0;r<e.defaultable.length;r++)t+=e.defaultable[r].defaultValueMorphRef;if(e.sequence?.defaultValueMorphsReference&&(t+=e.sequence?.defaultValueMorphsReference),e.undeclared==="delete"){if(t+="delete !(",e.required)for(const r of e.required)t+=r.compiledKey+" | ";if(e.optional)for(const r of e.optional)t+=r.compiledKey+" | ";if(e.index)for(const r of e.index)t+=r.signature.id+" | ";if(e.sequence)if(e.sequence.maxLength===null)t+=W.nonNegativeIntegerString.id;else for(let r=0;r<e.sequence.tuple.length;r++)t+=r+" | ";t+=")"}return t},Vw=e=>{const t=Dw(e);if(!t)return;if(dl[t])return dl[t];const r=(n,i)=>{for(let s=0;s<e.defaultable.length;s++)e.defaultable[s].key in n||e.defaultable[s].defaultValueMorph(n,i);if(e.sequence?.defaultables)for(let s=n.length-e.sequence.prefixLength;s<e.sequence.defaultables.length;s++)e.sequence.defaultValueMorphs[s](n,i);if(e.undeclared==="delete")for(const s in n)e.declaresKey(s)||delete n[s];return n};return dl[t]=r},zw=(e,t)=>{const n=`(data${t.defaultable.some(i=>i.defaultValueMorph.length===2)||t.sequence?.defaultValueMorphs.some(i=>i.length===2)?", ctx":""})`;return e.block(`${n} => `,i=>{for(let s=0;s<t.defaultable.length;s++){const{serializedKey:o,defaultValueMorphRef:a}=t.defaultable[s];i.if(`!(${o} in data)`,l=>l.line(`${a}${n}`))}return t.sequence?.defaultables&&i.for(`i < ${t.sequence.defaultables.length}`,s=>s.set("data[i]",5),`data.length - ${t.sequence.prefixLength}`),t.undeclared==="delete"&&i.forIn("data",s=>s.if(`!(${t._compileDeclaresKey(s)})`,o=>o.line("delete data[k]"))),i.return("data")})},Lh={implementation:Fw,Node:Lw},Bw=e=>(G(e,"root")&&e.hasKind("unit")&&(e=e.unit),typeof e=="number"&&(e=`${e}`),e),qw=(e,t)=>`${e} is not allowed as an array index on ${t}. Use the 'nonNegativeIntegerString' keyword instead.`,fl=(e,t,r)=>{const[n,i]=jv(e.branches,o=>o.hasKind("unit"));if(!n.length)return{index:r.node("index",{signature:e,value:t})};const s={};for(const o of n){const a=r.node("required",{key:o.unit,value:t});s[a.kind]=fe(s[a.kind],a)}return i.length&&(s.index=r.node("index",{signature:i,value:t})),s},jw=e=>G(e,"root")?e.expression:ce(e),Dh=(e,t)=>`Key${t.length===1?"":"s"} ${t.map(jw).join(", ")} ${t.length===1?"does":"do"} not exist on ${e}`,Vh=e=>`Duplicate key ${fn(e)}`,As={...I1,alias:al.implementation,domain:cl.implementation,unit:Ch.implementation,proto:Cs.implementation,union:Mh.implementation,morph:xh.implementation,intersection:vh.implementation,divisor:Jf.implementation,pattern:ah.implementation,predicate:Hf.implementation,required:Ih.implementation,optional:sl.implementation,index:Eh.implementation,sequence:Ph.implementation,structure:Lh.implementation};D.defaultConfig=t0(Object.assign(he(As,(e,t)=>[e,t.defaults]),{jitless:a0(),clone:i0,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:Ie.defaultConfig})),D.resolvedConfig=Za(D.defaultConfig,D.config);const Uw={...P1,alias:al.Node,domain:cl.Node,unit:Ch.Node,proto:Cs.Node,union:Mh.Node,morph:xh.Node,intersection:vh.Node,divisor:Jf.Node,pattern:ah.Node,predicate:Hf.Node,required:Ih.Node,optional:sl.Node,index:Eh.Node,sequence:Ph.Node,structure:Lh.Node};class hl extends Qv{get[Wt](){return"module"}}const zh=(e,t)=>new hl(he(e,(r,n)=>[r,G(n,"module")?zh(n,t):t.bindReference(n)])),Kw=e=>je(e)?e:"branches"in e&&je(e.branches)?e.branches:void 0,Gw=(e,t)=>N(`Node of kind ${t} is not valid as a ${e} definition`),Bh=e=>`#${e} duplicates public alias ${e}`,pl={};D.ambient??={};let qh;const jh="function $",Ww=e=>Uh(e,Kh(e)),Uh=(e,t)=>{const r=t.write(jh,4),n=t.compile()();for(const i of e)i.precompilation||(i.traverseAllows=n[`${i.id}Allows`].bind(n),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=n[`${i.id}Apply`].bind(n),n[`${i.id}Optimistic`]&&(i.traverseOptimistic=n[`${i.id}Optimistic`].bind(n)),i.precompilation=r)},Kh=e=>new Ef().return(e.reduce((t,r)=>{const n=new Ja({kind:"Allows"}).indent();r.compile(n);const i=n.write(`${r.id}Allows`),s=new Ja({kind:"Apply"}).indent();r.compile(s);const o=s.write(`${r.id}Apply`),a=`${t}${i},
${o},
`;if(!r.hasKind("union"))return a;const l=new Ja({kind:"Allows",optimistic:!0}).indent();r.compile(l);const c=l.write(`${r.id}Optimistic`);return`${a}${c},
`},`{
`)+"}");class Gh{config;resolvedConfig;name;get[Wt](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(t,r){this.config=Za(D.config,r),this.resolvedConfig=Za(D.resolvedConfig,r),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(pl).length}`,this.name in pl&&N(`A Scope already named ${this.name} already exists`),pl[this.name]=this;const n=Object.entries(t).map(i=>this.preparseOwnAliasEntry(...i));for(const[i,s]of n){let o=i;if(i[0]==="#"?(o=i.slice(1),o in this.aliases&&N(Bh(o)),this.aliases[o]=s):(o in this.aliases&&N(Bh(i)),this.aliases[o]=s,this.exportedNames.push(o)),!G(s,"module")&&!G(s,"generic")&&!ds(s)){const a=this.preparseOwnDefinitionFormat(s,{alias:o});this.resolutions[o]=G(a,"root")?this.bindReference(a):this.createParseContext(a).id}}qh??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[qh.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=D.intrinsic?he(D.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(t){return t}generic=(...t)=>{const r=this;return(n,i)=>new ks(t,i?new Wf(n):n,r,r,i??null)};units=(t,r)=>{const n=[];for(const s of t)n.includes(s)||n.push(s);const i=n.map(s=>this.node("unit",{unit:s},r));return this.node("union",i,{...r,prereduced:!0})};lazyResolutions=[];lazilyResolve(t,r){const n=this.node("alias",{reference:r??"synthetic",resolve:t},{prereduced:!0});return this.resolved||this.lazyResolutions.push(n),n}schema=(t,r)=>this.finalize(this.parseSchema(t,r));parseSchema=(t,r)=>this.node(Ms(t),t,r);preparseNode(t,r,n){let i=typeof t=="string"?t:Ms(r,t);if(We(r)&&r.kind===i)return r;if(i==="alias"&&!n?.prereduced){const{reference:a}=al.implementation.normalize(r,this);if(a.startsWith("$")){const l=this.resolveRoot(a.slice(1));r=l,i=l.kind}}else if(i==="union"&&Sr(r,"object")){const a=Kw(r);a?.length===1&&(r=a[0],i=Ms(r))}if(We(r)&&r.kind===i)return r;const o=As[i].normalize?.(r,this)??r;return We(o)?o.kind===i?o:Gw(i,o.kind):{...n,$:this,kind:i,def:o,prefix:n.alias??i}}bindReference(t){let r;return We(t)?r=t.$===this?t:new t.constructor(t.attachments,this):r=t.$===this?t:new ks(t.params,t.bodyDef,t.$,this,t.hkt),this.resolved||Object.assign(this.referencesById,r.referencesById),r}resolveRoot(t){return this.maybeResolveRoot(t)??N(Qh(t))}maybeResolveRoot(t){const r=this.maybeResolve(t);if(!G(r,"generic"))return r}maybeResolveSubalias(t){return ml(this.aliases,t)??ml(this.ambient,t)}get ambient(){return D.ambient}maybeResolve(t){const r=this.resolutions[t];if(r){if(typeof r!="string")return this.bindReference(r);const i=at[r];if(G(i,"root"))return this.resolutions[t]=i;if(G(i,"context")){if(i.phase==="resolving")return this.node("alias",{reference:`$${t}`},{prereduced:!0});if(i.phase==="resolved")return Ce(`Unexpected resolved context for was uncached by its scope: ${ce(i)}`);i.phase="resolving";const s=this.bindReference(this.parseOwnDefinitionFormat(i.def,i));return i.phase="resolved",at[s.id]=s,at[i.id]=s,this.resolutions[t]=s}return Ce(`Unexpected nodesById entry for ${r}: ${ce(i)}`)}let n=this.aliases[t]??this.ambient?.[t];return n?(n=this.normalizeRootScopeValue(n),G(n,"generic")?this.resolutions[t]=this.bindReference(n):G(n,"module")?(n.root||N(Zh(t)),this.resolutions[t]=this.bindReference(n.root)):this.resolutions[t]=this.parse(n,{alias:t})):this.maybeResolveSubalias(t)}createParseContext(t){const r=t.id??uh(t.prefix);return at[r]=Object.assign(t,{[Wt]:"context",$:this,id:r,phase:"unresolved"})}traversal(t){return new pn(t,this.resolvedConfig)}import(...t){return new hl(he(this.export(...t),(r,n)=>[`#${r}`,n]))}precompilation;_exportedResolutions;_exports;export(...t){if(!this._exports){this._exports={};for(const n of this.exportedNames){const i=this.aliases[n];this._exports[n]=G(i,"module")?zh(i,this):Hh(this.maybeResolve(n))}for(const n of this.lazyResolutions)n.resolution;if(this._exportedResolutions=Yh(this,this._exports),this._json=Jh(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const n=Kh(this.references);this.precompilation=n.write(jh,4),Uh(this.references,n)}this.resolved=!0}const r=t.length?t:this.exportedNames;return new hl(he(r,(n,i)=>[i,this._exports[i]]))}resolve(t){return this.export()[t]}node=(t,r,n={})=>{const i=this.preparseNode(t,r,n);if(We(i))return this.bindReference(i);const s=this.createParseContext(i),o=dh(s),a=this.bindReference(o);return at[s.id]=a};parse=(t,r={})=>this.finalize(this.parseDefinition(t,r));parseDefinition(t,r={}){if(G(t,"root"))return this.bindReference(t);const n=this.preparseOwnDefinitionFormat(t,r);if(G(n,"root"))return this.bindReference(n);const i=this.createParseContext(n);at[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(t,i));return s.isCyclic&&(s=F1(s,i.id)),at[i.id]=s,s}finalize(t){return Hh(t),!t.precompilation&&!this.resolvedConfig.jitless&&Ww(t.references),t}}class Wh extends Gh{parseOwnDefinitionFormat(t,r){return dh(r)}preparseOwnDefinitionFormat(t,r){return this.preparseNode(Ms(t),t,r)}preparseOwnAliasEntry(t,r){return[t,r]}normalizeRootScopeValue(t){return t}}const Hh=e=>{const t=e.references.filter(r=>r.hasKind("alias"));for(const r of t){Object.assign(r.referencesById,r.resolution.referencesById);for(const n of e.references)r.id in n.referencesById&&Object.assign(n.referencesById,r.referencesById)}return e},Jh=e=>he(e,(t,r)=>[t,G(r,"root")||G(r,"generic")?r.json:G(r,"module")?Jh(r):Ce(`Unexpected resolution ${ce(r)}`)]),ml=(e,t)=>{const r=t.indexOf(".");if(r===-1)return;const n=t.slice(0,r),i=e[n];if(i===void 0)return;if(!G(i,"module"))return N(Hw(n));const s=t.slice(r+1),o=i[s];if(o===void 0)return ml(i,s);if(G(o,"root")||G(o,"generic"))return o;if(G(o,"module"))return o.root??N(Zh(t));Ce(`Unexpected resolution for alias '${t}': ${ce(o)}`)},gl=(e,t)=>new Wh(e,t),fi=new Wh({}),Yh=(e,t)=>{const r={};for(const n in t){const i=t[n];if(G(i,"module")){const s=Yh(e,i),o=he(s,(a,l)=>[`${n}.${a}`,l]);Object.assign(r,o)}else G(i,"root")||G(i,"generic")?r[n]=i:Ce(`Unexpected scope resolution ${ce(i)}`)}return r},Qh=e=>`'${e}' is unresolvable`,Hw=e=>`'${e}' must reference a module to be accessed using dot syntax`,Zh=e=>`Reference to submodule '${e}' must specify an alias`;fi.export();const pe=fi.schema,yl=fi.node;fi.defineSchema;const Yt=fi.generic,Xh="^(?:0|[1-9]\\d*)$",Jw=new RegExp(Xh);Ge(Jw);const ep=gl({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();D.intrinsic={...ep};const tp=gl({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:Xh}},{prereducedAliases:!0}).export();Object.assign(D.intrinsic,tp);const Yw=gl({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),W={...ep,...tp,...Yw,emptyStructure:yl("structure",{},{prereduced:!0})};D.intrinsic={...W};const rp=((e,t)=>new RegExp(e,t));Object.assign(rp,{as:rp});const Qw=e=>typeof e=="string"&&e[0]==="d"&&(e[1]==="'"||e[1]==='"')&&e[e.length-1]===e[1],np=e=>e.toString()!=="Invalid Date",Zw=e=>e.slice(2,-1),ip=e=>`'${e}' could not be parsed by the Date constructor`,Xw=(e,t)=>ex(e,t),ex=(e,t)=>{const r=new Date(e);if(np(r))return r;const n=S0(e);if(n!==void 0){const i=new Date(n);if(np(i))return i}return t?N(t===!0?ip(e):t):void 0},tx=pe({proto:"Array",sequence:"string",required:{key:"groups",value:["object",{unit:void 0}]}}),_l=(e,t)=>{const r=e.scanner.shiftUntilEscapable(ix[ap[t]]);if(e.scanner.lookahead==="")return e.error(ox(r,t));if(e.scanner.shift(),t in op){let n;try{n=new RegExp(r)}catch(i){N(String(i))}e.root=e.ctx.$.node("intersection",{domain:"string",pattern:r},{prereduced:!0}),t==="x/"&&(e.root=e.ctx.$.node("morph",{in:e.root,morphs:i=>n.exec(i),declaredOut:tx}))}else if(Ct(t,sp))e.root=e.ctx.$.node("unit",{unit:r});else{const n=Xw(r,ip(r));e.root=e.ctx.$.node("unit",{meta:r,unit:n})}},sp={"'":1,'"':1},rx={"/":1,"'":1,'"':1},nx={"d'":"'",'d"':'"',"'":"'",'"':'"'},op={"/":"/","x/":"/"},ap={...nx,...op},ix={"'":e=>e.lookahead==="'",'"':e=>e.lookahead==='"',"/":e=>e.lookahead==="/"},sx={'"':"double-quote","'":"single-quote","/":"forward slash"},ox=(e,t)=>`${t}${e} requires a closing ${sx[ap[t]]}`,ax=e=>`Private type references should not include '#'. Use '${e}' instead.`,lp="Optional definitions like 'string?' are only valid as properties in an object or tuple",cp="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",vn={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...fs},lx=(e,t)=>e===">"?t[0]==="="?t[1]==="=":t.trimStart()===""||Ct(t.trimStart()[0],vn):e==="="?t[0]!=="=":e===","||e==="?",cx=(e,t,r)=>up(e,t,r,[]),up=(e,t,r,n)=>{const i=r.parseUntilFinalizer();return n.push(i.root),i.finalizer===">"?n.length!==t.params.length?r.error(dp(e,t.names,n.map(s=>s.expression))):n:i.finalizer===","?up(e,t,r,n):i.error(Cf(">"))},dp=(e,t,r)=>`${e}<${t.join(", ")}> requires exactly ${t.length} args (got ${r.length}${r.length===0?"":`: ${r.join(", ")}`})`,bl=e=>{const t=e.scanner.shiftUntilLookahead(vn);t==="keyof"?e.addPrefix("keyof"):e.root=dx(e,t)},ux=(e,t,r)=>{if(r.scanner.shiftUntilNonWhitespace(),r.scanner.shift()!=="<")return r.error(dp(e,t.names,[]));const i=cx(e,t,r);return t(...i)},dx=(e,t)=>fx(e,t)??hx(e,t)??e.error(t===""?e.scanner.lookahead==="#"?ax(e.shiftedBy(1).scanner.shiftUntilLookahead(vn)):fp(e):Qh(t)),fx=(e,t)=>{if(e.ctx.args?.[t]){const n=e.ctx.args[t];return typeof n!="string"?n:e.ctx.$.node("alias",{reference:n},{prereduced:!0})}const r=e.ctx.$.maybeResolve(t);if(G(r,"root"))return r;if(r!==void 0)return G(r,"generic")?ux(t,r,e):N(`Unexpected resolution ${ce(r)}`)},hx=(e,t)=>{const r=$0(t);if(r!==void 0)return e.ctx.$.node("unit",{unit:r});const n=A0(t);if(n!==void 0)return e.ctx.$.node("unit",{unit:n})},fp=e=>{const t=e.previousOperator();return t?hp(t,e.scanner.unscanned):px(e.scanner.unscanned)},hp=(e,t="")=>`Token '${e}' requires a right operand${t?` before '${t}'`:""}`,px=e=>`Expected an expression${e?` before '${e}'`:""}`,pp=e=>e.scanner.lookahead===""?e.error(fp(e)):e.scanner.lookahead==="("?e.shiftedBy(1).reduceGroupOpen():e.scanner.lookaheadIsIn(rx)?_l(e,e.scanner.shift()):e.scanner.lookaheadIsIn(fs)?pp(e.shiftedBy(1)):e.scanner.lookahead==="d"?e.scanner.nextLookahead in sp?_l(e,`${e.scanner.shift()}${e.scanner.shift()}`):bl(e):e.scanner.lookahead==="x"&&e.scanner.nextLookahead==="/"?e.shiftedBy(2)&&_l(e,"x/"):bl(e),mx={">":!0,">=":!0},gx={"<":!0,"<=":!0},Es={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},yx=(e,t)=>`Left bounds are only valid when paired with right bounds (try ...${t}${e})`,mp=e=>`Left-bounded expressions must specify their limits using < or <= (was ${e})`,_x=(e,t,r,n)=>`An expression may have at most one left bound (parsed ${e}${Es[t]}, ${r}${Es[n]})`,bx=(e,t)=>{const r=wx(e,t);if(e.root.hasKind("unit")){if(typeof e.root.unit=="number"){e.reduceLeftBound(e.root.unit,r),e.unsetRoot();return}if(e.root.unit instanceof Date){const n=`d'${e.root.description??e.root.unit.toISOString()}'`;e.unsetRoot(),e.reduceLeftBound(n,r);return}}return kx(e,r)},vx={"<":1,">":1,"=":1},wx=(e,t)=>e.scanner.lookaheadIs("=")?`${t}${e.scanner.shift()}`:t,gp=(e,t,r,n)=>r.extends(D.intrinsic.number)?typeof t!="number"?N(vl(e,t,n)):e==="=="?["min","max"]:e[0]===">"?["min"]:["max"]:r.extends(D.intrinsic.lengthBoundable)?typeof t!="number"?N(vl(e,t,n)):e==="=="?["exactLength"]:e[0]===">"?["minLength"]:["maxLength"]:r.extends(D.intrinsic.Date)?e==="=="?["after","before"]:e[0]===">"?["after"]:["before"]:N(m1(r.expression)),xx=e=>({rule:Qw(e.limit)?Zw(e.limit):e.limit,exclusive:e.comparator.length===1}),kx=(e,t)=>{const r=e.unsetRoot(),n=e.scanner.location;e.parseOperand();const i=e.unsetRoot(),s=e.scanner.sliceChars(n,e.scanner.location);if(e.root=r,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return e.error(vl(t,s,"right"));const o=i.unit,a=t.length===1,l=gp(t,typeof o=="number"?o:s,r,"right");for(const u of l)e.constrainRoot(u,t==="=="?{rule:o}:{rule:o,exclusive:a});if(!e.branches.leftBound)return;if(!Ct(t,gx))return e.error(mp(t));const c=gp(e.branches.leftBound.comparator,e.branches.leftBound.limit,r,"left");e.constrainRoot(c[0],xx(e.branches.leftBound)),e.branches.leftBound=null},vl=(e,t,r)=>`Comparator ${r==="left"?Es[e]:e} must be ${r==="left"?"preceded":"followed"} by a corresponding literal (was ${t})`,Mx=e=>{e.scanner.shiftUntilNonWhitespace();const t=e.scanner.shiftUntilLookahead(vn);e.root=e.root.brand(t)},Sx=e=>{e.scanner.shiftUntilNonWhitespace();const t=e.scanner.shiftUntilLookahead(vn),r=C0(t,{errorOnFail:yp(t)});r===0&&e.error(yp(0)),e.root=e.root.constrain("divisor",r)},yp=e=>`% operator must be followed by a non-zero integer literal (was ${e})`,_p=e=>{const t=e.scanner.shift();return t===""?e.finalize(""):t==="["?e.scanner.shift()==="]"?e.setRoot(e.root.array()):e.error($x):t==="|"?e.scanner.lookahead===">"?e.shiftedBy(1).pushRootToBranch("|>"):e.pushRootToBranch(t):t==="&"?e.pushRootToBranch(t):t===")"?e.finalizeGroup():lx(t,e.scanner.unscanned)?e.finalize(t):Ct(t,vx)?bx(e,t):t==="%"?Sx(e):t==="#"?Mx(e):t in fs?_p(e):e.error(wl(t))},wl=(e,t="")=>`'${e}' is not allowed here${t&&` (should be ${t})`}`,$x="Missing expected ']'",Cx=e=>{const t=e.unsetRoot();e.parseOperand();const r=e.unsetRoot();if(!r.hasKind("unit"))return e.error(Ax(r.expression));const n=r.unit instanceof Date?()=>new Date(r.unit):r.unit;return[t,"=",n]},Ax=e=>`Default value '${e}' must be a literal value`,bp=(e,t)=>{const r=t.$.maybeResolveRoot(e);if(r)return r;if(e.endsWith("[]")){const s=t.$.maybeResolveRoot(e.slice(0,-2));if(s)return s.array()}const n=new Is(new $f(e),t),i=Ex(n);return n.finalizer===">"&&N(wl(">")),i},Ex=e=>{e.parseOperand();let t=xl(e).root;return t?(e.finalizer==="="?t=Cx(e):e.finalizer==="?"&&(t=[t,"?"]),e.scanner.shiftUntilNonWhitespace(),e.scanner.lookahead&&N(wl(e.scanner.lookahead)),t):Ce(`Root was unexpectedly unset after parsing string '${e.scanner.scanned}'`)},xl=e=>{for(;e.finalizer===void 0;)Ix(e);return e},Ix=e=>e.hasRoot()?e.parseOperator():e.parseOperand();class Is{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(t,r){this.scanner=t,this.ctx=r}error(t){return N(t)}hasRoot(){return this.root!==void 0}setRoot(t){this.root=t}unsetRoot(){const t=this.root;return this.root=void 0,t}constrainRoot(...t){this.root=this.root.constrain(t[0],t[1])}finalize(t){if(this.groups.length)return this.error(Cf(")"));this.finalizeBranches(),this.finalizer=t}reduceLeftBound(t,r){const n=Es[r];if(!Ct(n,mx))return this.error(mp(r));if(this.branches.leftBound)return this.error(_x(this.branches.leftBound.limit,this.branches.leftBound.comparator,t,n));this.branches.leftBound={comparator:n,limit:t}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const t=this.groups.pop();if(!t)return this.error(N0(")",this.scanner.unscanned));this.branches=t}addPrefix(t){this.branches.prefixes.push(t)}applyPrefixes(){for(;this.branches.prefixes.length;){const t=this.branches.prefixes.pop();this.root=t==="keyof"?this.root.keyof():Ce(`Unexpected prefix '${t}'`)}}pushRootToBranch(t){this.assertRangeUnset(),this.applyPrefixes();const r=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(r)??r,t!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,t!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return xl(new Is(this.scanner,this.ctx))}parseOperator(){return _p(this)}parseOperand(){return pp(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(yx(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes[this.branches.prefixes.length-1]??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedBy(t){return this.scanner.jumpForward(t),this}}const Px="An empty string is not a valid generic parameter name",kl=(e,t,r)=>{e.shiftUntilNonWhitespace();const n=e.shiftUntilLookahead(vn);return n===""?e.lookahead===""&&t.length?t:N(Px):(e.shiftUntilNonWhitespace(),Ox(e,n,t,r))},vp="extends ",Ox=(e,t,r,n)=>{if(e.shiftUntilNonWhitespace(),e.unscanned.startsWith(vp))e.jumpForward(vp.length);else return e.lookahead===","&&e.shift(),r.push(t),kl(e,r,n);const i=xl(new Is(e,n));return r.push([t,i.root]),kl(e,r,n)};class Tx extends nr{constructor(t){const r={$:t,raw:t.fn};super((...n)=>{const i=n.indexOf(":"),s=i===-1?n.length-1:i-1,o=n.slice(0,s+1),a=t.parse(o).assertHasKind("intersection");let l=t.intrinsic.unknown;if(i!==-1){if(i!==n.length-2)return N(Rx);l=t.parse(n[i+1])}return c=>new Nx(c,a,l)},{attach:r})}}class Nx extends nr{raw;params;returns;expression;constructor(t,r,n){const i=`typed ${t.name}`,s={[i]:(...a)=>{const l=r.assert(a),c=t(...l);return n.assert(c)}}[i];super(s),this.raw=t,this.params=r,this.returns=n;let o=r.expression;o[0]==="["&&o[o.length-1]==="]"?o=o.slice(1,-1):o.endsWith("[]")&&(o=`...${o}`),this.expression=`(${o}) => ${n?.expression??"unknown"}`}}const Rx=`":" must be followed by exactly one return type e.g:
fn("string", ":", "number")(s => s.length)`;class Fx extends nr{$;constructor(t){super((...r)=>new Ps(t)(...r),{bind:t}),this.$=t}in(t){return new Ps(this.$,t===void 0?void 0:this.$.parse(t))}at(t,r){return new Ps(this.$).at(t,r)}case(t,r){return new Ps(this.$).case(t,r)}}class Ps extends nr{$;in;key;branches=[];constructor(t,r){super(n=>this.caseEntries(Object.entries(n).map(([i,s])=>i==="default"?[i,s]:[this.$.parse(i),s]))),this.$=t,this.in=r}at(t,r){return this.key&&N(Dx),this.branches.length&&N(Lx),this.key=t,r?this.match(r):this}case(t,r){return this.caseEntry(this.$.parse(t),r)}caseEntry(t,r){const i=(this.key?this.$.parse({[this.key]:t}):t).pipe(r);return this.branches.push(i),this}match(t){return this(t)}strings(t){return this.caseEntries(Object.entries(t).map(([r,n])=>r==="default"?[r,n]:[this.$.node("unit",{unit:r}),n]))}caseEntries(t){for(let r=0;r<t.length;r++){const[n,i]=t[r];if(n==="default")return r!==t.length-1&&N("default may only be specified as the last key of a switch definition"),this.default(i);if(typeof i!="function")return N(`Value for case "${n}" must be a function (was ${mt(i)})`);this.caseEntry(n,i)}return this}default(t){typeof t=="function"&&this.case(W.unknown,t);const r={branches:this.branches,ordered:!0};(t==="never"||t==="assert")&&(r.meta={onFail:wp});const n=this.$.node("union",r);if(!this.in)return this.$.finalize(n);let i=this.in.pipe(n);return(t==="never"||t==="assert")&&(i=i.configureReferences({onFail:wp},"self")),this.$.finalize(i)}}const wp=e=>e.throw(),Lx="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",Dx="At most one key matcher may be specified per expression",xp=(e,t)=>{if(je(e)){if(e[1]==="=")return[t.$.parseOwnDefinitionFormat(e[0],t),"=",e[2]];if(e[1]==="?")return[t.$.parseOwnDefinitionFormat(e[0],t),"?"]}return Op(e,t)},Vx="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",zx="Only required keys may specify default values, e.g. { value: 'number = 0' }",Bx=(e,t)=>{let r;const n={},i=us(e);for(const[o,a]of i){const l=Ux(o);if(l.kind==="spread"){if(!ti(n))return N(jx);const p=t.$.parseOwnDefinitionFormat(a,t);if(p.equals(W.object))continue;if(!p.hasKind("intersection")||!p.basis?.equals(W.object))return N(Kx(p.expression));r=p.structure;continue}if(l.kind==="undeclared"){a!=="reject"&&a!=="delete"&&a!=="ignore"&&N(qx(a)),n.undeclared=a;continue}const c=xp(a,t),u=l;if(l.kind==="required"){je(c)?Ml(n,"optional",c[1]==="="?{key:l.normalized,value:c[0],default:c[2]}:{key:l.normalized,value:c[0]},t):Ml(n,"required",{key:l.normalized,value:c},t);continue}if(je(c)&&(c[1]==="?"&&N(Vx),c[1]==="="&&N(zx)),l.kind==="optional"){Ml(n,"optional",{key:l.normalized,value:c},t);continue}const d=t.$.parseOwnDefinitionFormat(u.normalized,t),f=fl(d,c,t.$);f.index&&(n.index=fe(n.index,f.index)),f.required&&(n.required=fe(n.required,f.required))}const s=t.$.node("structure",n);return t.$.parseSchema({domain:"object",structure:r?.merge(s)??s})},Ml=(e,t,r,n)=>{e[t]=fe(e[t],n.$.node(t,r))},qx=e=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${ce(e)})`,jx="Spread operator may only be used as the first key in an object",Ux=e=>typeof e=="symbol"?{kind:"required",normalized:e}:e[e.length-1]==="?"?e[e.length-2]===ri?{kind:"required",normalized:`${e.slice(0,-2)}?`}:{kind:"optional",normalized:e.slice(0,-1)}:e[0]==="["&&e[e.length-1]==="]"?{kind:"index",normalized:e.slice(1,-1)}:e[0]===ri&&e[1]==="["&&e[e.length-1]==="]"?{kind:"required",normalized:e.slice(1)}:e==="..."?{kind:"spread"}:e==="+"?{kind:"undeclared"}:{kind:"required",normalized:e==="\\..."?"...":e==="\\+"?"+":e},Kx=e=>`Spread operand must resolve to an object literal type (was ${e})`,Gx=(e,t)=>tk(e)?$p[e[0]](e,t):ek(e)?Sp[e[1]](e,t):null,Wx=(e,t)=>t.$.parseOwnDefinitionFormat(e[1],t).keyof(),Sl=(e,t)=>{if(e[2]===void 0)return N(hp(e[1],""));const r=t.$.parseOwnDefinitionFormat(e[0],t),n=t.$.parseOwnDefinitionFormat(e[2],t);if(e[1]==="|")return t.$.node("union",{branches:[r,n]});const i=e[1]==="&"?Jt(r,n,t.$):el(r,n,t.$);return i instanceof q?i.throw():i},Hx=(e,t)=>t.$.parseOwnDefinitionFormat(e[0],t).array(),Jx=(e,t)=>typeof e[2]!="function"?N(kp("=>",e[2])):t.$.parseOwnDefinitionFormat(e[0],t).pipe(e[2]),kp=(e,t)=>`${e===":"?"Narrow":"Morph"} expression requires a function following '${e}' (was ${typeof t})`,Yx=(e,t)=>typeof e[2]!="function"?N(kp(":",e[2])):t.$.parseOwnDefinitionFormat(e[0],t).constrain("predicate",e[2]),Qx=(e,t)=>t.$.parseOwnDefinitionFormat(e[0],t).configure(e[2],e[3]),Mp=e=>e,Zx=Mp({"[]":Hx,"?":()=>N(lp)}),Xx=Mp({"|":Sl,"&":Sl,":":Yx,"=>":Jx,"|>":Sl,"@":Qx,"=":()=>N(cp)}),Sp={...Zx,...Xx},ek=e=>Sp[e[1]]!==void 0,$p=(e=>e)({keyof:Wx,instanceof:(e,t)=>{if(typeof e[1]!="function")return N(Cp(za(e[1])));const r=e.slice(1).map(n=>typeof n=="function"?t.$.node("proto",{proto:n}):N(Cp(za(n))));return r.length===1?r[0]:t.$.node("union",{branches:r})},"===":(e,t)=>t.$.units(e.slice(1))}),tk=e=>$p[e[0]]!==void 0,Cp=e=>`Expected a constructor following 'instanceof' operator (was ${e})`,rk=(e,t)=>{let r=[{}],n=0;for(;n<e.length;){let i=!1;e[n]==="..."&&n<e.length-1&&(i=!0,n++);const s=xp(e[n],t),[o,a,l]=je(s)?s:[s];if(n++,i){if(!o.extends(D.intrinsic.Array))return N(sk(o.expression));r=r.flatMap(c=>o.distribute(u=>ik(Of(c),u)))}else r=r.map(c=>a==="?"?Ap(c,o):a==="="?nk(c,o,l):$l(c,o))}return t.$.parseSchema(r.map(i=>ti(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},$l=(e,t)=>e.defaultables||e.optionals?N(e.variadic?Th:ok):(e.variadic?e.postfix=fe(e.postfix,t):e.prefix=fe(e.prefix,t),e),Ap=(e,t)=>e.variadic?N(Pp):(e.optionals=fe(e.optionals,t),e),nk=(e,t,r)=>e.variadic?N(Pp):e.optionals?N(ak):(e.defaultables=fe(e.defaultables,[[t,r]]),e),Ep=(e,t)=>(e.postfix&&N(Ip),e.variadic?e.variadic.equals(t)||N(Ip):e.variadic=t.internal,e),ik=(e,t)=>{const r=t.select({method:"find",kind:"sequence"});if(!r)return Ep(e,D.intrinsic.unknown);if(r.prefix)for(const n of r.prefix)$l(e,n);if(r.optionals)for(const n of r.optionals)Ap(e,n);if(r.variadic&&Ep(e,r.variadic),r.postfix)for(const n of r.postfix)$l(e,n);return e},sk=e=>`Spread element must be an array (was ${e})`,Ip="A tuple may have at most one variadic element",ok="A required element may not follow an optional element",Pp="An optional element may not follow a variadic element",ak="A defaultable element may not follow an optional element without a default",lk={},Op=(e,t)=>{if(typeof e=="string"){if(t.args&&Object.keys(t.args).some(n=>e.includes(n)))return bp(e,t);const r=lk[t.$.name]??={};return r[e]??=bp(e,t)}return Sr(e,"object")?ck(e,t):N(Cl(mt(e)))},ck=(e,t)=>{const r=Va(e);switch(r){case void 0:return G(e,"root")?e:"~standard"in e?uk(e,t):Bx(e,t);case"Array":return dk(e,t);case"RegExp":return t.$.node("intersection",{domain:"string",pattern:e},{prereduced:!0});case"Function":{const n=ds(e)?e():e;return G(n,"root")?n:N(Cl("Function"))}default:return N(Cl(r??ce(e)))}},uk=(e,t)=>t.$.intrinsic.unknown.pipe((r,n)=>{const i=e["~standard"].validate(r);if(!i.issues)return i.value;for(const{message:s,path:o}of i.issues)o?o.length?n.error({problem:f0(s),relativePath:o.map(a=>typeof a=="object"?a.key:a)}):n.error({message:s}):n.error({message:s})}),dk=(e,t)=>Gx(e,t)??rk(e,t),Cl=e=>`Type definitions must be strings or objects (was ${e})`;class fk extends nr{constructor(t){const r=Object.assign({errors:sr,hkt:Et,$:t,raw:t.parse,module:t.constructor.module,scope:t.constructor.scope,declare:t.declare,define:t.define,match:t.match,generic:t.generic,schema:t.schema,keywords:t.ambient,unit:t.unit,enumerated:t.enumerated,instanceOf:t.instanceOf,valueOf:t.valueOf,or:t.or,and:t.and,merge:t.merge,pipe:t.pipe,fn:t.fn},t.ambientAttachments);super((...n)=>{if(n.length===1)return t.parse(n[0]);if(n.length===2&&typeof n[0]=="string"&&n[0][0]==="<"&&n[0][n[0].length-1]===">"){const i=n[0].slice(1,-1),s=t.parseGenericParams(i,{});return new ks(s,n[1],t,t,null)}return t.parse(n)},{attach:r})}}const hi=D;class Os extends Gh{get ambientAttachments(){if(hi.typeAttachments)return this.cacheGetter("ambientAttachments",he(hi.typeAttachments,(t,r)=>[t,this.bindReference(r)]))}preparseOwnAliasEntry(t,r){const n=t.indexOf("<");if(n===-1){if(G(r,"module")||G(r,"generic"))return[t,r];const o=this.name==="ark"?t:t==="root"?this.name:`${this.name}.${t}`,a=this.resolvedConfig.keywords?.[o];return a&&(r=[r,"@",a]),[t,r]}t[t.length-1]!==">"&&N("'>' must be the last character of a generic declaration in a scope");const i=t.slice(0,n),s=t.slice(n+1,-1);return[i,()=>{const o=this.parseGenericParams(s,{alias:i});return t1(o,r,this)}]}parseGenericParams(t,r){return kl(new $f(t),[],this.createParseContext({...r,def:t,prefix:"generic"}))}normalizeRootScopeValue(t){return ds(t)&&!G(t,"generic")?t():t}preparseOwnDefinitionFormat(t,r){return{...r,def:t,prefix:r.alias??"type"}}parseOwnDefinitionFormat(t,r){!(r.alias&&r.alias in this.aliases)&&!r.args&&(r.args={this:r.id});const i=Op(t,r);if(je(i)){if(i[1]==="=")return N(cp);if(i[1]==="?")return N(lp)}return i}unit=t=>this.units([t]);valueOf=t=>this.units(r0(t));enumerated=(...t)=>this.units(t);instanceOf=t=>this.node("proto",{proto:t},{prereduced:!0});or=(...t)=>this.schema(t.map(r=>this.parse(r)));and=(...t)=>t.reduce((r,n)=>r.and(this.parse(n)),this.intrinsic.unknown);merge=(...t)=>t.reduce((r,n)=>r.merge(this.parse(n)),this.intrinsic.object);pipe=(...t)=>this.intrinsic.unknown.pipe(...t);fn=new Tx(this);match=new Fx(this);declare=()=>({type:this.type});define(t){return t}type=new fk(this);static scope=((t,r={})=>new Os(t,r));static module=((t,r={})=>this.scope(t,r).export())}const hk=Object.assign(Os.scope,{define:e=>e}),ie=Os;class pk extends Et{description='merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`'}const mk=Yt(["base",W.object],["props",W.object])(e=>e.base.merge(e.props),pk),gk=ie.module({Key:W.key,Merge:mk});class yk extends Et{}const _k=Yt("element")(e=>{const t=e.element.exclude(W.Array),r=t.array();return t.rawOr(r).pipe(ei).distribute(n=>n.assertHasKind("morph").declareOut(r),pe)},yk),bk=ie.module({root:W.Array,readonly:"root",index:W.nonNegativeIntegerString,liftFrom:_k},{name:"Array"}),Al=pe(["string",ni.FileConstructor]),vk=Al.rawOr(Al.array()),Tp=pe({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:vk}}),wk=ie.module({root:["instanceof",FormData],value:Al,parsed:Tp,parse:pe({in:FormData,morphs:e=>{const t={};for(const[r,n]of e)if(r in t){const i=t[r];typeof i=="string"||i instanceof ni.FileConstructor?t[r]=[i,n]:i.push(n)}else t[r]=n;return t},declaredOut:Tp})},{name:"FormData"}),xk=ie.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),kk={Boolean:1,Number:1,String:1},Mk=ie.module({...he({...ff,...pf},(e,t)=>e in kk?[]:[e,["instanceof",t]]),Array:bk,TypedArray:xk,FormData:wk}),Sk=pe({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),$k=pe({domain:"number",divisor:1}),Np=ie.module({root:W.number,integer:$k,epoch:Sk,safe:pe({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),_e=(e,t,r)=>{const n={domain:"string",pattern:{rule:e.source,flags:e.flags,meta:t}};return r&&(n.meta={format:r}),yl("intersection",n)},Rp=_e(hs,"a well-formed integer string"),Fp=ie.module({root:Rp,parse:pe({in:Rp,morphs:(e,t)=>{const r=Number.parseInt(e);return Number.isSafeInteger(r)?r:t.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:W.integer})},{name:"string.integer"}),Ck=_e(/^[\dA-Fa-f]+$/,"hex characters only"),Ak=ie.module({root:_e(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:_e(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),Lp=_e(/^[A-Z].*$/,"capitalized"),Ek=ie.module({root:pe({in:"string",morphs:e=>e.charAt(0).toUpperCase()+e.slice(1),declaredOut:Lp}),preformatted:Lp},{name:"string.capitalize"}),Ik=e=>{const t=e.replace(/[ -]+/g,"");let r=0,n,i,s=!1;for(let o=t.length-1;o>=0;o--)n=t.substring(o,o+1),i=Number.parseInt(n,10),s?(i*=2,r+=i>=10?i%10+1:i):r+=i,s=!s;return!!(r%10===0&&t)},Pk=pe({domain:"string",pattern:{meta:"a credit card number",rule:/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/.source},predicate:{meta:"a credit card number",predicate:Ik}}),Ok=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Dp=pe({domain:"string",predicate:{meta:"a parsable date",predicate:e=>!Number.isNaN(new Date(e).valueOf())}}).assertHasKind("intersection"),Vp=Fp.root.internal.narrow((e,t)=>{const r=Number.parseInt(e),n=Np.epoch(r);return n instanceof sr?(t.errors.merge(n),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),Tk=ie.module({root:Vp,parse:pe({in:Vp,morphs:e=>new Date(e),declaredOut:W.Date})},{name:"string.date.epoch"}),zp=_e(Ok,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),Nk=ie.module({root:zp,parse:pe({in:zp,morphs:e=>new Date(e),declaredOut:W.Date})},{name:"string.date.iso"}),Rk=ie.module({root:Dp,parse:pe({declaredIn:Dp,in:"string",morphs:(e,t)=>{const r=new Date(e);return Number.isNaN(r.valueOf())?t.error("a parsable date"):r},declaredOut:W.Date}),iso:Nk,epoch:Tk},{name:"string.date"}),Fk=_e(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),Bp="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ar=`(${Bp}[.]){3}${Bp}`,Lk=new RegExp(`^${ar}$`),Ae="(?:[0-9a-fA-F]{1,4})",Dk=new RegExp(`^((?:${Ae}:){7}(?:${Ae}|:)|(?:${Ae}:){6}(?:${ar}|:${Ae}|:)|(?:${Ae}:){5}(?::${ar}|(:${Ae}){1,2}|:)|(?:${Ae}:){4}(?:(:${Ae}){0,1}:${ar}|(:${Ae}){1,3}|:)|(?:${Ae}:){3}(?:(:${Ae}){0,2}:${ar}|(:${Ae}){1,4}|:)|(?:${Ae}:){2}(?:(:${Ae}){0,3}:${ar}|(:${Ae}){1,5}|:)|(?:${Ae}:){1}(?:(:${Ae}){0,4}:${ar}|(:${Ae}){1,6}|:)|(?::((?::${Ae}){0,5}:${ar}|(?::${Ae}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),Vk=ie.module({root:["v4 | v6","@","an IP address"],v4:_e(Lk,"an IPv4 address","ipv4"),v6:_e(Dk,"an IPv6 address","ipv6")},{name:"string.ip"}),wn="a JSON string",qp=e=>{if(!(e instanceof SyntaxError))throw e;return`must be ${wn} (${e})`},zk=pe({meta:wn,domain:"string",predicate:{meta:wn,predicate:(e,t)=>{try{return JSON.parse(e),!0}catch(r){return t.reject({code:"predicate",expected:wn,problem:qp(r)})}}}}),Bk=(e,t)=>{if(e.length===0)return t.error({code:"predicate",expected:wn,actual:"empty"});try{return JSON.parse(e)}catch(r){return t.error({code:"predicate",expected:wn,problem:qp(r)})}},qk=ie.module({root:zk,parse:pe({meta:"safe JSON string parser",in:"string",morphs:Bk,declaredOut:W.jsonObject})},{name:"string.json"}),jp=_e(/^[a-z]*$/,"only lowercase letters"),jk=ie.module({root:pe({in:"string",morphs:e=>e.toLowerCase(),declaredOut:jp}),preformatted:jp},{name:"string.lower"}),Up=["NFC","NFD","NFKC","NFKD"],pi=he(Up,(e,t)=>[t,pe({domain:"string",predicate:r=>r.normalize(t)===r,meta:`${t}-normalized unicode`})]),Ts=he(Up,(e,t)=>[t,pe({in:"string",morphs:r=>r.normalize(t),declaredOut:pi[t]})]),Uk=ie.module({root:Ts.NFC,preformatted:pi.NFC},{name:"string.normalize.NFC"}),Kk=ie.module({root:Ts.NFD,preformatted:pi.NFD},{name:"string.normalize.NFD"}),Gk=ie.module({root:Ts.NFKC,preformatted:pi.NFKC},{name:"string.normalize.NFKC"}),Wk=ie.module({root:Ts.NFKD,preformatted:pi.NFKD},{name:"string.normalize.NFKD"}),Hk=ie.module({root:"NFC",NFC:Uk,NFD:Kk,NFKC:Gk,NFKD:Wk},{name:"string.normalize"}),Kp=_e(qa,"a well-formed numeric string"),Jk=ie.module({root:Kp,parse:pe({in:Kp,morphs:e=>Number.parseFloat(e),declaredOut:W.number})},{name:"string.numeric"}),Gp="a regex pattern",Yk=pe({domain:"string",predicate:{meta:Gp,predicate:(e,t)=>{try{return new RegExp(e),!0}catch(r){return t.reject({code:"predicate",expected:Gp,problem:String(r)})}}},meta:{format:"regex"}}),Qk=_e(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,"a semantic version (see https://semver.org/)"),Wp=_e(/^\S.*\S$|^\S?$/,"trimmed"),Zk=ie.module({root:pe({in:"string",morphs:e=>e.trim(),declaredOut:Wp}),preformatted:Wp},{name:"string.trim"}),Hp=_e(/^[A-Z]*$/,"only uppercase letters"),Xk=ie.module({root:pe({in:"string",morphs:e=>e.toUpperCase(),declaredOut:Hp}),preformatted:Hp},{name:"string.upper"}),Jp=pe({domain:"string",predicate:{meta:"a URL string",predicate:e=>URL.canParse(e)},meta:{format:"uri"}}),eM=ie.module({root:Jp,parse:pe({declaredIn:Jp,in:"string",morphs:(e,t)=>{try{return new URL(e)}catch{return t.error("a URL string")}},declaredOut:pe(URL)})},{name:"string.url"}),tM=ie.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:_e(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:_e(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:_e(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:_e(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:_e(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:_e(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:_e(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:_e(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),rM=ie.module({root:W.string,alpha:_e(/^[A-Za-z]*$/,"only letters"),alphanumeric:_e(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex:Ck,base64:Ak,capitalize:Ek,creditCard:Pk,date:Rk,digits:_e(/^\d*$/,"only digits 0-9"),email:Fk,integer:Fp,ip:Vk,json:qk,lower:jk,normalize:Hk,numeric:Jk,regex:Yk,semver:Qk,trim:Zk,upper:Xk,url:eM,uuid:tM},{name:"string"}),nM=ie.module({bigint:W.bigint,boolean:W.boolean,false:W.false,never:W.never,null:W.null,number:W.number,object:W.object,string:W.string,symbol:W.symbol,true:W.true,unknown:W.unknown,undefined:W.undefined}),iM=ie.module({root:W.unknown,any:W.unknown},{name:"unknown"}),sM=ie.module({root:W.jsonObject,stringify:yl("morph",{in:W.jsonObject,morphs:e=>JSON.stringify(e),declaredOut:W.string})},{name:"object.json"}),oM=ie.module({root:W.object,json:sM},{name:"object"});class aM extends Et{description='instantiate an object from an index signature and corresponding value type like `Record("string", "number")`'}const lM=Yt(["K",W.key],"V")(e=>({domain:"object",index:{signature:e.K,value:e.V}}),aM);class cM extends Et{description='pick a set of properties from an object like `Pick(User, "name | age")`'}const uM=Yt(["T",W.object],["K",W.key])(e=>e.T.pick(e.K),cM);class dM extends Et{description='omit a set of properties from an object like `Omit(User, "age")`'}const fM=Yt(["T",W.object],["K",W.key])(e=>e.T.omit(e.K),dM);class hM extends Et{description="make all named properties of an object optional like `Partial(User)`"}const pM=Yt(["T",W.object])(e=>e.T.partial(),hM);class mM extends Et{description="make all named properties of an object required like `Required(User)`"}const gM=Yt(["T",W.object])(e=>e.T.required(),mM);class yM extends Et{description='exclude branches of a union like `Exclude("boolean", "true")`'}const _M=Yt("T","U")(e=>e.T.exclude(e.U),yM);class bM extends Et{description='extract branches of a union like `Extract("0 | false | 1", "number")`'}const vM=Yt("T","U")(e=>e.T.extract(e.U),bM),wM=ie.module({Exclude:_M,Extract:vM,Omit:fM,Partial:pM,Pick:uM,Record:lM,Required:gM}),lr=hk({...nM,...wM,...Mk,...gk,string:rM,number:Np,object:oM,unknown:iM},{prereducedAliases:!0,name:"ark"}),Te=lr.export();Object.assign(hi.ambient,Te),hi.typeAttachments={string:Te.string.root,number:Te.number.root,bigint:Te.bigint,boolean:Te.boolean,symbol:Te.symbol,undefined:Te.undefined,null:Te.null,object:Te.object.root,unknown:Te.unknown.root,false:Te.false,true:Te.true,never:Te.never,arrayIndex:Te.Array.index,Key:Te.Key,Record:Te.Record,Array:Te.Array.root,Date:Te.Date};const ae=Object.assign(lr.type,hi.typeAttachments);lr.match,lr.fn,lr.generic,lr.schema,lr.define,lr.declare,ae("'more-info' | 'toggle' | 'navigate' | 'url' | 'perform-action' | 'assist'"),ae("'tap' | 'hold' | 'double_tap'");const El=ae({action:"'perform-action'",perform_action:"string",target:"object","data?":"object"}).or({action:"'assist'","pipeline_id?":"string"}).or({action:"'url'",url_path:"string"}).or({action:"'navigate'",navigation_path:"string"}).or({action:"'more-info'","entity?":"string","camera_image?":"string"}).or({action:"'toggle'","entity?":"string"}).or({action:"'none'"}),Yp=ae({"entity?":"string","camera_image?":"string","tap_action?":El.or("undefined"),"hold_action?":El.or("undefined"),"double_tap_action?":El.or("undefined")}),Qp=ae({"always_show_power_button?":"boolean | null","show_volume_step_buttons?":"boolean","use_volume_up_down_for_step_buttons?":"boolean"}),Zp=ae({"icon?":"string","name?":"string",media_type:"string"}),xM=ae({entity:"string","name?":"string | null"}).or("string").array(),kM=ae({"name?":"string | null",entity_id:ae("string")}),MM=ae({"enabled?":"boolean | null","entity_id?":ae("string").or("null").or("undefined")}),Xp=ae("null").or(MM).or(kM.array()),em=ae({icon:"string > 0",name:"string > 0"}).and(Yp).array(),SM=ae({"enabled?":"boolean | null","show_favorites?":ae("boolean | null").or("undefined"),"entity_id?":ae("string").or("null").or("undefined"),"media_types?":Zp.array()}),tm=ae({"name?":"string | null",entity_id:ae("string"),"media_types?":Zp.array().or("undefined")}).array().or(SM).or("undefined"),rm=ae({type:"string","name?":"string | null",entity_id:"string","use_art_colors?":"boolean","action?":Yp,"speaker_group?":{"entity_id?":ae("string").or("null").or("undefined"),entities:xM},"custom_buttons?":em,"ma_entity_id?":ae("string").or("null").or("undefined"),"ma_favorite_button_entity_id?":ae("string").or("null").or("undefined"),"lms_entity_id?":ae("string").or("null").or("undefined"),"search?":tm,"media_browser?":Xp,"options?":Qp,"grid_options?":"unknown","visibility?":"unknown"}),$M=rm.and({"tap_opens_popup?":"boolean","options?":Qp.and({"always_show_custom_buttons?":"boolean | null","hide_when_off?":"boolean | null","hide_when_group_child?":"boolean | null"})}),CM=rm.and({mode:"'panel'|'card'|'in-card'|'popup'|'multi'"}),AM=ae({entity_id:"string","custom_buttons?":em,"name?":"string | null","speaker_group_entity_id?":ae("string").or("null").or("undefined"),"can_be_grouped?":"boolean | null","ma_entity_id?":ae("string").or("null").or("undefined"),"ma_favorite_button_entity_id?":ae("string").or("null").or("undefined"),"lms_entity_id?":ae("string").or("null").or("undefined"),"search?":tm,"media_browser?":Xp}),EM=ae({type:"string",mode:"'panel'|'card'","height?":"number | string",entity_id:"string","use_art_colors?":"boolean",media_players:AM.array(),"options?":{"player_is_active_when?":"'playing' | 'playing_or_paused'","transparent_background_on_home?":"boolean","show_volume_step_buttons?":"boolean","use_volume_up_down_for_step_buttons?":"boolean"},"grid_options?":"unknown","visibility?":"unknown"}),xn=new WeakMap,Ns=new WeakMap,Rs={current:[]};let Il=!1,mi=0;const gi=new Set,Fs=new Map;function nm(e){const t=Array.from(e).sort((r,n)=>r instanceof Pt&&r.options.deps.includes(n)?1:n instanceof Pt&&n.options.deps.includes(r)?-1:0);for(const r of t){if(Rs.current.includes(r))continue;Rs.current.push(r),r.recompute();const n=Ns.get(r);if(n)for(const i of n){const s=xn.get(i);s&&nm(s)}}}function IM(e){const t={prevVal:e.prevState,currentVal:e.state};for(const r of e.listeners)r(t)}function PM(e){const t={prevVal:e.prevState,currentVal:e.state};for(const r of e.listeners)r(t)}function im(e){if(mi>0&&!Fs.has(e)&&Fs.set(e,e.prevState),gi.add(e),!(mi>0)&&!Il)try{for(Il=!0;gi.size>0;){const t=Array.from(gi);gi.clear();for(const r of t){const n=Fs.get(r)??r.prevState;r.prevState=n,IM(r)}for(const r of t){const n=xn.get(r);n&&(Rs.current.push(r),nm(n))}for(const r of t){const n=xn.get(r);if(n)for(const i of n)PM(i)}}}finally{Il=!1,Rs.current=[],Fs.clear()}}function It(e){mi++;try{e()}finally{if(mi--,mi===0){const t=gi.values().next().value;t&&im(t)}}}function OM(e){return typeof e=="function"}class Pl{constructor(t,r){this.listeners=new Set,this.subscribe=n=>{var i,s;this.listeners.add(n);const o=(s=(i=this.options)==null?void 0:i.onSubscribe)==null?void 0:s.call(i,n,this);return()=>{this.listeners.delete(n),o?.()}},this.prevState=t,this.state=t,this.options=r}setState(t){var r,n,i;this.prevState=this.state,(r=this.options)!=null&&r.updateFn?this.state=this.options.updateFn(this.prevState)(t):OM(t)?this.state=t(this.prevState):this.state=t,(i=(n=this.options)==null?void 0:n.onUpdate)==null||i.call(n),im(this)}}class Pt{constructor(t){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const r=this.options.deps.length,n=new Array(r),i=new Array(r);for(let s=0;s<r;s++){const o=this.options.deps[s];n[s]=o.prevState,i[s]=o.state}return this.lastSeenDepValues=i,{prevDepVals:n,currDepVals:i,prevVal:this.prevState??void 0}},this.recompute=()=>{var r,n;this.prevState=this.state;const i=this.getDepVals();this.state=this.options.fn(i),(n=(r=this.options).onUpdate)==null||n.call(r)},this.checkIfRecalculationNeededDeeply=()=>{for(const s of this.options.deps)s instanceof Pt&&s.checkIfRecalculationNeededDeeply();let r=!1;const n=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let s=0;s<i.length;s++)if(i[s]!==n[s]){r=!0;break}r&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const r of this._subscriptions)r()}),this.subscribe=r=>{var n,i;this.listeners.add(r);const s=(i=(n=this.options).onSubscribe)==null?void 0:i.call(n,r,this);return()=>{this.listeners.delete(r),s?.()}},this.options=t,this.state=t.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(t=this.options.deps){for(const r of t)if(r instanceof Pt)r.registerOnGraph(),this.registerOnGraph(r.options.deps);else if(r instanceof Pl){let n=xn.get(r);n||(n=new Set,xn.set(r,n)),n.add(this);let i=Ns.get(this);i||(i=new Set,Ns.set(this,i)),i.add(r)}}unregisterFromGraph(t=this.options.deps){for(const r of t)if(r instanceof Pt)this.unregisterFromGraph(r.options.deps);else if(r instanceof Pl){const n=xn.get(r);n&&n.delete(this);const i=Ns.get(this);i&&i.delete(r)}}}var TM=class{constructor(e,t){this.fn=e,this.options=t,this.lastExecutionTime=0,this.isPending=!1,this.maybeExecute=(...r)=>{const n=Date.now()-this.lastExecutionTime;if(this.options.leading&&n>=this.options.wait)this.execute(...r);else if(this.lastArgs=r,!this.timeoutId&&this.options.trailing){const i=this.options.wait-n;this.isPending=!0,this.timeoutId=setTimeout(()=>{this.lastArgs!==void 0&&this.execute(...this.lastArgs)},i)}},this.execute=(...r)=>{this.fn(...r),this.options.onExecute?.(r,this),this.lastExecutionTime=Date.now(),this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.flush=()=>{this.isPending&&this.lastArgs&&this.execute(...this.lastArgs)},this.cancel=()=>{this.clearTimeout(),this.lastArgs=void 0,this.isPending=!1},this.clearTimeout=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)},this.options.leading===void 0&&this.options.trailing===void 0&&(this.options.leading=!0,this.options.trailing=!0)}};function NM(e,t){return new TM(e,t).maybeExecute}class RM{#s=!0;#t;#e;#d;#r;#a;#n;#l;#f=0;#p=5;#o=!1;#c=!1;#i=null;#h=()=>{this.debugLog("Connected to event bus"),this.#a=!0,this.#o=!1,this.debugLog("Emitting queued events",this.#r),this.#r.forEach(t=>this.emitEventToBus(t)),this.#r=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#h)};#u=()=>{if(this.#f<this.#p){this.#f++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#u),this.#c=!0,this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#m=()=>{this.#o||(this.#o=!0,this.#e().addEventListener("tanstack-connect-success",this.#h),this.#u())};constructor({pluginId:t,debug:r=!1,enabled:n=!0,reconnectEveryMs:i=300}){this.#t=t,this.#s=n,this.#e=this.getGlobalTarget,this.#d=r,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#r=[],this.#a=!1,this.#c=!1,this.#n=null,this.#l=i}startConnectLoop(){this.#n!==null||this.#a||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#n=setInterval(this.#u,this.#l))}stopConnectLoop(){this.#o=!1,this.#n!==null&&(clearInterval(this.#n),this.#n=null,this.#r=[],this.debugLog("Stopped connect loop"))}debugLog(...t){this.#d&&console.log(` [tanstack-devtools:${this.#t}-plugin]`,...t)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const t=typeof EventTarget<"u"?new EventTarget:void 0;return typeof t>"u"||typeof t.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),t)}getPluginId(){return this.#t}dispatchCustomEventShim(t,r){try{const n=new Event(t,{detail:r});this.#e().dispatchEvent(n)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(t,r){try{this.#e().dispatchEvent(new CustomEvent(t,{detail:r}))}catch{this.dispatchCustomEventShim(t,r)}}emitEventToBus(t){this.debugLog("Emitting event to client bus",t),this.dispatchCustomEvent("tanstack-dispatch-event",t)}createEventPayload(t,r){return{type:`${this.#t}:${t}`,payload:r,pluginId:this.#t}}emit(t,r){if(!this.#s){this.debugLog("Event bus client is disabled, not emitting event",t,r);return}if(this.#i&&(this.debugLog("Emitting event to internal event target",t,r),this.#i.dispatchEvent(new CustomEvent(`${this.#t}:${t}`,{detail:this.createEventPayload(t,r)}))),this.#c){this.debugLog("Previously failed to connect, not emitting to bus");return}if(!this.#a){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#r.push(this.createEventPayload(t,r)),typeof CustomEvent<"u"&&!this.#o&&(this.#m(),this.startConnectLoop());return}return this.emitEventToBus(this.createEventPayload(t,r))}on(t,r,n){const i=n?.withEventTarget??!1,s=`${this.#t}:${t}`;if(i&&(this.#i||(this.#i=new EventTarget),this.#i.addEventListener(s,a=>{r(a.detail)})),!this.#s)return this.debugLog("Event bus client is disabled, not registering event",s),()=>{};const o=a=>{this.debugLog("Received event from bus",a.detail),r(a.detail)};return this.#e().addEventListener(s,o),this.debugLog("Registered event to bus",s),()=>{i&&this.#i?.removeEventListener(s,o),this.#e().removeEventListener(s,o)}}onAll(t){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const r=n=>{const i=n.detail;t(i)};return this.#e().addEventListener("tanstack-devtools-global",r),()=>this.#e().removeEventListener("tanstack-devtools-global",r)}onAllPluginEvents(t){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const r=n=>{const i=n.detail;this.#t&&i.pluginId!==this.#t||t(i)};return this.#e().addEventListener("tanstack-devtools-global",r),()=>this.#e().removeEventListener("tanstack-devtools-global",r)}}class FM extends RM{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const lt=new FM;function yi(e,t){return typeof e=="function"?e(t):e}function kn(e,t){return Vs(t).reduce((n,i)=>{if(n===null)return null;if(typeof n<"u")return n[i]},e)}function Ls(e,t,r){const n=Vs(t);function i(s){if(!n.length)return yi(r,s);const o=n.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[o]:i(s[o])}):{[o]:i()};if(Array.isArray(s)&&typeof o=="number"){const a=s.slice(0,o);return[...a.length?a:new Array(o),i(s[o]),...s.slice(o+1)]}return[...new Array(o),i()]}return i(e)}function LM(e,t){const r=Vs(t);function n(i){if(!i)return;if(r.length===1){const o=r[0];if(Array.isArray(i)&&typeof o=="number")return i.filter((c,u)=>u!==o);const{[o]:a,...l}=i;return l}const s=r.shift();if((typeof s=="string"||typeof s=="number"&&!Array.isArray(i))&&typeof i=="object")return{...i,[s]:n(i[s])};if(typeof s=="number"&&Array.isArray(i)){if(s>=i.length)return i;const o=i.slice(0,s);return[...o.length?o:new Array(s),n(i[s]),...i.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return n(e)}const DM=/^(\d+)$/gm,VM=/\.(\d+)(?=\.)/gm,zM=/^(\d+)\./gm,BM=/\.(\d+$)/gm,qM=/\.{2,}/gm,Ol="__int__",Ds=`${Ol}$1`;function Vs(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(DM,Ds).replace(VM,`.${Ds}.`).replace(zM,`${Ds}.`).replace(BM,`.${Ds}`).replace(qM,".").split(".").map(t=>{if(t.startsWith(Ol)){const r=t.substring(Ol.length),n=parseInt(r,10);return String(n)===r?n:r}return t})}function sm(e,t){return e.length===0?t:t.length===0?e:t.startsWith("[")||t.startsWith(".")?e+t:`${e}.${t}`}function jM(e){return!(Array.isArray(e)&&e.length===0)}function Tl(e,t){const r=n=>n.validators.filter(Boolean).map(i=>({cause:i.cause,validate:i.fn}));return t.validationLogic({form:t.form,validators:t.validators,event:{type:e,async:!1},runValidation:r})}function Nl(e,t){const{asyncDebounceMs:r}=t,{onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:i,onDynamicAsyncDebounceMs:s}=t.validators||{},o=r??0,a=l=>l.validators.filter(Boolean).map(c=>{const u=c?.cause||e;let d=o;switch(u){case"change":d=i??o;break;case"blur":d=n??o;break;case"dynamic":d=s??o;break;case"submit":d=0;break}return e==="submit"&&(d=0),{cause:u,validate:c.fn,debounceMs:d}});return t.validationLogic({form:t.form,validators:t.validators,event:{type:e,async:!0},runValidation:a})}const Rl=e=>!!e&&typeof e=="object"&&"fields"in e;function cr(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,s]of e)if(!t.has(i)||!Object.is(s,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const i of r)if(!n.includes(i)||!cr(e[i],t[i]))return!1;return!0}const om=({newFormValidatorError:e,isPreviousErrorFromFormValidator:t,previousErrorValue:r})=>e?{newErrorValue:e,newSource:"form"}:t?{newErrorValue:void 0,newSource:void 0}:r?{newErrorValue:r,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},am=({formLevelError:e,fieldLevelError:t})=>t?{newErrorValue:t,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function Ye(e,t){return e==null?t:{...e,...t}}let Cr=256;const zs=[];let Bs;for(;Cr--;)zs[Cr]=(Cr+256).toString(16).substring(1);function lm(){let e=0,t,r="";if(!Bs||Cr+16>256){for(Bs=new Array(256),e=256;e--;)Bs[e]=256*Math.random()|0;e=0,Cr=0}for(;e<16;e++)t=Bs[Cr+e],e===6?r+=zs[t&15|64]:e===8?r+=zs[t&63|128]:r+=zs[t],e&1&&e>1&&e<11&&(r+="-");return Cr++,r}const UM=NM(e=>lt.emit("form-state",{id:e.formId,state:e.store.state}),{wait:300}),Mn=e=>{if(!e.validators)return e.runValidation({validators:[],form:e.form});const t=e.event.async,r=t?void 0:{fn:e.validators.onMount,cause:"mount"},n={fn:t?e.validators.onChangeAsync:e.validators.onChange,cause:"change"},i={fn:t?e.validators.onBlurAsync:e.validators.onBlur,cause:"blur"},s={fn:t?e.validators.onSubmitAsync:e.validators.onSubmit,cause:"submit"},o=t?void 0:{fn:()=>{},cause:"server"};switch(e.event.type){case"mount":return e.runValidation({validators:[r],form:e.form});case"submit":return e.runValidation({validators:[n,i,s,o],form:e.form});case"server":return e.runValidation({validators:[],form:e.form});case"blur":return e.runValidation({validators:[i,o],form:e.form});case"change":return e.runValidation({validators:[n,o],form:e.form});default:throw new Error(`Unknown validation event type: ${e.event.type}`)}};function KM(e,t){const r=new Map;for(const n of e){const i=n.path??[];let s=t,o="";for(let a=0;a<i.length;a++){const l=i[a];if(l===void 0)continue;const c=typeof l=="object"?l.key:l,u=Number(c);Array.isArray(s)&&!Number.isNaN(u)?o+=`[${u}]`:o+=(a>0?".":"")+String(c),typeof s=="object"&&s!==null?s=s[c]:s=void 0}r.set(o,(r.get(o)??[]).concat(n))}return Object.fromEntries(r)}const cm=(e,t)=>{const r=KM(e,t);return{form:r,fields:r}},Sn={validate({value:e,validationSource:t},r){const n=r["~standard"].validate(e);if(n instanceof Promise)throw new Error("async function passed to sync validator");if(n.issues)return t==="field"?n.issues:cm(n.issues,e)},async validateAsync({value:e,validationSource:t},r){const n=await r["~standard"].validate(e);if(n.issues)return t==="field"?n.issues:cm(n.issues,e)}},um=e=>!!e&&"~standard"in e,$n={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function qs(e){function t(u,d,f){const p=o(u,d,"move",f),m=Math.min(d,f),g=Math.max(d,f);for(let _=m;_<=g;_++)p.push(s(u,_));const y=Object.keys(e.fieldInfo).reduce((_,b)=>(b.startsWith(s(u,d))&&_.set(b,e.getFieldMeta(b)),_),new Map);l(p,d<f?"up":"down"),Object.keys(e.fieldInfo).filter(_=>_.startsWith(s(u,f))).forEach(_=>{const b=_.replace(s(u,f),s(u,d)),w=y.get(b);w&&e.setFieldMeta(_,w)})}function r(u,d){const f=o(u,d,"remove");l(f,"up")}function n(u,d,f){o(u,d,"swap",f).forEach(m=>{if(!m.toString().startsWith(s(u,d)))return;const g=m.toString().replace(s(u,d),s(u,f)),[y,_]=[e.getFieldMeta(m),e.getFieldMeta(g)];y&&e.setFieldMeta(g,y),_&&e.setFieldMeta(m,_)})}function i(u,d){const f=o(u,d,"insert");l(f,"down"),f.forEach(p=>{p.toString().startsWith(s(u,d))&&e.setFieldMeta(p,c())})}function s(u,d){return`${u}[${d}]`}function o(u,d,f,p){const m=[s(u,d)];switch(f){case"swap":m.push(s(u,p));break;case"move":{const[g,y]=[Math.min(d,p),Math.max(d,p)];for(let _=g;_<=y;_++)m.push(s(u,_));break}default:{const g=e.getFieldValue(u),y=Array.isArray(g)?g.length:0;for(let _=d+1;_<y;_++)m.push(s(u,_));break}}return Object.keys(e.fieldInfo).filter(g=>m.some(y=>g.startsWith(y)))}function a(u,d){return u.replace(/\[(\d+)\]/,(f,p)=>{const m=parseInt(p,10);return`[${d==="up"?m+1:Math.max(0,m-1)}]`})}function l(u,d){(d==="up"?u:[...u].reverse()).forEach(p=>{const m=a(p.toString(),d),g=e.getFieldMeta(m);g?e.setFieldMeta(p,g):e.setFieldMeta(p,c())})}const c=()=>$n;return{handleArrayMove:t,handleArrayRemove:r,handleArraySwap:n,handleArrayInsert:i}}function Fl(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class dm{constructor(t){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const r=this.fieldMetaDerived.mount(),n=this.store.mount(),i=this.store.subscribe(()=>{UM(this)}),s=lt.on("request-form-state",u=>{u.payload.id===this._formId&&lt.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),o=lt.on("request-form-reset",u=>{u.payload.id===this._formId&&this.reset()}),a=lt.on("request-form-force-submit",u=>{u.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)}),l=()=>{a(),o(),s(),i(),r(),n(),lt.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:c}=this.options.validators||{};return lt.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),c&&this.validateSync("mount"),l},this.update=r=>{if(!r)return;const n=this.options;this.options=r;const i=!!r.transform?.deps?.some((a,l)=>a!==this.prevTransformArray[l]),s=r.defaultValues&&!cr(r.defaultValues,n.defaultValues)&&!this.state.isTouched,o=!cr(r.defaultState,n.defaultState)&&!this.state.isTouched;!s&&!o&&!i||(It(()=>{this.baseStore.setState(()=>Fl(Object.assign({},this.state,o?r.defaultState:{},s?{values:r.defaultValues}:{},i?{_force_re_eval:!this.state._force_re_eval}:{})))}),lt.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(r,n)=>{const{fieldMeta:i}=this.state,s=this.resetFieldMeta(i);r&&!n?.keepDefaultValues&&(this.options={...this.options,defaultValues:r}),this.baseStore.setState(()=>Fl({...this.options.defaultState,values:r??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:s}))},this.validateAllFields=async r=>{const n=[];return It(()=>{Object.values(this.fieldInfo).forEach(s=>{if(!s.instance)return;const o=s.instance;n.push(Promise.resolve().then(()=>o.validate(r,{skipFormValidation:!0}))),s.instance.state.meta.isTouched||s.instance.setMeta(a=>({...a,isTouched:!0}))})}),(await Promise.all(n)).flat()},this.validateArrayFieldsStartingFrom=async(r,n,i)=>{const s=this.getFieldValue(r),o=Array.isArray(s)?Math.max(s.length-1,0):null,a=[`${r}[${n}]`];for(let d=n+1;d<=(o??0);d++)a.push(`${r}[${d}]`);const l=Object.keys(this.fieldInfo).filter(d=>a.some(f=>d.startsWith(f))),c=[];return It(()=>{l.forEach(d=>{c.push(Promise.resolve().then(()=>this.validateField(d,i)))})}),(await Promise.all(c)).flat()},this.validateField=(r,n)=>{const i=this.fieldInfo[r]?.instance;return i?(i.state.meta.isTouched||i.setMeta(s=>({...s,isTouched:!0})),i.validate(n)):[]},this.validateSync=r=>{const n=Tl(r,{...this.options,form:this,validationLogic:this.options.validationLogic||Mn});let i=!1;const s={};return It(()=>{for(const l of n){if(!l.validate)continue;const c=this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:u,fieldErrors:d}=js(c),f=_i(l.cause),p=new Set([...Object.keys(this.state.fieldMeta),...Object.keys(d||{})]);for(const m of p){if(this.baseStore.state.fieldMetaBase[m]===void 0&&!d?.[m])continue;const g=this.getFieldMeta(m)??$n,{errorMap:y,errorSourceMap:_}=g,b=d?.[m],{newErrorValue:w,newSource:k}=om({newFormValidatorError:b,isPreviousErrorFromFormValidator:_?.[f]==="form",previousErrorValue:y?.[f]});k==="form"&&(s[m]={...s[m],[f]:b}),y?.[f]!==w&&this.setFieldMeta(m,(x=$n)=>({...x,errorMap:{...x.errorMap,[f]:w},errorSourceMap:{...x.errorSourceMap,[f]:k}}))}this.state.errorMap?.[f]!==u&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[f]:u}})),(u||d)&&(i=!0)}const o=_i("submit");this.state.errorMap?.[o]&&r!=="submit"&&!i&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[o]:void 0}}));const a=_i("server");this.state.errorMap?.[a]&&r!=="server"&&!i&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[a]:void 0}}))}),{hasErrored:i,fieldsErrorMap:s}},this.validateAsync=async r=>{const n=Nl(r,{...this.options,form:this,validationLogic:this.options.validationLogic||Mn});this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const i=[];let s;for(const l of n){if(!l.validate)continue;const c=_i(l.cause);this.state.validationMetaMap[c]?.lastAbortController.abort();const d=new AbortController;this.state.validationMetaMap[c]={lastAbortController:d},i.push(new Promise(async f=>{let p;try{p=await new Promise((_,b)=>{setTimeout(async()=>{if(d.signal.aborted)return _(void 0);try{_(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:d.signal},type:"validateAsync"}))}catch(w){b(w)}},l.debounceMs)})}catch(_){p=_}const{formError:m,fieldErrors:g}=js(p);g&&(s=s?{...s,...g}:g);const y=_i(l.cause);for(const _ of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[_]===void 0)continue;const b=this.getFieldMeta(_);if(!b)continue;const{errorMap:w,errorSourceMap:k}=b,x=s?.[_],{newErrorValue:E,newSource:$}=om({newFormValidatorError:x,isPreviousErrorFromFormValidator:k?.[y]==="form",previousErrorValue:w?.[y]});w?.[y]!==E&&this.setFieldMeta(_,S=>({...S,errorMap:{...S.errorMap,[y]:E},errorSourceMap:{...S.errorSourceMap,[y]:$}}))}this.baseStore.setState(_=>({..._,errorMap:{..._.errorMap,[y]:m}})),f(s?{fieldErrors:s,errorMapKey:y}:void 0)}))}let o=[];const a={};if(i.length){o=await Promise.all(i);for(const l of o)if(l?.fieldErrors){const{errorMapKey:c}=l;for(const[u,d]of Object.entries(l.fieldErrors)){const p={...a[u]||{},[c]:d};a[u]=p}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),a},this.validate=r=>{const{hasErrored:n,fieldsErrorMap:i}=this.validateSync(r);return n&&!this.options.asyncAlways?i:this.validateAsync(r)},this._handleSubmit=async r=>{this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),It(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(o=>({...o,isTouched:!0})))})});const n=r??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:n});return}this.baseStore.setState(s=>({...s,isSubmitting:!0}));const i=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:n}),lt.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(s=>s.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:n}),lt.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}It(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:n});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:n}),It(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),lt.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),i()})}catch(s){throw this.baseStore.setState(o=>({...o,isSubmitSuccessful:!1})),lt.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:s}),i(),s}},this.getFieldValue=r=>kn(this.state.values,r),this.getFieldMeta=r=>this.state.fieldMeta[r],this.getFieldInfo=r=>this.fieldInfo[r]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(r,n)=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[r]:yi(n,i.fieldMetaBase[r])}}))},this.resetFieldMeta=r=>Object.keys(r).reduce((n,i)=>{const s=i;return n[s]=$n,n},{}),this.setFieldValue=(r,n,i)=>{const s=i?.dontUpdateMeta??!1,o=i?.dontRunListeners??!1,a=i?.dontValidate??!1;It(()=>{s||this.setFieldMeta(r,l=>({...l,isTouched:!0,isDirty:!0,errorMap:{...l?.errorMap,onMount:void 0}})),this.baseStore.setState(l=>({...l,values:Ls(l.values,r,n)}))}),o||this.getFieldInfo(r).instance?.triggerOnChangeListener(),a||this.validateField(r,"change")},this.deleteField=r=>{const i=[...Object.keys(this.fieldInfo).filter(s=>{const o=r.toString();return s!==o&&s.startsWith(o)}),r];this.baseStore.setState(s=>{const o={...s};return i.forEach(a=>{o.values=LM(o.values,a),delete this.fieldInfo[a],delete o.fieldMetaBase[a]}),o})},this.pushFieldValue=(r,n,i)=>{this.setFieldValue(r,s=>[...Array.isArray(s)?s:[],n],i)},this.insertFieldValue=async(r,n,i,s)=>{this.setFieldValue(r,a=>[...a.slice(0,n),i,...a.slice(n)],Ye(s,{dontValidate:!0}));const o=s?.dontValidate??!1;o||await this.validateField(r,"change"),qs(this).handleArrayInsert(r,n),o||await this.validateArrayFieldsStartingFrom(r,n,"change")},this.replaceFieldValue=async(r,n,i,s)=>{this.setFieldValue(r,a=>a.map((l,c)=>c===n?i:l),Ye(s,{dontValidate:!0})),(s?.dontValidate??!1)||(await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,n,"change"))},this.removeFieldValue=async(r,n,i)=>{const s=this.getFieldValue(r),o=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(r,l=>l.filter((c,u)=>u!==n),Ye(i,{dontValidate:!0})),qs(this).handleArrayRemove(r,n),o!==null){const l=`${r}[${o}]`;this.deleteField(l)}(i?.dontValidate??!1)||(await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,n,"change"))},this.swapFieldValues=(r,n,i,s)=>{this.setFieldValue(r,a=>{const l=a[n],c=a[i];return Ls(Ls(a,`${n}`,c),`${i}`,l)},Ye(s,{dontValidate:!0})),qs(this).handleArraySwap(r,n,i),(s?.dontValidate??!1)||(this.validateField(r,"change"),this.validateField(`${r}[${n}]`,"change"),this.validateField(`${r}[${i}]`,"change"))},this.moveFieldValues=(r,n,i,s)=>{this.setFieldValue(r,a=>{const l=[...a];return l.splice(i,0,l.splice(n,1)[0]),l},Ye(s,{dontValidate:!0})),qs(this).handleArrayMove(r,n,i),(s?.dontValidate??!1)||(this.validateField(r,"change"),this.validateField(`${r}[${n}]`,"change"),this.validateField(`${r}[${i}]`,"change"))},this.clearFieldValues=(r,n)=>{const i=this.getFieldValue(r),s=Array.isArray(i)?Math.max(i.length-1,0):null;if(this.setFieldValue(r,[],Ye(n,{dontValidate:!0})),s!==null)for(let a=0;a<=s;a++){const l=`${r}[${a}]`;this.deleteField(l)}(n?.dontValidate??!1)||this.validateField(r,"change")},this.resetField=r=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[r]:$n},values:this.options.defaultValues?Ls(n.values,r,kn(this.options.defaultValues,r)):n.values}))},this.setErrorMap=r=>{It(()=>{Object.entries(r).forEach(([n,i])=>{const s=n;if(Rl(i)){const{formError:o,fieldErrors:a}=js(i);for(const l of Object.keys(this.fieldInfo))this.getFieldMeta(l)&&this.setFieldMeta(l,u=>({...u,errorMap:{...u.errorMap,[s]:a?.[l]},errorSourceMap:{...u.errorSourceMap,[s]:"form"}}));this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[s]:o}}))}else this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[s]:i}}))})})},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((r,[n,i])=>(Object.keys(i).length&&i.errors.length&&(r[n]={errors:i.errors,errorMap:i.errorMap}),r),{})}),this.parseValuesWithSchema=r=>Sn.validate({value:this.state.values,validationSource:"form"},r),this.parseValuesWithSchemaAsync=r=>Sn.validateAsync({value:this.state.values,validationSource:"form"},r),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=t?.formId??lm(),this._devtoolsSubmissionOverride=!1,this.baseStore=new Pl(Fl({...t?.defaultState,values:t?.defaultValues??t?.defaultState?.values})),this.fieldMetaDerived=new Pt({deps:[this.baseStore],fn:({prevDepVals:r,currDepVals:n,prevVal:i})=>{const s=i,o=r?.[0],a=n[0];let l=0;const c={};for(const u of Object.keys(a.fieldMetaBase)){const d=a.fieldMetaBase[u],f=o?.fieldMetaBase[u],p=s?.[u],m=kn(a.values,u);let g=p?.errors;if(!f||d.errorMap!==f.errorMap){g=Object.values(d.errorMap??{}).filter(k=>k!==void 0);const w=this.getFieldInfo(u)?.instance;w&&!w.options.disableErrorFlat&&(g=g.flat(1))}const y=!jM(g),_=!d.isDirty,b=cr(m,kn(this.options.defaultValues,u))||cr(m,this.getFieldInfo(u)?.instance?.options.defaultValue);if(p&&p.isPristine===_&&p.isValid===y&&p.isDefaultValue===b&&p.errors===g&&d===f){c[u]=p,l++;continue}c[u]={...d,errors:g??[],isPristine:_,isValid:y,isDefaultValue:b}}return Object.keys(a.fieldMetaBase).length&&s&&l===Object.keys(a.fieldMetaBase).length?s:c}}),this.store=new Pt({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:r,currDepVals:n,prevVal:i})=>{const s=i,o=r?.[0],a=n[0],l=n[1],c=Object.values(l).filter(Boolean),u=c.some(M=>M.isValidating),d=c.every(M=>M.isValid),f=c.some(M=>M.isTouched),p=c.some(M=>M.isBlurred),m=c.every(M=>M.isDefaultValue),g=f&&a.errorMap?.onMount,y=c.some(M=>M.isDirty),_=!y,b=!!(a.errorMap?.onMount||c.some(M=>M?.errorMap?.onMount)),w=!!u;let k=s?.errors??[];(!o||a.errorMap!==o.errorMap)&&(k=Object.values(a.errorMap).reduce((M,L)=>L===void 0?M:L&&Rl(L)?(M.push(L.form),M):(M.push(L),M),[]));const x=k.length===0,E=d&&x,$=this.options.canSubmitWhenInvalid??!1,S=a.submissionAttempts===0&&!f&&!b||!w&&!a.isSubmitting&&E||$;let I=a.errorMap;if(g&&(k=k.filter(M=>M!==a.errorMap.onMount),I=Object.assign(I,{onMount:void 0})),s&&o&&s.errorMap===I&&s.fieldMeta===this.fieldMetaDerived.state&&s.errors===k&&s.isFieldsValidating===u&&s.isFieldsValid===d&&s.isFormValid===x&&s.isValid===E&&s.canSubmit===S&&s.isTouched===f&&s.isBlurred===p&&s.isPristine===_&&s.isDefaultValue===m&&s.isDirty===y&&cr(o,a))return s;let P={...a,errorMap:I,fieldMeta:this.fieldMetaDerived.state,errors:k,isFieldsValidating:u,isFieldsValid:d,isFormValid:x,isValid:E,canSubmit:S,isTouched:f,isBlurred:p,isPristine:_,isDefaultValue:m,isDirty:y};const C=this.options.transform?.deps??[];if(C.length!==this.prevTransformArray.length||C.some((M,L)=>M!==this.prevTransformArray[L])){const M=Object.assign({},this,{state:P});this.options.transform?.fn(M),P=M.state,this.prevTransformArray=C}return P}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(t||{})}get state(){return this.store.state}get formId(){return this._formId}runValidator(t){return um(t.validate)?Sn[t.type](t.value,t.validate):t.validate(t.value)}handleSubmit(t){return this._handleSubmit(t)}}function js(e){if(e){if(Rl(e)){const t=js(e.form).formError,r=e.fields;return{formError:t,fieldErrors:r}}return{formError:e}}return{formError:void 0}}function _i(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}class fm{constructor(t){this.options={},this.mount=()=>{const r=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const n=this.getInfo();n.instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const s=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});s&&this.setMeta(o=>({...o,errorMap:{...o?.errorMap,onMount:s},errorSourceMap:{...o?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),r},this.update=r=>{if(this.options=r,this.name=r.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const n=this.form.getFieldValue(this.name);cr(n,r.defaultValue)||this.form.setFieldValue(this.name,r.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(r,n)=>{this.form.setFieldValue(this.name,r,Ye(n,{dontRunListeners:!0,dontValidate:!0})),n?.dontRunListeners||this.triggerOnChangeListener(),n?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=r=>this.form.setFieldMeta(this.name,r),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(r,n)=>{this.form.pushFieldValue(this.name,r,Ye(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(r,n,i)=>{this.form.insertFieldValue(this.name,r,n,Ye(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(r,n,i)=>{this.form.replaceFieldValue(this.name,r,n,Ye(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(r,n)=>{this.form.removeFieldValue(this.name,r,Ye(n,{dontRunListeners:!0})),n?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(r,n,i)=>{this.form.swapFieldValues(this.name,r,n,Ye(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(r,n,i)=>{this.form.moveFieldValues(this.name,r,n,Ye(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=r=>{this.form.clearFieldValues(this.name,Ye(r,{dontRunListeners:!0})),r?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=r=>{const n=Object.values(this.form.fieldInfo),i=[];for(const s of n){if(!s.instance)continue;const{onChangeListenTo:o,onBlurListenTo:a}=s.instance.options.validators||{};r==="change"&&o?.includes(this.name)&&i.push(s.instance),r==="blur"&&a?.includes(this.name)&&i.push(s.instance)}return i},this.validateSync=(r,n)=>{const i=Tl(r,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Mn}),o=this.getLinkedFields(r).reduce((c,u)=>{const d=Tl(r,{...u.options,form:u.form,validationLogic:u.form.options.validationLogic||Mn});return d.forEach(f=>{f.field=u}),c.concat(d)},[]);let a=!1;It(()=>{const c=(u,d)=>{const f=Us(d.cause),p=d.validate?hm(u.runValidator({validate:d.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,m=n[f],{newErrorValue:g,newSource:y}=am({formLevelError:m,fieldLevelError:p});u.state.meta.errorMap?.[f]!==g&&u.setMeta(_=>({..._,errorMap:{..._.errorMap,[f]:g},errorSourceMap:{..._.errorSourceMap,[f]:y}})),g&&(a=!0)};for(const u of i)c(this,u);for(const u of o)u.validate&&c(u.field,u)});const l=Us("submit");return this.state.meta.errorMap?.[l]&&r!=="submit"&&!a&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[l]:void 0},errorSourceMap:{...c.errorSourceMap,[l]:void 0}})),{hasErrored:a}},this.validateAsync=async(r,n)=>{const i=Nl(r,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Mn}),s=await n,o=this.getLinkedFields(r),a=o.reduce((p,m)=>{const g=Nl(r,{...m.options,form:m.form,validationLogic:m.form.options.validationLogic||Mn});return g.forEach(y=>{y.field=m}),p.concat(g)},[]),l=[],c=[],u=i.some(p=>p.validate)||a.some(p=>p.validate);if(u){this.state.meta.isValidating||this.setMeta(p=>({...p,isValidating:!0}));for(const p of o)p.setMeta(m=>({...m,isValidating:!0}))}const d=(p,m,g)=>{const y=Us(m.cause);p.getInfo().validationMetaMap[y]?.lastAbortController.abort();const b=new AbortController;this.getInfo().validationMetaMap[y]={lastAbortController:b},g.push(new Promise(async w=>{let k;try{k=await new Promise((I,P)=>{this.timeoutIds.validations[m.cause]&&clearTimeout(this.timeoutIds.validations[m.cause]),this.timeoutIds.validations[m.cause]=setTimeout(async()=>{if(b.signal.aborted)return I(void 0);try{I(await this.runValidator({validate:m.validate,value:{value:p.store.state.value,fieldApi:p,signal:b.signal,validationSource:"field"},type:"validateAsync"}))}catch(C){P(C)}},m.debounceMs)})}catch(I){k=I}if(b.signal.aborted)return w(void 0);const x=hm(k),E=s[this.name]?.[y],{newErrorValue:$,newSource:S}=am({formLevelError:E,fieldLevelError:x});p.setMeta(I=>({...I,errorMap:{...I?.errorMap,[y]:$},errorSourceMap:{...I.errorSourceMap,[y]:S}})),w($)}))};for(const p of i)p.validate&&d(this,p,l);for(const p of a)p.validate&&d(p.field,p,c);let f=[];if((l.length||c.length)&&(f=await Promise.all(l),await Promise.all(c)),u){this.setMeta(p=>({...p,isValidating:!1}));for(const p of o)p.setMeta(m=>({...m,isValidating:!1}))}return f.filter(Boolean)},this.validate=(r,n)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=n?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(r),{hasErrored:s}=this.validateSync(r,i[this.name]??{});if(s&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[Us(r)]?.lastAbortController.abort(),this.state.meta.errors;const o=n?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(r);return this.validateAsync(r,o)},this.handleChange=r=>{this.setValue(r)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(n=>({...n,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(n=>({...n,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.setErrorMap=r=>{this.setMeta(n=>({...n,errorMap:{...n.errorMap,...r}}))},this.parseValueWithSchema=r=>Sn.validate({value:this.state.value,validationSource:"field"},r),this.parseValueWithSchemaAsync=r=>Sn.validateAsync({value:this.state.value,validationSource:"field"},r),this.triggerOnChangeListener=()=>{const r=this.form.options.listeners?.onChangeDebounceMs;r&&r>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},r)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const n=this.options.listeners?.onChangeDebounceMs;n&&n>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},n)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},this.form=t.form,this.name=t.name,this.options=t,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new Pt({deps:[this.form.store],fn:({prevVal:r})=>{const n=r,i=this.form.getFieldMeta(this.name)??{...$n,...t.defaultMeta};let s=this.form.getFieldValue(this.name);return!i.isTouched&&s===void 0&&this.options.defaultValue!==void 0&&!cr(s,this.options.defaultValue)&&(s=this.options.defaultValue),n&&n.value===s&&n.meta===i?n:{value:s,meta:i}}})}get state(){return this.store.state}runValidator(t){return um(t.validate)?Sn[t.type](t.value,t.validate):t.validate(t.value)}triggerOnBlurListener(){const t=this.form.options.listeners?.onBlurDebounceMs;t&&t>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},t)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const r=this.options.listeners?.onBlurDebounceMs;r&&r>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},r)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}}function hm(e){if(e)return e}function Us(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}class Ks{constructor(t){if(this.getFormFieldName=r=>{if(typeof this.fieldsMap=="string")return sm(this.fieldsMap,r);const n=Vs(r)[0];if(typeof n!="string")return"";const i=r.slice(n.length),s=this.fieldsMap[n];return sm(s,i)},this.getFormFieldOptions=r=>{const n={...r},i=n.validators;if(n.name=this.getFormFieldName(r.name),i&&(i.onChangeListenTo||i.onBlurListenTo)){const s={...i},o=a=>{if(a)return a.map(l=>this.getFormFieldName(l))};s.onChangeListenTo=o(i.onChangeListenTo),s.onBlurListenTo=o(i.onBlurListenTo),n.validators=s}return n},this.mount=()=>this.store.mount(),this.validateArrayFieldsStartingFrom=async(r,n,i)=>this.form.validateArrayFieldsStartingFrom(this.getFormFieldName(r),n,i),this.validateField=(r,n)=>this.form.validateField(this.getFormFieldName(r),n),this.getFieldValue=r=>this.form.getFieldValue(this.getFormFieldName(r)),this.getFieldMeta=r=>this.form.getFieldMeta(this.getFormFieldName(r)),this.setFieldMeta=(r,n)=>this.form.setFieldMeta(this.getFormFieldName(r),n),this.setFieldValue=(r,n,i)=>this.form.setFieldValue(this.getFormFieldName(r),n,i),this.deleteField=r=>this.form.deleteField(this.getFormFieldName(r)),this.pushFieldValue=(r,n,i)=>this.form.pushFieldValue(this.getFormFieldName(r),n,i),this.insertFieldValue=async(r,n,i,s)=>this.form.insertFieldValue(this.getFormFieldName(r),n,i,s),this.replaceFieldValue=async(r,n,i,s)=>this.form.replaceFieldValue(this.getFormFieldName(r),n,i,s),this.removeFieldValue=async(r,n,i)=>this.form.removeFieldValue(this.getFormFieldName(r),n,i),this.swapFieldValues=(r,n,i,s)=>this.form.swapFieldValues(this.getFormFieldName(r),n,i,s),this.moveFieldValues=(r,n,i,s)=>this.form.moveFieldValues(this.getFormFieldName(r),n,i,s),this.clearFieldValues=(r,n)=>this.form.clearFieldValues(this.getFormFieldName(r),n),this.resetField=r=>this.form.resetField(this.getFormFieldName(r)),this.validateAllFields=r=>this.form.validateAllFields(r),t.form instanceof Ks){const r=t.form;if(this.form=r.form,typeof t.fields=="string")this.fieldsMap=r.getFormFieldName(t.fields);else{const n={...t.fields};for(const i in n)n[i]=r.getFormFieldName(n[i]);this.fieldsMap=n}}else this.form=t.form,this.fieldsMap=t.fields;this.store=new Pt({deps:[this.form.store],fn:({currDepVals:r})=>{const n=r[0];let i;if(typeof this.fieldsMap=="string")i=kn(n.values,this.fieldsMap);else{i={};const s=this.fieldsMap;for(const o in s)i[o]=kn(n.values,s[o])}return{values:i}}})}get state(){return this.store.state}async handleSubmit(t){return this.form.handleSubmit(t)}}var Gs={exports:{}},Ll={};const Ws=Ng(Eo);var Hs={exports:{}},Dl={};var pm;function GM(){if(pm)return Dl;pm=1;var e=Ws;function t(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var r=typeof Object.is=="function"?Object.is:t,n=e.useState,i=e.useEffect,s=e.useLayoutEffect,o=e.useDebugValue;function a(d,f){var p=f(),m=n({inst:{value:p,getSnapshot:f}}),g=m[0].inst,y=m[1];return s(function(){g.value=p,g.getSnapshot=f,l(g)&&y({inst:g})},[d,p,f]),i(function(){return l(g)&&y({inst:g}),d(function(){l(g)&&y({inst:g})})},[d]),o(p),p}function l(d){var f=d.getSnapshot;d=d.value;try{var p=f();return!r(d,p)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Dl.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,Dl}var Vl={},mm;function WM(){if(mm)return Vl;mm=1;var e={};return e.NODE_ENV!=="production"&&(function(){function t(m,g){return m===g&&(m!==0||1/m===1/g)||m!==m&&g!==g}function r(m,g){d||s.startTransition===void 0||(d=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var y=g();if(!f){var _=g();o(y,_)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),f=!0)}_=a({inst:{value:y,getSnapshot:g}});var b=_[0].inst,w=_[1];return c(function(){b.value=y,b.getSnapshot=g,n(b)&&w({inst:b})},[m,y,g]),l(function(){return n(b)&&w({inst:b}),m(function(){n(b)&&w({inst:b})})},[m]),u(y),y}function n(m){var g=m.getSnapshot;m=m.value;try{var y=g();return!o(m,y)}catch{return!0}}function i(m,g){return g()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var s=Ws,o=typeof Object.is=="function"?Object.is:t,a=s.useState,l=s.useEffect,c=s.useLayoutEffect,u=s.useDebugValue,d=!1,f=!1,p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?i:r;Vl.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:p,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())})(),Vl}var gm;function ym(){if(gm)return Hs.exports;gm=1;var e={};return e.NODE_ENV==="production"?Hs.exports=GM():Hs.exports=WM(),Hs.exports}var _m;function HM(){if(_m)return Ll;_m=1;var e=Ws,t=ym();function r(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var n=typeof Object.is=="function"?Object.is:r,i=t.useSyncExternalStore,s=e.useRef,o=e.useEffect,a=e.useMemo,l=e.useDebugValue;return Ll.useSyncExternalStoreWithSelector=function(c,u,d,f,p){var m=s(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=a(function(){function _(E){if(!b){if(b=!0,w=E,E=f(E),p!==void 0&&g.hasValue){var $=g.value;if(p($,E))return k=$}return k=E}if($=k,n(w,E))return $;var S=f(E);return p!==void 0&&p($,S)?(w=E,$):(w=E,k=S)}var b=!1,w,k,x=d===void 0?null:d;return[function(){return _(u())},x===null?void 0:function(){return _(x())}]},[u,d,f,p]);var y=i(c,m[0],m[1]);return o(function(){g.hasValue=!0,g.value=y},[y]),l(y),y},Ll}var zl={},bm;function JM(){if(bm)return zl;bm=1;var e={};return e.NODE_ENV!=="production"&&(function(){function t(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=Ws,n=ym(),i=typeof Object.is=="function"?Object.is:t,s=n.useSyncExternalStore,o=r.useRef,a=r.useEffect,l=r.useMemo,c=r.useDebugValue;zl.useSyncExternalStoreWithSelector=function(u,d,f,p,m){var g=o(null);if(g.current===null){var y={hasValue:!1,value:null};g.current=y}else y=g.current;g=l(function(){function b($){if(!w){if(w=!0,k=$,$=p($),m!==void 0&&y.hasValue){var S=y.value;if(m(S,$))return x=S}return x=$}if(S=x,i(k,$))return S;var I=p($);return m!==void 0&&m(S,I)?(k=$,S):(k=$,x=I)}var w=!1,k,x,E=f===void 0?null:f;return[function(){return b(d())},E===null?void 0:function(){return b(E())}]},[d,f,p,m]);var _=s(u,g[0],g[1]);return a(function(){y.hasValue=!0,y.value=_},[_]),c(_),_},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())})(),zl}var vm;function YM(){if(vm)return Gs.exports;vm=1;var e={};return e.NODE_ENV==="production"?Gs.exports=HM():Gs.exports=JM(),Gs.exports}var QM=YM();function ct(e,t=n=>n,r={}){const n=r.equal??ZM;return QM.useSyncExternalStoreWithSelector(e.subscribe,()=>e.state,()=>e.state,t,n)}function ZM(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,i]of e)if(!t.has(n)||!Object.is(i,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();const r=wm(e);if(r.length!==wm(t).length)return!1;for(let n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(t,r[n])||!Object.is(e[r[n]],t[r[n]]))return!1;return!0}function wm(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}const bi=typeof window<"u"?Nt:ee;function XM(e){const[t,r]=F(()=>({form:e.form,name:e.name})),[n,i]=F(()=>new fm({...e}));(t.form!==e.form||t.name!==e.name)&&(i(new fm({...e})),r({form:e.form,name:e.name}));const s=ct(n.store,e.mode==="array"?p=>Object.keys(p.value??[]).length:p=>p.value),o=ct(n.store,p=>p.meta.isTouched),a=ct(n.store,p=>p.meta.isBlurred),l=ct(n.store,p=>p.meta.isDirty),c=ct(n.store,p=>p.meta.errorMap),u=ct(n.store,p=>p.meta.errorSourceMap),d=ct(n.store,p=>p.meta.isValidating),f=V(()=>{const m={...n,get state(){return{value:e.mode==="array"?n.state.value:s,get meta(){return{...n.state.meta,isTouched:o,isBlurred:a,isDirty:l,errorMap:c,errorSourceMap:u,isValidating:d}}}}};return m.Field=xm,m},[n,e.mode,s,o,a,l,c,u,d]);return bi(n.mount,[n]),bi(()=>{n.update(e)}),f}const xm=(({children:e,...t})=>{const r=XM(t),n=V(()=>yi(e,r),[e,r]);return ze(Q,{children:n})});function eS(){return F(()=>lm())[0]}const tS=Gc.split(".")[0]==="17"?eS:$i;function rS({form:e,selector:t,children:r}){const n=ct(e.store,t);return ze(Q,{children:yi(r,n)})}function nS(e){const t=tS(),[r,n]=F(e?.formId),[i,s]=F(()=>new dm({...e,formId:e?.formId??t}));if(r!==e?.formId){const a=e?.formId??t;s(new dm({...e,formId:a})),n(a)}const o=V(()=>{const a={...i,handleSubmit:((...l)=>i._handleSubmit(...l)),get formId(){return i._formId},get state(){return i.store.state}};return a.Field=function(c){return ze(xm,{...c,form:i})},a.Subscribe=function(c){return ze(rS,{form:i,selector:c.selector,children:c.children})},a},[i]);return bi(i.mount,[]),bi(()=>{i.update(e)}),o}function iS({lens:e,selector:t,children:r}){const n=ct(e.store,t);return ze(Q,{children:yi(r,n)})}function sS(e){const[t]=F(()=>{const r=new Ks(e),n=e.form instanceof Ks?e.form.form:e.form,i=r;return i.AppForm=function(o){return ze(n.AppForm,{...o})},i.AppField=function(o){return ze(n.AppField,{...t.getFormFieldOptions(o)})},i.Field=function(o){return ze(n.Field,{...t.getFormFieldOptions(o)})},i.Subscribe=function(o){return ze(iS,{lens:t,selector:o.selector,children:o.children})},Object.assign(i,{...e.formComponents})});return bi(t.mount,[t]),t}const km=_t(null),Mm=_t(null);function oS(){function e(){const r=te(km);if(!r)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return r}function t(){const r=te(Mm);if(!r)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return r}return{fieldContext:km,useFieldContext:e,useFormContext:t,formContext:Mm}}function aS({fieldComponents:e,fieldContext:t,formContext:r,formComponents:n}){function i(a){const l=nS(a),c=V(()=>({children:f})=>ze(r.Provider,{value:l,children:f}),[l]),u=V(()=>(({children:p,...m})=>ze(l.Field,{...m,children:g=>ze(t.Provider,{value:g,children:p(Object.assign(g,e))})})),[l]);return V(()=>Object.assign(l,{AppField:u,AppForm:c,...n}),[l,u,c])}function s({render:a,props:l}){return c=>a({...l,...c})}function o({render:a,props:l,defaultValues:c}){return function(d){const f=V(()=>({form:d.form,fields:d.fields,defaultValues:c,formComponents:n}),[d.form,d.fields]),p=sS(f);return a({...l,...d,group:p})}}return{useAppForm:i,withForm:s,withFieldGroup:o}}function lS({label:e,domains:t,required:r}){const n=$e(),i=vi();return h(Mt,{children:h(Xr,{hass:n,label:e,domains:t,value:i.state.value||"",required:r,error:i.state.meta.errors.join(", "),onChange:s=>i.handleChange(s)})})}function cS({label:e,domains:t}){const r=$e(),n=vi();return h(Mt,{children:h($b,{hass:r,value:n.state.value??[],onChange:i=>{n.handleChange(i)},label:e,domains:t})})}function uS({label:e}){const t=vi();return A(xb,{children:[h(Mb,{id:t.name,checked:t.state.value,onChange:r=>t.handleChange(r.target?.checked??!1)}),h(kb,{htmlFor:t.name,children:e})]})}function dS(){const e=vi(),t=$e();return h(Vd,{hass:t,value:e.state.value,onChange:r=>e.handleChange(r??{})})}function fS({label:e,required:t,isIconInput:r}){const n=vi(),i=$e();return h(wb,{children:h(Jn,{value:n.state.value??"",onChange:s=>n.handleChange(s??""),hass:i,required:t,isIconInput:r,label:e,error:n.state.meta.errors.join(", ")})})}const{fieldContext:hS,formContext:pS,useFieldContext:vi}=oS(),{useAppForm:Bl,withFieldGroup:Js}=aS({fieldContext:hS,formContext:pS,fieldComponents:{EntityPicker:lS,EntitiesPicker:cS,InteractionsPicker:dS,Toggle:uS,Text:fS},formComponents:{}}),ql=Js({defaultValues:{ma_entity_id:null,ma_favorite_button_entity_id:null},props:{},render:function({group:t}){return A(Q,{children:[h(t.AppField,{name:"ma_entity_id",children:r=>h(r.EntityPicker,{label:"Music Assistant Entity ID (Optional)",domains:["media_player"]})}),h(t.AppField,{name:"ma_favorite_button_entity_id",children:r=>h(r.EntityPicker,{label:"MA Favorite Button Entity ID (Optional)",domains:["button"]})})]})}}),ur={root:v({border:"1px solid var(--outline-color, #e0e0e0)",borderRadius:"6px",position:"relative",marginBottom:"16px"}),rootError:v({borderColor:"var(--error-color, #ff5252)"}),header:v({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",borderBottom:"none"}),headerButtons:v({display:"flex",gap:"8px",alignItems:"center"}),headerExpanded:v({borderBottom:"1px solid var(--outline-color, #e0e0e0)"}),title:v({margin:0,fontSize:"14px",fontWeight:500}),content:v({padding:12,display:"none"}),contentExpanded:v({display:"block"})},le=({title:e,children:t,initiallyExpanded:r=!1,buttons:n=[],error:i})=>{const[s,o]=F(r);return A("div",{css:[ur.root,!!i&&ur.rootError],children:[A("div",{css:[ur.header,s&&ur.headerExpanded],children:[h("div",{css:ur.title,children:e}),A("div",{css:ur.headerButtons,children:[n.map((a,l)=>h(B,{icon:a.icon,onClick:a.onClick,type:"button",size:"small"},l+a.icon)),h(B,{onClick:()=>o(!s),icon:s?"mdi:chevron-up":"mdi:chevron-down",type:"button",size:"small"})]})]}),h("div",{css:[ur.content,s&&ur.contentExpanded],children:t})]})},mS={buttons:v({display:"flex",flexDirection:"row",gap:"8px"})},gS=({hass:e,entityId:t,mediaTypes:r,onChange:n})=>{const[i,s]=F(null),o=O(async()=>{const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:t},return_response:!0};try{const l=await e.connection.sendMessagePromise(a);return l?l.response[t]?.children.filter(c=>!c.media_content_id||c.media_content_id&&!c.media_content_id.startsWith("media-source")).map(c=>({name:c.title,media_type:c.media_content_type,icon:yS(c)}))||[]:[]}catch(l){return s(l instanceof Error?l.message:String(l)),[]}},[t]);return h(le,{title:"Media Types (optional)",children:A(Q,{children:[h(Xi,{children:"Use custom media types. If none added sensible defaults will be used. Be aware that not all media types are necessarily searchable."}),r.map((a,l)=>A(le,{title:a.name??a.media_type,error:!a.media_type,buttons:[{icon:"mdi:arrow-up",onClick:()=>{if(l===0)return;const c=[...r],u=c[l-1];c[l-1]=c[l],c[l]=u,n(c)}},{icon:"mdi:arrow-down",onClick:()=>{if(l===r.length-1)return;const c=[...r],u=c[l+1];c[l+1]=c[l],c[l]=u,n(c)}},{icon:"mdi:delete",onClick:()=>{const c=[...r];c.splice(l,1),n(c)}}],children:[h(Jn,{hass:e,value:a.name||"",label:"Name",onChange:c=>{if(!c)return;const u=[...r];u[l]={...u[l],name:c},n(u)}}),h(Jn,{hass:e,value:a.icon??"",isIconInput:!0,label:"Icon",onChange:c=>{if(!c)return;const u=[...r];u[l]={...u[l],icon:c},n(u)}}),h(Jn,{hass:e,value:a.media_type||"",label:"Media Type",onChange:c=>{if(!c)return;const u=[...r];u[l]={...u[l],media_type:c},n(u)}})]},l+a.media_type)),A("div",{css:mS.buttons,children:[h(Hn,{variant:"neutral",onClick:()=>n([...r,{name:"",media_type:""}]),children:"Add"}),h(Hn,{variant:"neutral",onClick:async()=>{const a=await o();a.length!==0&&n(a)},children:"Generate"}),h(Hn,{variant:"danger",onClick:()=>n([]),children:"Clear"})]}),i&&h(wa,{children:i})]})})},yS=e=>{if(e.thumbnail)return e.thumbnail;switch(e.media_class){case"album":return"mdi:album";case"artist":return"mdi:account-music";case"track":return"mdi:music-note";case"playlist":return"mdi:playlist-music";default:return"mdi:folder-music"}},jl=Js({defaultValues:{search:{},ma_entity_id:null},props:{},render:function({group:t}){const r=$e();return h(t.Field,{name:"search",mode:"array",children:n=>A(Q,{children:[Array.isArray(n.state.value)&&n.state.value?.map((i,s)=>h(le,{title:i.name??i.entity_id??`Entry ${s}`,buttons:[{icon:"mdi:delete",onClick:()=>n.removeValue(s)},{icon:"mdi:arrow-up",onClick:()=>{n.moveValue(s,s-1)}},{icon:"mdi:arrow-down",onClick:()=>{n.moveValue(s,s+1)}}],children:A(Mt,{children:[h(t.AppField,{name:`search[${s}].name`,children:o=>h(o.Text,{label:"Name"})}),h(t.AppField,{name:`search[${s}].entity_id`,children:o=>h(o.EntityPicker,{label:"Media Player Entity ID (to search)",domains:["media_player"],required:!0})}),i.entity_id&&h(t.Field,{name:`search[${s}].media_types`,children:o=>h(gS,{entityId:i.entity_id,hass:r,mediaTypes:o.state.value??[],onChange:a=>{o.handleChange(a??[])}})})]})},s)),h(Xr,{hass:r,value:"",onChange:i=>{i&&n.pushValue({entity_id:i,name:r.states[i]?.attributes.friendly_name??"Search"})},label:"Add Search",domains:["media_player"]})]})})}}),Ul=Js({defaultValues:{media_browser:[]},props:{},render:function({group:t}){const r=$e();return h(t.Field,{name:"media_browser",mode:"array",children:n=>A(Q,{children:[Array.isArray(n.state.value)&&n.state.value?.map((i,s)=>h(le,{title:i.name??i.entity_id??`Entry ${s}`,buttons:[{icon:"mdi:delete",onClick:()=>n.removeValue(s)},{icon:"mdi:arrow-up",onClick:()=>{n.moveValue(s,s-1)}},{icon:"mdi:arrow-down",onClick:()=>{n.moveValue(s,s+1)}}],children:A(Mt,{children:[h(t.AppField,{name:`media_browser[${s}].name`,children:o=>h(o.Text,{label:"Name"})}),h(t.AppField,{name:`media_browser[${s}].entity_id`,children:o=>h(o.EntityPicker,{label:"Media Browser Entity ID",domains:["media_player"]})})]})},s)),h(Xr,{hass:r,value:"",onChange:i=>{i&&n.pushValue({entity_id:i,name:r.states[i]?.attributes.friendly_name??void 0})},label:"Add Media Browser",domains:["media_player"]})]})})}}),Kl=Js({defaultValues:{custom_buttons:[]},props:{formErrors:{}},render:function({group:t,formErrors:r}){const n=$e(),i=O(s=>!!Object.keys(r?.onChange??{}).find(o=>o.startsWith(s)),[r]);return h(t.Field,{name:"custom_buttons",mode:"array",children:s=>A(Q,{children:[Array.isArray(s.state.value)&&s.state.value?.map((o,a)=>{const l=`${o.name}-${a}`;return h(le,{title:`Button ${a} - ${o.name}`,error:i(`custom_buttons[${a}]`),buttons:[{icon:"mdi:delete",onClick:()=>s.removeValue(a)},{icon:"mdi:arrow-up",onClick:()=>{s.swapValues(a,a-1)}},{icon:"mdi:arrow-down",onClick:()=>{s.swapValues(a,a+1)}}],children:A(Mt,{children:[h(t.AppField,{name:`custom_buttons[${a}].name`,children:c=>h(c.Text,{label:"Name"})}),h(t.AppField,{name:`custom_buttons[${a}].icon`,children:c=>h(c.Text,{label:"Icon",isIconInput:!0})}),h(Xi,{children:"Interactions"}),h(t.Field,{name:`custom_buttons[${a}]`,children:c=>{const u=c.state.value??{icon:"",name:""},{name:d,icon:f,...p}=u;return h(Vd,{hass:n,value:p,onChange:m=>{c.handleChange({name:d,icon:f,...m})}})}})]})},l)}),h(Hn,{onClick:()=>{s.pushValue({name:"New Button",icon:"mdi:button-pointer"})},children:"Add Custom Button"})]})})}}),_S=({config:e,rootElement:t,hass:r})=>{const n=O(a=>{const l=new Event("config-changed",{bubbles:!0,composed:!0});l.detail={config:a},t.dispatchEvent(l)},[t]),i=Bl({defaultValues:Su(e),validators:{onChange:CM},listeners:{onChange:({formApi:a})=>{if(a.state.isValid){const l=Cu(a.state.values);JSON.stringify(e)!==JSON.stringify(Cu(l))&&n(l)}else console.log(a.state.errors)},onChangeDebounceMs:500}}),s=ct(i.store,a=>a.errorMap),o=O(a=>!!Object.keys(s?.onChange??{}).find(l=>l.startsWith(a)),[s]);return ee(()=>{const a=i.state.values,l=Su(e);JSON.stringify(a)!==JSON.stringify(l)&&i.reset(l)},[e,i]),!e||!r?null:A(i.AppForm,{children:[h(i.AppField,{name:"entity_id",children:a=>h(a.EntityPicker,{label:"Media Player Entity",required:!0,domains:["media_player"]})}),A(Mt,{css:v({display:"flex",flexDirection:"row",alignItems:"center",gap:"16px"}),children:[h(i.AppField,{name:"use_art_colors",children:a=>h(a.Toggle,{label:"Use album art colors."})}),h(i.Field,{name:"mode",children:a=>h(xa,{options:[{name:"Panel",value:"panel"},{name:"Card",value:"card"},{name:"In Card",value:"in-card"}],onSelected:l=>a.handleChange(l),selected:e.mode||"panel"})})]}),h(le,{title:"Interactions",error:o("action"),children:h(i.AppField,{name:"action",children:a=>h(a.InteractionsPicker,{})})}),A(le,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[h(i.AppField,{name:"speaker_group.entity_id",children:a=>h(a.EntityPicker,{label:"Main Speaker Entity ID (Optional)",domains:["media_player"]})}),h(i.AppField,{name:"speaker_group.entities",children:a=>h(a.EntitiesPicker,{label:"Select Speakers (including main speaker)",domains:["media_player"]})})]}),h(le,{title:"Music Assistant Configuration (optional)",error:o("ma_entity_id")??o("ma_favorite_button_entity_id"),children:h(ql,{form:i,fields:{ma_entity_id:"ma_entity_id",ma_favorite_button_entity_id:"ma_favorite_button_entity_id"}})}),h(le,{title:"LMS Configuration (optional)",error:o("lms_entity_id"),children:h(i.AppField,{name:"lms_entity_id",children:a=>h(a.EntityPicker,{label:"LMS Media Player Entity ID",domains:["media_player"]})})}),h(le,{title:"Search (optional)",error:o("search"),children:h(jl,{form:i,fields:{search:"search",ma_entity_id:"ma_entity_id"}})}),h(le,{title:"Media Browser (optional)",error:o("media_browser"),children:h(Ul,{form:i,fields:{media_browser:"media_browser"}})}),h(le,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:h(Kl,{form:i,formErrors:s,fields:{custom_buttons:"custom_buttons"}})}),A(le,{title:"Additional options (optional)",error:o("options"),children:[h(i.AppField,{name:"options.always_show_power_button",children:a=>h(a.Toggle,{label:"Always show power button."})}),h(i.AppField,{name:"options.show_volume_step_buttons",children:a=>h(a.Toggle,{label:"Show volume step buttons + - on volume sliders"})}),h(i.AppField,{name:"options.use_volume_up_down_for_step_buttons",children:a=>h(a.Toggle,{label:"Use volume_up and volume_down services for step buttons (breaks volume sync when step buttons are used)"})})]})]})},Sm={root:v({display:"flex",flexDirection:"row",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"},paddingTop:"16px",paddingBottom:"16px",borderTop:`0.5px solid ${j.colors.onCardDivider}`,gap:"2px"}),chip:v({"&:first-child":{marginLeft:16},"&:last-child":{marginRight:16}})},bS=()=>{const{config:e}=te(de),{custom_buttons:t}=e;return h("div",{css:Sm.root,children:t?.map((r,n)=>h($m,{button:r},n))})},$m=({button:e,type:t="chip"})=>{const{rootElement:r,config:n}=te(de),{icon:i,name:s,...o}=e,a=jt({rootElement:r,actionConfig:{...o,entity:n.entity_id}});return t==="icon-button"?h(B,{icon:e.icon??"mdi:dots-vertical",size:"x-small",...a}):A(Ze,{css:Sm.chip,icon:i,...a,children:[!!s&&h("span",{children:s}),a.renderLongPressIndicator()]})},vS=br`
  from {
    top: 15%;
    opacity: 0;
  }
  to {
    top: 0%;
    opacity: 1;
  }
`,Cm=58,dr={overlay:v({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:8,transition:"opacity 0.3s ease-in-out",display:"flex",justifyContent:"center",alignItems:"flex-end","@media screen and (min-height: 832px)":{alignItems:"center"}}),clickableBackground:v({position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),popUpContainer:v({position:"relative",animation:`${vS} 0.55s cubic-bezier(0.25, 1, 0.5, 1) forwards`,maxHeight:"98vh",height:"fit-content",width:"424px",maxWidth:"98vw",backgroundColor:j.colors.dialog,overflow:"hidden","--mmpc-popup-shadow-color":"var(--ha-color-shadow-dark)",boxShadow:"var(--ha-box-shadow-l)",borderTopLeftRadius:"var(--ha-dialog-border-radius, 28px)",borderTopRightRadius:"var(--ha-dialog-border-radius, 28px)","@media screen and (min-height: 832px)":{borderRadius:"var(--ha-dialog-border-radius, 28px)",boxShadow:"0px 0px 20px var(--mmpc-popup-shadow-color)"}}),popUpContainerLight:v({boxShadow:"0px 10px 20px --mmpc-popup-shadow-color"}),popUpContent:v({display:"grid",height:"100%"}),popUpHeader:v({display:"flex",height:Cm,justifyContent:"flex-start",alignItems:"center",padding:"0px 16px",borderBottom:"1px solid var(--divider-color, rgba(0, 0, 0, 0.12))",gap:"8px"}),title:v({margin:0,fontSize:"18px",fontWeight:500,color:j.colors.onDialog,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"auto"}),massiveCard:v({maxHeight:`calc(98vh - ${Cm}px)`,maxWidth:"98vw",width:"100%",height:"100%",overflow:"hidden"})},wS=({visible:e,setVisible:t})=>{const r=$e(),{config:n,rootElement:i}=te(de),{entity_id:s,speaker_group:o}=n,{attributes:{friendly_name:a,icon:l,device_class:c}}=ye(),u=r.states[o?.entity_id??s]?.attributes?.group_members,d=Un({icon:l,deviceClass:c}),f=V(()=>{const{tap_opens_popup:m,...g}=n;return{...g,mode:"popup"}},[n]),p=jt({rootElement:i,actionConfig:{tap_action:{action:"more-info"},entity:s}});return e?A("div",{css:dr.overlay,children:[h("div",{css:dr.clickableBackground,onClick:()=>t(!1)}),A("div",{css:[dr.popUpContainer,!Bt()&&dr.popUpContainerLight],children:[A("div",{css:dr.popUpHeader,children:[h(be,{size:"small",icon:d}),A("h2",{css:dr.title,children:[a,u?.length>1&&A("span",{children:[" +",u.length-1]})]}),h(B,{size:"small",...p,icon:"mdi:dots-vertical"}),h(B,{icon:"mdi:close",size:"small",onClick:()=>t(!1)})]}),h("div",{css:dr.popUpContent,children:h(Zi,{rootElement:i,config:f,children:h(La,{css:dr.massiveCard})})})]})]}):null},xS={root:v({maxHeight:300,paddingBottom:12,borderTop:`0.5px solid ${j.colors.onCardDivider}`,overflowY:"auto"})},kS=()=>{const{config:e}=te(de),{media_browser:t,entity_id:r}=e;return Wi(t)===!1?null:h("div",{css:xS.root,children:h(Ea,{mediaBrowserEntryArray:fa(t,r),horizontalPadding:12})})},Am={titleText:v({margin:0,fontSize:"16px",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:j.colors.onCard}),artistText:v({margin:0,fontSize:"14px",color:j.colors.onCardMuted,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},MS=()=>{const{title:e,subtitle:t}=ye();return A(Q,{children:[!!e&&h("h3",{css:Am.titleText,children:e}),!!t&&h("p",{css:Am.artistText,children:t})]})},wi={root:v({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",marginTop:"auto",height:"36px",marginLeft:"-4px"}),buttonMuted:v({opacity:.8}),shuffleButton:v({"@container (max-width: 150px)":{display:"none"}}),repeatButton:v({"@container (max-width: 130px)":{display:"none"}})},SS=()=>{const{attributes:{shuffle:e,repeat:t},state:r}=ye(),n=r==="playing",{supportPreviousTrack:i,supportNextTrack:s,supportsShuffle:o,supportsRepeat:a,supportsTogglePlayPause:l,supportsStop:c}=os(),{togglePlayback:u,toggleRepeat:d,toggleShuffle:f,previousTrack:p,nextTrack:m,stop:g}=Ra();return A("div",{css:wi.root,children:[!!o&&h(B,{css:[wi.shuffleButton,...e?[]:[wi.buttonMuted]],size:"x-small",onClick:f,icon:e?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),!!i&&h(B,{size:"small",onClick:p,icon:"mdi:skip-previous"}),l?h(B,{size:"medium",onClick:u,icon:n?"mdi:pause-circle":"mdi:play-circle"}):c?h(B,{size:"medium",onClick:g,icon:"mdi:stop"}):null,!!s&&h(B,{size:"small",onClick:m,icon:"mdi:skip-next"}),!!a&&h(B,{css:[wi.repeatButton,...t==="off"?[wi.buttonMuted]:[]],size:"x-small",onClick:d,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},Gl={root:v({display:"flex",flexDirection:"row",alignItems:"center",gap:"4px"}),friendlyName:v({fontSize:"11px",color:j.colors.onCardMuted,opacity:.8,fontStyle:"italic"})},$S=()=>{const e=$e(),{config:t}=te(de),{entity_id:r,speaker_group:n}=t,{attributes:{friendly_name:i,icon:s,device_class:o}}=ye(),a=e.states[n?.entity_id??r]?.attributes?.group_members,l=Un({icon:s,deviceClass:o});return A("div",{css:Gl.root,children:[h(be,{icon:l,size:"xx-small"}),h("span",{css:Gl.friendlyName,children:t.name??i}),a&&a.length>1&&A("span",{css:Gl.friendlyName,children:["+",a.length-1]})]})},Wl={root:v({maxHeight:300,paddingBottom:12,borderTop:`0.5px solid ${j.colors.onCardDivider}`,overflowY:"auto"}),title:v({fontSize:"16px",fontWeight:500,color:j.colors.onCard,padding:0,margin:0}),titleRow:v({padding:12,paddingBottom:8,display:"flex",alignItems:"center",justifyContent:"space-between"})},CS=()=>{const{config:e}=te(de),{lms_entity_id:t,ma_entity_id:r}=e,{t:n}=Fe(),i=O((s,o)=>A("div",{css:Wl.titleRow,children:[h("h3",{css:Wl.title,children:n({id:"MediocreMediaPlayerCard.QueueView.up_next",defaultMessage:"Up Next"})}),h(B,{icon:"mdi:refresh",onClick:s,size:"x-small",disabled:o})]}),[n]);return h("div",{css:Wl.root,style:{"--mmpc-search-padding":"12px"},children:h(Jl,{lms_entity_id:t,ma_entity_id:r,renderHeader:i})})},AS={root:v({maxHeight:300,paddingTop:12,paddingBottom:12,borderTop:`0.5px solid ${j.colors.onCardDivider}`,overflowY:"auto"})},ES=()=>{const{config:e}=te(de),{ma_entity_id:t,search:r,entity_id:n}=e,{selectedSearchProvider:i,searchProvidersMenu:s}=Sa(r,n,t),o=()=>i?i.entity_id===t?h(Aa,{maEntityId:t,horizontalPadding:12,additionalOptions:s}):h($a,{entityId:i.entity_id,showFavorites:!0,horizontalPadding:12,filterConfig:i.media_types,additionalOptions:s}):null;return h("div",{css:AS.root,children:o()})},Ar={speakerGroupContainer:v({display:"flex",flexDirection:"column",paddingTop:"12px",paddingBottom:"16px",borderTop:`0.5px solid ${j.colors.onCardDivider}`,gap:"12px"}),groupTitle:v({fontSize:"16px",fontWeight:500,color:j.colors.onCard,margin:"0px 16px"}),syncContainer:v({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",marginRight:"19px"}),syncText:v({fontSize:"12px",color:j.colors.onCardMuted}),groupedSpeakers:v({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),titleRow:v({display:"flex",alignItems:"center"})},IS=()=>{const{t:e}=Fe(),t=$e(),{config:r}=te(de),{entity_id:n,speaker_group:i}=r,[s,o]=F(!0),a=i?.entity_id||n,l=t.states[a];return A("div",{css:Ar.speakerGroupContainer,children:[l?.attributes?.group_members?.length>1&&A(Q,{children:[A("div",{css:Ar.titleRow,children:[h("h3",{css:Ar.groupTitle,children:e({id:"MediocreMediaPlayerCard.SpeakerGrouping.grouped_speakers_title"})}),A("div",{css:Ar.syncContainer,children:[h("span",{css:Ar.syncText,onClick:()=>o(!s),children:e({id:"MediocreMediaPlayerCard.SpeakerGrouping.link_volume_title"})}),h(B,{icon:s?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>o(!s)})]})]}),h("div",{css:Ar.groupedSpeakers,children:h(ka,{config:r,syncMainSpeaker:s})})]}),h("h3",{css:Ar.groupTitle,children:e({id:"MediocreMediaPlayerCard.SpeakerGrouping.add_speakers_title"})}),h(es,{config:{entity_id:n,speaker_group:i},showGrouped:!1,layout:{horizontalMargin:16}})]})},PS={root:v({display:"flex",alignItems:"center",transition:"all 0.3s ease",width:"100%",gap:"4px"})},OS=()=>{const{config:e}=te(de),{speaker_group:t}=e,r=ye(),n=r.entity_id,i=r.attributes?.volume_level??0,s=r.attributes?.is_volume_muted??!1,o=O(()=>{K().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!s})},[s]),a=V(()=>Yr(i,s),[i,s]);return A("div",{css:PS.root,children:[h(B,{size:"x-small",onClick:o,icon:a}),h(Qs,{entityId:t?.entity_id??n,syncGroupChildren:!0,sliderSize:"small",showStepButtons:e.options?.show_volume_step_buttons??!1,useVolumeUpDownForSteps:e.options?.use_volume_up_down_for_step_buttons??!1})]})},TS=({sliderVisible:e,setSliderVisible:t})=>{const r=ye(),n=r.attributes?.volume_level??0,i=r.attributes?.is_volume_muted??!1,s=Yr(n,i);return h(Q,{children:e?h(B,{size:"x-small",onClick:()=>t(!1),icon:"mdi:chevron-left"}):h(B,{size:"x-small",onClick:()=>t(!0),icon:s})})},gt={card:v({borderRadius:j.sizes.cardBorderRadius,overflow:"hidden"}),artBackground:v({background:`
      radial-gradient( circle at bottom right, var(--art-alternative-color, transparent) -500%, transparent 30% ),
      radial-gradient( circle at top center, var(--art-alternative-color, transparent) -500%, transparent 30% ),
      radial-gradient( circle at bottom center, var(--art-alternative-color, transparent) -500%, transparent 30% ),
      radial-gradient( circle at top left, var(--art-alternative-color, transparent) -500%, transparent 30% )`}),cardContent:v({display:"flex",gap:"14px",padding:"12px",opacity:1,transition:"opacity 0.3s ease",position:"relative"}),cardRowRight:v({display:"grid",gridTemplateColumns:"repeat(4, auto)",gap:"4px",minWidth:"max-content"}),cardRow:v({display:"flex",flexDirection:"row",gap:"8px",alignItems:"center",justifyContent:"space-between"}),alignStart:v({alignItems:"start"}),cardColumn:v({display:"flex",flexDirection:"column",flex:1}),grid:v({display:"grid"}),controlsContainer:v({display:"flex",flexGrow:1,containerType:"inline-size"})},Em=({isEmbeddedInMultiCard:e,onClick:t})=>{const{rootElement:r,config:n}=te(de),{entity_id:i,custom_buttons:s,action:o,tap_opens_popup:a,use_art_colors:l,ma_entity_id:c,ma_favorite_button_entity_id:u,lms_entity_id:d,search:f,media_browser:p,speaker_group:m,options:{always_show_power_button:g,always_show_custom_buttons:y,hide_when_group_child:_,hide_when_off:b}={}}=n,w=s&&s.length>0,k=ca(f,c)&&!e,x=Wi(p)&&!e,[E,$]=F(!1),[S,I]=F(y??!1),[P,C]=F(!1),[R,M]=F(!1),[L,J]=F(!1),[ut,xe]=F(!1),{artVars:et,haVars:Ne}=Ta(),An=ye(),{state:Pr,subtitle:xi}=An,Or=Na({ma_entity_id:c,lms_entity_id:d})&&!e,Xs=$e(),Ql=V(()=>{if(!m)return!1;const so=m?.entity_id??i,oo=Xs.states[so];return!oo.attributes.group_members||oo.attributes.group_members.length===0?!1:oo.attributes.group_members.length>1&&oo.attributes.group_members[0]!==so},[m,Xs]),hr=os(),En=!hr.supportsTogglePlayPause&&!hr.supportNextTrack&&!hr.supportPreviousTrack&&!hr.supportsShuffle&&!hr.supportsStop&&!hr.supportsRepeat,Tr=Pr!=="off"&&Pr!=="unavailable",eo=!e&&n.speaker_group&&n.speaker_group.entities&&n.speaker_group.entities.length>0,Zl=()=>{$(!E)},[to,ro]=F(!1),U=xi?100:78,In=jt({rootElement:r,actionConfig:{...o??{tap_action:{action:"more-info"}},entity:n.entity_id},overrideCallback:a?{onTap:()=>{ro(!0)}}:t?{onTap:t}:void 0}),io=O(()=>{K().callService("media_player","toggle",{entity_id:i})},[i]);return b&&!Tr||_&&Ql?null:h("ha-card",{style:{...et??{},...Ne&&l?Ne:{}},children:A("div",{css:[gt.card,l&&gt.artBackground],children:[A("div",{css:gt.cardContent,style:{opacity:Tr?1:.7},children:[h(Od,{size:U,iconSize:"large",...In}),A("div",{css:gt.cardColumn,children:[A("div",{css:[gt.cardRow,gt.alignStart],children:[A("div",{css:gt.grid,children:[h(MS,{}),h($S,{})]}),A("div",{css:gt.cardRowRight,children:[w&&!y&&h(Q,{children:s.length===1?h($m,{button:s[0],type:"icon-button"}):h(B,{size:"x-small",onClick:()=>I(!S),icon:"mdi:dots-horizontal"})}),!e&&h(Pd,{ma_entity_id:c??void 0,ma_favorite_button_entity_id:u??void 0,lms_entity_id:n.lms_entity_id??void 0,renderTrigger:so=>h(B,{icon:"mdi:dots-vertical",size:"x-small",...so})}),x&&h(B,{size:"x-small",onClick:()=>J(!L),icon:"mdi:folder-music"}),k&&h(B,{size:"x-small",onClick:()=>M(!R),icon:"mdi:magnify"}),Or&&h(B,{size:"x-small",onClick:()=>xe(!ut),icon:"mdi:playlist-music"})]})]}),A("div",{css:gt.cardRow,style:{marginTop:"auto",minHeight:En?"unset":"36px"},children:[h("div",{css:gt.controlsContainer,children:P||En?h(OS,{}):h(SS,{})}),A("div",{css:gt.cardRowRight,children:[!!Tr&&!En&&h(TS,{sliderVisible:P,setSliderVisible:C}),!!Tr&&eo&&h(B,{size:"x-small",onClick:Zl,icon:"mdi:speaker-multiple"}),(!Tr||En||g)&&h(B,{size:"x-small",onClick:io,icon:"mdi:power"})]})]})]})]}),E&&eo&&h(IS,{}),S&&h(bS,{}),R&&h(ES,{}),L&&h(kS,{}),ut&&h(CS,{}),to&&h(wS,{visible:to,setVisible:ro})]})})},NS=({config:e,rootElement:t,hass:r})=>{const n=O(a=>{const l=new Event("config-changed",{bubbles:!0,composed:!0});l.detail={config:a},t.dispatchEvent(l)},[t]),i=Bl({defaultValues:Mu(e),validators:{onChange:$M},listeners:{onChange:({formApi:a})=>{if(a.state.isValid){const l=$u(a.state.values);JSON.stringify(e)!==JSON.stringify($u(l))&&(console.log("Updating config",l),n(l))}else console.log(a.state.errors)},onChangeDebounceMs:500}}),s=ct(i.store,a=>a.errorMap),o=O(a=>!!Object.keys(s?.onChange??{}).find(l=>l.startsWith(a)),[s]);return ee(()=>{const a=i.state.values,l=Mu(e);JSON.stringify(a)!==JSON.stringify(l)&&i.reset(l)},[e,i]),!e||!r?null:A(i.AppForm,{children:[h(i.AppField,{name:"entity_id",children:a=>h(a.EntityPicker,{label:"Media Player Entity",required:!0,domains:["media_player"]})}),h(i.AppField,{name:"name",children:a=>h(a.Text,{label:"Name (optional)"})}),A(Mt,{css:v({display:"flex",flexDirection:"row",gap:"16px"}),children:[h(i.AppField,{name:"use_art_colors",children:a=>h(a.Toggle,{label:"Use album art colors."})}),h(i.AppField,{name:"tap_opens_popup",children:a=>h(a.Toggle,{label:"Tap opens popup."})})]}),A(le,{title:"Interactions",error:o("action"),children:[h(i.Field,{name:"tap_opens_popup",children:a=>a.state.value&&h(Xi,{children:'Tap action overridden by "tap opens popup".'})}),h(i.AppField,{name:"action",children:a=>h(a.InteractionsPicker,{})})]}),A(le,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[h(i.AppField,{name:"speaker_group.entity_id",children:a=>h(a.EntityPicker,{label:"Main Speaker Entity ID (Optional)",domains:["media_player"]})}),h(i.AppField,{name:"speaker_group.entities",children:a=>h(a.EntitiesPicker,{label:"Select Speakers (including main speaker)",domains:["media_player"]})})]}),h(le,{title:"Music Assistant Configuration (optional)",error:o("ma_entity_id")??o("ma_favorite_button_entity_id"),children:h(ql,{form:i,fields:{ma_entity_id:"ma_entity_id",ma_favorite_button_entity_id:"ma_favorite_button_entity_id"}})}),h(le,{title:"LMS Configuration (optional)",error:o("lms_entity_id"),children:h(i.AppField,{name:"lms_entity_id",children:a=>h(a.EntityPicker,{label:"LMS Media Player Entity ID",domains:["media_player"]})})}),h(le,{title:"Search (optional)",error:o("search"),children:h(jl,{form:i,fields:{search:"search",ma_entity_id:"ma_entity_id"}})}),h(le,{title:"Media Browser (optional)",error:o("media_browser"),children:h(Ul,{form:i,fields:{media_browser:"media_browser"}})}),h(le,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:h(Kl,{form:i,formErrors:s,fields:{custom_buttons:"custom_buttons"}})}),A(le,{title:"Additional options (optional)",error:o("options"),children:[h(i.AppField,{name:"options.always_show_power_button",children:a=>h(a.Toggle,{label:"Always show power button."})}),h(i.AppField,{name:"options.always_show_custom_buttons",children:a=>h(a.Toggle,{label:"Always show custom buttons panel below card"})}),h(i.AppField,{name:"options.hide_when_off",children:a=>h(a.Toggle,{label:"Hide when media player is off"})}),h(i.AppField,{name:"options.hide_when_group_child",children:a=>h(a.Toggle,{label:"Hide when media player is a group child"})}),h(i.AppField,{name:"options.show_volume_step_buttons",children:a=>h(a.Toggle,{label:"Show volume step buttons + - on volume sliders"})}),h(i.AppField,{name:"options.use_volume_up_down_for_step_buttons",children:a=>h(a.Toggle,{label:"Use volume_up and volume_down services for step buttons (breaks volume sync when step buttons are used)"})})]})]})},Ys={root:v({}),titleRow:v({display:"flex",justifyContent:"space-between",alignItems:"center",gap:8}),title:v({fontSize:20,color:j.colors.onCard}),subtitle:v({fontSize:14,color:j.colors.onCardMuted})},Er=({title:e,subtitle:t,className:r,renderAction:n})=>A("div",{css:Ys.root,className:r,children:[A("div",{css:Ys.titleRow,children:[h("span",{css:Ys.title,children:e}),!!n&&n()]}),!!t&&h("span",{css:Ys.subtitle,children:t})]}),Hl={root:v({display:"flex",flexDirection:"column",alignItems:"flex-start",overflowY:"auto",padding:16,gap:12}),buttons:v({display:"flex",flexDirection:"row",justifyContent:"flex-start",flexWrap:"wrap",gap:"6px 2px"})},RS=Pe(({mediaPlayer:e,setSelectedPlayer:t})=>{const{custom_buttons:r,ma_favorite_button_entity_id:n,ma_entity_id:i,lms_entity_id:s}=e,{config:{media_players:o}}=te(de),a=$e(),l=ye(),c=V(()=>_r(l),[l,l?.attributes?.active_child]),u=V(()=>s&&Hi(l,s),[l,s]),d=O(b=>{i&&kd(i,b)},[i]),f=V(()=>!i||!c?[]:o.map(w=>{if(!w.ma_entity_id)return null;const k=a.states[w.entity_id];return!k||k.state==="unavailable"||w.entity_id===e.entity_id?null:{label:k.attributes.friendly_name||w.entity_id,onClick:()=>{w.ma_entity_id&&(d(w.ma_entity_id),t(w))}}}).filter(w=>w!==null),[c,i,d,o,t]),p=V(()=>!s||!u?[]:o.map(w=>{if(!w.lms_entity_id)return null;const k=a.states[w.entity_id];return!k||k.state==="unavailable"||w.entity_id===e.entity_id?null:{label:w.name||k.attributes.friendly_name||w.entity_id,onClick:()=>{w.lms_entity_id&&(xd(s,w.lms_entity_id),t(w))}}}).filter(w=>w!==null),[u,s,o,t]),m=O(()=>{n&&K().callService("button","press",{entity_id:n})},[n]),g=V(()=>(l.attributes.source_list??[]).map(b=>({label:b,onClick:()=>{K().callService("media_player","select_source",{entity_id:l.entity_id,source:b})}})),[l.attributes.source_list,l.attributes.source]),y=!!i&&c||g.length>0,{t:_}=Fe();return A("div",{css:Hl.root,children:[r&&r.length>0&&A(Q,{children:[h(Er,{title:_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.shortcuts_title"}),subtitle:_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.shortcuts_subtitle"})}),h("div",{css:Hl.buttons,children:r?.map((b,w)=>h(FS,{button:b,entityId:e.entity_id},w))})]}),y&&A(Q,{children:[h(Er,{title:_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.media_player_actions_title"}),subtitle:_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.media_player_actions_subtitle"})}),A("div",{css:Hl.buttons,children:[!!i&&c&&A(Q,{children:[n&&h(Ze,{icon:"mdi:heart-plus",onClick:m,children:_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.mark_as_favorite"})}),f.length>0&&h(nt,{menuItems:f,side:"bottom",renderTrigger:b=>A(Ze,{icon:"mdi:transfer",...b,children:[_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.transfer_queue"}),h(be,{size:"x-small",icon:"mdi:chevron-down"})]})})]}),p.length>0&&h(nt,{menuItems:p,side:"bottom",renderTrigger:b=>A(Ze,{icon:"mdi:transfer",...b,children:[_({id:"MediocreMultiMediaPlayerCard.AdditionalActionsView.transfer_queue"}),h(be,{size:"x-small",icon:"mdi:chevron-down"})]})}),g.length>0&&l.attributes.source&&h(nt,{side:"bottom",menuItems:g,renderTrigger:b=>A(Ze,{...b,icon:Ji({source:l.attributes.source??"",fallbackIcon:"mdi:import"}),children:[l.attributes.source,h(be,{size:"x-small",icon:"mdi:chevron-down"})]})})]})]})]})}),FS=({button:e,entityId:t})=>{const{rootElement:r}=te(de),{icon:n,name:i,...s}=e,o=jt({rootElement:r,actionConfig:{...s,entity:t}});return A(Ze,{icon:n,...o,children:[!!i&&h("span",{children:i}),o.renderLongPressIndicator()]})},LS=Pe(Rt(({style:e,useArtColors:t,...r},n)=>{const{artVars:i,haVars:s}=Ta();return h("div",{...r,style:{...i??{},...s&&t?s:{},...typeof e=="object"?e:{}},ref:n})})),DS={root:v({backgroundColor:j.colors.card,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderRadius:"12px",padding:"12px",width:"100%",position:"relative",boxSizing:"border-box",borderWidth:"var(--ha-card-border-width, 1px)",borderColor:"var(--ha-card-border-color,var(--divider-color,#e0e0e0))",borderStyle:"var(--ha-card-border-style, solid)"})},VS=Pe(({mediaPlayer:e,setNavigationRoute:t,navigationRoute:r,desktopMode:n})=>{const{rootElement:i}=te(de),{entity_id:s,ma_entity_id:o,search:a,custom_buttons:l,media_browser:c,lms_entity_id:u}=e,d=ca(a,o),f=Wi(c),p=Na({ma_entity_id:o,lms_entity_id:u});return A("div",{css:DS.root,children:[!n&&h(B,{size:"small",icon:"mdi:home",onClick:()=>t("massive"),selected:r==="massive"}),d&&h(B,{size:"small",icon:"mdi:magnify",onClick:()=>t("search"),selected:r==="search"}),f&&h(B,{size:"small",icon:"mdi:folder-music",onClick:()=>t("media-browser"),selected:r==="media-browser"}),p&&h(B,{size:"small",icon:"mdi:playlist-music",onClick:()=>t("queue"),selected:r==="queue"}),l&&l.length===1&&!o?h(zS,{button:l[0],rootElement:i,entityId:s}):l&&l.length>1||o?h(B,{size:"small",icon:"mdi:dots-horizontal",onClick:()=>t("custom-buttons"),selected:r==="custom-buttons"}):null,h(B,{size:"small",icon:"mdi:speaker-multiple",onClick:()=>t("speaker-grouping"),selected:r==="speaker-grouping"})]})}),zS=({button:e,rootElement:t,entityId:r})=>{const{icon:n,name:i,...s}=e,o=jt({rootElement:t,actionConfig:{...s,entity:r}});return h(B,{icon:e.icon??"mdi:dots-vertical",size:"small",...o})},Cn={root:v({padding:16,display:"grid",gap:24,gridTemplateRows:"auto 1fr auto",gridTemplateColumns:"1fr",height:"100%"}),massive:v({overflow:"hidden"}),massiveHeader:v({display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"8px"}),title:v({margin:0,fontSize:"18px",color:j.colors.onCard,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"auto"}),volumeRoot:v({display:"flex",alignItems:"center",flex:1,maxHeight:"36px",marginTop:"auto",gap:"8px",justifySelf:"center",width:"100%",maxWidth:600}),buttonMuted:v({opacity:.8})},Im=Pe(({mediaPlayer:e,setNavigationRoute:t,navigationRoute:r})=>{const n=$e(),{rootElement:i,config:s}=te(de),{entity_id:o,attributes:{friendly_name:a,icon:l,device_class:c,volume_level:u,is_volume_muted:d}}=ye(),f=u??0,p=d??!1,m=O(()=>{K().callService("media_player","volume_mute",{entity_id:o,is_volume_muted:!p})},[p]),g=V(()=>Yr(f,p),[f,p]),y=n.states[e.speaker_group_entity_id??e.entity_id]?.attributes?.group_members,_=Un({icon:l,deviceClass:c}),b=jt({rootElement:i,actionConfig:{tap_action:{action:"more-info"},entity:e.entity_id}}),w=O(()=>{K().callService("media_player","toggle",{entity_id:o})},[o]),k=O(()=>t(r==="speaker-grouping"?"massive":"speaker-grouping"),[t,r]),x=V(()=>({...e,mode:"multi",type:"custom:mediocre-massive-media-player-card",use_art_colors:s.use_art_colors}),[e,s.use_art_colors]);return A("div",{css:Cn.root,children:[A("div",{css:Cn.massiveHeader,id:"mmpc-multi-media-player-card-massive-view-header",children:[h(be,{size:"small",icon:_}),A("span",{css:Cn.title,children:[e.name??a,y?.length>1&&A("span",{children:[" +",y.length-1]})]}),h(B,{size:"small",...b,icon:"mdi:dots-vertical"})]}),h(Zi,{rootElement:i,config:x,children:h(La,{css:Cn.massive,onClick:k})}),A("div",{css:Cn.volumeRoot,children:[h(B,{css:p?Cn.buttonMuted:{},size:"small",onClick:m,icon:g}),h(Qs,{entityId:e.speaker_group_entity_id??e.entity_id,syncGroupChildren:!0,sliderSize:"medium",showStepButtons:s.options?.show_volume_step_buttons??!1,useVolumeUpDownForSteps:s.options?.use_volume_up_down_for_step_buttons??!1}),h(B,{size:"small",onClick:w,icon:"mdi:power"})]})]})}),Pm={root:v({height:"100%",overflowY:"auto"}),header:v({padding:"12px 16px 12px 16px"})},BS=Pe(({mediaPlayer:{entity_id:e,media_browser:t},height:r})=>{const{t:n}=Fe(),i=()=>h(Er,{title:n({id:"MediocreMultiMediaPlayerCard.MediaBrowserView.browse_media_title"}),css:Pm.header});return h("div",{css:Pm.root,style:{maxHeight:r},children:h(Ea,{mediaBrowserEntryArray:fa(t,e),horizontalPadding:16,renderHeader:i,maxHeight:r})})}),qS={root:v({borderRadius:"12px",overflow:"hidden"})},jS=Pe(({mediaPlayer:e,setNavigationRoute:t,navigationRoute:r})=>{const{rootElement:n,config:i}=te(de),s=V(()=>{const{custom_buttons:a,...l}=e,c=i.media_players.filter(u=>u.can_be_grouped).map(u=>u.name?{name:u.name,entity:u.speaker_group_entity_id??u.entity_id}:u.speaker_group_entity_id??u.entity_id);return{type:"custom:mediocre-media-player-card",speaker_group:c.length>0?{entity_id:e.speaker_group_entity_id||e.entity_id,entities:c}:void 0,options:{show_volume_step_buttons:i.options?.show_volume_step_buttons??!1,use_volume_up_down_for_step_buttons:i.options?.use_volume_up_down_for_step_buttons??!1},...l,use_art_colors:i.use_art_colors}},[e,i.use_art_colors]),o=O(()=>t(r==="speaker-grouping"?"massive":"speaker-grouping"),[t,r]);return h("div",{css:qS.root,children:h(Zi,{rootElement:n,config:s,children:h(Em,{isEmbeddedInMultiCard:!0,onClick:o})})})}),Om={root:v({height:"100%",overflowY:"auto"}),header:v({padding:"12px 16px 12px 16px"})},US=Pe(({mediaPlayer:{ma_entity_id:e,search:t,entity_id:r},height:n})=>{const{selectedSearchProvider:i,searchProvidersMenu:s}=Sa(t,r,e),{t:o}=Fe(),a=()=>h(Er,{title:i?.entity_id===e?o({id:"MediocreMultiMediaPlayerCard.SearchView.search_in_ma_title"}):o({id:"MediocreMultiMediaPlayerCard.SearchView.search_title"}),css:Om.header,renderAction:s.length>1?()=>h(nt,{menuItems:s,align:"end",renderTrigger:c=>A(Ze,{icon:"mdi:import",invertedColors:!0,border:!0,size:"small",...c,children:[i?.name??i?.entity_id,h(be,{icon:"mdi:chevron-down",size:"x-small"})]})}):void 0}),l=()=>i?i.entity_id===e?h(Aa,{renderHeader:a,maEntityId:e,horizontalPadding:16,maxHeight:n}):h($a,{renderHeader:a,entityId:i.entity_id,showFavorites:!0,horizontalPadding:16,filterConfig:i.media_types,maxHeight:n}):null;return h("div",{css:Om.root,style:{maxHeight:n},children:l()})}),fr={speakerGroupContainer:v({display:"flex",flexDirection:"column",padding:"16px 0px",gap:"12px",overflowY:"auto",height:"100%"}),horizontalPadding:v({padding:"0px 16px"}),groupTitle:v({fontSize:"16px",fontWeight:500,color:j.colors.onCard,margin:"0px 16px"}),syncContainer:v({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px"}),syncText:v({fontSize:"12px",color:j.colors.onCardMuted}),groupedSpeakers:v({display:"flex",flexDirection:"column",gap:"8px"}),titleRow:v({display:"flex",alignItems:"center"}),playerSelector:v({display:"flex",flexDirection:"column",gap:4}),playerChips:v({display:"flex",flexDirection:"column",flexWrap:"wrap",gap:"6px 2px"}),chipPlayer:v({padding:"0px 6px",gap:6}),chipPlayerOff:v({opacity:.8}),chipPlayerArtwork:v({borderRadius:"50%"})},KS=Pe(({mediaPlayer:e,setSelectedPlayer:t})=>{const{t:r}=Fe(),{config:n}=te(de),i=$e(),{media_players:s}=n,{entity_id:o,speaker_group_entity_id:a}=e,[l,c]=F(!0),u=a||o,d=V(()=>s.map(m=>{const g=i.states[m.entity_id],y=i.states[m.speaker_group_entity_id||m.entity_id],_=y?.attributes?.group_members??[],b=_.length===0?!1:_[0]!==y.entity_id;return{...g,name:m.name??g?.attributes?.friendly_name,groupPlayerState:y,isChildInGroup:b,numPlayersInGroup:(y?.attributes?.group_members??[]).length,isMainSpeaker:m.entity_id===o,selectPlayer:()=>t(m)}})??[],[i,o,s,t]),f=V(()=>s.filter(m=>m.can_be_grouped).map(m=>m.name?{name:m.name,entity:m.speaker_group_entity_id??m.entity_id}:m.speaker_group_entity_id??m.entity_id),[s]),p=m=>!m||m.isChildInGroup?null:h(ga,{entityId:m.entity_id,children:h(e$,{onClick:m.selectPlayer,name:`${m.name}${m.numPlayersInGroup>1?` +${m.numPlayersInGroup-1}`:""}`})},m.entity_id);return A("div",{css:fr.speakerGroupContainer,children:[!!f&&f.length>0&&A(Q,{children:[h(Er,{title:r({id:"MediocreMultiMediaPlayerCard.SpeakerGrouping.join_title"}),subtitle:r({id:"MediocreMultiMediaPlayerCard.SpeakerGrouping.join_subtitle"}),css:fr.horizontalPadding,renderAction:()=>A("div",{css:fr.syncContainer,children:[h("span",{css:fr.syncText,onClick:()=>c(!l),children:r({id:"MediocreMultiMediaPlayerCard.SpeakerGrouping.link_volume"})}),h(B,{icon:l?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>c(!l)})]})}),h(ka,{config:{entity_id:o,speaker_group:{entities:f,entity_id:u},options:{show_volume_step_buttons:n.options?.show_volume_step_buttons??!1,use_volume_up_down_for_step_buttons:n.options?.use_volume_up_down_for_step_buttons??!1}},syncMainSpeaker:l,css:fr.horizontalPadding}),h("div",{children:h(es,{config:{entity_id:u,speaker_group:{entities:f}},showGrouped:!1,layout:{horizontalMargin:16}})})]}),h(Er,{title:r({id:"MediocreMultiMediaPlayerCard.SpeakerGrouping.player_focus_title"}),subtitle:r({id:"MediocreMultiMediaPlayerCard.SpeakerGrouping.player_focus_subtitle"}),css:fr.horizontalPadding}),h("div",{css:[fr.playerChips,fr.horizontalPadding],children:d.length>0&&d.map(p)})]})}),Tm={root:v({height:"100%",overflowY:"auto"}),header:v({padding:"12px 16px 12px 16px"}),itemPlaying:v({border:`1px solid ${j.colors.onCardDivider}`})},GS=Pe(({mediaPlayer:{lms_entity_id:e,ma_entity_id:t},height:r})=>{const{t:n}=Fe(),i=O((s,o)=>h(Er,{title:n({id:"MediocreMultiMediaPlayerCard.QueueView.up_next",defaultMessage:"Up Next"}),subtitle:n({id:"MediocreMultiMediaPlayerCard.QueueView.up_next_subtitle",defaultMessage:"Current playback queue"}),css:Tm.header,renderAction:()=>h(B,{icon:"mdi:refresh",onClick:s,size:"x-small",disabled:o})}),[n]);return h("div",{css:Tm.root,style:{maxHeight:r,"--mmpc-search-padding":"16px"},children:h(Jl,{height:r,lms_entity_id:e,ma_entity_id:t,renderHeader:i})})}),De={root:v({display:"grid",minHeight:0,gridTemplateRows:"1fr auto",gridTemplateColumns:"1fr",rowGap:12,"*, *:before, *:after":{boxSizing:"border-box"}}),rootDesktop:v({gridTemplateColumns:"1fr 1fr",gridTemplateRows:"1fr auto",gridTemplateAreas:`
      "massive content"
      "massive footer"
    `,columnGap:12}),rootPanel:v({height:"100%",padding:12,maxHeight:"calc(100vh - 24px - var(--header-height, 16px))","--ha-card-border-radius":`max(${j.sizes.cardBorderRadius}, 12px)`,"*":{"--ha-card-border-radius":"inherit !important"}}),rootCard:v({height:780}),contentArea:v({alignSelf:"stretch",overflow:"hidden",minHeight:0,backgroundColor:j.colors.card,borderRadius:12,marginBottom:0,borderWidth:"var(--ha-card-border-width, 1px)",borderColor:"var(--ha-card-border-color,var(--divider-color,#e0e0e0))",borderStyle:"var(--ha-card-border-style, solid)"}),contentAreaDesktop:v({gridArea:"content"}),contentAreaDesktopMassive:v({gridArea:"massive"}),contentAreaCard:v({borderRadius:j.sizes.cardBorderRadius}),contentAreaMassiveTransparent:v({backgroundColor:"transparent",borderStyle:"none"}),contentAreaPannelMassiveTransparent:v({margin:"12px 8px 12px 8px"}),footer:v({alignSelf:"end",gap:12,display:"flex",flexDirection:"column"}),footerDesktop:v({gridArea:"footer"}),footerCard:v({padding:0})},WS=()=>{const{config:e}=te(de),t=$e(),r=ge(null),[n,i]=F(()=>vd(t,e));ee(()=>{const m=Date.now();if(r.current&&m-r.current<120*1e3)return;const g=vd(t,e,n);g?.entity_id!==n?.entity_id&&i(g)},[t,e,n]);const[s,o]=F("massive"),[a,{height:l,width:c}]=pa(),[u,{height:d}]=pa(),f=c?c>800:!1;ee(()=>{f&&s==="massive"&&o("speaker-grouping")},[f]);const p=O(()=>{r.current=Date.now()},[]);return h(ga,{entityId:n?.entity_id||e.entity_id,children:h(Q,{children:n?A(LS,{useArtColors:e.use_art_colors,css:[De.root,e.mode==="panel"&&De.rootPanel,e.mode==="card"&&De.rootCard,f&&De.rootDesktop],style:e.height?{height:e.height}:{},ref:a,onClick:p,children:[f?h("div",{css:[De.contentArea,De.contentAreaDesktopMassive,e.mode==="card"&&De.contentAreaCard,e.options?.transparent_background_on_home&&De.contentAreaMassiveTransparent,e.mode==="panel"&&e.options?.transparent_background_on_home&&De.contentAreaMassiveTransparent],ref:u,children:h(Im,{mediaPlayer:n,setNavigationRoute:o,navigationRoute:s})}):null,A("div",{css:[De.contentArea,f&&De.contentAreaDesktop,e.mode==="card"&&De.contentAreaCard,s==="massive"&&e.options?.transparent_background_on_home&&De.contentAreaMassiveTransparent,s==="massive"&&e.mode==="panel"&&e.options?.transparent_background_on_home&&De.contentAreaMassiveTransparent],ref:u,children:[s==="search"&&d&&h(US,{height:d,mediaPlayer:n}),s==="media-browser"&&d&&h(BS,{height:d,mediaPlayer:n}),s==="speaker-grouping"&&h(KS,{mediaPlayer:n,setSelectedPlayer:i}),s==="queue"&&d&&h(GS,{mediaPlayer:n,height:d}),s==="massive"&&h(Im,{mediaPlayer:n,setNavigationRoute:o,navigationRoute:s}),s==="custom-buttons"&&h(RS,{mediaPlayer:n,setSelectedPlayer:i})]}),A("div",{css:[De.footer,f&&De.footerDesktop,e.mode==="card"&&De.footerCard],children:[!f&&s!=="massive"&&l&&l>500&&h(jS,{mediaPlayer:n,setNavigationRoute:o,navigationRoute:s}),h(VS,{mediaPlayer:n,setNavigationRoute:o,navigationRoute:s,desktopMode:f})]})]}):h("div",{children:"Please select a media player in the configuration."})})})},HS=({config:e,rootElement:t,hass:r})=>{const n=ge(null),i=O(u=>{n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{const d=new Event("config-changed",{bubbles:!0,composed:!0});d.detail={config:u},t.dispatchEvent(d)},500)},[t]),s=O(u=>u?{...u,media_players:u.media_players.map(d=>({...d,search:zr(d.search,d.entity_id),media_browser:d?.media_browser?Array.isArray(d.media_browser)?d.media_browser:[{entity_id:d.media_browser.entity_id??d.entity_id}]:[]}))}:{type:"custom:mediocre-multi-media-player-card",entity_id:"",mode:"card",use_art_colors:!0,media_players:[]},[]),o=Bl({defaultValues:s(e),validators:{onChange:EM},listeners:{onChange:({formApi:u})=>{const d=Object.assign(u.state.values),f=p=>{Object.keys(p).forEach(m=>{(p[m]===void 0||p[m]===null)&&delete p[m]})};f(d),d.search&&f(d.search),u.state.isValid?JSON.stringify(e)!==JSON.stringify(d)&&i(d):console.log(u.state.errors)},onChangeDebounceMs:150}}),a=ct(o.store,u=>u.errorMap),l=O(u=>!!Object.keys(a?.onChange??{}).find(d=>d.startsWith(u)),[a]),c=O(()=>yd().filter(d=>!d.attributes.active_child).map(d=>({entity_id:d.entity_id,ma_entity_id:d.entity_id,media_browser:[{entity_id:d.entity_id,name:"Music Assistant"}],can_be_grouped:!0})),[]);return ee(()=>{const u=o.state.values,d=e;JSON.stringify(u)!==JSON.stringify(d)&&o.reset(s(d))},[e,o]),!e||!r?null:A(o.AppForm,{children:[h(o.AppField,{name:"entity_id",children:u=>h(u.EntityPicker,{label:"Default Media Player (used when no media player is active)",required:!0,domains:["media_player"]})}),A(Mt,{css:v({display:"flex",flexDirection:"row",alignItems:"center",gap:"16px"}),children:[h(o.AppField,{name:"use_art_colors",children:u=>h(u.Toggle,{label:"Use album art colors."})}),h(o.Field,{name:"mode",children:u=>h(xa,{options:[{name:"Panel",value:"panel"},{name:"Card",value:"card"}],onSelected:d=>u.handleChange(d),selected:e.mode||"panel"})})]}),h(le,{title:"Media Players",error:l("media_players"),children:h(o.Field,{name:"media_players",mode:"array",children:u=>A(Q,{children:[u.state.value.map((d,f)=>A(le,{title:r.states[d.entity_id]?.attributes.friendly_name||d.entity_id||"Media Player",buttons:[{icon:"mdi:delete",onClick:()=>u.removeValue(f)},{icon:"mdi:arrow-up",onClick:()=>{u.moveValue(f,f-1)}},{icon:"mdi:arrow-down",onClick:()=>{u.moveValue(f,f+1)}}],children:[A(Mt,{children:[h(o.AppField,{name:`media_players[${f}].name`,children:p=>h(p.Text,{label:"Name (optional)"})}),h(o.AppField,{name:`media_players[${f}].speaker_group_entity_id`,children:p=>h(p.EntityPicker,{label:"Group Media Player (if different from above)",domains:["media_player"]})}),h(o.AppField,{name:`media_players[${f}].can_be_grouped`,children:p=>h(p.Toggle,{label:"Enable speaker grouping (joining) for this player"})})]}),h(le,{title:"Music Assistant Integration (optional)",error:l(`media_players[${f}].ma_entity_id`)??l(`media_players[${f}].ma_favorite_button_entity_id`),children:h(ql,{form:o,fields:{ma_entity_id:`media_players[${f}].ma_entity_id`,ma_favorite_button_entity_id:`media_players[${f}].ma_favorite_button_entity_id`}})}),h(le,{title:"LMS Configuration (optional)",error:l(`media_players[${f}].lms_entity_id`),children:h(o.AppField,{name:`media_players[${f}].lms_entity_id`,children:p=>h(p.EntityPicker,{label:"LMS Media Player Entity ID",domains:["media_player"]})})}),h(le,{title:"Search Configuration (optional) (not for music assistant)",error:l(`media_players[${f}].search`),children:h(jl,{form:o,fields:{search:`media_players[${f}].search`,ma_entity_id:`media_players[${f}].ma_entity_id`}})}),h(le,{title:"Media Browser (optional)",error:l(`media_players[${f}].media_browser`),children:h(Ul,{form:o,fields:{media_browser:`media_players[${f}].media_browser`}})}),h(le,{title:"Custom Buttons (optional)",error:l(`media_players[${f}].custom_buttons`),children:h(Kl,{form:o,formErrors:a,fields:{custom_buttons:`media_players[${f}].custom_buttons`}})})]},f)),A("div",{css:v({display:"flex",flexDirection:"column",gap:8}),children:[h(Xr,{hass:r,value:"",onChange:d=>{d&&u.pushValue({entity_id:d})},label:"Add a new media player",domains:["media_player"]}),h("span",{children:"or"}),h(Hn,{onClick:()=>{c().forEach(f=>{u.pushValue(f)})},children:"Add all Music Assistant media players"})]})]})})}),h(le,{title:"Advanced",error:l("height"),children:A(Mt,{children:[h(o.AppField,{name:"height",children:u=>h(u.Text,{label:"Height"})}),h(o.AppField,{name:"options.transparent_background_on_home",children:u=>h(u.Toggle,{label:"Hide the card background on the home tab (massive player)"})}),h(o.AppField,{name:"options.show_volume_step_buttons",children:u=>h(u.Toggle,{label:"Show volume step buttons + - on volume sliders"})}),h(o.AppField,{name:"options.use_volume_up_down_for_step_buttons",children:u=>h(u.Toggle,{label:"Use volume_up and volume_down services for step buttons (breaks volume sync when step buttons are used)"})}),h(o.Field,{name:"options.player_is_active_when",children:u=>A("div",{css:v({display:"flex",flexDirection:"row",gap:4,alignItems:"center",justifyContent:"space-between"}),children:[h(Xi,{children:"Consider player active when:"}),h(xa,{options:[{name:"Playing",value:"playing"},{name:"Playing or Paused",value:"playing_or_paused"}],onSelected:d=>u.handleChange(d),selected:u.state.value||"playing"})]})})]})})]})},Nm={root:v({display:"flex",flexDirection:"row",height:"4px",width:"100%",backgroundColor:"var(--divider-color)",borderRadius:"2px",overflow:"hidden"}),progress:v({height:"100%",backgroundColor:"var(--secondary-text-color)",width:"0%",transition:"width 1s linear"})},JS=({min:e,max:t,value:r})=>{const n=(r-e)/(t-e)*100;return h("div",{css:Nm.root,children:h("div",{css:Nm.progress,style:{width:`${n}%`}})})},YS={itemPlaying:v({border:`1px solid ${j.colors.onCardDivider}`})},Jl=({height:e,ma_entity_id:t,lms_entity_id:r,renderHeader:n})=>{const i=ye(),s=V(()=>r&&Hi(i,r),[i,r]),o=V(()=>_r(i),[i]),{queue:a,loading:l,refetch:c,error:u}=Ev(r??"",!!s&&_d()),{queue:d,loading:f,refetch:p,error:m}=Av(t??"",!!o&&bd()),g=s?a:d,y=s?l:f,_=s?c:p,b=s?u:m,w=O(k=>k.isPlaying&&g.length<1?null:h(QS,{item:k}),[]);return h(ts,{maxHeight:e,data:g,renderHeader:n?()=>n(_,y):void 0,keyExtractor:k=>k.id+k.playlistIndex,renderEmpty:y?()=>h(vr,{}):b?()=>h("div",{children:b}):void 0,renderItem:w})},QS=Pe(({item:e})=>h(en,{numberOfColumns:1,children:h(wr,{css:e.isPlaying?YS.itemPlaying:void 0,imageUrl:e.artworkUrl,title:e.title,artist:`${e.artist}${e.album?`  ${e.album}`:""}`,onClick:e.skipToItem,buttons:[{onClick:e.deleteItem,icon:"mdi:delete"},{onClick:()=>{if(e.moveItem)return e.moveItem(e.playlistIndex-1);if(e.moveItemUp)return e.moveItemUp()},disabled:e.isFirst,icon:"mdi:arrow-up-bold-outline"},{onClick:()=>{if(e.moveItem)return e.moveItem(e.playlistIndex+1);if(e.moveItemDown)return e.moveItemDown()},disabled:e.isLast,icon:"mdi:arrow-down-bold-outline"}]})}));v({display:"flex",position:"relative",flexShrink:0}),v({display:"block",marginBottom:"8px",color:j.colors.onCard,fontSize:"14px",fontWeight:500}),v({"--input-text-color":"var(--primary-text-color)","--input-bg-color":"var(--secondary-background-color)","--input-border-color":"var(--divider-color)","--input-focus-border-color":"var(--secondary-text-color)","--input-disabled-bg-color":"var(--disabled-color)","--input-disabled-text-color":"var(--disabled-text-color)",width:"100%",padding:"8px 12px",color:"var(--input-text-color)",backgroundColor:"var(--input-bg-color)",border:"none",boxShadow:"0 0 1px 1px var(--input-border-color)",borderRadius:"6px",fontSize:"14px",display:"flex",flexDirection:"row",alignItems:"center",gap:"6px","&:focus":{outline:"none",boxShadow:"0 0 1px 1px var(--input-focus-border-color)"},"&:disabled":{backgroundColor:"var(--input-disabled-bg-color)",color:"var(--input-disabled-text-color)",cursor:"not-allowed"}});const ZS=e=>{switch(e){case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120;default:return 32}},Ir={root:v({width:"100%",position:"relative"}),slider:v({"--control-slider-border-radius":"6px"}),stepButton:v({opacity:.8,"@media (hover: hover)":{"&:hover":{backgroundColor:"unset"},"&:active":{backgroundColor:"unset"}},borderRadius:0,height:"100%"}),incrementButton:v({position:"absolute",top:"50%",right:"0px",transform:"translateY(-50%)"}),decrementButton:v({position:"absolute",top:"50%",left:"0px",transform:"translateY(-50%)","--icon-primary-color":"var(--text-primary-color)"}),decrementButtonLight:v({"--icon-primary-color":"var(--art-surface-color, rgba(255, 255, 255, 0.8))"})},XS=({min:e,max:t,step:r,value:n,unit:i,sliderSize:s="medium",showStepButtons:o=!1,className:a,onStepButtonClick:l,onChange:c})=>{const[u,d]=F(n),f=ge();ee(()=>{n!==u&&d(n)},[n]);const p=ge(null);ee(()=>{const g=p.current;if(!g)return;const y=_=>{const b=Number(_.detail.value);d(b),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{c(b)},250)};return g.addEventListener("value-changed",y),()=>{g.removeEventListener("value-changed",y)}},[c]);const m=ZS(s);return A("div",{css:Ir.root,children:[h("ha-control-slider",{ref:p,min:e,max:t,step:r,unit:i,value:u,"aria-valuenow":u,"aria-valuemin":e,"aria-valuemax":t,"aria-orientation":"horizontal",css:Ir.slider,class:a,style:{"--control-slider-thickness":`${m}px`}}),o&&A(Q,{children:[u*100/t<10?null:h(B,{size:"x-small",onClick:()=>{l?l("decrement"):c(Math.max(e,u-r))},icon:"mdi:minus",css:[Ir.decrementButton,Ir.stepButton,!Bt()&&Ir.decrementButtonLight]}),u*100/t>90?null:h(B,{size:"x-small",onClick:()=>{l?l("increment"):c(Math.min(t,u+r))},icon:"mdi:plus",css:[Ir.incrementButton,Ir.stepButton]})]})]})},e$=e=>{const t=ye(),r=V(()=>e.name?e.name:t.attributes.friendly_name||t.entity_id,[e.name,t.attributes.friendly_name,t.entity_id]),n=`${t.title}${t.subtitle?`  ${t.subtitle}`:""}`,i=t.attributes.entity_picture_local||t.attributes.entity_picture,s=os(),o=Ra(),a=V(()=>{const l=[];if(t.state==="off")return l.push({icon:"mdi:power",onClick:o.togglePower,priority:1,size:"x-small"}),l;const{supportsStop:c,supportNextTrack:u,supportPreviousTrack:d,supportsRepeat:f,supportsShuffle:p,supportsTogglePlayPause:m}=s;if(p&&l.push({icon:t.attributes.shuffle?"mdi:shuffle-variant":"mdi:shuffle-disabled",onClick:o.toggleShuffle,priority:3,size:"xx-small"}),d&&l.push({icon:"mdi:skip-previous",onClick:o.previousTrack,priority:2,size:"x-small"}),m?l.push({icon:t.state==="playing"?"mdi:pause-circle":"mdi:play-circle",onClick:o.togglePlayback,priority:1,size:"small"}):c&&l.push({icon:"mdi:stop-circle",onClick:o.stop,priority:1,size:"small"}),u&&l.push({icon:"mdi:skip-next",onClick:o.nextTrack,priority:2,size:"x-small"}),f){const g=t.attributes.repeat;l.push({icon:g==="one"?"mdi:repeat-once":g==="all"?"mdi:repeat":"mdi:repeat-off",onClick:o.toggleRepeat,priority:3,size:"xx-small"})}return l},[s,t,o]);return h(wr,{...e,buttons:a,mdiIcon:t.state==="off"||!t.attributes.source?Un({icon:t.attributes.icon,deviceClass:t.attributes.device_class}):Ji({source:t.attributes.source}),imageUrl:i,title:r,artist:n,buttonIconSize:"small"})},t$={off:v({opacity:.25,overflow:"hidden",borderRadius:"6px","--primary-color":"var(--disabled-text-color)","--text-primary-color":"var(--disabled-text-color)","--art-surface-color":"var(--disabled-text-color)"})},Qs=({entityId:e,useVolumeUpDownForSteps:t,syncGroupChildren:r,...n})=>{const s=$e().states[e],o=s?.state==="off",a=s?.attributes?.volume_level??0,l=O(u=>{const d=u/100;nb(e,d,r)},[e,r]),c=O(u=>{const d=u==="increment"?"volume_up":"volume_down";K().callService("media_player",d,{entity_id:e})},[]);return h(XS,{min:0,max:100,step:1,value:a*100,onChange:l,unit:"%",onStepButtonClick:t?c:void 0,css:o?t$.off:{},...n})};class Yl extends HTMLElement{constructor(){super(...arguments),this._config=null,this.Card=null,this.extraProps={},this._hass=null}set hass(t){this._hass=t}setConfig(t){this._config=t,!(!this._hass||!this.Card)&&mr(h(Ld,{rootElement:this,children:h(Cb,{children:h(Qd,{hass:this._hass,children:h(this.Card,{config:this._config,hass:this._hass,rootElement:this,...this.extraProps})})})}),this)}}class Zs extends HTMLElement{constructor(){super(...arguments),this.Card=null,this.config=null,this.providePlayerContext=!0,this.shouldUpdate=null,this._previousHass=null,this._previousConfig=null}set hass(t){if(!this.Card)throw new Error("Preact Card is not defined");const r=this.config?.entity_id;!!r&&(this.config!==this._previousConfig||this.shouldUpdate?.(this._previousHass,t))?(this._previousHass=t,this._previousConfig=this.config,mr(h(pb,{locale:t.language??"en",children:h(Ld,{rootElement:this,children:h(Zi,{rootElement:this,config:this.config,children:h(Qd,{hass:t,children:this.providePlayerContext?h(ga,{entityId:r,children:h(this.Card,{})}):h(this.Card,{})})})})}),this)):this._previousHass=t}getCardSize(){return 1}}class r$ extends Zs{constructor(){super(...arguments),this.Card=rv,this.shouldUpdate=(t,r)=>!r||!t||!this.config||!t&&r?!0:zt(t.states[this.config.entity_id],r.states[this.config.entity_id])}setConfig(t){if(!t.entity_id)throw new Error("You need to define an entity_id");if(!t.entities)throw new Error("You need to define entities");this.config=t}getCardSize(){return 1}getLayoutOptions(){return{grid_rows:1,grid_columns:6,grid_min_rows:1,grid_max_rows:1}}}customElements.define("mediocre-chip-media-player-group-card",r$);class n$ extends Yl{constructor(){super(...arguments),this.Card=_S,this.extraProps={isMassive:!0,className:void 0}}}customElements.define("mediocre-massive-media-player-card-editor",n$);class i$ extends Zs{constructor(){super(...arguments),this.Card=La,this.shouldUpdate=(t,r)=>{if(!r||!t||!this.config||!t&&r||zt(t.states[this.config.entity_id],r.states[this.config.entity_id])||this.config.speaker_group?.entity_id&&zt(t.states[this.config.speaker_group.entity_id],r.states[this.config.speaker_group.entity_id]))return!0;if(this.config.speaker_group?.entities){for(const n of this.config.speaker_group.entities)if(zt(t.states[typeof n=="string"?n:n.entity],r.states[typeof n=="string"?n:n.entity],!0))return!0}return!1}}setConfig(t){if(!t.entity_id)throw new Error("You need to define an entity_id");this.config=t}static getConfigElement(){return document.createElement("mediocre-massive-media-player-card-editor")}static getStubConfig(t){return{entity_id:Object.keys(t.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??"",mode:"card"}}}customElements.define("mediocre-massive-media-player-card",i$),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-massive-media-player-card",name:"Mediocre Massive Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"});class s$ extends Yl{constructor(){super(...arguments),this.Card=NS}}customElements.define("mediocre-media-player-card-editor",s$);class o$ extends Zs{constructor(){super(...arguments),this.Card=Em,this.shouldUpdate=(t,r)=>{if(!r||!t||!this.config||!t&&r||zt(t.states[this.config.entity_id],r.states[this.config.entity_id])||this.config.speaker_group?.entity_id&&zt(t.states[this.config.speaker_group.entity_id],r.states[this.config.speaker_group.entity_id]))return!0;if(this.config.speaker_group?.entities){for(const n of this.config.speaker_group.entities)if(zt(t.states[typeof n=="string"?n:n.entity],r.states[typeof n=="string"?n:n.entity],!0))return!0}return!1}}setConfig(t){if(!t.entity_id)throw new Error("You need to define an entity_id");this.config=t}static getConfigElement(){return document.createElement("mediocre-media-player-card-editor")}static getStubConfig(t){return{entity_id:Object.keys(t.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??""}}getCardSize(){return 2}getGridOptions(){return{columns:12,min_columns:8}}}customElements.define("mediocre-media-player-card",o$),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-media-player-card",name:"Mediocre Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"});class a$ extends Yl{constructor(){super(...arguments),this.Card=HS}}customElements.define("mediocre-multi-media-player-card-editor",a$);class l$ extends Zs{constructor(){super(...arguments),this.Card=WS,this.providePlayerContext=!1,this.shouldUpdate=(t,r)=>!r||!t||!this.config||!t&&r?!0:this.config.media_players.some(n=>{const i=n.entity_id;if(zt(t.states[i],r.states[i])||n.speaker_group_entity_id&&zt(t.states[n.speaker_group_entity_id],r.states[n.speaker_group_entity_id]))return!0})}setConfig(t){if(!t.media_players||t.media_players.length===0)throw new Error("You need to define at least one media player.");if(t.entity_id&&t.media_players.find(r=>r.entity_id===t.entity_id)===void 0)throw new Error("The entity_id must be one of the defined media players.");this.config=t}static getConfigElement(){return document.createElement("mediocre-multi-media-player-card-editor")}static getStubConfig(t){const n=Object.keys(t.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player");return{entity_id:n[0]??"",mode:"card",media_players:[{entity_id:n[0]??""}]}}getCardSize(){return 2}getGridOptions(){return{columns:12,min_columns:8}}}customElements.define("mediocre-multi-media-player-card",l$),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-multi-media-player-card",name:"Mediocre Multi Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"})}));
