(function(Xe){typeof define=="function"&&define.amd?define(Xe):Xe()})(function(){"use strict";var DS=Object.defineProperty;var VS=(Xe,Y,Qt)=>Y in Xe?DS(Xe,Y,{enumerable:!0,configurable:!0,writable:!0,value:Qt}):Xe[Y]=Qt;var y=(Xe,Y,Qt)=>VS(Xe,typeof Y!="symbol"?Y+"":Y,Qt);var Pf,Df,Vf,Ff,Lf,zf,Bf,jf,qf,Uf,Kf,Wf,Hf;var Xe,Y,Qt,en,Ta,Ra,Na,Pa,gs,ys,vs,Da,Qn={},Va=[],Jf=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,er=Array.isArray;function yt(e,n){for(var t in n)e[t]=n[t];return e}function bs(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Le(e,n,t){var r,i,s,o={};for(s in n)s=="key"?r=n[s]:s=="ref"?i=n[s]:o[s]=n[s];if(arguments.length>2&&(o.children=arguments.length>3?Xe.call(arguments,2):t),typeof e=="function"&&e.defaultProps!=null)for(s in e.defaultProps)o[s]===void 0&&(o[s]=e.defaultProps[s]);return tr(e,o,r,i,null)}function tr(e,n,t,r,i){var s={type:e,props:n,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Qt,__i:-1,__u:0};return i==null&&Y.vnode!=null&&Y.vnode(s),s}function Fa(){return{current:null}}function Oe(e){return e.children}function ut(e,n){this.props=e,this.context=n}function wn(e,n){if(n==null)return e.__?wn(e.__,e.__i+1):null;for(var t;n<e.__k.length;n++)if((t=e.__k[n])!=null&&t.__e!=null)return t.__e;return typeof e.type=="function"?wn(e):null}function La(e){var n,t;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,n=0;n<e.__k.length;n++)if((t=e.__k[n])!=null&&t.__e!=null){e.__e=e.__c.base=t.__e;break}return La(e)}}function _s(e){(!e.__d&&(e.__d=!0)&&en.push(e)&&!Wr.__r++||Ta!=Y.debounceRendering)&&((Ta=Y.debounceRendering)||Ra)(Wr)}function Wr(){for(var e,n,t,r,i,s,o,a=1;en.length;)en.length>a&&en.sort(Na),e=en.shift(),a=en.length,e.__d&&(t=void 0,i=(r=(n=e).__v).__e,s=[],o=[],n.__P&&((t=yt({},r)).__v=r.__v+1,Y.vnode&&Y.vnode(t),xs(n.__P,t,r,n.__n,n.__P.namespaceURI,32&r.__u?[i]:null,s,i??wn(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,Ua(s,t,o),t.__e!=i&&La(t)));Wr.__r=0}function za(e,n,t,r,i,s,o,a,c,l,u){var d,h,f,p,g,v,b=r&&r.__k||Va,_=n.length;for(c=Yf(t,n,b,c,_),d=0;d<_;d++)(f=t.__k[d])!=null&&(h=f.__i==-1?Qn:b[f.__i]||Qn,f.__i=d,v=xs(e,f,h,i,s,o,a,c,l,u),p=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&ws(h.ref,null,f),u.push(f.ref,f.__c||p,f)),g==null&&p!=null&&(g=p),4&f.__u||h.__k===f.__k?c=Ba(f,c,e):typeof f.type=="function"&&v!==void 0?c=v:p&&(c=p.nextSibling),f.__u&=-7);return t.__e=g,c}function Yf(e,n,t,r,i){var s,o,a,c,l,u=t.length,d=u,h=0;for(e.__k=new Array(i),s=0;s<i;s++)(o=n[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=s+h,(o=e.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?tr(null,o,null,null,null):er(o)?tr(Oe,{children:o},null,null,null):o.constructor==null&&o.__b>0?tr(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=e,o.__b=e.__b+1,a=null,(l=o.__i=Zf(o,t,c,d))!=-1&&(d--,(a=t[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(i>u?h--:i<u&&h++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,o.__u|=4))):e.__k[s]=null;if(d)for(s=0;s<u;s++)(a=t[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=wn(a)),Wa(a,a));return r}function Ba(e,n,t){var r,i;if(typeof e.type=="function"){for(r=e.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=e,n=Ba(r[i],n,t));return n}e.__e!=n&&(n&&e.type&&!t.contains(n)&&(n=wn(e)),t.insertBefore(e.__e,n||null),n=e.__e);do n=n&&n.nextSibling;while(n!=null&&n.nodeType==8);return n}function Et(e,n){return n=n||[],e==null||typeof e=="boolean"||(er(e)?e.some(function(t){Et(t,n)}):n.push(e)),n}function Zf(e,n,t,r){var i,s,o=e.key,a=e.type,c=n[t];if(c===null&&e.key==null||c&&o==c.key&&a==c.type&&(2&c.__u)==0)return t;if(r>(c!=null&&(2&c.__u)==0?1:0))for(i=t-1,s=t+1;i>=0||s<n.length;){if(i>=0){if((c=n[i])&&(2&c.__u)==0&&o==c.key&&a==c.type)return i;i--}if(s<n.length){if((c=n[s])&&(2&c.__u)==0&&o==c.key&&a==c.type)return s;s++}}return-1}function ja(e,n,t){n[0]=="-"?e.setProperty(n,t??""):e[n]=t==null?"":typeof t!="number"||Jf.test(n)?t:t+"px"}function Hr(e,n,t,r,i){var s,o;e:if(n=="style")if(typeof t=="string")e.style.cssText=t;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(n in r)t&&n in t||ja(e.style,n,"");if(t)for(n in t)r&&t[n]==r[n]||ja(e.style,n,t[n])}else if(n[0]=="o"&&n[1]=="n")s=n!=(n=n.replace(Pa,"$1")),o=n.toLowerCase(),n=o in e||n=="onFocusOut"||n=="onFocusIn"?o.slice(2):n.slice(2),e.l||(e.l={}),e.l[n+s]=t,t?r?t.u=r.u:(t.u=gs,e.addEventListener(n,s?vs:ys,s)):e.removeEventListener(n,s?vs:ys,s);else{if(i=="http://www.w3.org/2000/svg")n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(n!="width"&&n!="height"&&n!="href"&&n!="list"&&n!="form"&&n!="tabIndex"&&n!="download"&&n!="rowSpan"&&n!="colSpan"&&n!="role"&&n!="popover"&&n in e)try{e[n]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&n[4]!="-"?e.removeAttribute(n):e.setAttribute(n,n=="popover"&&t==1?"":t))}}function qa(e){return function(n){if(this.l){var t=this.l[n.type+e];if(n.t==null)n.t=gs++;else if(n.t<t.u)return;return t(Y.event?Y.event(n):n)}}}function xs(e,n,t,r,i,s,o,a,c,l){var u,d,h,f,p,g,v,b,_,$,k,x,C,M,O,I,T,N=n.type;if(n.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=n.__e=t.__e]),(u=Y.__b)&&u(n);e:if(typeof N=="function")try{if(b=n.props,_="prototype"in N&&N.prototype.render,$=(u=N.contextType)&&r[u.__c],k=u?$?$.props.value:u.__:r,t.__c?v=(d=n.__c=t.__c).__=d.__E:(_?n.__c=d=new N(b,k):(n.__c=d=new ut(b,k),d.constructor=N,d.render=Qf),$&&$.sub(d),d.props=b,d.state||(d.state={}),d.context=k,d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),_&&d.__s==null&&(d.__s=d.state),_&&N.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=yt({},d.__s)),yt(d.__s,N.getDerivedStateFromProps(b,d.__s))),f=d.props,p=d.state,d.__v=n,h)_&&N.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),_&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(_&&N.getDerivedStateFromProps==null&&b!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(b,k),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(b,d.__s,k)===!1||n.__v==t.__v){for(n.__v!=t.__v&&(d.props=b,d.state=d.__s,d.__d=!1),n.__e=t.__e,n.__k=t.__k,n.__k.some(function(j){j&&(j.__=n)}),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(b,d.__s,k),_&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,p,g)})}if(d.context=k,d.props=b,d.__P=e,d.__e=!1,C=Y.__r,M=0,_){for(d.state=d.__s,d.__d=!1,C&&C(n),u=d.render(d.props,d.state,d.context),O=0;O<d._sb.length;O++)d.__h.push(d._sb[O]);d._sb=[]}else do d.__d=!1,C&&C(n),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++M<25);d.state=d.__s,d.getChildContext!=null&&(r=yt(yt({},r),d.getChildContext())),_&&!h&&d.getSnapshotBeforeUpdate!=null&&(g=d.getSnapshotBeforeUpdate(f,p)),I=u,u!=null&&u.type===Oe&&u.key==null&&(I=Ka(u.props.children)),a=za(e,er(I)?I:[I],n,t,r,i,s,o,a,c,l),d.base=n.__e,n.__u&=-161,d.__h.length&&o.push(d),v&&(d.__E=d.__=null)}catch(j){if(n.__v=null,c||s!=null)if(j.then){for(n.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,n.__e=a}else for(T=s.length;T--;)bs(s[T]);else n.__e=t.__e,n.__k=t.__k;Y.__e(j,n,t)}else s==null&&n.__v==t.__v?(n.__k=t.__k,n.__e=t.__e):a=n.__e=Xf(t.__e,n,t,r,i,s,o,c,l);return(u=Y.diffed)&&u(n),128&n.__u?void 0:a}function Ua(e,n,t){for(var r=0;r<t.length;r++)ws(t[r],t[++r],t[++r]);Y.__c&&Y.__c(n,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(s){s.call(i)})}catch(s){Y.__e(s,i.__v)}})}function Ka(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:er(e)?e.map(Ka):yt({},e)}function Xf(e,n,t,r,i,s,o,a,c){var l,u,d,h,f,p,g,v=t.props,b=n.props,_=n.type;if(_=="svg"?i="http://www.w3.org/2000/svg":_=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((f=s[l])&&"setAttribute"in f==!!_&&(_?f.localName==_:f.nodeType==3)){e=f,s[l]=null;break}}if(e==null){if(_==null)return document.createTextNode(b);e=document.createElementNS(i,_,b.is&&b),a&&(Y.__m&&Y.__m(n,s),a=!1),s=null}if(_==null)v===b||a&&e.data==b||(e.data=b);else{if(s=s&&Xe.call(e.childNodes),v=t.props||Qn,!a&&s!=null)for(v={},l=0;l<e.attributes.length;l++)v[(f=e.attributes[l]).name]=f.value;for(l in v)if(f=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")d=f;else if(!(l in b)){if(l=="value"&&"defaultValue"in b||l=="checked"&&"defaultChecked"in b)continue;Hr(e,l,null,f,i)}}for(l in b)f=b[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?u=f:l=="value"?p=f:l=="checked"?g=f:a&&typeof f!="function"||v[l]===f||Hr(e,l,f,v[l],i);if(u)a||d&&(u.__html==d.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),n.__k=[];else if(d&&(e.innerHTML=""),za(n.type=="template"?e.content:e,er(h)?h:[h],n,t,r,_=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&wn(t,0),a,c),s!=null)for(l=s.length;l--;)bs(s[l]);a||(l="value",_=="progress"&&p==null?e.removeAttribute("value"):p!=null&&(p!==e[l]||_=="progress"&&!p||_=="option"&&p!=v[l])&&Hr(e,l,p,v[l],i),l="checked",g!=null&&g!=e[l]&&Hr(e,l,g,v[l],i))}return e}function ws(e,n,t){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&n==null||(e.__u=e(n))}else e.current=n}catch(i){Y.__e(i,t)}}function Wa(e,n,t){var r,i;if(Y.unmount&&Y.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||ws(r,null,n)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Y.__e(s,n)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&Wa(r[i],n,t||typeof e.type!="function");t||bs(e.__e),e.__c=e.__=e.__e=void 0}function Qf(e,n,t){return this.constructor(e,t)}function tn(e,n,t){var r,i,s,o;n==document&&(n=document.documentElement),Y.__&&Y.__(e,n),i=(r=typeof t=="function")?null:t&&t.__k||n.__k,s=[],o=[],xs(n,e=(!r&&t||n).__k=Le(Oe,null,[e]),i||Qn,Qn,n.namespaceURI,!r&&t?[t]:i?null:n.firstChild?Xe.call(n.childNodes):null,s,!r&&t?t:i?i.__e:n.firstChild,r,o),Ua(s,e,o)}function Ha(e,n){tn(e,n,Ha)}function ep(e,n,t){var r,i,s,o,a=yt({},e.props);for(s in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),n)s=="key"?r=n[s]:s=="ref"?i=n[s]:a[s]=n[s]===void 0&&o!=null?o[s]:n[s];return arguments.length>2&&(a.children=arguments.length>3?Xe.call(arguments,2):t),tr(e.type,a,r||e.key,i||e.ref,null)}function it(e){function n(t){var r,i;return this.getChildContext||(r=new Set,(i={})[n.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&r.forEach(function(o){o.__e=!0,_s(o)})},this.sub=function(s){r.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){r&&r.delete(s),o&&o.call(s)}}),t.children}return n.__c="__cC"+Da++,n.__=e,n.Provider=n.__l=(n.Consumer=function(t,r){return t.children(r)}).contextType=n,n}Xe=Va.slice,Y={__e:function(e,n,t,r){for(var i,s,o;n=n.__;)if((i=n.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(e)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,r||{}),o=i.__d),o)return i.__E=i}catch(a){e=a}throw e}},Qt=0,ut.prototype.setState=function(e,n){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=yt({},this.state),typeof e=="function"&&(e=e(yt({},t),this.props)),e&&yt(t,e),e!=null&&this.__v&&(n&&this._sb.push(n),_s(this))},ut.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),_s(this))},ut.prototype.render=Oe,en=[],Ra=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Na=function(e,n){return e.__v.__b-n.__v.__b},Wr.__r=0,Pa=/(PointerCapture)$|Capture$/i,gs=0,ys=qa(!1),vs=qa(!0),Da=0;var Ot,be,Ss,Ga,Sn=0,Ja=[],Ce=Y,Ya=Ce.__b,Za=Ce.__r,Xa=Ce.diffed,Qa=Ce.__c,el=Ce.unmount,tl=Ce.__;function nn(e,n){Ce.__h&&Ce.__h(be,e,Sn||n),Sn=0;var t=be.__H||(be.__H={__:[],__h:[]});return e>=t.__.length&&t.__.push({}),t.__[e]}function F(e){return Sn=1,nr(rl,e)}function nr(e,n,t){var r=nn(Ot++,2);if(r.t=e,!r.__c&&(r.__=[t?t(n):rl(void 0,n),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=be,!be.__f)){var i=function(a,c,l){if(!r.__c.__H)return!0;var u=r.__c.__H.__.filter(function(h){return!!h.__c});if(u.every(function(h){return!h.__N}))return!s||s.call(this,a,c,l);var d=r.__c.props!==a;return u.forEach(function(h){if(h.__N){var f=h.__[0];h.__=h.__N,h.__N=void 0,f!==h.__[0]&&(d=!0)}}),s&&s.call(this,a,c,l)||d};be.__f=!0;var s=be.shouldComponentUpdate,o=be.componentWillUpdate;be.componentWillUpdate=function(a,c,l){if(this.__e){var u=s;s=void 0,i(a,c,l),s=u}o&&o.call(this,a,c,l)},be.shouldComponentUpdate=i}return r.__N||r.__}function ce(e,n){var t=nn(Ot++,3);!Ce.__s&&Es(t.__H,n)&&(t.__=e,t.u=n,be.__H.__h.push(t))}function It(e,n){var t=nn(Ot++,4);!Ce.__s&&Es(t.__H,n)&&(t.__=e,t.u=n,be.__h.push(t))}function le(e){return Sn=5,W(function(){return{current:e}},[])}function $s(e,n,t){Sn=6,It(function(){if(typeof e=="function"){var r=e(n());return function(){e(null),r&&typeof r=="function"&&r()}}if(e)return e.current=n(),function(){return e.current=null}},t==null?t:t.concat(e))}function W(e,n){var t=nn(Ot++,7);return Es(t.__H,n)&&(t.__=e(),t.__H=n,t.__h=e),t.__}function D(e,n){return Sn=8,W(function(){return e},n)}function me(e){var n=be.context[e.__c],t=nn(Ot++,9);return t.c=e,n?(t.__==null&&(t.__=!0,n.sub(be)),n.props.value):e.__}function ks(e,n){Ce.useDebugValue&&Ce.useDebugValue(n?n(e):e)}function tp(e){var n=nn(Ot++,10),t=F();return n.__=e,be.componentDidCatch||(be.componentDidCatch=function(r,i){n.__&&n.__(r,i),t[1](r)}),[t[0],function(){t[1](void 0)}]}function Cs(){var e=nn(Ot++,11);if(!e.__){for(var n=be.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;var t=n.__m||(n.__m=[0,0]);e.__="P"+t[0]+"-"+t[1]++}return e.__}function np(){for(var e;e=Ja.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Gr),e.__H.__h.forEach(Ms),e.__H.__h=[]}catch(n){e.__H.__h=[],Ce.__e(n,e.__v)}}Ce.__b=function(e){be=null,Ya&&Ya(e)},Ce.__=function(e,n){e&&n.__k&&n.__k.__m&&(e.__m=n.__k.__m),tl&&tl(e,n)},Ce.__r=function(e){Za&&Za(e),Ot=0;var n=(be=e.__c).__H;n&&(Ss===be?(n.__h=[],be.__h=[],n.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(n.__h.forEach(Gr),n.__h.forEach(Ms),n.__h=[],Ot=0)),Ss=be},Ce.diffed=function(e){Xa&&Xa(e);var n=e.__c;n&&n.__H&&(n.__H.__h.length&&(Ja.push(n)!==1&&Ga===Ce.requestAnimationFrame||((Ga=Ce.requestAnimationFrame)||rp)(np)),n.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),Ss=be=null},Ce.__c=function(e,n){n.some(function(t){try{t.__h.forEach(Gr),t.__h=t.__h.filter(function(r){return!r.__||Ms(r)})}catch(r){n.some(function(i){i.__h&&(i.__h=[])}),n=[],Ce.__e(r,t.__v)}}),Qa&&Qa(e,n)},Ce.unmount=function(e){el&&el(e);var n,t=e.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{Gr(r)}catch(i){n=i}}),t.__H=void 0,n&&Ce.__e(n,t.__v))};var nl=typeof requestAnimationFrame=="function";function rp(e){var n,t=function(){clearTimeout(r),nl&&cancelAnimationFrame(n),setTimeout(e)},r=setTimeout(t,35);nl&&(n=requestAnimationFrame(t))}function Gr(e){var n=be,t=e.__c;typeof t=="function"&&(e.__c=void 0,t()),be=n}function Ms(e){var n=be;e.__c=e.__(),be=n}function Es(e,n){return!e||e.length!==n.length||n.some(function(t,r){return t!==e[r]})}function rl(e,n){return typeof n=="function"?n(e):n}function il(e,n){for(var t in n)e[t]=n[t];return e}function Os(e,n){for(var t in e)if(t!=="__source"&&!(t in n))return!0;for(var r in n)if(r!=="__source"&&e[r]!==n[r])return!0;return!1}function Is(e,n){var t=n(),r=F({t:{__:t,u:n}}),i=r[0].t,s=r[1];return It(function(){i.__=t,i.u=n,As(i)&&s({t:i})},[e,t,n]),ce(function(){return As(i)&&s({t:i}),e(function(){As(i)&&s({t:i})})},[e]),t}function As(e){var n,t,r=e.u,i=e.__;try{var s=r();return!((n=i)===(t=s)&&(n!==0||1/n==1/t)||n!=n&&t!=t)}catch{return!0}}function Ts(e){e()}function Rs(e){return e}function Ns(){return[!1,Ts]}var Ps=It;function Jr(e,n){this.props=e,this.context=n}function sl(e,n){function t(i){var s=this.props.ref,o=s==i.ref;return!o&&s&&(s.call?s(null):s.current=null),n?!n(this.props,i)||!o:Os(this.props,i)}function r(i){return this.shouldComponentUpdate=t,Le(e,i)}return r.displayName="Memo("+(e.displayName||e.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Jr.prototype=new ut).isPureReactComponent=!0,Jr.prototype.shouldComponentUpdate=function(e,n){return Os(this.props,e)||Os(this.state,n)};var ol=Y.__b;Y.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),ol&&ol(e)};var ip=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Qe(e){function n(t){var r=il({},t);return delete r.ref,e(r,t.ref||null)}return n.$$typeof=ip,n.render=n,n.prototype.isReactComponent=n.__f=!0,n.displayName="ForwardRef("+(e.displayName||e.name)+")",n}var al=function(e,n){return e==null?null:Et(Et(e).map(n))},ll={map:al,forEach:al,count:function(e){return e?Et(e).length:0},only:function(e){var n=Et(e);if(n.length!==1)throw"Children.only";return n[0]},toArray:Et},sp=Y.__e;Y.__e=function(e,n,t,r){if(e.then){for(var i,s=n;s=s.__;)if((i=s.__c)&&i.__c)return n.__e==null&&(n.__e=t.__e,n.__k=t.__k),i.__c(e,n)}sp(e,n,t,r)};var cl=Y.unmount;function ul(e,n,t){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),e.__c.__H=null),(e=il({},e)).__c!=null&&(e.__c.__P===t&&(e.__c.__P=n),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(r){return ul(r,n,t)})),e}function dl(e,n,t){return e&&t&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(r){return dl(r,n,t)}),e.__c&&e.__c.__P===n&&(e.__e&&t.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=t)),e}function rr(){this.__u=0,this.o=null,this.__b=null}function hl(e){var n=e.__.__c;return n&&n.__a&&n.__a(e)}function fl(e){var n,t,r;function i(s){if(n||(n=e()).then(function(o){t=o.default||o},function(o){r=o}),r)throw r;if(!t)throw n;return Le(t,s)}return i.displayName="Lazy",i.__f=!0,i}function $n(){this.i=null,this.l=null}Y.unmount=function(e){var n=e.__c;n&&n.__R&&n.__R(),n&&32&e.__u&&(e.type=null),cl&&cl(e)},(rr.prototype=new ut).__c=function(e,n){var t=n.__c,r=this;r.o==null&&(r.o=[]),r.o.push(t);var i=hl(r.__v),s=!1,o=function(){s||(s=!0,t.__R=null,i?i(a):a())};t.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=dl(c,c.__c.__P,c.__c.__O)}var l;for(r.setState({__a:r.__b=null});l=r.o.pop();)l.forceUpdate()}};r.__u++||32&n.__u||r.setState({__a:r.__b=r.__v.__k[0]}),e.then(o,o)},rr.prototype.componentWillUnmount=function(){this.o=[]},rr.prototype.render=function(e,n){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=ul(this.__b,t,r.__O=r.__P)}this.__b=null}var i=n.__a&&Le(Oe,null,e.fallback);return i&&(i.__u&=-33),[Le(Oe,null,n.__a?null:e.children),i]};var pl=function(e,n,t){if(++t[1]===t[0]&&e.l.delete(n),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(t=e.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;e.i=t=t[2]}};function op(e){return this.getChildContext=function(){return e.context},e.children}function ap(e){var n=this,t=e.h;if(n.componentWillUnmount=function(){tn(null,n.v),n.v=null,n.h=null},n.h&&n.h!==t&&n.componentWillUnmount(),!n.v){for(var r=n.__v;r!==null&&!r.__m&&r.__!==null;)r=r.__;n.h=t,n.v={nodeType:1,parentNode:t,childNodes:[],__k:{__m:r.__m},contains:function(){return!0},insertBefore:function(i,s){this.childNodes.push(i),n.h.insertBefore(i,s)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),n.h.removeChild(i)}}}tn(Le(op,{context:n.context},e.__v),n.v)}function ml(e,n){var t=Le(ap,{__v:e,h:n});return t.containerInfo=n,t}($n.prototype=new ut).__a=function(e){var n=this,t=hl(n.__v),r=n.l.get(e);return r[0]++,function(i){var s=function(){n.props.revealOrder?(r.push(i),pl(n,e,r)):i()};t?t(s):s()}},$n.prototype.render=function(e){this.i=null,this.l=new Map;var n=Et(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&n.reverse();for(var t=n.length;t--;)this.l.set(n[t],this.i=[1,0,this.i]);return e.children},$n.prototype.componentDidUpdate=$n.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(n,t){pl(e,t,n)})};var gl=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,lp=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,cp=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,up=/[A-Z0-9]/g,dp=typeof document<"u",hp=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};function yl(e,n,t){return n.__k==null&&(n.textContent=""),tn(e,n),typeof t=="function"&&t(),e?e.__c:null}function vl(e,n,t){return Ha(e,n),typeof t=="function"&&t(),e?e.__c:null}ut.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(ut.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(n){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:n})}})});var bl=Y.event;function fp(){}function pp(){return this.cancelBubble}function mp(){return this.defaultPrevented}Y.event=function(e){return bl&&(e=bl(e)),e.persist=fp,e.isPropagationStopped=pp,e.isDefaultPrevented=mp,e.nativeEvent=e};var Ds,gp={enumerable:!1,configurable:!0,get:function(){return this.class}},_l=Y.vnode;Y.vnode=function(e){typeof e.type=="string"&&function(n){var t=n.props,r=n.type,i={},s=r.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||dp&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||r!=="input"&&r!=="textarea"||hp(t.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":cp.test(o)&&(o=c):c=o="oninput":s&&lp.test(o)?o=o.replace(up,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&i[o=c]&&(o="oninputCapture"),i[o]=a}}r=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Et(t.children).forEach(function(l){l.props.selected=i.value.indexOf(l.props.value)!=-1})),r=="select"&&i.defaultValue!=null&&(i.value=Et(t.children).forEach(function(l){l.props.selected=i.multiple?i.defaultValue.indexOf(l.props.value)!=-1:i.defaultValue==l.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",gp)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),n.props=i}(e),e.$$typeof=gl,_l&&_l(e)};var xl=Y.__r;Y.__r=function(e){xl&&xl(e),Ds=e.__c};var wl=Y.diffed;Y.diffed=function(e){wl&&wl(e);var n=e.props,t=e.__e;t!=null&&e.type==="textarea"&&"value"in n&&n.value!==t.value&&(t.value=n.value==null?"":n.value),Ds=null};var Sl={ReactCurrentDispatcher:{current:{readContext:function(e){return Ds.__n[e.__c].props.value},useCallback:D,useContext:me,useDebugValue:ks,useDeferredValue:Rs,useEffect:ce,useId:Cs,useImperativeHandle:$s,useInsertionEffect:Ps,useLayoutEffect:It,useMemo:W,useReducer:nr,useRef:le,useState:F,useSyncExternalStore:Is,useTransition:Ns}}},$l="18.3.1";function kl(e){return Le.bind(null,e)}function ir(e){return!!e&&e.$$typeof===gl}function Cl(e){return ir(e)&&e.type===Oe}function Ml(e){return!!e&&!!e.displayName&&(typeof e.displayName=="string"||e.displayName instanceof String)&&e.displayName.startsWith("Memo(")}function Yr(e){return ir(e)?ep.apply(null,arguments):e}function El(e){return!!e.__k&&(tn(null,e),!0)}function Ol(e){return e&&(e.base||e.nodeType===1&&e)||null}var Il=function(e,n){return e(n)},Zr=function(e,n){return e(n)},Al=Oe,Tl=ir,yp={useState:F,useId:Cs,useReducer:nr,useEffect:ce,useLayoutEffect:It,useInsertionEffect:Ps,useTransition:Ns,useDeferredValue:Rs,useSyncExternalStore:Is,startTransition:Ts,useRef:le,useImperativeHandle:$s,useMemo:W,useCallback:D,useContext:me,useDebugValue:ks,version:"18.3.1",Children:ll,render:yl,hydrate:vl,unmountComponentAtNode:El,createPortal:ml,createElement:Le,createContext:it,createFactory:kl,cloneElement:Yr,createRef:Fa,Fragment:Oe,isValidElement:ir,isElement:Tl,isFragment:Cl,isMemo:Ml,findDOMNode:Ol,Component:ut,PureComponent:Jr,memo:sl,forwardRef:Qe,flushSync:Zr,unstable_batchedUpdates:Il,StrictMode:Al,Suspense:rr,SuspenseList:$n,lazy:fl,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Sl};const Xr=Object.freeze(Object.defineProperty({__proto__:null,Children:ll,Component:ut,Fragment:Oe,PureComponent:Jr,StrictMode:Al,Suspense:rr,SuspenseList:$n,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Sl,cloneElement:Yr,createContext:it,createElement:Le,createFactory:kl,createPortal:ml,createRef:Fa,default:yp,findDOMNode:Ol,flushSync:Zr,forwardRef:Qe,hydrate:vl,isElement:Tl,isFragment:Cl,isMemo:Ml,isValidElement:ir,lazy:fl,memo:sl,render:yl,startTransition:Ts,unmountComponentAtNode:El,unstable_batchedUpdates:Il,useCallback:D,useContext:me,useDebugValue:ks,useDeferredValue:Rs,useEffect:ce,useErrorBoundary:tp,useId:Cs,useImperativeHandle:$s,useInsertionEffect:Ps,useLayoutEffect:It,useMemo:W,useReducer:nr,useRef:le,useState:F,useSyncExternalStore:Is,useTransition:Ns,version:$l},Symbol.toStringTag,{value:"Module"}));var vp=0;function Re(e,n,t,r,i,s){n||(n={});var o,a,c=n;if("ref"in c)for(a in c={},n)a=="ref"?o=n[a]:c[a]=n[a];var l={type:e,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--vp,__i:-1,__u:0,__source:i,__self:s};if(typeof e=="function"&&(o=e.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return Y.vnode&&Y.vnode(l),l}function bp(e){if(e.sheet)return e.sheet;for(var n=0;n<document.styleSheets.length;n++)if(document.styleSheets[n].ownerNode===e)return document.styleSheets[n]}function _p(e){var n=document.createElement("style");return n.setAttribute("data-emotion",e.key),e.nonce!==void 0&&n.setAttribute("nonce",e.nonce),n.appendChild(document.createTextNode("")),n.setAttribute("data-s",""),n}var xp=function(){function e(t){var r=this;this._insertTag=function(i){var s;r.tags.length===0?r.insertionPoint?s=r.insertionPoint.nextSibling:r.prepend?s=r.container.firstChild:s=r.before:s=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,s),r.tags.push(i)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var n=e.prototype;return n.hydrate=function(r){r.forEach(this._insertTag)},n.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(_p(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var s=bp(i);try{s.insertRule(r,s.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},n.flush=function(){this.tags.forEach(function(r){var i;return(i=r.parentNode)==null?void 0:i.removeChild(r)}),this.tags=[],this.ctr=0},e}(),Ke="-ms-",Qr="-moz-",ue="-webkit-",Rl="comm",Vs="rule",Fs="decl",wp="@import",Nl="@keyframes",Sp="@layer",$p=Math.abs,ei=String.fromCharCode,kp=Object.assign;function Cp(e,n){return ze(e,0)^45?(((n<<2^ze(e,0))<<2^ze(e,1))<<2^ze(e,2))<<2^ze(e,3):0}function Pl(e){return e.trim()}function Mp(e,n){return(e=n.exec(e))?e[0]:e}function de(e,n,t){return e.replace(n,t)}function Ls(e,n){return e.indexOf(n)}function ze(e,n){return e.charCodeAt(n)|0}function sr(e,n,t){return e.slice(n,t)}function vt(e){return e.length}function zs(e){return e.length}function ti(e,n){return n.push(e),e}function Ep(e,n){return e.map(n).join("")}var ni=1,kn=1,Dl=0,et=0,Ie=0,Cn="";function ri(e,n,t,r,i,s,o){return{value:e,root:n,parent:t,type:r,props:i,children:s,line:ni,column:kn,length:o,return:""}}function or(e,n){return kp(ri("",null,null,"",null,null,0),e,{length:-e.length},n)}function Op(){return Ie}function Ip(){return Ie=et>0?ze(Cn,--et):0,kn--,Ie===10&&(kn=1,ni--),Ie}function st(){return Ie=et<Dl?ze(Cn,et++):0,kn++,Ie===10&&(kn=1,ni++),Ie}function bt(){return ze(Cn,et)}function ii(){return et}function ar(e,n){return sr(Cn,e,n)}function lr(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Vl(e){return ni=kn=1,Dl=vt(Cn=e),et=0,[]}function Fl(e){return Cn="",e}function si(e){return Pl(ar(et-1,Bs(e===91?e+2:e===40?e+1:e)))}function Ap(e){for(;(Ie=bt())&&Ie<33;)st();return lr(e)>2||lr(Ie)>3?"":" "}function Tp(e,n){for(;--n&&st()&&!(Ie<48||Ie>102||Ie>57&&Ie<65||Ie>70&&Ie<97););return ar(e,ii()+(n<6&&bt()==32&&st()==32))}function Bs(e){for(;st();)switch(Ie){case e:return et;case 34:case 39:e!==34&&e!==39&&Bs(Ie);break;case 40:e===41&&Bs(e);break;case 92:st();break}return et}function Rp(e,n){for(;st()&&e+Ie!==57;)if(e+Ie===84&&bt()===47)break;return"/*"+ar(n,et-1)+"*"+ei(e===47?e:st())}function Np(e){for(;!lr(bt());)st();return ar(e,et)}function Pp(e){return Fl(oi("",null,null,null,[""],e=Vl(e),0,[0],e))}function oi(e,n,t,r,i,s,o,a,c){for(var l=0,u=0,d=o,h=0,f=0,p=0,g=1,v=1,b=1,_=0,$="",k=i,x=s,C=r,M=$;v;)switch(p=_,_=st()){case 40:if(p!=108&&ze(M,d-1)==58){Ls(M+=de(si(_),"&","&\f"),"&\f")!=-1&&(b=-1);break}case 34:case 39:case 91:M+=si(_);break;case 9:case 10:case 13:case 32:M+=Ap(p);break;case 92:M+=Tp(ii()-1,7);continue;case 47:switch(bt()){case 42:case 47:ti(Dp(Rp(st(),ii()),n,t),c);break;default:M+="/"}break;case 123*g:a[l++]=vt(M)*b;case 125*g:case 59:case 0:switch(_){case 0:case 125:v=0;case 59+u:b==-1&&(M=de(M,/\f/g,"")),f>0&&vt(M)-d&&ti(f>32?zl(M+";",r,t,d-1):zl(de(M," ","")+";",r,t,d-2),c);break;case 59:M+=";";default:if(ti(C=Ll(M,n,t,l,u,i,a,$,k=[],x=[],d),s),_===123)if(u===0)oi(M,n,C,C,k,s,d,a,x);else switch(h===99&&ze(M,3)===110?100:h){case 100:case 108:case 109:case 115:oi(e,C,C,r&&ti(Ll(e,C,C,0,0,i,a,$,i,k=[],d),x),i,x,d,a,r?k:x);break;default:oi(M,C,C,C,[""],x,0,a,x)}}l=u=f=0,g=b=1,$=M="",d=o;break;case 58:d=1+vt(M),f=p;default:if(g<1){if(_==123)--g;else if(_==125&&g++==0&&Ip()==125)continue}switch(M+=ei(_),_*g){case 38:b=u>0?1:(M+="\f",-1);break;case 44:a[l++]=(vt(M)-1)*b,b=1;break;case 64:bt()===45&&(M+=si(st())),h=bt(),u=d=vt($=M+=Np(ii())),_++;break;case 45:p===45&&vt(M)==2&&(g=0)}}return s}function Ll(e,n,t,r,i,s,o,a,c,l,u){for(var d=i-1,h=i===0?s:[""],f=zs(h),p=0,g=0,v=0;p<r;++p)for(var b=0,_=sr(e,d+1,d=$p(g=o[p])),$=e;b<f;++b)($=Pl(g>0?h[b]+" "+_:de(_,/&\f/g,h[b])))&&(c[v++]=$);return ri(e,n,t,i===0?Vs:a,c,l,u)}function Dp(e,n,t){return ri(e,n,t,Rl,ei(Op()),sr(e,2,-2),0)}function zl(e,n,t,r){return ri(e,n,t,Fs,sr(e,0,r),sr(e,r+1,-1),r)}function Mn(e,n){for(var t="",r=zs(e),i=0;i<r;i++)t+=n(e[i],i,e,n)||"";return t}function Vp(e,n,t,r){switch(e.type){case Sp:if(e.children.length)break;case wp:case Fs:return e.return=e.return||e.value;case Rl:return"";case Nl:return e.return=e.value+"{"+Mn(e.children,r)+"}";case Vs:e.value=e.props.join(",")}return vt(t=Mn(e.children,r))?e.return=e.value+"{"+t+"}":""}function Fp(e){var n=zs(e);return function(t,r,i,s){for(var o="",a=0;a<n;a++)o+=e[a](t,r,i,s)||"";return o}}function Lp(e){return function(n){n.root||(n=n.return)&&e(n)}}function zp(e){var n=Object.create(null);return function(t){return n[t]===void 0&&(n[t]=e(t)),n[t]}}var Bp=function(n,t,r){for(var i=0,s=0;i=s,s=bt(),i===38&&s===12&&(t[r]=1),!lr(s);)st();return ar(n,et)},jp=function(n,t){var r=-1,i=44;do switch(lr(i)){case 0:i===38&&bt()===12&&(t[r]=1),n[r]+=Bp(et-1,t,r);break;case 2:n[r]+=si(i);break;case 4:if(i===44){n[++r]=bt()===58?"&\f":"",t[r]=n[r].length;break}default:n[r]+=ei(i)}while(i=st());return n},qp=function(n,t){return Fl(jp(Vl(n),t))},Bl=new WeakMap,Up=function(n){if(!(n.type!=="rule"||!n.parent||n.length<1)){for(var t=n.value,r=n.parent,i=n.column===r.column&&n.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(n.props.length===1&&t.charCodeAt(0)!==58&&!Bl.get(r))&&!i){Bl.set(n,!0);for(var s=[],o=qp(t,s),a=r.props,c=0,l=0;c<o.length;c++)for(var u=0;u<a.length;u++,l++)n.props[l]=s[c]?o[c].replace(/&\f/g,a[u]):a[u]+" "+o[c]}}},Kp=function(n){if(n.type==="decl"){var t=n.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(n.return="",n.value="")}};function jl(e,n){switch(Cp(e,n)){case 5103:return ue+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ue+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return ue+e+Qr+e+Ke+e+e;case 6828:case 4268:return ue+e+Ke+e+e;case 6165:return ue+e+Ke+"flex-"+e+e;case 5187:return ue+e+de(e,/(\w+).+(:[^]+)/,ue+"box-$1$2"+Ke+"flex-$1$2")+e;case 5443:return ue+e+Ke+"flex-item-"+de(e,/flex-|-self/,"")+e;case 4675:return ue+e+Ke+"flex-line-pack"+de(e,/align-content|flex-|-self/,"")+e;case 5548:return ue+e+Ke+de(e,"shrink","negative")+e;case 5292:return ue+e+Ke+de(e,"basis","preferred-size")+e;case 6060:return ue+"box-"+de(e,"-grow","")+ue+e+Ke+de(e,"grow","positive")+e;case 4554:return ue+de(e,/([^-])(transform)/g,"$1"+ue+"$2")+e;case 6187:return de(de(de(e,/(zoom-|grab)/,ue+"$1"),/(image-set)/,ue+"$1"),e,"")+e;case 5495:case 3959:return de(e,/(image-set\([^]*)/,ue+"$1$`$1");case 4968:return de(de(e,/(.+:)(flex-)?(.*)/,ue+"box-pack:$3"+Ke+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ue+e+e;case 4095:case 3583:case 4068:case 2532:return de(e,/(.+)-inline(.+)/,ue+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(vt(e)-1-n>6)switch(ze(e,n+1)){case 109:if(ze(e,n+4)!==45)break;case 102:return de(e,/(.+:)(.+)-([^]+)/,"$1"+ue+"$2-$3$1"+Qr+(ze(e,n+3)==108?"$3":"$2-$3"))+e;case 115:return~Ls(e,"stretch")?jl(de(e,"stretch","fill-available"),n)+e:e}break;case 4949:if(ze(e,n+1)!==115)break;case 6444:switch(ze(e,vt(e)-3-(~Ls(e,"!important")&&10))){case 107:return de(e,":",":"+ue)+e;case 101:return de(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ue+(ze(e,14)===45?"inline-":"")+"box$3$1"+ue+"$2$3$1"+Ke+"$2box$3")+e}break;case 5936:switch(ze(e,n+11)){case 114:return ue+e+Ke+de(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return ue+e+Ke+de(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return ue+e+Ke+de(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return ue+e+Ke+e+e}return e}var Wp=function(n,t,r,i){if(n.length>-1&&!n.return)switch(n.type){case Fs:n.return=jl(n.value,n.length);break;case Nl:return Mn([or(n,{value:de(n.value,"@","@"+ue)})],i);case Vs:if(n.length)return Ep(n.props,function(s){switch(Mp(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Mn([or(n,{props:[de(s,/:(read-\w+)/,":"+Qr+"$1")]})],i);case"::placeholder":return Mn([or(n,{props:[de(s,/:(plac\w+)/,":"+ue+"input-$1")]}),or(n,{props:[de(s,/:(plac\w+)/,":"+Qr+"$1")]}),or(n,{props:[de(s,/:(plac\w+)/,Ke+"input-$1")]})],i)}return""})}},Hp=[Wp],ql=function(n){var t=n.key;if(t==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(g){var v=g.getAttribute("data-emotion");v.indexOf(" ")!==-1&&(document.head.appendChild(g),g.setAttribute("data-s",""))})}var i=n.stylisPlugins||Hp,s={},o,a=[];o=n.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(g){for(var v=g.getAttribute("data-emotion").split(" "),b=1;b<v.length;b++)s[v[b]]=!0;a.push(g)});var c,l=[Up,Kp];{var u,d=[Vp,Lp(function(g){u.insert(g)})],h=Fp(l.concat(i,d)),f=function(v){return Mn(Pp(v),h)};c=function(v,b,_,$){u=_,f(v?v+"{"+b.styles+"}":b.styles),$&&(p.inserted[b.name]=!0)}}var p={key:t,sheet:new xp({key:t,container:o,nonce:n.nonce,speedy:n.speedy,prepend:n.prepend,insertionPoint:n.insertionPoint}),nonce:n.nonce,inserted:s,registered:{},insert:c};return p.sheet.hydrate(a),p};function Gp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Jp(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var n=e.default;if(typeof n=="function"){var t=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};t.prototype=n.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),t}var ai={exports:{}},fe={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ul;function Yp(){if(Ul)return fe;Ul=1;var e=typeof Symbol=="function"&&Symbol.for,n=e?Symbol.for("react.element"):60103,t=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,c=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,p=e?Symbol.for("react.lazy"):60116,g=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,b=e?Symbol.for("react.responder"):60118,_=e?Symbol.for("react.scope"):60119;function $(x){if(typeof x=="object"&&x!==null){var C=x.$$typeof;switch(C){case n:switch(x=x.type,x){case c:case l:case r:case s:case i:case d:return x;default:switch(x=x&&x.$$typeof,x){case a:case u:case p:case f:case o:return x;default:return C}}case t:return C}}}function k(x){return $(x)===l}return fe.AsyncMode=c,fe.ConcurrentMode=l,fe.ContextConsumer=a,fe.ContextProvider=o,fe.Element=n,fe.ForwardRef=u,fe.Fragment=r,fe.Lazy=p,fe.Memo=f,fe.Portal=t,fe.Profiler=s,fe.StrictMode=i,fe.Suspense=d,fe.isAsyncMode=function(x){return k(x)||$(x)===c},fe.isConcurrentMode=k,fe.isContextConsumer=function(x){return $(x)===a},fe.isContextProvider=function(x){return $(x)===o},fe.isElement=function(x){return typeof x=="object"&&x!==null&&x.$$typeof===n},fe.isForwardRef=function(x){return $(x)===u},fe.isFragment=function(x){return $(x)===r},fe.isLazy=function(x){return $(x)===p},fe.isMemo=function(x){return $(x)===f},fe.isPortal=function(x){return $(x)===t},fe.isProfiler=function(x){return $(x)===s},fe.isStrictMode=function(x){return $(x)===i},fe.isSuspense=function(x){return $(x)===d},fe.isValidElementType=function(x){return typeof x=="string"||typeof x=="function"||x===r||x===l||x===s||x===i||x===d||x===h||typeof x=="object"&&x!==null&&(x.$$typeof===p||x.$$typeof===f||x.$$typeof===o||x.$$typeof===a||x.$$typeof===u||x.$$typeof===v||x.$$typeof===b||x.$$typeof===_||x.$$typeof===g)},fe.typeOf=$,fe}var pe={},Kl;function Zp(){if(Kl)return pe;Kl=1;var e={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,o=n?Symbol.for("react.profiler"):60114,a=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,u=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,p=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,b=n?Symbol.for("react.fundamental"):60117,_=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function k(L){return typeof L=="string"||typeof L=="function"||L===i||L===u||L===o||L===s||L===h||L===f||typeof L=="object"&&L!==null&&(L.$$typeof===g||L.$$typeof===p||L.$$typeof===a||L.$$typeof===c||L.$$typeof===d||L.$$typeof===b||L.$$typeof===_||L.$$typeof===$||L.$$typeof===v)}function x(L){if(typeof L=="object"&&L!==null){var at=L.$$typeof;switch(at){case t:var ie=L.type;switch(ie){case l:case u:case i:case o:case s:case h:return ie;default:var Fe=ie&&ie.$$typeof;switch(Fe){case c:case d:case g:case p:case a:return Fe;default:return at}}case r:return at}}}var C=l,M=u,O=c,I=a,T=t,N=d,j=i,Z=g,ne=p,ve=r,ke=o,$e=s,ee=h,Q=!1;function qe(L){return Q||(Q=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),E(L)||x(L)===l}function E(L){return x(L)===u}function V(L){return x(L)===c}function B(L){return x(L)===a}function G(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function J(L){return x(L)===d}function X(L){return x(L)===i}function U(L){return x(L)===g}function K(L){return x(L)===p}function q(L){return x(L)===r}function oe(L){return x(L)===o}function re(L){return x(L)===s}function Ue(L){return x(L)===h}pe.AsyncMode=C,pe.ConcurrentMode=M,pe.ContextConsumer=O,pe.ContextProvider=I,pe.Element=T,pe.ForwardRef=N,pe.Fragment=j,pe.Lazy=Z,pe.Memo=ne,pe.Portal=ve,pe.Profiler=ke,pe.StrictMode=$e,pe.Suspense=ee,pe.isAsyncMode=qe,pe.isConcurrentMode=E,pe.isContextConsumer=V,pe.isContextProvider=B,pe.isElement=G,pe.isForwardRef=J,pe.isFragment=X,pe.isLazy=U,pe.isMemo=K,pe.isPortal=q,pe.isProfiler=oe,pe.isStrictMode=re,pe.isSuspense=Ue,pe.isValidElementType=k,pe.typeOf=x}(),pe}var Wl;function js(){if(Wl)return ai.exports;Wl=1;var e={};return e.NODE_ENV==="production"?ai.exports=Yp():ai.exports=Zp(),ai.exports}var qs,Hl;function Xp(){if(Hl)return qs;Hl=1;var e=js(),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[e.ForwardRef]=r,s[e.Memo]=i;function o(p){return e.isMemo(p)?i:s[p.$$typeof]||n}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,h=Object.prototype;function f(p,g,v){if(typeof g!="string"){if(h){var b=d(g);b&&b!==h&&f(p,b,v)}var _=c(g);l&&(_=_.concat(l(g)));for(var $=o(p),k=o(g),x=0;x<_.length;++x){var C=_[x];if(!t[C]&&!(v&&v[C])&&!(k&&k[C])&&!($&&$[C])){var M=u(g,C);try{a(p,C,M)}catch{}}}}return p}return qs=f,qs}Xp();var Qp=!0;function em(e,n,t){var r="";return t.split(" ").forEach(function(i){e[i]!==void 0?n.push(e[i]+";"):i&&(r+=i+" ")}),r}var Gl=function(n,t,r){var i=n.key+"-"+t.name;(r===!1||Qp===!1)&&n.registered[i]===void 0&&(n.registered[i]=t.styles)},tm=function(n,t,r){Gl(n,t,r);var i=n.key+"-"+t.name;if(n.inserted[t.name]===void 0){var s=t;do n.insert(t===s?"."+i:"",s,n.sheet,!0),s=s.next;while(s!==void 0)}};function nm(e){for(var n=0,t,r=0,i=e.length;i>=4;++r,i-=4)t=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,n=(t&65535)*1540483477+((t>>>16)*59797<<16)^(n&65535)*1540483477+((n>>>16)*59797<<16);switch(i){case 3:n^=(e.charCodeAt(r+2)&255)<<16;case 2:n^=(e.charCodeAt(r+1)&255)<<8;case 1:n^=e.charCodeAt(r)&255,n=(n&65535)*1540483477+((n>>>16)*59797<<16)}return n^=n>>>13,n=(n&65535)*1540483477+((n>>>16)*59797<<16),((n^n>>>15)>>>0).toString(36)}var rm={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},im=/[A-Z]|^ms/g,sm=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Jl=function(n){return n.charCodeAt(1)===45},Yl=function(n){return n!=null&&typeof n!="boolean"},Us=zp(function(e){return Jl(e)?e:e.replace(im,"-$&").toLowerCase()}),Zl=function(n,t){switch(n){case"animation":case"animationName":if(typeof t=="string")return t.replace(sm,function(r,i,s){return _t={name:i,styles:s,next:_t},i})}return rm[n]!==1&&!Jl(n)&&typeof t=="number"&&t!==0?t+"px":t};function cr(e,n,t){if(t==null)return"";var r=t;if(r.__emotion_styles!==void 0)return r;switch(typeof t){case"boolean":return"";case"object":{var i=t;if(i.anim===1)return _t={name:i.name,styles:i.styles,next:_t},i.name;var s=t;if(s.styles!==void 0){var o=s.next;if(o!==void 0)for(;o!==void 0;)_t={name:o.name,styles:o.styles,next:_t},o=o.next;var a=s.styles+";";return a}return om(e,n,t)}case"function":{if(e!==void 0){var c=_t,l=t(e);return _t=c,cr(e,n,l)}break}}var u=t;return u}function om(e,n,t){var r="";if(Array.isArray(t))for(var i=0;i<t.length;i++)r+=cr(e,n,t[i])+";";else for(var s in t){var o=t[s];if(typeof o!="object"){var a=o;Yl(a)&&(r+=Us(s)+":"+Zl(s,a)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&n==null)for(var c=0;c<o.length;c++)Yl(o[c])&&(r+=Us(s)+":"+Zl(s,o[c])+";");else{var l=cr(e,n,o);switch(s){case"animation":case"animationName":{r+=Us(s)+":"+l+";";break}default:r+=s+"{"+l+"}"}}}return r}var Xl=/label:\s*([^\s;{]+)\s*(;|$)/g,_t;function Ql(e,n,t){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var r=!0,i="";_t=void 0;var s=e[0];if(s==null||s.raw===void 0)r=!1,i+=cr(t,n,s);else{var o=s;i+=o[0]}for(var a=1;a<e.length;a++)if(i+=cr(t,n,e[a]),r){var c=s;i+=c[a]}Xl.lastIndex=0;for(var l="",u;(u=Xl.exec(i))!==null;)l+="-"+u[1];var d=nm(i)+l;return{name:d,styles:i,next:_t}}var am=function(n){return n()},lm=Xr.useInsertionEffect?Xr.useInsertionEffect:!1,cm=lm||am,ec=it(typeof HTMLElement<"u"?ql({key:"css"}):null),um=ec.Provider,dm=function(n){return Qe(function(t,r){var i=me(ec);return n(t,i,r)})},hm=it({}),ur={}.hasOwnProperty,Ks="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",Ws=function(n,t){var r={};for(var i in t)ur.call(t,i)&&(r[i]=t[i]);return r[Ks]=n,r},fm=function(n){var t=n.cache,r=n.serialized,i=n.isStringTag;return Gl(t,r,i),cm(function(){return tm(t,r,i)}),null},pm=dm(function(e,n,t){var r=e.css;typeof r=="string"&&n.registered[r]!==void 0&&(r=n.registered[r]);var i=e[Ks],s=[r],o="";typeof e.className=="string"?o=em(n.registered,s,e.className):e.className!=null&&(o=e.className+" ");var a=Ql(s,void 0,me(hm));o+=n.key+"-"+a.name;var c={};for(var l in e)ur.call(e,l)&&l!=="css"&&l!==Ks&&(c[l]=e[l]);return c.className=o,t&&(c.ref=t),Le(Oe,null,Le(fm,{cache:n,serialized:a,isStringTag:typeof i=="string"}),Le(i,c))}),Hs=pm,dr=Oe,m=function(n,t,r){return ur.call(t,"css")?Re(Hs,Ws(n,t),r):Re(n,t,r)},A=function(n,t,r){return ur.call(t,"css")?Re(Hs,Ws(n,t),r):Re(n,t,r)};const Me={colors:{dialog:"var(--mmpc-dialog, var(--ha-dialog-surface-background, var(--mdc-theme-surface,#fff)))",onDialog:"var(--mmpc-on-dialog, var(--primary-text-color, #333))",onDialogMuted:"var(--mmpc-on-dialog-muted, var(--secondary-text-color, #888))",card:"var(--mmpc-card, var(--card-background-color))",onCard:"var(--mmpc-on-card, var(--primary-text-color, #333))",onCardMuted:"var(--mmpc-on-card-muted, var(--secondary-text-color, #666))",onCardDivider:"var(--mmpc-on-card-divider, var(--divider-color, rgba(0, 0, 0, 0.12)))"}};var tc=function(n,t){var r=arguments;if(t==null||!ur.call(t,"css"))return Le.apply(void 0,r);var i=r.length,s=new Array(i);s[0]=Hs,s[1]=Ws(n,t);for(var o=2;o<i;o++)s[o]=r[o];return Le.apply(null,s)};(function(e){var n;n||(n=e.JSX||(e.JSX={}))})(tc||(tc={}));function S(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return Ql(n)}function hr(){var e=S.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const mm=({hass:e,action:n,target:t,data:r})=>{const i=n.split(".")[0],s=n.split(".")[1],o={...r,...t};return e.callService(i,s,o)},Gs=async(e,n,t,r)=>{const i=n[t+"_action"];if((i==null?void 0:i.action)==="perform-action")return mm({hass:r,action:i.perform_action,target:i.target,data:i.data});const s=new CustomEvent("hass-action",{bubbles:!0,composed:!0,detail:{config:{...n,entity_id:n==null?void 0:n.entity},action:t}});return e.dispatchEvent(s),Promise.resolve()},Js=({icon:e,deviceClass:n})=>{if(e)return e;switch(n){case"speaker":return"mdi:speaker";case"receiver":return"mdi:audio-video";default:return"mdi:speaker"}},rn=(e,n,t)=>{const r=t?["state","attributes.volume_level","attributes.is_volume_muted","attributes.group_members"]:["state","attributes.media_duration","attributes.media_title","attributes.media_artist","attributes.media_album_name","attributes.icon","attributes.friendly_name","attributes.entity_picture","attributes.volume_level","attributes.is_volume_muted","attributes.source","attributes.shuffle","attributes.repeat","attributes.supported_features","attributes.group_members"],i=(o,a)=>a.split(".").reduce((l,u)=>l&&l[u]!==void 0?l[u]:void 0,o),s=(o,a)=>{if(o.length!==a.length)return!1;for(let c=0;c<o.length;c++)if(o[c]!==a[c])return!1;return!0};for(const o of r){const a=i(e,o),c=i(n,o);if(Array.isArray(a)&&Array.isArray(c)){if(!s(a,c))return!0}else if(a!==c)return!0}return!1};function ge(){return document.querySelector("home-assistant").hass}const fr=(e,n)=>e===0||n?"mdi:volume-off":e<.5?"mdi:volume-medium":"mdi:volume-high",gm=(e,n,t=!1)=>{var s;const r=ge(),i=r.states[e];if(i&&(r.callService("media_player","volume_set",{entity_id:e,volume_level:n}),t&&((s=i.attributes.group_members)==null?void 0:s.length)>0)){const o=i.attributes.volume_level||0,a=o>0?n/o:1;i.attributes.group_members.slice(1).forEach(c=>{const l=r.states[c];if(!l)return;const u=l.attributes.volume_level||0,d=Math.min(Math.max(u*a,0),1);r.callService("media_player","volume_set",{entity_id:c,volume_level:d})})}},li={root:S({background:"none",border:"none",cursor:"pointer",padding:"0px",margin:"0px",position:"relative",overflow:"hidden",width:"var(--mmpc-art-width)",height:"var(--mmpc-art-height)","&::after":{content:'""',display:"block",paddingBottom:"100%"}}),contentContainer:S({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"}),image:S({height:"100%",aspectRatio:"1 / 1",objectFit:"cover",borderRadius:"var(--mmpc-art-border-radius, 4px)"}),iconContainer:S({display:"flex",justifyContent:"center",alignItems:"center","--icon-primary-color":Me.colors.card,backgroundColor:Me.colors.onCard,opacity:.5,borderRadius:"var(--mmpc-art-border-radius, 4px)",height:"100%",aspectRatio:"1 / 1"})},nc=({size:e,borderRadius:n=4,iconSize:t,renderLongPressIndicator:r,...i})=>{const s=He(),{media_title:o,media_artist:a,entity_picture:c,icon:l,device_class:u,source:d}=s.attributes,h=s.state,[f,p]=F(!1);return ce(()=>{p(!1)},[c]),A("button",{css:li.root,style:{"--mmpc-art-border-radius":`${n}px`,"--mmpc-art-width":e?typeof e=="string"?e:`${e}px`:"100%","--mmpc-art-height":e?typeof e=="string"?e:`${e}px`:"unset",...typeof e=="number"?{flexShrink:0}:{}},...i,children:[m("div",{css:li.contentContainer,children:c&&h!=="off"&&!f?m("img",{css:li.image,src:c,alt:o&&a?`${o} by ${a}`:`Source: ${d}`,onError:()=>p(!0)}):m("div",{css:li.iconContainer,children:m(At,{icon:h==="off"||!d?Js({icon:l,deviceClass:u}):ym({source:d}),size:t})})}),r&&r()]})},ym=({source:e})=>{switch(e==null?void 0:e.toLowerCase()){case"spotify":return"mdi:spotify";case"airplay":return"mdi:airplay";case"bluetooth":return"mdi:bluetooth";case"net radio":return"mdi:radio";case"server":return"mdi:server";case"usb":return"mdi:usb";case"aux":return"mdi:audio-input-rca";case"hdmi":return"mdi:hdmi-port";case"tv":return"mdi:television";case"tuner":return"mdi:radio-tower";case"optical":return"mdi:audio-input-stereo-minijack";default:return"mdi:music"}},Be=it(null),rc=({rootElement:e,config:n,children:t})=>{const r=W(()=>({rootElement:e,config:n}),[e,n]);return m(Be.Provider,{value:r,children:t})},ic={root:S({position:"relative",background:"none",border:"none",display:"flex",flex:0,flexDirection:"row",height:"32px",fontSize:"13px",fontWeight:500,lineHeight:"32px",padding:"0 12px",borderRadius:"16px",color:`var(--mmpc-chip-foreground, ${Me.colors.card})`,backgroundColor:`var(--mmpc-chip-background, ${Me.colors.onCard})`,"--icon-primary-color":`var(--mmpc-chip-foreground, ${Me.colors.card})`,marginRight:"5px",alignItems:"center",gap:"4px",textWrap:"nowrap",cursor:"pointer","&:hover":{opacity:.8},opacity:1,"& ha-icon":{pointerEvents:"none"}}),rootLoading:S({opacity:.8})},sn=({loading:e,icon:n,iconPosition:t="left",children:r,...i})=>{const s=()=>{if(e)return m(mr,{size:"x-small"});if(n)return m(At,{size:"x-small",icon:n})};return A("button",{css:[ic.root,e&&ic.rootLoading],...i,children:[t==="left"&&s(),r,t==="right"&&s()]})},sc=({rootElement:e,children:n})=>{const[t]=F(()=>ql({key:"mmpc",container:e,speedy:!1}));return m(um,{value:t,children:n})},vm=()=>[{name:"tap_action",label:"Tap Action",selector:{ui_action:{}}},{name:"hold_action",label:"Hold Action",selector:{ui_action:{}}},{name:"double_tap_action",label:"Double Tap Action",selector:{ui_action:{}}}],bm=({hass:e,value:n,onChange:t,disabled:r=!1})=>{const i=le(null),s=W(()=>n?{...n}:{action:"none"},[n]),o=D(a=>{const l=a.detail.value;t(l)},[t]);return ce(()=>{const a=i.current;return a&&a.addEventListener("value-changed",o),()=>{a&&a.removeEventListener("value-changed",o)}},[i.current,o]),m("ha-form",{ref:i,hass:e,data:s,schema:vm(),computeLabel:a=>a.label||a.name,disabled:r})},dt={formGroup:S({marginBottom:"16px"}),label:S({display:"block",marginBottom:"16px",fontWeight:500}),buttonsContainer:S({display:"flex",flexDirection:"column"}),button:S({padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",backgroundColor:"var(--primary-color, #03a9f4)",color:"white",fontWeight:500,"&:hover":{backgroundColor:"var(--primary-color-dark, #007ac1)"},alignSelf:"flex-start"}),deleteButton:S({backgroundColor:"var(--error-color, #ff5252)","&:hover":{backgroundColor:"var(--error-color-dark, #c50b0b)"}}),inputGroup:S({display:"flex",flexDirection:"column",marginBottom:"16px"}),toggleContainer:S({display:"flex",alignItems:"center",marginBottom:"16px"}),toggleLabel:S({marginLeft:"8px",fontWeight:"normal"}),toggle:S({cursor:"pointer"}),errorMessage:S({color:"var(--error-color, #ff5252)",marginTop:"8px",fontSize:"14px"})},tt=e=>m("div",{css:dt.formGroup,...e}),En=e=>m("label",{css:dt.label,...e}),oc=e=>m("div",{css:dt.buttonsContainer,...e}),pr=e=>m("button",{css:dt.button,...e}),ac=e=>m("button",{css:[dt.button,dt.deleteButton],...e}),ci=e=>m("div",{css:dt.inputGroup,...e}),xt=e=>m("div",{css:dt.toggleContainer,...e}),wt=e=>m("label",{css:dt.toggleLabel,...e}),St=e=>m("input",{type:"checkbox",css:dt.toggle,...e}),Ys=e=>m("div",{css:dt.errorMessage,...e}),$t=e=>{const{hass:n,value:t,onChange:r,label:i,domains:s,required:o=!1,disabled:a=!1,allowCustomEntity:c=!1,error:l}=e,u=le(null),d=D(h=>{const p=h.detail.value;r(p)},[r]);return ce(()=>{const h=u.current;return h&&h.addEventListener("value-changed",d),()=>{h&&h.removeEventListener("value-changed",d)}},[u.current,d]),A("div",{children:[m("ha-entity-picker",{ref:u,hass:n,value:t,label:i,includeDomains:s,disabled:a,required:o,"allow-custom-entity":c}),!!l&&m(Ys,{children:l})]})},_m={root:S({display:"flex",flexDirection:"column",gap:"8px"})},lc=({hass:e,value:n,onChange:t,label:r,domains:i,disabled:s=!1,allowCustomEntity:o=!1})=>{const a=(n==null?void 0:n.filter(Boolean))||[],c=D((l,u)=>{const d=[...a];!l&&u<a.length?d.splice(u,1):u<a.length?d[u]=l||"":l&&d.push(l),t(d.filter(Boolean))},[a,t]);return A("div",{css:_m.root,className:"entities-picker",children:[r&&m("label",{children:r}),a.map((l,u)=>m($t,{hass:e,value:l,onChange:d=>c(d,u),domains:i,disabled:s,required:!1,allowCustomEntity:o},`entity-${u}`)),m($t,{hass:e,value:"",onChange:l=>c(l,a.length),domains:i,disabled:s,required:!1,allowCustomEntity:o},"entity-new")]})},xm=({options:e,onSelected:n,selected:t})=>m("select",{value:t,onChange:r=>n(r.target.value),children:e.map(r=>m("option",{value:r.value,children:r.name},r.value))}),ui=({hass:e,value:n={},onChange:t})=>m(bm,{hass:e,value:n,onChange:t}),wm={root:S({display:"flex",flexDirection:"column"})},on=({hass:e,value:n,onChange:t,label:r,error:i,required:s=!1,disabled:o=!1,isIconInput:a=!1})=>{const c=D(u=>{t(u.detail.value)},[t]),l=()=>a?m("ha-icon-picker",{label:r||"Icon",hass:e,value:n,disabled:o,required:s,"onvalue-changed":c}):m("ha-textfield",{label:r||"Text",value:n,disabled:o,required:s,onchange:u=>t(u.target.value)});return A("div",{css:wm.root,children:[l(),!!i&&m(Ys,{children:i})]})},Sm=({children:e})=>{const[n,t]=F(!1);return ce(()=>{customElements.get("hui-glance-card").getConfigElement().then(()=>{t(!0)})},[]),n?e:null},cc={root:S({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),speakerChip:S({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}})},Zs=({config:e,showGrouped:n,layout:t})=>{const r=An(),{entity_id:i,speaker_group:s}=e,[o,a]=F([]),c=(s==null?void 0:s.entity_id)||i,l=r.states[c],u=W(()=>{var h;return(h=s==null?void 0:s.entities)!=null&&h.length?s.entities.filter(f=>f!==c).filter(f=>r.states[f]).map(f=>{var p,g;return{entity_id:f,name:r.states[f].attributes.friendly_name??f,volume:r.states[f].attributes.volume_level||0,muted:r.states[f].attributes.is_volume_muted||!1,isGrouped:((g=(p=l==null?void 0:l.attributes)==null?void 0:p.group_members)==null?void 0:g.includes(f))||!1}}).filter(f=>n?!0:!f.isGrouped).sort((f,p)=>f.entity_id===c?-1:p.entity_id===c?1:f.name.localeCompare(p.name)).sort((f,p)=>f.isGrouped&&!p.isGrouped?-1:!f.isGrouped&&p.isGrouped?1:0):[]},[r.states,s,n]),d=D(async(h,f)=>{if(!o.includes(h)){a(p=>[...p,h]);try{const p=r.states[h];f?await r.callService("media_player","unjoin",{entity_id:h}):(p.state==="off"&&await r.callService("media_player","turn_on",{entity_id:h}),await r.callService("media_player","join",{entity_id:c,group_members:[h]}))}catch(p){console.error(p)}a(p=>p.filter(g=>g!==h))}},[c,o]);return m("div",{css:cc.root,children:u.map(h=>m(sn,{css:cc.speakerChip,loading:o.includes(h.entity_id),onClick:()=>d(h.entity_id,h.isGrouped),icon:h.isGrouped?"mdi:close":"mdi:plus",iconPosition:"right",style:{"--mmpc-chip-horizontal-margin":`${(t==null?void 0:t.horizontalMargin)??0}px`},children:h.name},h.entity_id))})},Ut={speakersTable:S({width:"100%",borderCollapse:"collapse",tableLayout:"fixed"}),speakerRow:S({width:"100%",height:"32px"}),nameCell:S({paddingRight:"8px",fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),nameCellMainSpeaker:S({fontWeight:500}),controlsCell:S({padding:"0px 4px"}),buttonCell:S({width:"28px",whiteSpace:"nowrap"}),controlsContainer:S({display:"flex",alignItems:"center",width:"100%"})},uc=({config:{speaker_group:e,entity_id:n},syncMainSpeaker:t})=>{const r=An(),[i,s]=F([]),o=(e==null?void 0:e.entity_id)||n,a=r.states[o],c=W(()=>{var p;if(!((p=e==null?void 0:e.entities)!=null&&p.length)&&!a)return[];const f=[...(e==null?void 0:e.entities)||[]];return a&&!f.includes(o)&&f.push(o),f.filter(g=>r.states[g]).map(g=>{var v,b,_,$;return{entity_id:g,name:r.states[g].attributes.friendly_name??g,volume:r.states[g].attributes.volume_level||0,muted:r.states[g].attributes.is_volume_muted||!1,isGrouped:((b=(v=a==null?void 0:a.attributes)==null?void 0:v.group_members)==null?void 0:b.includes(g))||!1,isMainSpeaker:(($=(_=a==null?void 0:a.attributes)==null?void 0:_.group_members)==null?void 0:$[0])===g||!1}}).sort((g,v)=>g.entity_id===o?-1:v.entity_id===o?1:g.name.localeCompare(v.name))},[r.states,e,o,a]),l=D(async(f,p)=>{if(!i.includes(f)){s(g=>[...g,f]);try{const g=r.states[f];p?await r.callService("media_player","unjoin",{entity_id:f}):(g.state==="off"&&await r.callService("media_player","turn_on",{entity_id:f}),await r.callService("media_player","join",{entity_id:o,group_members:[f]}))}catch(g){console.error(g)}s(g=>g.filter(v=>v!==f))}},[o,i]),u=D((f,p)=>{ge().callService("media_player","volume_mute",{entity_id:f,is_volume_muted:!p})},[]),d=D((f,p,g)=>{gm(f,p,g&&t)},[t]),h=(f,p,g)=>{const{entity_id:v,name:b,volume:_,muted:$,isGrouped:k,isMainSpeaker:x}=f,M=i.includes(v)||x&&!k;return A("tr",{css:Ut.speakerRow,children:[m("td",{css:[Ut.nameCell,x&&Ut.nameCellMainSpeaker],children:b}),m("td",{css:Ut.buttonCell,children:m(ae,{size:"x-small",onClick:()=>u(v,$),icon:fr(_,$)})}),m("td",{css:Ut.controlsCell,children:m("div",{css:Ut.controlsContainer,children:m(Ea,{min:0,max:1,step:.01,value:_,sliderSize:"small",onChange:O=>d(v,O,x)})})}),m("td",{css:Ut.buttonCell,children:m(ae,{size:"x-small",onClick:()=>l(v,k),icon:k?"mdi:close":"mdi:plus",disabled:M})})]},v)};return m("div",{children:m("table",{css:Ut.speakersTable,children:m("tbody",{children:c.filter(f=>f.isGrouped).map((f,p,g)=>h(f))})})})};function dc(e,n){const[t,r]=F(e);return ce(()=>{const i=setTimeout(()=>{r(e)},n);return()=>{clearTimeout(i)}},[e,n]),t}function $m(){const[e,n]=F({width:null,height:null}),t=le(null);return[D(i=>{if(t.current&&(t.current.disconnect(),t.current=null),(i==null?void 0:i.nodeType)===Node.ELEMENT_NODE){const s=new ResizeObserver(([o])=>{if(o&&o.borderBoxSize){const{inlineSize:a,blockSize:c}=o.borderBoxSize[0];n({width:a,height:c})}});s.observe(i),t.current=s}},[]),e]}const km={root:S({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gridGap:"8px",padding:"0px var(--mmpc-search-padding, 0px)"})},di=({numberOfColumns:e=3,children:n})=>m("div",{css:km.root,style:{gridTemplateColumns:`repeat(${e}, minmax(0, 1fr))`},children:n}),Cm={root:S({background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"var(--mmpc-icon-size)",aspectRatio:"1","& > ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-size)",width:"var(--mmpc-icon-size)",height:"var(--mmpc-icon-size)",display:"flex"}})},At=({icon:e,size:n="medium",className:t})=>m("div",{css:Cm.root,style:{"--mmpc-icon-size":`${Xs(n)}px`},className:t,children:m("ha-icon",{icon:e})}),Xs=e=>{switch(e){case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}},Mm=hr`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Em={spinner:S({animation:`${Mm} 1s linear infinite`,"--mdc-icon-size":"var(--mmpc-spinner-size)",width:"var(--mmpc-spinner-size)",display:"flex",pointerEvents:"none"})},mr=e=>m(At,{icon:"mdi:loading",css:Em.spinner,...e}),Om=hr({"0%":{opacity:1,transform:"translateY(0px)"},"85%":{opacity:1,transform:"translateY(0px)"},"100%":{opacity:0,transform:"translateY(-20px)"}}),gr={root:S({width:"100%","&::before":{content:'""',display:"block",paddingTop:"100%"},borderRadius:"4px","--icon-primary-color":"var(--card-background-color)",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),image:S({position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}),icon:S({position:"absolute","--icon-primary-color":"var(--primary-text-color, #333)",backgroundColor:"var(--card-background-color)",borderRadius:"50%",padding:"2px",width:Xs("x-small")+4,height:Xs("x-small")+4}),done:S({animation:`${Om} 3s forwards`})},hc=({imageUrl:e,loading:n,done:t,className:r})=>A("div",{css:gr.root,className:r,children:[e&&m("img",{src:e,css:gr.image,alt:""}),!e&&m(At,{icon:"mdi:image-broken-variant",size:"small"}),n&&m(mr,{css:gr.icon,size:"x-small"}),!n&&t&&m(At,{icon:"mdi:check",size:"x-small",css:[gr.icon,gr.done]})]}),hi={root:S({display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",transition:"transform 0.2s",borderRadius:"8px",padding:"8px",background:"rgba(255, 255, 255, 0.05)","@media (prefers-color-scheme: light)":{background:"rgba(0, 0, 0, 0.05)"},"&:hover":{transform:"translateY(-4px)"}}),name:S({fontSize:"14px",fontWeight:500,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%",color:"var(--primary-text-color)"}),artist:S({fontSize:"12px",color:"var(--secondary-text-color)",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",width:"100%"}),mediaImage:S({marginBottom:8})},fi=({imageUrl:e,name:n,artist:t,onClick:r})=>{const[i,s]=F(!1),[o,a]=F(!1),c=D(async()=>{a(!1),s(!0);try{await r(),a(!0)}catch(l){console.error("Error in MediaItem onClick:",l)}s(!1)},[r]);return A("div",{css:hi.root,onClick:c,children:[m(hc,{css:hi.mediaImage,imageUrl:e,loading:i,done:o}),m("div",{css:hi.name,children:n}),m("div",{css:hi.artist,children:t})]})},fc={root:S({display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",margin:"0 4px",padding:"4px var(--mmpc-search-padding, 0px)"}),title:S({fontSize:"16px",fontWeight:500,color:"var(--primary-text-color)",margin:0})},pc=({children:e,onClick:n})=>A("div",{css:fc.root,onClick:n,children:[m("h3",{css:fc.title,children:e}),!!n&&m(At,{icon:"mdi:chevron-right",size:"small"})]}),yr={root:S({display:"grid",gridTemplateColumns:"50px 1fr auto",alignItems:"center",gap:"12px",padding:"8px 12px",borderRadius:"8px",gridColumn:"1/-1",background:"rgba(255, 255, 255, 0.05)",cursor:"pointer","&:hover":{background:"rgba(255, 255, 255, 0.1)"},"@media (prefers-color-scheme: light)":{background:"rgba(0, 0, 0, 0.05)","&:hover":{background:"rgba(0, 0, 0, 0.01)"}}}),trackInfo:S({display:"flex",flexDirection:"column",overflow:"hidden"}),trackName:S({fontSize:"14px",fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--primary-text-color)"}),trackArtist:S({fontSize:"12px",color:"var(--secondary-text-color)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),mediaImage:S({width:50,height:50})},pi=({imageUrl:e,title:n,artist:t,onClick:r})=>{const[i,s]=F(!1),[o,a]=F(!1),c=D(async()=>{a(!1),s(!0);try{await r(),a(!0)}catch(l){console.error("Error in MediaItem onClick:",l)}s(!1)},[r]);return A("div",{css:yr.root,onClick:c,children:[m(hc,{css:yr.mediaImage,imageUrl:e,loading:i,done:o}),A("div",{css:yr.trackInfo,children:[m("div",{css:yr.trackName,children:n}),!!t&&m("div",{css:yr.trackArtist,children:t})]})]})},Pe={root:S({display:"flex",flexDirection:"column",gap:"12px",overflow:"hidden"}),rootSearchBarBottom:S({overflow:"hidden"}),searchBarContainer:S({display:"flex",flexDirection:"column",gap:12,marginBottom:12}),searchInput:S({padding:"1px var(--mmpc-search-padding, 0px)"}),filterContainer:S({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:S({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}}),verticalChipSeperator:S({height:"28px",alignSelf:"center",borderRight:"1px solid var(--divider-color)",marginRight:"6px"}),mediaEmptyText:S({padding:"0px var(--mmpc-search-padding, 0px)"}),resultsContainerSearchBarBottom:S({overflowY:"auto"})},Im=(e,n,t)=>{const[r,i]=F(null),[s,o]=F(!1),[a,c]=F(null);ce(()=>{if(e==="")return;const u={type:"call_service",domain:"media_player",service:"search_media",service_data:{search_query:e,entity_id:t,media_content_type:n==="all"?void 0:n},return_response:!0},d=ge();o(!0),d.connection.sendMessagePromise(u).then(h=>{const f=h;f.response[t]&&(o(!1),i(f.response[t]),c(null))}).catch(h=>{console.error("Error fetching search results:",h),o(!1),c("Error fetching search results: "+h.message),i(null)})},[e,t,n]);const l=D(async(u,d,h)=>ge().callService("media_player","play_media",{entity_id:d,media_content_type:u.media_content_type,media_content_id:u.media_content_id,enqueue:h}),[]);return W(()=>({results:(r==null?void 0:r.result)??[],loading:s,playItem:l,error:a}),[r,s,a])},Am=(e,n="favorites",t=!1)=>{const[r,i]=F([]),[s,o]=F(!1);return ce(()=>{if(!t){i([]);return}const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:e,media_content_type:n},return_response:!0},c=ge();o(!0),c.connection.sendMessagePromise(a).then(l=>{const u=l;u.response[e]&&(o(!1),i(u.response[e].children.filter(d=>d.can_play)))}).catch(l=>{console.error("Error fetching search results:",l),o(!1),i([])})},[e,t,n]),W(()=>({mediaBrowserItems:r,isFetching:s}),[r,s])};function On(e,n,t){let r=t.initialDeps??[],i;function s(){var o,a,c,l;let u;t.key&&((o=t.debug)!=null&&o.call(t))&&(u=Date.now());const d=e();if(!(d.length!==r.length||d.some((p,g)=>r[g]!==p)))return i;r=d;let f;if(t.key&&((a=t.debug)!=null&&a.call(t))&&(f=Date.now()),i=n(...d),t.key&&((c=t.debug)!=null&&c.call(t))){const p=Math.round((Date.now()-u)*100)/100,g=Math.round((Date.now()-f)*100)/100,v=g/16,b=(_,$)=>{for(_=String(_);_.length<$;)_=" "+_;return _};console.info(`%c⏱ ${b(g,5)} /${b(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*v,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(l=t==null?void 0:t.onChange)==null||l.call(t,i),i}return s.updateDeps=o=>{r=o},s}function mc(e,n){if(e===void 0)throw new Error("Unexpected undefined");return e}const Tm=(e,n)=>Math.abs(e-n)<=1,Rm=(e,n,t)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>n.apply(this,i),t)}};var In={};const gc=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Nm=e=>e,Pm=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let i=n;i<=t;i++)r.push(i);return r},Dm=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;const i=o=>{const{width:a,height:c}=o;n({width:Math.round(a),height:Math.round(c)})};if(i(gc(t)),!r.ResizeObserver)return()=>{};const s=new r.ResizeObserver(o=>{const a=()=>{const c=o[0];if(c!=null&&c.borderBoxSize){const l=c.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(gc(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return s.observe(t,{box:"border-box"}),()=>{s.unobserve(t)}},yc={passive:!0},vc=typeof window>"u"?!0:"onscrollend"in window,Vm=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;let i=0;const s=e.options.useScrollendEvent&&vc?()=>{}:Rm(r,()=>{n(i,!1)},e.options.isScrollingResetDelay),o=u=>()=>{const{horizontal:d,isRtl:h}=e.options;i=d?t.scrollLeft*(h&&-1||1):t.scrollTop,s(),n(i,u)},a=o(!0),c=o(!1);c(),t.addEventListener("scroll",a,yc);const l=e.options.useScrollendEvent&&vc;return l&&t.addEventListener("scrollend",c,yc),()=>{t.removeEventListener("scroll",a),l&&t.removeEventListener("scrollend",c)}},Fm=(e,n,t)=>{if(n!=null&&n.borderBoxSize){const r=n.borderBoxSize[0];if(r)return Math.round(r[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},Lm=(e,{adjustments:n=0,behavior:t},r)=>{var i,s;const o=e+n;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:t})};class zm{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const r=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(i=>{i.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var i;(i=r())==null||i.disconnect(),t=null},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([r,i])=>{typeof i>"u"&&delete t[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Nm,rangeExtractor:Pm,onChange:()=>{},measureElement:Fm,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,t)},this.maybeNotify=On(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:In.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const a=t[o];if(i.has(a.lane))continue;const c=s.get(a.lane);if(c==null||a.end>c.end?s.set(a.lane,a):a.end<c.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurementOptions=On(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,r,i,s,o)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o}),{key:!1}),this.getMeasurements=On(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o},a)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const c=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,c);for(let u=c;u<t;u++){const d=s(u),h=this.options.lanes===1?l[u-1]:this.getFurthestMeasurement(l,u),f=h?h.end+this.options.gap:r+i,p=a.get(d),g=typeof p=="number"?p:this.options.estimateSize(u),v=f+g,b=h?h.lane:u%this.options.lanes;l[u]={index:u,start:f,size:g,end:v,key:d,lane:b}}return this.measurementsCache=l,l},{key:In.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=On(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,r,i,s)=>this.range=t.length>0&&r>0?Bm({measurements:t,outerSize:r,scrollOffset:i,lanes:s}):null,{key:In.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getVirtualIndexes=On(()=>{let t=null,r=null;const i=this.calculateRange();return i&&(t=i.startIndex,r=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,r]},(t,r,i,s,o)=>s===null||o===null?[]:t({startIndex:s,endIndex:o,overscan:r,count:i}),{key:In.NODE_ENV!=="production"&&"getVirtualIndexes",debug:()=>this.options.debug}),this.indexFromElement=t=>{const r=this.options.indexAttribute,i=t.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(t,r)=>{const i=this.indexFromElement(t),s=this.measurementsCache[i];if(!s)return;const o=s.key,a=this.elementsCache.get(o);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(o,t)),t.isConnected&&this.resizeItem(i,this.options.measureElement(t,r,this))},this.resizeItem=(t,r)=>{const i=this.measurementsCache[t];if(!i)return;const s=this.itemSizeCache.get(i.key)??i.size,o=r-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,o,this):this.scrollDirection==="backward"&&i.start<this.getScrollOffset()+this.scrollAdjustments)&&(In.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",o),this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,r)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((r,i)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(i))});return}this._measureElement(t,void 0)},this.getVirtualItems=On(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,r)=>{const i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],c=r[a];i.push(c)}return i},{key:In.NODE_ENV!=="production"&&"getVirtualItems",debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const r=this.getMeasurements();if(r.length!==0)return mc(r[bc(0,r.length-1,i=>mc(r[i]).start,t)])},this.getOffsetForAlignment=(t,r,i=0)=>{const s=this.getSize(),o=this.getScrollOffset();r==="auto"&&(r=t>=o+s?"end":"start"),r==="center"?t+=(i-s)/2:r==="end"&&(t-=s);const a=this.getTotalSize()-s;return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,r="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const i=this.measurementsCache[t];if(!i)return;const s=this.getSize(),o=this.getScrollOffset();if(r==="auto")if(i.end>=o+s-this.options.scrollPaddingEnd)r="end";else if(i.start<=o+this.options.scrollPaddingStart)r="start";else return[o,r];const a=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,r,i.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(t,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(t,{align:r="auto",behavior:i}={})=>{t=Math.max(0,Math.min(t,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const s=this.getOffsetForIndex(t,r);if(!s)return;const[o,a]=s;this._scrollToOffset(o,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(t))){const l=this.getOffsetForIndex(t,a);if(!l)return;const[u]=l,d=this.getScrollOffset();Tm(u,d)||this.scrollToIndex(t,{align:a,behavior:i})}else this.scrollToIndex(t,{align:a,behavior:i})}))},this.scrollBy=(t,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var t;const r=this.getMeasurements();let i;if(r.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((t=r[r.length-1])==null?void 0:t.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=r.length-1;for(;o>=0&&s.some(a=>a===null);){const a=r[o];s[a.lane]===null&&(s[a.lane]=a.end),o--}i=Math.max(...s.filter(a=>a!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:r,behavior:i})=>{this.options.scrollToFn(t,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(n)}}const bc=(e,n,t,r)=>{for(;e<=n;){const i=(e+n)/2|0,s=t(i);if(s<r)e=i+1;else if(s>r)n=i-1;else return i}return e>0?e-1:0};function Bm({measurements:e,outerSize:n,scrollOffset:t,lanes:r}){const i=e.length-1,s=c=>e[c].start;if(e.length<=r)return{startIndex:0,endIndex:i};let o=bc(0,i,s,t),a=o;if(r===1)for(;a<i&&e[a].end<t+n;)a++;else if(r>1){const c=Array(r).fill(0);for(;a<i&&c.some(u=>u<t+n);){const u=e[a];c[u.lane]=u.end,a++}const l=Array(r).fill(t+n);for(;o>=0&&l.some(u=>u>=t);){const u=e[o];l[u.lane]=u.start,o--}o=Math.max(0,o-o%r),a=Math.min(i,a+(r-1-a%r))}return{startIndex:o,endIndex:a}}const _c=typeof document<"u"?It:ce;function jm(e){const n=nr(()=>({}),{})[1],t={...e,onChange:(i,s)=>{var o;s?Zr(n):n(),(o=e.onChange)==null||o.call(e,i,s)}},[r]=F(()=>new zm(t));return r.setOptions(t),_c(()=>r._didMount(),[]),_c(()=>r._willUpdate()),r}function qm(e){return jm({observeElementRect:Dm,observeElementOffset:Vm,scrollToFn:Lm,...e})}const xc={container:S({height:"100%",overflow:"auto"}),item:S({padding:"4px 0"})},wc=({onLayout:e,data:n,renderItem:t,renderHeader:r,renderEmpty:i,estimateSize:s=80,maxHeight:o=300,overscan:a=5,className:c,style:l={}})=>{const u=le(null),[d,{width:h}]=$m();ce(()=>{e&&h!==null&&e({width:h??0})},[e,h]);const f=W(()=>(n==null?void 0:n.length)===0?["empty"]:n,[n]),p=qm({count:f.length,getScrollElement:()=>u.current,estimateSize:()=>s,overscan:a});return m("div",{ref:u,style:{...l,maxHeight:o},css:xc.container,className:c,children:m("div",{ref:d,style:{height:`${p.getTotalSize()}px`,width:"100%",position:"relative"},children:p.getVirtualItems().map(g=>A("div",{"data-index":g.index,css:xc.item,ref:p.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${g.start}px)`},children:[g.index===0&&r&&r(),f[g.index]==="empty"&&i&&i(),f[g.index]!=="empty"&&t(n[g.index],g.index)]},g.key))})})},Um=({data:e,onItemClick:n,onHeaderClick:t,filterConfig:r,loading:i=!1,hideEmpty:s=!1,error:o=null,...a})=>{const[c,l]=F(4),u=W(()=>{const h=[],f={};return e.forEach(p=>{const g=p.media_content_type;f[g]||(f[g]=[]),f[g].push(p)}),Object.entries(f).forEach(([p,g])=>{var v,b;if(Object.keys(f).length>1&&h.push({type:"header",mediaType:p}),((v=g[0])==null?void 0:v.media_class)==="track"&&((b=g[0])==null?void 0:b.media_content_type)!=="favorite")g.forEach(_=>{h.push({type:"item",item:_})});else for(let _=0;_<g.length;_+=c){const $=g.slice(_,_+c);h.push({type:"itemsRow",items:$})}}),h},[e,c]),d=h=>{switch(h.type){case"header":{const f=r.find(p=>p.media_type===h.mediaType||p.media_type.slice(0,-1)===h.mediaType);return m(pc,{onClick:f?()=>t==null?void 0:t(f.media_type):void 0,children:(f==null?void 0:f.name)??h.mediaType})}case"item":{const{item:f}=h,p=async()=>{await n(f)};return m(di,{numberOfColumns:c,children:f.media_class==="track"&&f.media_content_type!=="favorite"?m(pi,{imageUrl:f.thumbnail,title:f.title,onClick:p},f.media_content_id):m(fi,{imageUrl:f.thumbnail,name:f.title,onClick:p},f.media_content_id)})}case"itemsRow":return m(di,{numberOfColumns:c,children:h.items.map(f=>{const p=async()=>{await n(f)};return f.media_class==="track"&&f.media_content_type!=="favorite"?m(pi,{imageUrl:f.thumbnail,title:f.title,onClick:p},f.media_content_id):m(fi,{imageUrl:f.thumbnail,name:f.title,onClick:p},f.media_content_id)})});default:return null}};return i?m(mr,{}):m(wc,{onLayout:({width:h})=>{h<390?l(3):l(4)},data:u,renderItem:d,renderEmpty:()=>m(Oe,{children:o?m("p",{css:Pe.mediaEmptyText,children:o}):s?null:m("p",{css:Pe.mediaEmptyText,children:"No items found."})}),...a})},Km=[{media_type:"artists",name:"Artists",icon:"mdi:account-music"},{media_type:"albums",name:"Albums",icon:"mdi:album"},{media_type:"tracks",name:"Tracks",icon:"mdi:music-note"},{media_type:"playlists",name:"Playlists",icon:"mdi:playlist-music"}],Sc=({entityId:e,showFavorites:n,horizontalPadding:t,searchBarPosition:r="top",maxHeight:i=300,filterConfig:s=Km})=>{const[o,a]=F(""),[c,l]=F("replace"),u=dc(o,600),[d,h]=F("all"),f=D(()=>{const x=["play","replace","next","add"],M=(x.indexOf(c)+1)%x.length;l(x[M])},[c]),{results:p,loading:g,error:v,playItem:b}=Im(u,d,e),{mediaBrowserItems:_}=Am(e,d==="all"?"favorites":d,(d==="all"&&n||d!=="all")&&o===""),$=()=>A("div",{css:Pe.searchBarContainer,children:[m(Jc,{placeholder:"Search..",onChange:a,value:o,loading:g,css:Pe.searchInput}),A("div",{css:Pe.filterContainer,children:[m(sn,{css:Pe.chip,style:{"--mmpc-chip-horizontal-margin":`${t}px`},icon:Wm(c),onClick:f,children:Hm(c)}),m("div",{css:Pe.verticalChipSeperator}),k()]})]}),k=()=>[{media_type:"all",name:"All",icon:"mdi:all-inclusive"},...s].map(x=>m(sn,{css:Pe.chip,style:{"--mmpc-chip-horizontal-margin":`${t}px`,opacity:d===x.media_type?1:.6,fontWeight:d===x.media_type?"bold":"normal"},onClick:()=>h(x.media_type),icon:x.icon,children:x.name},x.media_type));return A("div",{css:Pe.root,style:{"--mmpc-search-padding":`${t}px`},children:[m(Um,{renderHeader:r==="top"?$:void 0,data:o===""&&_.length>0?_:p,error:v,hideEmpty:o===""&&d==="all"&&!n,onItemClick:x=>b(x,e,c),style:{"--mmpc-search-padding":`${t}px`},maxHeight:i,filterConfig:s,onHeaderClick:h}),r==="bottom"&&$()]})},Wm=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},Hm=e=>{switch(e){case"play":return"Play now";case"replace":return"Replace queue";case"next":return"Add next";case"add":return"Add to queue";default:return"Play"}},$c=it({}),Gm=({hass:e,children:n})=>m($c.Provider,{value:{hass:e},children:n}),An=()=>me($c).hass,Qs={root:S({position:"relative",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"background-color 0.2s",padding:4,minWidth:"var(--mmpc-icon-button-size)",aspectRatio:"1",color:Me.colors.onCard,touchAction:"manipulation","-webkit-tap-highlight-color":"transparent","&:hover":{backgroundColor:"var(--secondary-background-color, rgba(0, 0, 0, 0.05))"},"&:active":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))"},"@media (hover: none)":{"&:hover":{backgroundColor:"transparent"},"&:active":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))"}},"> ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-button-size)",width:"var(--mmpc-icon-button-size)",display:"flex",pointerEvents:"none"}}),rootDisabled:S({color:"var(--disabled-text-color, #999)"}),rootXxsmall:S({padding:0})},ae=({icon:e,size:n="medium",disabled:t=!1,loading:r=!1,className:i,renderLongPressIndicator:s,...o})=>A("button",{disabled:t,css:[Qs.root,t&&Qs.rootDisabled,n==="xx-small"&&Qs.rootXxsmall],style:{"--mmpc-icon-button-size":`${Jm(n)}px`},className:i,...o,children:[r?m(mr,{size:n}):m("ha-icon",{icon:e}),s&&s()]}),Jm=e=>{switch(e){case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}};var mi={exports:{}};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var eo,kc;function Ym(){if(kc)return eo;kc=1;var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function i(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(u){return o[u]});if(c.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(u){l[u]=u}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return eo=i()?Object.assign:function(s,o){for(var a,c=r(s),l,u=1;u<arguments.length;u++){a=Object(arguments[u]);for(var d in a)n.call(a,d)&&(c[d]=a[d]);if(e){l=e(a);for(var h=0;h<l.length;h++)t.call(a,l[h])&&(c[l[h]]=a[l[h]])}}return c},eo}var to,Cc;function no(){if(Cc)return to;Cc=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return to=e,to}var ro,Mc;function Ec(){return Mc||(Mc=1,ro=Function.call.bind(Object.prototype.hasOwnProperty)),ro}var io,Oc;function Zm(){if(Oc)return io;Oc=1;var e={},n=function(){};if(e.NODE_ENV!=="production"){var t=no(),r={},i=Ec();n=function(o){var a="Warning: "+o;typeof console<"u"&&console.error(a);try{throw new Error(a)}catch{}}}function s(o,a,c,l,u){if(e.NODE_ENV!=="production"){for(var d in o)if(i(o,d)){var h;try{if(typeof o[d]!="function"){var f=Error((l||"React class")+": "+c+" type `"+d+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[d]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw f.name="Invariant Violation",f}h=o[d](a,d,l,c,null,t)}catch(g){h=g}if(h&&!(h instanceof Error)&&n((l||"React class")+": type specification of "+c+" `"+d+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof h+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),h instanceof Error&&!(h.message in r)){r[h.message]=!0;var p=u?u():"";n("Failed "+c+" type: "+h.message+(p??""))}}}}return s.resetWarningCache=function(){e.NODE_ENV!=="production"&&(r={})},io=s,io}var so,Ic;function Xm(){if(Ic)return so;Ic=1;var e={},n=js(),t=Ym(),r=no(),i=Ec(),s=Zm(),o=function(){};e.NODE_ENV!=="production"&&(o=function(c){var l="Warning: "+c;typeof console<"u"&&console.error(l);try{throw new Error(l)}catch{}});function a(){return null}return so=function(c,l){var u=typeof Symbol=="function"&&Symbol.iterator,d="@@iterator";function h(E){var V=E&&(u&&E[u]||E[d]);if(typeof V=="function")return V}var f="<<anonymous>>",p={array:_("array"),bigint:_("bigint"),bool:_("boolean"),func:_("function"),number:_("number"),object:_("object"),string:_("string"),symbol:_("symbol"),any:$(),arrayOf:k,element:x(),elementType:C(),instanceOf:M,node:N(),objectOf:I,oneOf:O,oneOfType:T,shape:Z,exact:ne};function g(E,V){return E===V?E!==0||1/E===1/V:E!==E&&V!==V}function v(E,V){this.message=E,this.data=V&&typeof V=="object"?V:{},this.stack=""}v.prototype=Error.prototype;function b(E){if(e.NODE_ENV!=="production")var V={},B=0;function G(X,U,K,q,oe,re,Ue){if(q=q||f,re=re||K,Ue!==r){if(l){var L=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw L.name="Invariant Violation",L}else if(e.NODE_ENV!=="production"&&typeof console<"u"){var at=q+":"+K;!V[at]&&B<3&&(o("You are manually calling a React.PropTypes validation function for the `"+re+"` prop on `"+q+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),V[at]=!0,B++)}}return U[K]==null?X?U[K]===null?new v("The "+oe+" `"+re+"` is marked as required "+("in `"+q+"`, but its value is `null`.")):new v("The "+oe+" `"+re+"` is marked as required in "+("`"+q+"`, but its value is `undefined`.")):null:E(U,K,q,oe,re)}var J=G.bind(null,!1);return J.isRequired=G.bind(null,!0),J}function _(E){function V(B,G,J,X,U,K){var q=B[G],oe=$e(q);if(oe!==E){var re=ee(q);return new v("Invalid "+X+" `"+U+"` of type "+("`"+re+"` supplied to `"+J+"`, expected ")+("`"+E+"`."),{expectedType:E})}return null}return b(V)}function $(){return b(a)}function k(E){function V(B,G,J,X,U){if(typeof E!="function")return new v("Property `"+U+"` of component `"+J+"` has invalid PropType notation inside arrayOf.");var K=B[G];if(!Array.isArray(K)){var q=$e(K);return new v("Invalid "+X+" `"+U+"` of type "+("`"+q+"` supplied to `"+J+"`, expected an array."))}for(var oe=0;oe<K.length;oe++){var re=E(K,oe,J,X,U+"["+oe+"]",r);if(re instanceof Error)return re}return null}return b(V)}function x(){function E(V,B,G,J,X){var U=V[B];if(!c(U)){var K=$e(U);return new v("Invalid "+J+" `"+X+"` of type "+("`"+K+"` supplied to `"+G+"`, expected a single ReactElement."))}return null}return b(E)}function C(){function E(V,B,G,J,X){var U=V[B];if(!n.isValidElementType(U)){var K=$e(U);return new v("Invalid "+J+" `"+X+"` of type "+("`"+K+"` supplied to `"+G+"`, expected a single ReactElement type."))}return null}return b(E)}function M(E){function V(B,G,J,X,U){if(!(B[G]instanceof E)){var K=E.name||f,q=qe(B[G]);return new v("Invalid "+X+" `"+U+"` of type "+("`"+q+"` supplied to `"+J+"`, expected ")+("instance of `"+K+"`."))}return null}return b(V)}function O(E){if(!Array.isArray(E))return e.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),a;function V(B,G,J,X,U){for(var K=B[G],q=0;q<E.length;q++)if(g(K,E[q]))return null;var oe=JSON.stringify(E,function(Ue,L){var at=ee(L);return at==="symbol"?String(L):L});return new v("Invalid "+X+" `"+U+"` of value `"+String(K)+"` "+("supplied to `"+J+"`, expected one of "+oe+"."))}return b(V)}function I(E){function V(B,G,J,X,U){if(typeof E!="function")return new v("Property `"+U+"` of component `"+J+"` has invalid PropType notation inside objectOf.");var K=B[G],q=$e(K);if(q!=="object")return new v("Invalid "+X+" `"+U+"` of type "+("`"+q+"` supplied to `"+J+"`, expected an object."));for(var oe in K)if(i(K,oe)){var re=E(K,oe,J,X,U+"."+oe,r);if(re instanceof Error)return re}return null}return b(V)}function T(E){if(!Array.isArray(E))return e.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),a;for(var V=0;V<E.length;V++){var B=E[V];if(typeof B!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+Q(B)+" at index "+V+"."),a}function G(J,X,U,K,q){for(var oe=[],re=0;re<E.length;re++){var Ue=E[re],L=Ue(J,X,U,K,q,r);if(L==null)return null;L.data&&i(L.data,"expectedType")&&oe.push(L.data.expectedType)}var at=oe.length>0?", expected one of type ["+oe.join(", ")+"]":"";return new v("Invalid "+K+" `"+q+"` supplied to "+("`"+U+"`"+at+"."))}return b(G)}function N(){function E(V,B,G,J,X){return ve(V[B])?null:new v("Invalid "+J+" `"+X+"` supplied to "+("`"+G+"`, expected a ReactNode."))}return b(E)}function j(E,V,B,G,J){return new v((E||"React class")+": "+V+" type `"+B+"."+G+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+J+"`.")}function Z(E){function V(B,G,J,X,U){var K=B[G],q=$e(K);if(q!=="object")return new v("Invalid "+X+" `"+U+"` of type `"+q+"` "+("supplied to `"+J+"`, expected `object`."));for(var oe in E){var re=E[oe];if(typeof re!="function")return j(J,X,U,oe,ee(re));var Ue=re(K,oe,J,X,U+"."+oe,r);if(Ue)return Ue}return null}return b(V)}function ne(E){function V(B,G,J,X,U){var K=B[G],q=$e(K);if(q!=="object")return new v("Invalid "+X+" `"+U+"` of type `"+q+"` "+("supplied to `"+J+"`, expected `object`."));var oe=t({},B[G],E);for(var re in oe){var Ue=E[re];if(i(E,re)&&typeof Ue!="function")return j(J,X,U,re,ee(Ue));if(!Ue)return new v("Invalid "+X+" `"+U+"` key `"+re+"` supplied to `"+J+"`.\nBad object: "+JSON.stringify(B[G],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(E),null,"  "));var L=Ue(K,re,J,X,U+"."+re,r);if(L)return L}return null}return b(V)}function ve(E){switch(typeof E){case"number":case"string":case"undefined":return!0;case"boolean":return!E;case"object":if(Array.isArray(E))return E.every(ve);if(E===null||c(E))return!0;var V=h(E);if(V){var B=V.call(E),G;if(V!==E.entries){for(;!(G=B.next()).done;)if(!ve(G.value))return!1}else for(;!(G=B.next()).done;){var J=G.value;if(J&&!ve(J[1]))return!1}}else return!1;return!0;default:return!1}}function ke(E,V){return E==="symbol"?!0:V?V["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&V instanceof Symbol:!1}function $e(E){var V=typeof E;return Array.isArray(E)?"array":E instanceof RegExp?"object":ke(V,E)?"symbol":V}function ee(E){if(typeof E>"u"||E===null)return""+E;var V=$e(E);if(V==="object"){if(E instanceof Date)return"date";if(E instanceof RegExp)return"regexp"}return V}function Q(E){var V=ee(E);switch(V){case"array":case"object":return"an "+V;case"boolean":case"date":case"regexp":return"a "+V;default:return V}}function qe(E){return!E.constructor||!E.constructor.name?f:E.constructor.name}return p.checkPropTypes=s,p.resetWarningCache=s.resetWarningCache,p.PropTypes=p,p},so}var oo,Ac;function Qm(){if(Ac)return oo;Ac=1;var e=no();function n(){}function t(){}return t.resetWarningCache=n,oo=function(){function r(o,a,c,l,u,d){if(d!==e){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:n};return s.PropTypes=s,s},oo}var Tc;function eg(){if(Tc)return mi.exports;Tc=1;var e={};if(e.NODE_ENV!=="production"){var n=js(),t=!0;mi.exports=Xm()(n.isElement,t)}else mi.exports=Qm()();return mi.exports}var tg=eg();const w=Gp(tg);function Rc(e,n){let t={};return Object.entries(e).forEach(([r,i])=>{if(n!=null&&n.hasOwnProperty(r)){const s=n[r](i);s!=null&&(t={...t,...s});return}i===!0?t[`data-${r.toLowerCase()}`]="":i&&(t[`data-${r.toLowerCase()}`]=i.toString())}),t}function Nc(e,n){return typeof e=="function"?e(n):e}function nt(...e){if(e.length===0)return{};if(e.length===1)return Pc(e[0],{});let n=Pc(e[0],{});for(let t=1;t<e.length;t+=1){const r=e[t];r&&(Dc(r)?n=r(n):n=ng(n,r))}return n??{}}function Pc(e,n){return Dc(e)?e(n):e??{}}function ng(e,n){return n?e?Object.entries(n).reduce((t,[r,i])=>(rg(r,i)?t[r]=ig(e[r],i):r==="style"?t[r]=og(e.style,i):r==="className"?t[r]=ag(e.className,i):t[r]=i,t),{...e}):n:e||{}}function rg(e,n){const t=e.charCodeAt(2);return e[0]==="o"&&e[1]==="n"&&t>=65&&t<=90&&typeof n=="function"}function Dc(e){return typeof e=="function"}function ig(e,n){return t=>{if(lg(t)){const i=t;sg(i);const s=n(i);return i.baseUIHandlerPrevented||e==null||e(i),s}const r=n(t);return e==null||e(t),r}}function sg(e){return e.preventBaseUIHandler=()=>{e.baseUIHandlerPrevented=!0},e}function og(e,n){if(n||e)return{...e,...n}}function ag(e,n){return n?e?n+" "+e:n:e}function lg(e){return e!=null&&typeof e=="object"&&"nativeEvent"in e}function cg(e,n,t){return typeof e=="function"?e(n,t):Yr(e,{...nt(n,e.props),ref:n.ref})}function Tn(...e){const n=le(void 0),t=D(r=>{const i=e.map(s=>{if(s==null)return null;if(typeof s=="function"){const o=s,a=o(r);return typeof a=="function"?a:()=>{o(null)}}return s.current=r,()=>{s.current=null}});return()=>{i.forEach(s=>s==null?void 0:s())}},e);return W(()=>e.every(r=>r==null)?null:r=>{n.current&&(n.current(),n.current=void 0),r!=null&&(n.current=t(r))},e)}const ug=parseInt($l,10);function Vc(e){return ug>=e}function dg(e,...n){let t;return typeof e!="function"?t=Vc(19)?e.props.ref:e.ref:t=null,Tn(t,...n)}function hg(e){return function(t){return e==="button"?Re("button",{type:"button",...t}):e==="img"?Re("img",{alt:"",...t}):Re(e,{...t})}}const Fc={};function fg(e,n,t={}){const{className:r,render:i}=n,{propGetter:s=b=>b,state:o=Fc,ref:a,props:c,customStyleHookMapping:l,styleHooks:u=!0}=t,d=i||(typeof e=="string"?hg(e):e),h=Nc(r,o),f=W(()=>u?Rc(o,l):Fc,[o,l,u]),p=s({...f,...Array.isArray(c)?nt(...c):c});let g=[];a!==void 0&&(g=Array.isArray(a)?a:[a]);const v={...p,ref:dg(d,p.ref,...g)};return h!==void 0&&(v.className=h),()=>cg(d,v,o)}function Tt(e){const n=typeof e.render=="string"?e.render:void 0,t=typeof e.render=="string"?void 0:e.render;return{renderElement:fg(n,{className:e.className,render:t},{...e,props:e.extraProps})}}let Lc=function(e){return e.disabled="data-disabled",e.valid="data-valid",e.invalid="data-invalid",e.touched="data-touched",e.dirty="data-dirty",e.filled="data-filled",e.focused="data-focused",e}({});const ao={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:null,valueMissing:!1},vr={valid(e){return e===null?null:e?{[Lc.valid]:""}:{[Lc.invalid]:""}}};var pg={};const Rt=()=>{},lo=it({invalid:void 0,controlId:void 0,setControlId:Rt,labelId:void 0,setLabelId:Rt,messageIds:[],setMessageIds:Rt,name:void 0,validityData:{state:ao,errors:[],error:"",value:"",initialValue:null},setValidityData:Rt,disabled:void 0,touched:!1,setTouched:Rt,dirty:!1,setDirty:Rt,filled:!1,setFilled:Rt,focused:!1,setFocused:Rt,validate:()=>null,validationMode:"onBlur",validationDebounceTime:0,state:{disabled:!1,valid:null,touched:!1,dirty:!1,filled:!1,focused:!1},markedDirtyRef:{current:!1}});pg.NODE_ENV!=="production"&&(lo.displayName="FieldRootContext");function ot(e=!0){const n=me(lo);if(n.setControlId===Rt&&!e)throw new Error("Base UI: FieldRootContext is missing. Field parts must be placed within <Field.Root>.");return n}var mg={};const zc=it({legendId:void 0,setLegendId:()=>{},disabled:void 0});mg.NODE_ENV!=="production"&&(zc.displayName="FieldsetRootContext");function gg(){return me(zc)}const Je=typeof window<"u"?It:ce;function ht(e){const n=le(e);return Je(()=>{n.current=e}),D((...t)=>{var r;return(r=n.current)==null?void 0:r.call(n,...t)},[])}var yg={};const Bc=it({formRef:{current:{fields:new Map}},errors:{},onClearErrors:()=>{}});yg.NODE_ENV!=="production"&&(Bc.displayName="FormContext");function br(){return me(Bc)}var vg={};const bg=Qe(function(n,t){const{render:r,className:i,validate:s,validationDebounceTime:o=0,validationMode:a="onBlur",name:c,disabled:l=!1,invalid:u,...d}=n,{disabled:h}=gg(),{errors:f}=br(),p=ht(s||(()=>null)),g=h||l,[v,b]=F(void 0),[_,$]=F(void 0),[k,x]=F([]),[C,M]=F(!1),[O,I]=F(!1),[T,N]=F(!1),[j,Z]=F(!1),ne=le(!1),ve=D(B=>{B&&(ne.current=!0),I(B)},[]),ke=!!(u||c&&{}.hasOwnProperty.call(f,c)),[$e,ee]=F({state:ao,error:"",errors:[],value:null,initialValue:null}),Q=!ke&&$e.state.valid,qe=W(()=>({disabled:g,touched:C,dirty:O,valid:Q,filled:T,focused:j}),[g,C,O,Q,T,j]),E=W(()=>({invalid:ke,controlId:v,setControlId:b,labelId:_,setLabelId:$,messageIds:k,setMessageIds:x,name:c,validityData:$e,setValidityData:ee,disabled:g,touched:C,setTouched:M,dirty:O,setDirty:ve,filled:T,setFilled:N,focused:j,setFocused:Z,validate:p,validationMode:a,validationDebounceTime:o,state:qe,markedDirtyRef:ne}),[ke,v,_,k,c,$e,g,C,O,ve,T,N,j,Z,p,a,o,qe]),{renderElement:V}=Tt({render:r??"div",ref:t,className:i,state:qe,extraProps:d,customStyleHookMapping:vr});return Re(lo.Provider,{value:E,children:V()})});vg.NODE_ENV!=="production"&&(bg.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),disabled:w.bool,invalid:w.bool,name:w.string,render:w.oneOfType([w.element,w.func]),validate:w.func,validationDebounceTime:w.number,validationMode:w.oneOf(["onBlur","onChange"])});function _g(){const{controlId:e,labelId:n}=ot(),t=D((r={})=>nt({id:n,htmlFor:e,onMouseDown(i){var o;const s=window.getSelection();s&&!((o=s.anchorNode)!=null&&o.contains(i.currentTarget))&&s.empty(),i.preventDefault()}},r),[e,n]);return W(()=>({getLabelProps:t}),[t])}let jc=0;function xg(e,n="mui"){const[t,r]=F(e),i=e||t;return ce(()=>{t==null&&(jc+=1,r(`${n}-${jc}`))},[t,n]),i}const qc={...Xr}.useId;function wg(e,n){if(qc!==void 0){const t=qc();return e??`${n}-${t}`}return xg(e,n)}function an(e){return wg(e,"base-ui")}var Sg={};const $g=Qe(function(n,t){const{render:r,className:i,id:s,...o}=n,{setLabelId:a,state:c}=ot(!1),l=an(s);Je(()=>(a(l),()=>{a(void 0)}),[l,a]);const{getLabelProps:u}=_g(),{renderElement:d}=Tt({propGetter:u,render:r??"label",ref:t,className:i,state:c,extraProps:o,customStyleHookMapping:vr});return d()});Sg.NODE_ENV!=="production"&&($g.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),id:w.string,render:w.oneOfType([w.element,w.func])});function kg(e){const{id:n,rendered:t,formError:r}=e,{setMessageIds:i,validityData:s}=ot(),o=an(n);Je(()=>{if(!(!t||!o))return i(c=>c.concat(o)),()=>{i(c=>c.filter(l=>l!==o))}},[t,o,i]);const a=D((c={})=>nt({id:o,children:r||(s.errors.length>1?Le("ul",{},s.errors.map(l=>Le("li",{key:l},l))):s.error)},c),[o,r,s]);return W(()=>({getErrorProps:a}),[a])}var Cg={};const Mg=Qe(function(n,t){const{render:r,id:i,className:s,match:o,forceShow:a,...c}=n,{validityData:l,state:u,name:d}=ot(!1),{errors:h}=br(),f=d?h[d]:null;let p=!1;f||a?p=!0:o?p=!!l.state[o]:a==null&&(p=l.state.valid===!1);const{getErrorProps:g}=kg({id:i,rendered:p,formError:f}),{renderElement:v}=Tt({propGetter:g,render:r??"div",ref:t,className:s,state:u,extraProps:c,customStyleHookMapping:vr});return p?v():null});Cg.NODE_ENV!=="production"&&(Mg.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),forceShow:w.bool,id:w.string,match:w.oneOf(["badInput","customError","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valid","valueMissing"]),render:w.oneOfType([w.element,w.func])});function Eg(e){const{id:n}=e,{setMessageIds:t}=ot(),r=an(n);Je(()=>{if(r)return t(s=>s.concat(r)),()=>{t(s=>s.filter(o=>o!==r))}},[r,t]);const i=D((s={})=>nt({id:r},s),[r]);return W(()=>({getDescriptionProps:i}),[i])}var Og={};const Ig=Qe(function(n,t){const{render:r,id:i,className:s,...o}=n,{state:a}=ot(!1),{getDescriptionProps:c}=Eg({id:i}),{renderElement:l}=Tt({propGetter:c,render:r??"p",ref:t,className:s,state:a,extraProps:o,customStyleHookMapping:vr});return l()});Og.NODE_ENV!=="production"&&(Ig.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),id:w.string,render:w.oneOfType([w.element,w.func])});function Uc(e,n){return{...e,state:{...e.state,valid:!n&&e.state.valid}}}const Ag=Object.keys(ao);function gi(){const{setValidityData:e,validate:n,messageIds:t,validityData:r,validationMode:i,validationDebounceTime:s,invalid:o,markedDirtyRef:a,controlId:c,state:l}=ot(),{formRef:u}=br(),d=le(-1),h=le(null);ce(()=>()=>{window.clearTimeout(d.current)},[]);const f=ht(async v=>{const b=h.current;if(!b)return;function _(I){return Ag.reduce((T,N)=>(T[N]=I.validity[N],!I.validity.customError&&!a.current&&(T[N]=N==="valid"),T),{})}window.clearTimeout(d.current);const $=n(v);let k=null;typeof $=="object"&&$!==null&&"then"in $?k=await $:k=$;let x="";k!==null&&(x=Array.isArray(k)?k.join(`
`):k),b.setCustomValidity(x);const C=_(b);let M=[];Array.isArray(k)?M=k:k?M=[k]:b.validationMessage&&(M=[b.validationMessage]);const O={value:v,state:C,error:Array.isArray(k)?k[0]:k??b.validationMessage,errors:M,initialValue:r.initialValue};if(c){const I=u.current.fields.get(c);I&&u.current.fields.set(c,{...I,...Uc(O,o)})}e(O)}),p=D((v={})=>nt({...t.length&&{"aria-describedby":t.join(" ")},...l.valid===!1&&{"aria-invalid":!0}},v),[t,l.valid]),g=D((v={})=>nt({onChange(b){if(b.nativeEvent.defaultPrevented||o||i!=="onChange")return;const _=b.currentTarget;if(_.value===""){f(_.value);return}window.clearTimeout(d.current),s?d.current=window.setTimeout(()=>{f(_.value)},s):f(_.value)}},p(v)),[p,o,i,s,f]);return W(()=>({getValidationProps:p,getInputValidationProps:g,inputRef:h,commitValidation:f}),[p,g,f])}function Tg(e){const n=le(e);return Je(()=>{n.current=e}),n}function Kc(e){const{formRef:n}=br(),{invalid:t,markedDirtyRef:r,validityData:i,setValidityData:s}=ot(),{value:o,id:a,controlRef:c,commitValidation:l}=e,u=Tg(e.getValue);Je(()=>{var h;let d=o;d===void 0&&(d=(h=u.current)==null?void 0:h.call(u)),i.initialValue===null&&d!==i.initialValue&&s(f=>({...f,initialValue:d}))},[s,o,i.initialValue,u]),Je(()=>{a&&n.current.fields.set(a,{controlRef:c,validityData:Uc(i,t),validate(){var h;let d=o;d===void 0&&(d=(h=u.current)==null?void 0:h.call(u)),r.current=!0,Zr(()=>l(d))}})},[l,c,n,u,a,t,r,i,o])}var Rg={};function Wc({controlled:e,default:n,name:t,state:r="value"}){const{current:i}=le(e!==void 0),[s,o]=F(n),a=i?e:s;if(Rg.NODE_ENV!=="production"){ce(()=>{i!==(e!==void 0)&&console.error([`Base UI: A component is changing the ${i?"":"un"}controlled ${r} state of ${t} to be ${i?"un":""}controlled.`,"Elements should not switch from uncontrolled to controlled (or vice versa).",`Decide between using a controlled or uncontrolled ${t} element for the lifetime of the component.`,"The nature of the state is determined during the first render. It's considered controlled if the value is not `undefined`.","More info: https://fb.me/react-controlled-components"].join(`
`))},[r,t,e]);const{current:l}=le(n);ce(()=>{!i&&!Object.is(l,n)&&console.error([`Base UI: A component is changing the default ${r} state of an uncontrolled ${t} after being initialized. To suppress this warning opt to use a controlled ${t}.`].join(`
`))},[JSON.stringify(n)])}const c=D(l=>{i||o(l)},[]);return[a,c]}function Ng(e){const{id:n,name:t,value:r,defaultValue:i,onValueChange:s,disabled:o}=e,{setControlId:a,labelId:c,setTouched:l,setDirty:u,validityData:d,setFocused:h,setFilled:f,validationMode:p}=ot(),{errors:g,onClearErrors:v}=br(),{getValidationProps:b,getInputValidationProps:_,commitValidation:$,inputRef:k}=gi(),x=an(n);Je(()=>(a(x),()=>{a(void 0)}),[x,a]),Je(()=>{var N;const T=r!=null;(N=k.current)!=null&&N.value||T&&r!==""?f(!0):T&&r===""&&f(!1)},[k,f,r]);const[C,M]=Wc({controlled:r,default:i,name:"FieldControl",state:"value"}),O=ht((T,N)=>{M(T),s==null||s(T,N)});Kc({id:x,commitValidation:$,value:C,getValue:()=>{var T;return(T=k.current)==null?void 0:T.value},controlRef:k});const I=D((T={})=>nt({id:x,disabled:o,name:t,ref:k,"aria-labelledby":c,value:C,onChange(N){if(C!=null&&O(N.currentTarget.value,N.nativeEvent),u(N.currentTarget.value!==d.initialValue),f(N.currentTarget.value!==""),t&&{}.hasOwnProperty.call(g,t)){const j={...g};delete j[t],v(j)}},onFocus(){h(!0)},onBlur(N){l(!0),h(!1),p==="onBlur"&&$(N.currentTarget.value)},onKeyDown(N){N.currentTarget.tagName==="INPUT"&&N.key==="Enter"&&(l(!0),$(N.currentTarget.value))}},b(_(T))),[b,_,x,o,t,k,c,C,u,d.initialValue,f,g,O,v,h,l,p,$]);return W(()=>({getControlProps:I}),[I])}var Pg={};const Hc=Qe(function(n,t){const{render:r,className:i,id:s,name:o,value:a,disabled:c=!1,onValueChange:l,defaultValue:u,...d}=n,{state:h,name:f,disabled:p}=ot(),g=p||c,v=f??o,b=W(()=>({...h,disabled:g}),[h,g]),{getControlProps:_}=Ng({id:s,name:v,disabled:g,value:a,defaultValue:u,onValueChange:l}),{renderElement:$}=Tt({propGetter:_,render:r??"input",ref:t,className:i,state:b,extraProps:d,customStyleHookMapping:vr});return $()});Pg.NODE_ENV!=="production"&&(Hc.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),defaultValue:w.oneOfType([w.arrayOf(w.string),w.number,w.string]),disabled:w.bool,id:w.string,name:w.string,onValueChange:w.func,render:w.oneOfType([w.element,w.func]),value:w.oneOfType([w.arrayOf(w.string),w.number,w.string])});var Dg={};Dg.NODE_ENV!=="production"&&w.func.isRequired;var Vg={};const Gc=Qe(function(n,t){const{render:r,className:i,...s}=n;return Re(Hc,{ref:t,render:r,className:i,...s})});Vg.NODE_ENV!=="production"&&(Gc.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),render:w.oneOfType([w.element,w.func])});const Fg=hr({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),yi={root:S({display:"flex",position:"relative"}),label:S({display:"block",marginBottom:"8px",color:Me.colors.onCard,fontSize:"14px",fontWeight:500}),input:S({"--input-text-color":"var(--primary-text-color)","--input-bg-color":"var(--secondary-background-color)","--input-border-color":"var(--divider-color)","--input-focus-border-color":"var(--secondary-text-color)","--input-disabled-bg-color":"var(--disabled-color)","--input-disabled-text-color":"var(--disabled-text-color)",width:"100%",padding:"8px",color:"var(--input-text-color)",backgroundColor:"var(--input-bg-color)",border:"none",boxShadow:"0 0 1px 1px var(--input-border-color)",borderRadius:"6px",fontSize:"14px","&:focus":{outline:"none",boxShadow:"0 0 1px 1px var(--input-focus-border-color)"},"&:disabled":{backgroundColor:"var(--input-disabled-bg-color)",color:"var(--input-disabled-text-color)",cursor:"not-allowed"}}),icon:S({position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)","& ha-icon":{pointerEvents:"none",animation:`${Fg} 1s linear infinite`}})},Jc=({value:e="",placeholder:n,onChange:t,disabled:r,type:i="text",label:s,name:o,loading:a=!1,className:c})=>{const l=u=>{t==null||t(u.target.value)};return A("div",{css:yi.root,className:c,children:[s&&m("label",{css:yi.label,children:s}),m(Gc,{css:yi.input,value:e,placeholder:n,onChange:l,disabled:r,type:i,name:o}),a&&m(At,{size:"x-small",icon:"mdi:loading",css:yi.icon})]})},Lg=(e,n)=>{const[t,r]=F(null),[i,s]=F(null),[o,a]=F(!1);ce(()=>{ge().callApi("GET","config/config_entries/entry").then(u=>{const h=u.filter(f=>f.domain==="music_assistant").find(f=>f.state==="loaded");h&&r(h.entry_id)})},[]),ce(()=>{if(e===""||!t)return;const l={type:"call_service",domain:"music_assistant",service:"search",service_data:{name:e,config_entry_id:t,media_type:n==="all"?void 0:n,limit:n==="all"?8:100},return_response:!0},u=ge();a(!0),u.connection.sendMessagePromise(l).then(d=>{const h=d;h.response&&(a(!1),s(h.response))})},[e,t,n]);const c=D(async(l,u,d)=>ge().callService("music_assistant","play_media",{entity_id:u,media_type:l.media_type,media_id:l.uri,enqueue:d}),[]);return W(()=>({results:i,loading:o,playItem:c}),[i,o])},zg=[{type:"all",label:"All",icon:"mdi:all-inclusive"},{type:"artist",label:"Artists",icon:"mdi:account-music"},{type:"album",label:"Albums",icon:"mdi:album"},{type:"track",label:"Tracks",icon:"mdi:music-note"},{type:"playlist",label:"Playlists",icon:"mdi:playlist-music"},{type:"radio",label:"Radio",icon:"mdi:radio"},{type:"audiobook",label:"Audiobooks",icon:"mdi:book"},{type:"podcast",label:"Podcasts",icon:"mdi:podcast"}],Yc={artists:"artist",albums:"album",tracks:"track",playlists:"playlist",radio:"radio",audiobooks:"audiobook",podcasts:"podcast"},Bg={artist:"Artists",album:"Albums",track:"Tracks",playlist:"Playlists",radio:"Radio",audiobook:"Audiobooks",podcast:"Podcasts"},jg=(e,n)=>{const[t,r]=F(null),[i,s]=F(),[o,a]=F(!1);return ce(()=>{ge().callApi("GET","config/config_entries/entry").then(l=>{const d=l.filter(h=>h.domain==="music_assistant").find(h=>h.state==="loaded");d&&r(d.entry_id)})},[]),ce(()=>{if(!t||!n){s(null);return}a(!0);const c={artists:[],albums:[],tracks:[],playlists:[],radio:[],podcasts:[],audiobooks:[]},l=async u=>{const d={type:"call_service",domain:"music_assistant",service:"get_library",service_data:{config_entry_id:t,media_type:u,favorite:!0,limit:e==="all"?8:20},return_response:!0},h=ge();try{const p=await h.connection.sendMessagePromise(d);if(!p.response)return;c[qg[u]]=p.response.items??[]}catch(f){return console.error("Error fetching favorites:",u,f),Promise.reject(f)}};e==="all"?Promise.all(Object.values(Yc).map(u=>l(u))).then(()=>{a(!1),s(c)}):l(e).then(()=>{a(!1),s(c)})},[t,e]),W(()=>({favorites:i,loading:o}),[i,o])},qg={artist:"artists",album:"albums",track:"tracks",playlist:"playlists",radio:"radio",audiobook:"audiobooks",podcast:"podcasts"},Ug=({onItemClick:e,onHeaderClick:n,loading:t=!1,error:r=null,results:i,...s})=>{const[o,a]=F(4),c=W(()=>{const u=[];if(!i)return u;const d=Object.entries(i).map(([h,f])=>({mediaType:Yc[h],items:f})).filter(h=>h.items.length>0);return d.forEach(({mediaType:h,items:f})=>{if(f.length!==0)if(d.length>1&&u.push({type:"header",mediaType:h}),f[0].media_type==="track")f.forEach(p=>{u.push({type:"item",item:p})});else for(let p=0;p<f.length;p+=o){const g=f.slice(p,p+o);u.push({type:"itemsRow",items:g})}}),u},[i,o]),l=u=>{var d;switch(u.type){case"header":return m(pc,{onClick:()=>n==null?void 0:n(u.mediaType),children:Bg[u.mediaType]});case"item":{const{item:h}=u,f=async()=>{await e(h)};return m(di,{numberOfColumns:o,children:h.media_type==="track"?m(pi,{imageUrl:h.image??((d=h.album)==null?void 0:d.image),title:h.name,artist:h.artists.map(p=>p.name).join(", "),onClick:f},h.uri):m(fi,{imageUrl:h.image,name:h.name,artist:"artists"in h?h.artists.map(p=>p.name).join(", "):void 0,onClick:f},h.uri)})}case"itemsRow":return m(di,{numberOfColumns:o,children:u.items.map(h=>{var p;const f=async()=>{await e(h)};return h.media_type==="track"?m(pi,{imageUrl:h.image??((p=h.album)==null?void 0:p.image),title:h.name,artist:h.artists.map(g=>g.name).join(", "),onClick:f},h.uri):m(fi,{imageUrl:h.image,name:h.name,artist:"artists"in h?h.artists.map(g=>g.name).join(", "):void 0,onClick:f},h.uri)})});default:return null}};return t?m(mr,{}):r?m("p",{css:Pe.mediaEmptyText,children:r}):m(wc,{onLayout:({width:u})=>{u<390?a(3):a(4)},data:c,renderItem:l,renderEmpty:()=>m("p",{css:Pe.mediaEmptyText,children:"No items found."}),...s})},Zc=({maEntityId:e,horizontalPadding:n,searchBarPosition:t="top",maxHeight:r=300})=>{const[i,s]=F(""),[o,a]=F("play"),c=dc(i,300),[l,u]=F("all"),d=D(()=>{const _=["play","replace","next","replace_next","add"],k=(_.indexOf(o)+1)%_.length;a(_[k])},[o]),{results:h,loading:f,playItem:p}=Lg(c,l),{favorites:g}=jg(l,i===""),v=()=>A("div",{css:Pe.searchBarContainer,children:[m(Jc,{placeholder:"Search..",onChange:s,value:i,loading:f,css:Pe.searchInput}),A("div",{css:Pe.filterContainer,children:[m(sn,{css:Pe.chip,style:{"--mmpc-chip-horizontal-margin":`${n}px`},icon:Kg(o),onClick:d,children:Wg(o)}),m("div",{css:Pe.verticalChipSeperator}),b()]})]}),b=()=>zg.map(_=>m(sn,{css:Pe.chip,style:{"--mmpc-chip-horizontal-margin":`${n}px`,opacity:l===_.type?1:.6,fontWeight:l===_.type?"bold":"normal"},onClick:()=>u(_.type),icon:_.icon,children:_.label},_.type));return A("div",{css:Pe.root,style:{"--mmpc-search-padding":`${n}px`},children:[m(Ug,{renderHeader:t==="top"?v:void 0,results:i!==""&&h?h:g||void 0,onItemClick:_=>p(_,e,o),style:{"--mmpc-search-padding":`${n}px`},maxHeight:r,onHeaderClick:u}),t==="bottom"&&v()]})},Kg=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"replace_next":return"mdi:playlist-edit";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},Wg=e=>{switch(e){case"play":return"Play now";case"replace":return"Replace queue";case"next":return"Add next";case"replace_next":return"Replace next";case"add":return"Add to queue";default:return"Play"}},Hg={root:S({display:"contents","--mmpc-chip-background":"var(--card-background-color)","--mmpc-chip-foreground":"var(--primary-text-color)"})},Gg=()=>{const{config:e}=me(Be);return m("div",{css:Hg.root,children:m(Zs,{config:{entity_id:e.entity_id,speaker_group:{entities:e.entities}},showGrouped:!0})})};function Rn({actionConfig:e,rootElement:n,overrideCallback:t}){const r=W(()=>({onTap:e!=null&&e.tap_action?()=>Gs(n,e,"tap",ge()):void 0,onLongPress:e!=null&&e.hold_action?()=>Gs(n,e,"hold",ge()):void 0,onDoubleTap:e!=null&&e.double_tap_action?()=>Gs(n,e,"double_tap",ge()):void 0,...t??{}}),[e,t]),i=by(r);return W(()=>i,[i])}class Jg{constructor(n,t){this.pixels=n,this.opts=t;const{sigBits:r}=t,i=(k,x,C)=>(k<<2*r)+(x<<r)+C;this.getColorIndex=i;const s=8-r,o=1<<3*r,a=new Uint32Array(o);let c,l,u,d,h,f,p,g,v,b;c=u=h=0,l=d=f=Number.MAX_VALUE;const _=n.length/4;let $=0;for(;$<_;){const k=$*4;if($++,p=n[k+0],g=n[k+1],v=n[k+2],b=n[k+3],b===0)continue;p=p>>s,g=g>>s,v=v>>s;const x=i(p,g,v);a[x]===void 0&&(a[x]=0),a[x]+=1,p>c&&(c=p),p<l&&(l=p),g>u&&(u=g),g<d&&(d=g),v>h&&(h=v),v<f&&(f=v)}this._colorCount=a.reduce((k,x)=>x>0?k+1:k,0),this.hist=a,this.rmax=c,this.rmin=l,this.gmax=u,this.gmin=d,this.bmax=h,this.bmin=f}get colorCount(){return this._colorCount}}class Yg{scaleDown(n){const t=this.getWidth(),r=this.getHeight();let i=1;if(n.maxDimension>0){const s=Math.max(t,r);s>n.maxDimension&&(i=n.maxDimension/s)}else i=1/n.quality;i<1&&this.resize(t*i,r*i,i)}}function Zg(e,n){var t;if(n.length>0){const r=e.data,i=r.length/4;let s,o,a,c,l;for(let u=0;u<i;u++){s=u*4,o=r[s+0],a=r[s+1],c=r[s+2],l=r[s+3];for(let d=0;d<n.length;d++)if(!((t=n[d])!=null&&t.call(n,o,a,c,l))){r[s+3]=0;break}}}return e}function Xg(e){const n=new URL(e,location.href);return n.protocol===location.protocol&&n.host===location.host&&n.port===location.port}function Qg(e,n){const t=new URL(e),r=new URL(n);return t.protocol===r.protocol&&t.hostname===r.hostname&&t.port===r.port}class ey extends Yg{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const n=this.image;if(!n)throw new Error("Image is not initialized");const t=this._canvas=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new ReferenceError("Failed to create canvas context");this._context=r,t.className="@vibrant/canvas",t.style.display="none",this._width=t.width=n.width,this._height=t.height=n.height,r.drawImage(n,0,0),document.body.appendChild(t)}load(n){let t,r;if(typeof n=="string")t=document.createElement("img"),r=n,!Xg(r)&&!Qg(window.location.href,r)&&(t.crossOrigin="anonymous"),t.src=r;else if(n instanceof HTMLImageElement)t=n,r=n.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=t,new Promise((i,s)=>{const o=()=>{this._initCanvas(),i(this)};t.complete?o():(t.onload=o,t.onerror=a=>s(new Error(`Fail to load image: ${r}`)))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(n){this._getContext().putImageData(n,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(n,t,r){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=n,this._height=this._getCanvas().height=t,this._getContext().scale(r,r),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function _r(e,...n){return n.forEach(t=>{if(t){for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];Array.isArray(i)?e[r]=i.slice(0):typeof i=="object"?(e[r]||(e[r]={}),_r(e[r],i)):e[r]=i}}}),e}function ty(e,n){const{colorCount:t,quantizer:r,generators:i,filters:s}=e,o={colorCount:t},a=typeof r=="string"?{name:r,options:{}}:r;return a.options=_r({},o,a.options),_r({},{quantizer:a,generators:i,filters:s},n)}class ny{constructor(n,t={}){this._src=n,this._opts=_r({},Kt.DefaultOpts,t)}maxColorCount(n){return this._opts.colorCount=n,this}maxDimension(n){return this._opts.maxDimension=n,this}addFilter(n){return this._opts.filters?this._opts.filters.push(n):this._opts.filters=[n],this}removeFilter(n){if(this._opts.filters){const t=this._opts.filters.indexOf(n);t>0&&this._opts.filters.splice(t)}return this}clearFilters(){return this._opts.filters=[],this}quality(n){return this._opts.quality=n,this}useImageClass(n){return this._opts.ImageClass=n,this}useGenerator(n,t){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(t?{name:n,options:t}:n),this}useQuantizer(n,t){return this._opts.quantizer=t?{name:n,options:t}:n,this}build(){return new Kt(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class co{constructor(n){this.pipeline=n,this._map={}}names(){return Object.keys(this._map)}has(n){return!!this._map[n]}get(n){return this._map[n]}register(n,t){return this._map[n]=t,this.pipeline}}class ry{constructor(){this.filter=new co(this),this.quantizer=new co(this),this.generator=new co(this)}_buildProcessTasks({filters:n,quantizer:t,generators:r}){return r.length===1&&r[0]==="*"&&(r=this.generator.names()),{filters:n.map(s=>i(this.filter,s)),quantizer:i(this.quantizer,t),generators:r.map(s=>i(this.generator,s))};function i(s,o){let a,c;return typeof o=="string"?a=o:(a=o.name,c=o.options),{name:a,fn:s.get(a),options:c}}}async process(n,t){const{filters:r,quantizer:i,generators:s}=this._buildProcessTasks(t),o=await this._filterColors(r,n),a=await this._generateColors(i,o),c=await this._generatePalettes(s,a);return{colors:a,palettes:c}}_filterColors(n,t){return Promise.resolve(Zg(t,n.map(({fn:r})=>r)))}_generateColors(n,t){return Promise.resolve(n.fn(t.data,n.options))}async _generatePalettes(n,t){const r=await Promise.all(n.map(({fn:i,options:s})=>Promise.resolve(i(t,s))));return Promise.resolve(r.reduce((i,s,o)=>(i[n[o].name]=s,i),{}))}}function iy(e,n,t){return"#"+((1<<24)+(e<<16)+(n<<8)+t).toString(16).slice(1,7)}function sy(e,n,t){e/=255,n/=255,t/=255;const r=Math.max(e,n,t),i=Math.min(e,n,t);let s=0,o=0;const a=(r+i)/2;if(r!==i){const c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case e:s=(n-t)/c+(n<t?6:0);break;case n:s=(t-e)/c+2;break;case t:s=(e-n)/c+4;break}s/=6}return[s,o,a]}function Nt(e,n,t){let r,i,s;function o(a,c,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?a+(c-a)*6*l:l<1/2?c:l<2/3?a+(c-a)*(2/3-l)*6:a}if(n===0)r=i=s=t;else{const a=t<.5?t*(1+n):t+n-t*n,c=2*t-a;r=o(c,a,e+1/3),i=o(c,a,e),s=o(c,a,e-1/3)}return[r*255,i*255,s*255]}class lt{static applyFilters(n,t){return t.length>0?n.filter(({r,g:i,b:s})=>{var o;for(let a=0;a<t.length;a++)if(!((o=t[a])!=null&&o.call(t,r,i,s,255)))return!1;return!0}):n}static clone(n){return new lt(n._rgb,n._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[n,t,r]=this._rgb;this._hsl=sy(n,t,r)}return this._hsl}get hex(){if(!this._hex){const[n,t,r]=this._rgb;this._hex=iy(n,t,r)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const n=this._rgb;this._yiq=(n[0]*299+n[1]*587+n[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(n,t){this._rgb=n,this._population=t}}const Xc=class Aa{constructor(n,t){this._src=n,this.opts=_r({},Aa.DefaultOpts,t)}static use(n){this._pipeline=n}static from(n){return new ny(n)}get result(){return this._result}_process(n,t){n.scaleDown(this.opts);const r=ty(this.opts,t);return Aa._pipeline.process(n.getImageData(),r)}async getPalette(){const n=new this.opts.ImageClass;try{const t=await n.load(this._src),r=await this._process(t,{generators:["default"]});this._result=r;const i=r.palettes.default;if(!i)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return n.remove(),i}catch(t){return n.remove(),Promise.reject(t)}}async getPalettes(){const n=new this.opts.ImageClass;try{const t=await n.load(this._src),r=await this._process(t,{generators:["*"]});this._result=r;const i=r.palettes;return n.remove(),i}catch(t){return n.remove(),Promise.reject(t)}}};Xc.DefaultOpts={colorCount:64,quality:5,filters:[]};let Kt=Xc;Kt.DefaultOpts.quantizer="mmcq",Kt.DefaultOpts.generators=["default"],Kt.DefaultOpts.filters=["default"],Kt.DefaultOpts.ImageClass=ey;const uo=5,ho=8-uo;class vi{constructor(n,t,r,i,s,o,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:n,r2:t,g1:r,g2:i,b1:s,b2:o}}static build(n){const t=new Jg(n,{sigBits:uo}),{rmin:r,rmax:i,gmin:s,gmax:o,bmin:a,bmax:c}=t;return new vi(r,i,s,o,a,c,t)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:n,r2:t,g1:r,g2:i,b1:s,b2:o}=this.dimension;this._volume=(t-n+1)*(i-r+1)*(o-s+1)}return this._volume}count(){if(this._count<0){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension;let l=0;for(let u=r;u<=i;u++)for(let d=s;d<=o;d++)for(let h=a;h<=c;h++){const f=t(u,d,h);n[f]&&(l+=n[f])}this._count=l}return this._count}clone(){const{histogram:n}=this,{r1:t,r2:r,g1:i,g2:s,b1:o,b2:a}=this.dimension;return new vi(t,r,i,s,o,a,n)}avg(){if(!this._avg){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension;let l=0;const u=1<<8-uo;let d,h,f;d=h=f=0;for(let p=r;p<=i;p++)for(let g=s;g<=o;g++)for(let v=a;v<=c;v++){const b=t(p,g,v),_=n[b];_&&(l+=_,d+=_*(p+.5)*u,h+=_*(g+.5)*u,f+=_*(v+.5)*u)}l?this._avg=[~~(d/l),~~(h/l),~~(f/l)]:this._avg=[~~(u*(r+i+1)/2),~~(u*(s+o+1)/2),~~(u*(a+c+1)/2)]}return this._avg}contains(n){let[t,r,i]=n;const{r1:s,r2:o,g1:a,g2:c,b1:l,b2:u}=this.dimension;return t>>=ho,r>>=ho,i>>=ho,t>=s&&t<=o&&r>=a&&r<=c&&i>=l&&i<=u}split(){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension,l=this.count();if(!l)return[];if(l===1)return[this.clone()];const u=i-r+1,d=o-s+1,h=c-a+1,f=Math.max(u,d,h);let p=null,g,v;g=v=0;let b=null;if(f===u){b="r",p=new Uint32Array(i+1);for(let C=r;C<=i;C++){g=0;for(let M=s;M<=o;M++)for(let O=a;O<=c;O++){const I=t(C,M,O);n[I]&&(g+=n[I])}v+=g,p[C]=v}}else if(f===d){b="g",p=new Uint32Array(o+1);for(let C=s;C<=o;C++){g=0;for(let M=r;M<=i;M++)for(let O=a;O<=c;O++){const I=t(M,C,O);n[I]&&(g+=n[I])}v+=g,p[C]=v}}else{b="b",p=new Uint32Array(c+1);for(let C=a;C<=c;C++){g=0;for(let M=r;M<=i;M++)for(let O=s;O<=o;O++){const I=t(M,O,C);n[I]&&(g+=n[I])}v+=g,p[C]=v}}let _=-1;const $=new Uint32Array(p.length);for(let C=0;C<p.length;C++){const M=p[C];M&&(_<0&&M>v/2&&(_=C),$[C]=v-M)}const k=this;function x(C){const M=C+"1",O=C+"2",I=k.dimension[M];let T=k.dimension[O];const N=k.clone(),j=k.clone(),Z=_-I,ne=T-_;for(Z<=ne?(T=Math.min(T-1,~~(_+ne/2)),T=Math.max(0,T)):(T=Math.max(I,~~(_-1-Z/2)),T=Math.min(k.dimension[O],T));!p[T];)T++;let ve=$[T];for(;!ve&&p[T-1];)ve=$[--T];return N.dimension[O]=T,j.dimension[M]=T+1,[N,j]}return x(b)}}class Qc{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(n){this._comparator=n,this.contents=[],this._sorted=!1}push(n){this.contents.push(n),this._sorted=!1}peek(n){return this._sort(),n=typeof n=="number"?n:this.contents.length-1,this.contents[n]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(n){return this._sort(),this.contents.map(n)}}const oy=.75;function eu(e,n){let t=e.size();for(;e.size()<n;){const r=e.pop();if(r&&r.count()>0){const[i,s]=r.split();if(!i||(e.push(i),s&&s.count()>0&&e.push(s),e.size()===t))break;t=e.size()}else break}}const ay=(e,n)=>{if(e.length===0||n.colorCount<2||n.colorCount>256)throw new Error("Wrong MMCQ parameters");const t=vi.build(e);t.histogram.colorCount;const r=new Qc((s,o)=>s.count()-o.count());r.push(t),eu(r,oy*n.colorCount);const i=new Qc((s,o)=>s.count()*s.volume()-o.count()*o.volume());return i.contents=r.contents,eu(i,n.colorCount-i.size()),ly(i)};function ly(e){const n=[];for(;e.size();){const t=e.pop(),r=t.avg();n.push(new lt(r,t.count()))}return n}const cy={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function uy(e){let n=0;return e.forEach(t=>{n=Math.max(n,t.population)}),n}function dy(e,n){return e.Vibrant===n||e.DarkVibrant===n||e.LightVibrant===n||e.Muted===n||e.DarkMuted===n||e.LightMuted===n}function hy(e,n,t,r,i,s,o){function a(...l){let u=0,d=0;for(let h=0;h<l.length;h+=2){const f=l[h],p=l[h+1];!f||!p||(u+=f*p,d+=p)}return u/d}function c(l,u){return 1-Math.abs(l-u)}return a(c(e,n),o.weightSaturation,c(t,r),o.weightLuma,i/s,o.weightPopulation)}function Nn(e,n,t,r,i,s,o,a,c,l){let u=null,d=0;return n.forEach(h=>{const[,f,p]=h.hsl;if(f>=a&&f<=c&&p>=i&&p<=s&&!dy(e,h)){const g=hy(f,o,p,r,h.population,t,l);(u===null||g>d)&&(u=h,d=g)}}),u}function fy(e,n,t){const r={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return r.Vibrant=Nn(r,e,n,t.targetNormalLuma,t.minNormalLuma,t.maxNormalLuma,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.LightVibrant=Nn(r,e,n,t.targetLightLuma,t.minLightLuma,1,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.DarkVibrant=Nn(r,e,n,t.targetDarkLuma,0,t.maxDarkLuma,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.Muted=Nn(r,e,n,t.targetNormalLuma,t.minNormalLuma,t.maxNormalLuma,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r.LightMuted=Nn(r,e,n,t.targetLightLuma,t.minLightLuma,1,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r.DarkMuted=Nn(r,e,n,t.targetDarkLuma,0,t.maxDarkLuma,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r}function py(e,n,t){if(!e.Vibrant&&!e.DarkVibrant&&!e.LightVibrant){if(!e.DarkVibrant&&e.DarkMuted){let[r,i,s]=e.DarkMuted.hsl;s=t.targetDarkLuma,e.DarkVibrant=new lt(Nt(r,i,s),0)}if(!e.LightVibrant&&e.LightMuted){let[r,i,s]=e.LightMuted.hsl;s=t.targetDarkLuma,e.DarkVibrant=new lt(Nt(r,i,s),0)}}if(!e.Vibrant&&e.DarkVibrant){let[r,i,s]=e.DarkVibrant.hsl;s=t.targetNormalLuma,e.Vibrant=new lt(Nt(r,i,s),0)}else if(!e.Vibrant&&e.LightVibrant){let[r,i,s]=e.LightVibrant.hsl;s=t.targetNormalLuma,e.Vibrant=new lt(Nt(r,i,s),0)}if(!e.DarkVibrant&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetDarkLuma,e.DarkVibrant=new lt(Nt(r,i,s),0)}if(!e.LightVibrant&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetLightLuma,e.LightVibrant=new lt(Nt(r,i,s),0)}if(!e.Muted&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetMutesSaturation,e.Muted=new lt(Nt(r,i,s),0)}if(!e.DarkMuted&&e.DarkVibrant){let[r,i,s]=e.DarkVibrant.hsl;s=t.targetMutesSaturation,e.DarkMuted=new lt(Nt(r,i,s),0)}if(!e.LightMuted&&e.LightVibrant){let[r,i,s]=e.LightVibrant.hsl;s=t.targetMutesSaturation,e.LightMuted=new lt(Nt(r,i,s),0)}}const my=(e,n)=>{n=Object.assign({},cy,n);const t=uy(e),r=fy(e,t,n);return py(r,t,n),r},gy=new ry().filter.register("default",(e,n,t,r)=>r>=125&&!(e>250&&n>250&&t>250)).quantizer.register("mmcq",ay).generator.register("default",my);Kt.use(gy);const fo=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;function tu(){const{attributes:{entity_picture:e}}=He(),[n,t]=F(null),[r,i]=F(fo()),s=D(()=>{e&&Kt.from(e).getPalette().then(t).catch(c=>{console.error("Error getting color with Vibrant:",c)})},[e]);ce(()=>{t(null),e&&s()},[e]),ce(()=>{const c=window.matchMedia("(prefers-color-scheme: dark)"),l=()=>i(fo());if(i(fo()),c.addEventListener)return c.addEventListener("change",l),()=>c.removeEventListener("change",l)},[]);const o=W(()=>{if(r||!n)return null;const c=n.Vibrant??n.Muted;if(!c)return null;const l={...bi(c.hsl),l:50},u=Wt(l),d={...l,s:4.35,l:95.49},h={...Wt(d),l:15.29},f={...d,l:d.l*.98},p=Wt(f),g={...d,l:d.l*1.1},v=Wt(g);return{artVars:{"--art-color":`${se(bi(c.hsl))}`,"--art-on-art-color":`${c.titleTextColor}`,"--art-primary-color":`${se(l)}`,"--art-on-primary-color":`${se(u)}`,"--art-surface-color":`${se(d)}`,"--art-on-surface-color":`${se(h)}`,"--art-surface-higher-color":`${se(f)}`,"--art-on-surface-higher-color":`${se(p)}`,"--art-surface-lower-color":`${se(g)}`,"--art-on-surface-lower-color":`${se(v)}`},haVars:{"--primary-color":`${se(l)}`,"--ha-card-background":`${se(d)}`,"--card-background-color":`${se(f)}`,"--primary-text-color":`${se(h)}`,"--secondary-text-color":`${se({...h,l:h.l*1.1})}`,"--icon-primary-color":`${se(h)}`,"--divider-color":`${se({...d,l:88})}`,"--clear-background-color":`${se({...d,l:100})}`,"--secondary-background-color":`${se({...h,l:95})}`}}},[n,r]),a=W(()=>{if(!r||!n)return null;const c=n.Vibrant??n.Muted;if(!c)return null;const l={...bi(c.hsl),l:50},u=Wt(l),d={...l,s:2.91,l:20.2},h={...Wt(d),l:86.47},f={...d,l:d.l*1.02},p=Wt(f),g={...d,l:d.l*.98},v=Wt(g);return{artVars:{"--art-color":`${se(bi(c.hsl))}`,"--art-on-art-color":`${c.titleTextColor}`,"--art-primary-color":`${se(l)}`,"--art-on-primary-color":`${se(u)}`,"--art-surface-color":`${se(d)}`,"--art-on-surface-color":`${se(h)}`,"--art-surface-higher-color":`${se(f)}`,"--art-on-surface-higher-color":`${se(p)}`,"--art-surface-lower-color":`${se(g)}`,"--art-on-surface-lower-color":`${se(v)}`},haVars:{"--primary-color":`${se(l)}`,"--ha-card-background":`${se(d)}`,"--card-background-color":`${se(f)}`,"--primary-text-color":`${se(h)}`,"--secondary-text-color":`${se({...h,l:h.l*.9})}`,"--icon-primary-color":`${se(h)}`,"--divider-color":`${se({...d,l:25})}`,"--clear-background-color":`${se({...d,l:0})}`,"--secondary-background-color":`${se({...h,l:19})}`}}},[n,r]);return W(()=>({artVars:r?a==null?void 0:a.artVars:o==null?void 0:o.artVars,haVars:r?a==null?void 0:a.haVars:o==null?void 0:o.haVars}),[a,o])}const bi=e=>{const n=Math.round(e[0]*360),t=Math.round(e[1]*100),r=Math.round(e[2]*100);return{h:n,s:t,l:r}},Wt=({h:e,s:n,l:t})=>({h:(e+180)%360,s:n,l:t}),se=({h:e,s:n,l:t,a:r})=>`hsla(${e}deg, ${n}%, ${t}%, ${r||1})`,yy="ontouchstart"in window,vy={longPressIndicator:S({position:"fixed",width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"var(--primary-color, rgba(7, 114, 244))",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:9,animation:"pulse 1s infinite",transform:"translate(-50%, -50%)","@keyframes pulse":{"0%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6},"50%":{transform:"translate(-50%, -50%) scale(1)",opacity:.8},"100%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6}}})};function by({onTap:e,onLongPress:n,onDoubleTap:t}){const r=le(null),i=le(0),s=le(null),o=le(null),[a,c]=F(!1),[l,u]=F(!1),[d,h]=F({x:0,y:0}),f=D(()=>{s.current&&clearTimeout(s.current),o.current&&clearTimeout(o.current),u(!1),r.current=null,i.current=0},[]),p=()=>l?m("div",{css:vy.longPressIndicator,style:{left:`${d.x}px`,top:`${d.y}px`}}):null,g=D(()=>{const O=Date.now();return!!(r.current&&O-r.current>=500)},[]),v=D((O,I)=>{h({x:O,y:I})},[]),b=D((O,I)=>{r.current=Date.now(),v(O,I),o.current=setTimeout(()=>{u(!0)},500)},[v]),_=D((O,I)=>{l&&v(O,I)},[l,v]),$=D(()=>{s.current&&clearTimeout(s.current),o.current&&(clearTimeout(o.current),u(!1)),i.current+=1,s.current=setTimeout(async()=>{c(!0);try{i.current>1?await(t==null?void 0:t()):g()?await(n==null?void 0:n()):await(e==null?void 0:e())}catch(O){console.error("Error in button callback:",O)}c(!1),r.current=null,i.current=0},250)},[g,t,n,e]),k=D(O=>{b(O.clientX,O.clientY)},[b]),x=D(O=>{_(O.clientX,O.clientY)},[_]),C=D(O=>{if(O.touches.length>0){const I=O.touches[0];b(I.clientX,I.clientY)}},[b]),M=D(O=>{if(O.touches.length>0){const I=O.touches[0];_(I.clientX,I.clientY)}},[_]);return W(()=>({...yy?{onTouchStart:C,onTouchMove:M,onTouchEnd:$,onTouchCancel:f,loading:a}:{onMouseDown:k,onMouseMove:x,onMouseUp:$,onMouseOut:f,loading:a},renderLongPressIndicator:p}),[k,x,$,f,C,M,p])}function _y(e,n){const{shuffle:t,repeat:r,source:i,supported_features:s}=n,o=e==="off",a=!o&&s!==void 0&&(s|16)===s,c=!o&&s!==void 0&&(s|32)===s,l=!o&&t!==void 0&&!["optical","aux"].includes((i==null?void 0:i.toLowerCase())||"")&&s!==void 0&&(s&32768)===32768,u=!o&&r!==void 0&&!["optical","aux"].includes((i==null?void 0:i.toLowerCase())||"")&&s!==void 0&&(s&262144)===262144,d=!o&&s!==void 0&&((s&4096)===4096||(s&16384)===16384);return{supportPreviousTrack:a,supportNextTrack:c,supportsShuffle:l,supportsRepeat:u,supportsTogglePlayPause:d}}function po(){const{attributes:e,state:n}=He(),t=_y(n,e);return W(()=>t,[t.supportPreviousTrack,t.supportNextTrack,t.supportsShuffle,t.supportsRepeat,t.supportsTogglePlayPause])}const nu={root:S({display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:"2px",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:S({"&:first-child":{marginLeft:"16px"},"&:last-child":{marginRight:"16px"}})},xy=()=>{const{config:e}=me(Be),{custom_buttons:n}=e;return m("div",{css:nu.root,children:n==null?void 0:n.map((t,r)=>m(wy,{button:t},r))})},wy=({button:e})=>{const{rootElement:n,config:t}=me(Be),{icon:r,name:i,...s}=e,o=Rn({rootElement:n,actionConfig:{...s,entity:t.entity_id}});return A(sn,{css:nu.chip,icon:r,...o,children:[!!i&&m("span",{children:i}),o.renderLongPressIndicator()]})},Sy={root:S({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around",width:"100%",paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)"})},$y=()=>{const{config:e}=me(Be),{attributes:{shuffle:n,repeat:t},state:r}=He(),i=r==="playing",{supportPreviousTrack:s,supportNextTrack:o,supportsShuffle:a,supportsRepeat:c,supportsTogglePlayPause:l}=po(),u=D(()=>{ge().callService("media_player","media_play_pause",{entity_id:e.entity_id})},[]),d=D(()=>{ge().callService("media_player","media_next_track",{entity_id:e.entity_id})},[]),h=D(()=>{ge().callService("media_player","media_previous_track",{entity_id:e.entity_id})},[]),f=D(()=>{ge().callService("media_player","shuffle_set",{entity_id:e.entity_id,shuffle:!n})},[n]),p=D(()=>{const g=t==="off"?"one":t==="one"?"all":"off";ge().callService("media_player","repeat_set",{entity_id:e.entity_id,repeat:g})},[t]);return A("div",{css:Sy.root,children:[a&&m(ae,{size:"small",onClick:f,icon:n?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),s&&m(ae,{size:"large",onClick:h,icon:"mdi:skip-previous"}),l&&m(ae,{size:"x-large",onClick:u,icon:i?"mdi:pause-circle":"mdi:play-circle"}),o&&m(ae,{size:"large",onClick:d,icon:"mdi:skip-next"}),c&&m(ae,{size:"small",onClick:p,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},ru={root:S({display:"flex",alignItems:"center",flex:1,maxHeight:"36px",marginTop:"auto",gap:"8px"}),buttonMuted:S({opacity:.8})},ky=()=>{var a,c;const e=He(),n=e.entity_id,t=((a=e.attributes)==null?void 0:a.volume_level)??0,r=((c=e.attributes)==null?void 0:c.is_volume_muted)??!1,i=D(l=>{ge().callService("media_player","volume_set",{entity_id:n,volume_level:l})},[]),s=D(()=>{ge().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!r})},[r]),o=W(()=>fr(t,r),[t,r]);return A("div",{css:ru.root,children:[m(ae,{css:r?ru.buttonMuted:{},size:"small",onClick:s,icon:o}),m(Ea,{min:0,max:1,step:.01,value:t,sliderSize:"large",onChange:i})]})},Cy=({onClick:e})=>{var s,o;const n=He(),t=((s=n.attributes)==null?void 0:s.volume_level)??0,r=((o=n.attributes)==null?void 0:o.is_volume_muted)??!1,i=fr(t,r);return m(ae,{size:"small",onClick:e,icon:i})},_i={root:S({display:"flex",flexDirection:"column",gap:"18px"}),speakerList:S({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),syncContainer:S({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",opacity:.8,position:"absolute",right:"56px",top:"12px"}),syncText:S({fontSize:"12px"})},My=()=>{var c,l;const e=An(),{config:n}=me(Be),{entity_id:t,speaker_group:r}=n,[i,s]=F(!0),o=(r==null?void 0:r.entity_id)||t,a=e.states[o];return A("div",{css:_i.root,children:[((l=(c=a==null?void 0:a.attributes)==null?void 0:c.group_members)==null?void 0:l.length)>1&&A("div",{children:[A("div",{css:_i.syncContainer,children:[m("span",{css:_i.syncText,onClick:()=>s(!i),children:"Link Volume"}),m(ae,{icon:i?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>s(!i)})]}),m("div",{css:_i.speakerList,children:m(uc,{config:{entity_id:t,speaker_group:r},syncMainSpeaker:i})})]}),m(Zs,{config:{entity_id:t,speaker_group:r},showGrouped:!1,layout:{horizontalMargin:16}})]})},Ey=hr`
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`,xi={root:S({backgroundColor:"var(--mmpc-surface-higher)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderRadius:"12px",padding:"12px",width:"100%",position:"relative",boxSizing:"border-box",boxShadow:"0 15px 100px var(--clear-background-color)"}),modalRoot:S({position:"absolute",bottom:"calc(100% + 12px)",left:0,width:"100%",backgroundColor:"var(--mmpc-surface-higher)",borderRadius:"12px",boxSizing:"border-box",animation:`${Ey} 0.3s ease forwards`,boxShadow:"0 0px 80px var(--clear-background-color)"}),modalHeader:S({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",color:"var(--primary-text-color, #fff)",borderBottom:`0.5px solid ${Me.colors.onCardDivider}`,"> h4":{margin:0}}),modalContent:S({display:"flex",flexDirection:"column",gap:"12px",maxHeight:"400px",overflowY:"auto",padding:"var(--mmpc-modal-padding, 16px)"})},Oy=()=>{const{config:e}=me(Be),{entity_id:n,custom_buttons:t,speaker_group:r,ma_entity_id:i,search:s,options:{always_show_power_button:o}={}}=e,{state:a}=He(),c=a!=="off"&&a!=="unavailable",u=i&&i.length>0||(s==null?void 0:s.enabled),[d,h]=F(),f=D(g=>{h(d===g?void 0:g)},[d]),p=D(()=>{ge().callService("media_player","toggle",{entity_id:n})},[n]);return A("div",{css:xi.root,children:[m(wi,{title:"Volume",isOpen:d==="volume",onClose:()=>h(void 0),children:m(ky,{})}),m(wi,{title:"Speaker Grouping",isOpen:d==="speaker-grouping",onClose:()=>h(void 0),padding:"16px 0px 16px 0px",children:m(My,{})}),m(wi,{title:"Search",isOpen:d==="search",onClose:()=>h(void 0),padding:"16px 0px 16px 0px",children:i?m(Zc,{maEntityId:i,horizontalPadding:16,searchBarPosition:"bottom"}):m(Sc,{entityId:(s==null?void 0:s.entity_id)??e.entity_id,showFavorites:(s==null?void 0:s.show_favorites)??!1,horizontalPadding:16,filterConfig:s==null?void 0:s.media_types,searchBarPosition:"bottom"})}),!!r&&m(ae,{size:"small",icon:"mdi:speaker-multiple",onClick:()=>f("speaker-grouping")}),t&&t.length===1?m(Iy,{button:t[0]}):t&&t.length>1?A(Oe,{children:[m(ae,{size:"small",icon:"mdi:dots-horizontal",onClick:()=>f("custom-buttons")}),m(wi,{title:"Shortcuts",isOpen:d==="custom-buttons",onClose:()=>h(void 0),padding:"16px 0px 16px 0px",children:m(xy,{})})]}):null,u&&m(ae,{size:"small",icon:"mdi:magnify",onClick:()=>h("search")}),(!c||o)&&m(ae,{size:"x-small",onClick:p,icon:"mdi:power"}),m(Cy,{onClick:()=>f("volume")})]})},wi=({children:e,title:n,isOpen:t,padding:r,onClose:i})=>t?A("div",{css:xi.modalRoot,children:[A("div",{css:xi.modalHeader,children:[m("h4",{children:n}),m(ae,{type:"button",size:"small",icon:"mdi:close",onClick:i})]}),m("div",{css:xi.modalContent,style:{"--mmpc-modal-padding":r??"16px"},children:e})]}):null,Iy=({button:e})=>{const{rootElement:n,config:t}=me(Be),{icon:r,name:i,...s}=e,o=Rn({rootElement:n,actionConfig:{...s,entity:t.entity_id}});return m(ae,{icon:e.icon??"mdi:dots-vertical",size:"small",...o})},mo={root:S({display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",textAlign:"center",color:Me.colors.onDialog,paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)","> h2, > h3":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"}}),titleH2:S({margin:0}),titleH3:S({margin:0,fontWeight:"normal",color:Me.colors.onDialogMuted})},Ay=()=>{const{title:e,subtitle:n}=He();return A("div",{css:mo.root,children:[!!e&&m("h2",{css:mo.titleH2,children:e}),!!n&&m("h3",{css:mo.titleH3,children:n})]})},iu={root:S({paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)"}),timeWrap:S({display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:"4px",color:Me.colors.onDialogMuted,height:"20px",marginBottom:"-20px"})},Ty=()=>{const e=He(),[n,t]=F(0),r=e.state==="playing";ce(()=>{if(!r)return;const s=setInterval(()=>{t(o=>o+1)},1e3);return()=>clearInterval(s)},[r]);const i=W(()=>{var f,p,g;const s=((f=e.attributes)==null?void 0:f.media_position)??null,o=((p=e.attributes)==null?void 0:p.media_position_updated_at)??null,a=((g=e.attributes)==null?void 0:g.media_duration)??null;if(s===null||s<0||a===null||o===null)return null;const c=new Date,l=new Date(o),d=(c.getTime()-l.getTime())/1e3+s,h=v=>{const b=Math.floor(v/60).toString().padStart(2,"0"),_=Math.round(v-Number(b)*60).toString().padStart(2,"0");return`${b}:${_}`};return{currentPosition:d,mediaDuration:a,prettyNow:h(d),prettyEnd:h(a)}},[e,n]);return i?A("div",{css:iu.root,children:[m(Uw,{value:i.currentPosition,min:0,max:i.mediaDuration}),A("div",{css:iu.timeWrap,children:[m("span",{children:i.prettyNow}),m("span",{children:i.prettyEnd})]})]}):null},Ht={root:S({display:"flex",justifyContent:"center",alignItems:"center","--mmpc-extra-horizontal-padding":"0px",boxSizing:"border-box","*":{boxSizing:"border-box"},"--mmpc-surface-higher":Me.colors.card}),rootPanelMode:S({width:"100%",height:"100%",background:"linear-gradient(var(--app-header-background-color), rgba(255, 255, 255, 0))",maxHeight:"calc(100vh - var(--header-height, 16px))"}),rootPopupMode:S({"--mmpc-extra-horizontal-padding":"12px"}),wrap:S({display:"flex",flex:1,flexDirection:"column",gap:"16px",justifyContent:"space-around",alignItems:"center",paddingTop:"16px",paddingBottom:"16px",height:"100%"}),wrapPanelMode:S({width:"90%",maxWidth:"400px",padding:"16px"}),wrapPopupMode:S({maxWidth:"100%",padding:"16px",paddingBottom:"max(calc(env(safe-area-inset-bottom) + 8px), 16px)"}),wrapCardMode:S({width:"100%",padding:"16px"}),controlsWrapper:S({display:"flex",flexDirection:"column",maxHeight:"300px",minHeight:"280px",width:"100%",height:"100%",justifyContent:"space-between"})},su=({className:e})=>{const{config:n,rootElement:t}=me(Be),{mode:r,use_art_colors:i,action:s}=n,{artVars:o,haVars:a}=tu(),l=Rn({rootElement:t,actionConfig:{...s??{tap_action:{action:"more-info"}},entity:n.entity_id}}),u=()=>m("div",{className:e,css:[Ht.root,r==="panel"&&Ht.rootPanelMode,r==="popup"&&Ht.rootPopupMode],style:{...o??{},...a&&i?a:{}},children:A("div",{css:[Ht.wrap,r==="panel"&&Ht.wrapPanelMode,r==="card"&&Ht.wrapCardMode,r==="popup"&&Ht.wrapPopupMode],children:[m(nc,{iconSize:"x-large",borderRadius:8,...l}),A("div",{css:Ht.controlsWrapper,children:[m(Ay,{}),m(Ty,{}),m($y,{}),m(Oy,{})]})]})});return r==="card"?m("ha-card",{children:u()}):u()},xr=e=>Array.isArray(e)?e:[e],Ry=(e,n)=>{const t=[[],[]];for(const r of e)n(r)?t[0].push(r):t[1].push(r);return t},ou=Array,ln=(e,n)=>e.includes(n),Ny=(e,n=0)=>[...new Array(e)].map((t,r)=>r+n),_e=(e,n,t)=>e===void 0?n===void 0?[]:Array.isArray(n)?n:[n]:(Array.isArray(n)?e.push(...n):e.push(n),e),cn=(e,n)=>n==null?e??[]:e==null?xr(n):e.concat(n),Py=(...e)=>e.reduce(cn,[]),un=(e,n,t)=>{if(e===void 0)return Array.isArray(n)?n:[n];const r=(t==null?void 0:t.isEqual)??((i,s)=>i===s);for(const i of xr(n))e.some(s=>r(s,i))||e.push(i);return e},Dy=(e,n)=>e.reduce((t,r)=>{const i=r[n];return t[i]=_e(t[i],r),t},{}),Pn=(e,n,t)=>e.length===n.length&&e.every(t!=null&&t.isEqual?(r,i)=>t.isEqual(r,n[i]):(r,i)=>r===n[i]),dn=(e,n)=>ft(e)===n,ft=e=>{const n=typeof e;return n==="object"?e===null?"null":"object":n==="function"?"object":n},Pt={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},Vy={...Pt,function:"a function"};class Fy extends Error{}const Ae=e=>Dn(e,Fy),Dn=(e,n=Error)=>{throw new n(e)};class Ly extends Error{constructor(){super(...arguments);y(this,"name","ParseError")}}const R=e=>Dn(e,Ly),au=e=>` ${e}`,xe=(e,n)=>{const t={},r=Array.isArray(e);let i=!1;for(const[s,o]of Object.entries(e).entries()){const a=r?n(s,o[1]):n(...o,s);i||(i=typeof a[0]=="number");const c=Array.isArray(a[0])||a.length===0?a:[a];for(const[l,u]of c)typeof l=="object"?t[l.group]=_e(t[l.group],u):t[l]=u}return i?Object.values(t):t},lu=Object.entries,kt=(e,n)=>e in n,go=(e,n)=>n in e;class zy{constructor(n){Object.assign(this,n)}}const By=class{};class cu extends By{}const jy=(e,n)=>{const t={},r={};let i;for(i in e)i in n?t[i]=e[i]:r[i]=e[i];return[t,r]},qy=(e,n)=>jy(e,n)[1],wr=e=>Object.keys(e).length===0,Si=e=>[...Object.entries(e),...Object.getOwnPropertySymbols(e).map(n=>[n,e[n]])],Uy=(e,n)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)),Ky=e=>{const n=Object.keys(e).sort(),t={};for(let r=0;r<n.length;r++)t[n[r]]=e[n[r]];return t},Dt=au("represents an uninitialized value"),Wy=e=>Object.values(e).filter(n=>typeof n=="number"?!0:typeof e[n]!="number"),uu={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},du=globalThis.File??Blob,hu={ArrayBuffer,Blob,File:du,FormData,Headers,Request,Response,URL},Hy={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},Vn={...uu,...hu,...Hy,String,Number,Boolean},yo=e=>{var r;let n=Object.getPrototypeOf(e);for(;n!=null&&n.constructor&&(!kt(n.constructor.name,Vn)||!(e instanceof Vn[n.constructor.name]));)n=Object.getPrototypeOf(n);const t=(r=n==null?void 0:n.constructor)==null?void 0:r.name;if(!(t===void 0||t==="Object"))return t},vo=e=>typeof e=="object"&&e!==null?yo(e)??"object":ft(e),We=Array.isArray,Gy={...{Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},...{ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},...{Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"}},bo=e=>{const n=Object(e).name??null;return n&&kt(n,Vn)&&Vn[n]===e?n:null},fu=(e,n)=>{let t=e.prototype;for(;t!==null;){if(t===n.prototype)return!0;t=Object.getPrototypeOf(t)}return!1},Jy=e=>pu(e,new Map),pu=(e,n)=>{if(typeof e!="object"||e===null)return e;if(n!=null&&n.has(e))return n.get(e);const t=bo(e.constructor);if(t==="Date")return new Date(e.getTime());if(t&&t!=="Array")return e;const r=Array.isArray(e)?e.slice():Object.create(Object.getPrototypeOf(e)),i=Object.getOwnPropertyDescriptors(e);if(n){n.set(e,r);for(const s in i){const o=i[s];"get"in o||"set"in o||(o.value=pu(o.value,n))}}return Object.defineProperties(r,i),r},Yy=e=>{let n=Dt;return()=>n===Dt?n=e():n},$i=e=>typeof e=="function"&&e.length===0,Zy=class extends Function{constructor(...e){const n=e.slice(0,-1),t=e.at(-1);try{super(...n,t)}catch(r){return Ae(`Encountered an unexpected error while compiling your definition:
                Message: ${r} 
                Source: (${e.slice(0,-1)}) => {
                    ${e.at(-1)}
                }`)}}};class Fn{constructor(n,...[t]){return Object.assign(Object.setPrototypeOf(n.bind((t==null?void 0:t.bind)??this),this.constructor.prototype),t==null?void 0:t.attach)}}const Xy=Yy(()=>{try{return new Function("return false")()}catch{return!0}});class Ct{constructor(){}}const Qy=()=>{var e,n,t;try{return(((t=(((n=(e=new Error().stack)==null?void 0:e.split(`
`)[2])==null?void 0:n.trim())||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/))==null?void 0:t[1])||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},ev=((Pf=globalThis.process)==null?void 0:Pf.env)??{},tv={fileName:Qy,env:ev},nv=e=>e[0].toUpperCase()+e.slice(1),mu=e=>new RegExp(rv(e),typeof e=="string"?"":e.flags),rv=e=>`^(?:${typeof e=="string"?e:e.source})$`,Gt={negativeLookahead:e=>`(?!${e})`,nonCapturingGroup:e=>`(?:${e})`},_o="\\",ki={" ":1,"\n":1,"	":1},iv=/^-0\.?0*$/.source,gu=/[1-9]\d*/.source,sv=/\.\d+/.source,ov=/\.\d*[1-9]/.source,yu=e=>mu(Gt.negativeLookahead(iv)+Gt.nonCapturingGroup("-?"+Gt.nonCapturingGroup(Gt.nonCapturingGroup("0|"+gu)+Gt.nonCapturingGroup(e.decimalPattern)+"?")+(e.allowDecimalOnly?"|"+e.decimalPattern:"")+"?")),vu=yu({decimalPattern:ov,allowDecimalOnly:!1}),av=vu.test.bind(vu),xo=yu({decimalPattern:sv,allowDecimalOnly:!0});xo.test.bind(xo);const lv=/^-?\d*\.?\d*$/,cv=e=>e.length!==0&&lv.test(e),Ci=mu(Gt.negativeLookahead("^-0$")+"-?"+Gt.nonCapturingGroup(Gt.nonCapturingGroup("0|"+gu))),uv=Ci.test.bind(Ci),wo=/^-?\d+$/,dv=wo.test.bind(wo),bu={number:"a number",bigint:"a bigint",integer:"an integer"},_u=(e,n)=>`'${e}' was parsed as ${bu[n]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,hv=(e,n)=>n==="number"?av(e):uv(e),fv=(e,n)=>n==="number"?Number(e):Number.parseInt(e),pv=(e,n)=>n==="number"?cv(e):dv(e),mv=(e,n)=>So(e,"number",n),gv=(e,n)=>So(e,"number",{...n,strict:!0}),yv=(e,n)=>So(e,"integer",n),So=(e,n,t)=>{const r=fv(e,n);return!Number.isNaN(r)&&pv(e,n)?t!=null&&t.strict?hv(e,n)?r:R(_u(e,n)):r:t!=null&&t.errorOnFail?R((t==null?void 0:t.errorOnFail)===!0?`Failed to parse ${bu[n]} from '${e}'`:t==null?void 0:t.errorOnFail):void 0},vv=e=>{if(e[e.length-1]!=="n")return;const n=e.slice(0,-1);let t;try{t=BigInt(n)}catch{return}if(Ci.test(n))return t;if(wo.test(n))return R(_u(e,"bigint"))},Sr={version:"0.46.0",filename:tv.fileName(),FileConstructor:du},xu=new Map,$o=Object.create(null),ko=e=>{const n=xu.get(e);if(n)return n;let t=bv(e);return $o[t]?t=`${t}${$o[t]++}`:$o[t]=1,Sr[t]=e,xu.set(e,t),t},$r=e=>/^[$A-Z_a-z][\w$]*$/.test(e),bv=e=>{switch(typeof e){case"object":{if(e===null)break;const n=yo(e)??"object";return n[0].toLowerCase()+n.slice(1)}case"function":return $r(e.name)?e.name:"fn";case"symbol":return e.description&&$r(e.description)?e.description:"symbol"}return Ae(`Unexpected attempt to register serializable value of type ${ft(e)}`)},Co=e=>typeof e=="string"?JSON.stringify(e):typeof e=="bigint"?`${e}n`:`${e}`,_v=(e,n={})=>kr(e,{onUndefined:"$ark.undefined",onBigInt:t=>`$ark.bigint-${t}`,...n},[]),ye=(e,n)=>{switch(ft(e)){case"object":const t=e,r=t.constructor.name;return r==="Object"||r==="Array"?(n==null?void 0:n.quoteKeys)===!1?Mi(t,(n==null?void 0:n.indent)??0,""):JSON.stringify(kr(t,Ln,[]),null,n==null?void 0:n.indent):Mi(t,(n==null?void 0:n.indent)??0,"");case"symbol":return Ln.onSymbol(e);default:return Co(e)}},Mi=(e,n,t)=>{if(typeof e=="function")return Ln.onFunction(e);if(typeof e!="object"||e===null)return Co(e);const r=t+" ".repeat(n);if(Array.isArray(e)){if(e.length===0)return"[]";const s=e.map(o=>Mi(o,n,r)).join(`,
`+r);return n?`[
${r}${s}
${t}]`:`[${s}]`}const i=e.constructor.name;if(i==="Object"){const s=Si(e).map(([o,a])=>{const c=typeof o=="symbol"?Ln.onSymbol(o):$r(o)?o:JSON.stringify(o),l=Mi(a,n,r);return`${r}${c}: ${l}`});return s.length===0?"{}":n?`{
${s.join(`,
`)}
${t}}`:`{${s.join(", ")}}`}return e instanceof Date?Cr(e):"expression"in e&&typeof e.expression=="string"?e.expression:i},Ln={onCycle:()=>"(cycle)",onSymbol:e=>`Symbol(${ko(e)})`,onFunction:e=>`Function(${ko(e)})`},kr=(e,n,t)=>{var r,i;switch(ft(e)){case"object":{const s=e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();if(typeof s=="function")return Ln.onFunction(s);if(t.includes(s))return"(cycle)";const o=[...t,s];if(Array.isArray(s))return s.map(c=>kr(c,n,o));if(s instanceof Date)return s.toDateString();const a={};for(const c in s)a[c]=kr(s[c],n,o);for(const c of Object.getOwnPropertySymbols(s))a[((r=n.onSymbol)==null?void 0:r.call(n,c))??c.toString()]=kr(s[c],n,o);return a}case"symbol":return Ln.onSymbol(e);case"bigint":return((i=n.onBigInt)==null?void 0:i.call(n,e))??`${e}n`;case"undefined":return n.onUndefined??"undefined";case"string":return e.replaceAll("\\","\\\\");default:return e}},Cr=e=>{const n=e.getFullYear(),t=e.getMonth(),r=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),a=e.getMilliseconds();if(t===0&&r===1&&i===0&&s===0&&o===0&&a===0)return`${n}`;const c=`${xv[t]} ${r}, ${n}`;if(i===0&&s===0&&o===0&&a===0)return c;let l=e.toLocaleTimeString();const u=l.endsWith(" AM")||l.endsWith(" PM")?l.slice(-3):"";return u&&(l=l.slice(0,-u.length)),a?l+=`.${Sv(a,3)}`:wv.test(l)&&(l=l.slice(0,-3)),`${l+u}, ${c}`},xv=["January","February","March","April","May","June","July","August","September","October","November","December"],wv=/:\d\d:00$/,Sv=(e,n)=>String(e).padStart(n,"0"),wu=(e,n,...[t])=>{const r=(t==null?void 0:t.stringifySymbol)??ye;let i=e;switch(typeof n){case"string":i=$r(n)?e===""?n:`${e}.${n}`:`${e}[${JSON.stringify(n)}]`;break;case"number":i=`${e}[${n}]`;break;case"symbol":i=`${e}[${r(n)}]`;break;default:t!=null&&t.stringifyNonKey?i=`${e}[${t.stringifyNonKey(n)}]`:R(`${ye(n)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},Mr=(e,...n)=>e.reduce((t,r)=>wu(t,r,...n),"");class Su extends ou{constructor(...t){super();y(this,"cache",{});this.push(...t)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let t=0;t<this.length;t++)this.cache.json.push(typeof this[t]=="symbol"?ye(this[t]):this[t]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=Mr(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let t="";const r=[t];for(const i of this)t=wu(t,i),r.push(t);return this.cache.stringifyAncestors=r}}class $v{constructor(n){y(this,"chars");y(this,"i");y(this,"def");this.def=n,this.chars=[...n],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(n){let t="";for(;this.lookahead;){if(n(this,t))if(t[t.length-1]===_o)t=t.slice(0,-1);else break;t+=this.shift()}return t}shiftUntilLookahead(n){return typeof n=="string"?this.shiftUntil(t=>t.lookahead===n):this.shiftUntil(t=>t.lookahead in n)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in ki))}jumpToIndex(n){this.i=n<0?this.length+n:n}jumpForward(n){this.i+=n}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(n,t){return this.chars.slice(n,t).join("")}lookaheadIs(n){return this.lookahead===n}lookaheadIsIn(n){return this.lookahead in n}}let Mo="$ark",kv=2;for(;Mo in globalThis;)Mo=`$ark${kv++}`;const $u=Mo;globalThis[$u]=Sr;const P=Sr,Cv=e=>`${$u}.${e}`,Ye=e=>Cv(ko(e));class ku extends cu{constructor(...t){super();y(this,"argNames");y(this,"body","");y(this,"indentation",0);this.argNames=t;for(const r of t){if(r in this)throw new Error(`Arg name '${r}' would overwrite an existing property on FunctionBody`);this[r]=r}}indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(t,r=!1){return Cu(t,r)}index(t,r=!1){return Mu(`${t}`,r)}line(t){return this.body+=`${" ".repeat(this.indentation)}${t}
`,this}const(t,r){return this.line(`const ${t} = ${r}`),this}let(t,r){return this.line(`let ${t} = ${r}`)}set(t,r){return this.line(`${t} = ${r}`)}if(t,r){return this.block(`if (${t})`,r)}elseIf(t,r){return this.block(`else if (${t})`,r)}else(t){return this.block("else",t)}for(t,r,i=0){return this.block(`for (let i = ${i}; ${t}; i++)`,r)}forIn(t,r){return this.block(`for (const k in ${t})`,r)}block(t,r,i=""){return this.line(`${t} {`),this.indent(),r(this),this.dedent(),this.line(`}${i}`)}return(t=""){return this.line(`return ${t}`)}write(t="anonymous",r=0){return`${t}(${this.argNames.join(", ")}) { ${r?this.body.split(`
`).map(i=>" ".repeat(r)+`${i}`).join(`
`):this.body} }`}compile(){return new Zy(...this.argNames,this.body)}}const Er=e=>dn(e,"object")||typeof e=="symbol"?Ye(e):Co(e),Cu=(e,n=!1)=>typeof e=="string"&&$r(e)?`${n?"?":""}.${e}`:Mu(Mv(e),n),Mv=e=>typeof e=="symbol"?Ye(e):JSON.stringify(e),Mu=(e,n=!1)=>`${n?"?.":""}[${e}]`;class Eo extends ku{constructor(t){super("data","ctx");y(this,"traversalKind");y(this,"optimistic");this.traversalKind=t.kind,this.optimistic=t.optimistic===!0}invoke(t,r){const i=(r==null?void 0:r.arg)??this.data,s=typeof t=="string"?!0:this.requiresContextFor(t),o=typeof t=="string"?t:t.id;return s?`${this.referenceToId(o,r)}(${i}, ${this.ctx})`:`${this.referenceToId(o,r)}(${i})`}referenceToId(t,r){const i=(r==null?void 0:r.kind)??this.traversalKind,s=`this.${t}${i}`;return r!=null&&r.bind?`${s}.bind(${r==null?void 0:r.bind})`:s}requiresContextFor(t){return this.traversalKind==="Apply"||t.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(t,r,i){const s=this.requiresContextFor(i);return s&&this.line(`${this.ctx}.path.push(${t})`),this.check(i,{arg:r}),s&&this.line(`${this.ctx}.path.pop()`),this}check(t,r){return this.traversalKind==="Allows"?this.if(`!${this.invoke(t,r)}`,()=>this.return(!1)):this.line(this.invoke(t,r))}}const Eu=e=>xe(e,(n,t)=>[n,We(t)?[...t]:t]),Vt=au("arkKind"),H=(e,n)=>(e==null?void 0:e[Vt])===n,Ze=e=>H(e,"root")||H(e,"constraint"),Ev=["unit","proto","domain"],Ei=["required","optional","index","sequence"],Ou=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Oo=[...Ou,...Ei,"structure","predicate"],Oi=["alias","union","morph","unit","intersection","proto","domain"],Ov=[...Oi,...Oo],Iu=xe(Oo,(e,n)=>[n,1]),Iv=xe([...Ei,"undeclared"],(e,n)=>[n,1]),Au=xe(Ov,(e,n)=>[n,e]),Ii=e=>typeof e=="string"&&e in Au,Ai=e=>Au[e],Io=e=>Oi.slice(Ai(e)+1);[...Io("union")],[...Io("morph")];const hn=e=>typeof e=="string"||typeof e=="boolean"||e===null?e:typeof e=="number"?Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e:Er(e),Ti=e=>{let n="{ ";for(const[t,r]of Object.entries(e))n+=`${t}: ${Er(r)}, `;return n+" }"},Ee=e=>{var t,r,i,s;const n=e;return n.hasAssociatedError&&((t=n.defaults).expected??(t.expected=o=>"description"in o?o.description:n.defaults.description(o)),(r=n.defaults).actual??(r.actual=o=>ye(o)),(i=n.defaults).problem??(i.problem=o=>`must be ${o.expected}${o.actual?` (was ${o.actual})`:""}`),(s=n.defaults).message??(s.message=o=>{if(o.path.length===0)return o.problem;const a=`${o.propString} ${o.problem}`;return a[0]==="["?`value at ${a}`:a})),n};class Av extends Error{constructor(t,r){super(ye(r,{quoteKeys:!1,indent:4}));y(this,"name","ToJsonSchemaError");y(this,"code");y(this,"context");this.code=t,this.context=r}hasCode(t){return this.code===t}}const Ne={Error:Av,throw:(...e)=>{throw new Ne.Error(...e)},throwInternalOperandError:(e,n)=>Ae(`Unexpected JSON Schema input for ${e}: ${ye(n)}`),defaultConfig:{dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:e=>Ne.throw("arrayObject",e),arrayPostfix:e=>Ne.throw("arrayPostfix",e),defaultValue:e=>Ne.throw("defaultValue",e),domain:e=>Ne.throw("domain",e),morph:e=>Ne.throw("morph",e),patternIntersection:e=>Ne.throw("patternIntersection",e),predicate:e=>Ne.throw("predicate",e),proto:e=>Ne.throw("proto",e),symbolKey:e=>Ne.throw("symbolKey",e),unit:e=>Ne.throw("unit",e),date:e=>Ne.throw("date",e)}}};P.config??(P.config={});const Ao=(e,n)=>{if(!n)return e;const t={...e};let r;for(r in n){const i={...e.keywords};if(r==="keywords"){for(const s in n[r]){const o=n.keywords[s];o!==void 0&&(i[s]=typeof o=="string"?{description:o}:o)}t.keywords=i}else r==="toJsonSchema"?t[r]=Tu(e.toJsonSchema,n.toJsonSchema):Ii(r)?t[r]={...e[r],...n[r]}:t[r]=n[r]}return t},Tu=(e,n)=>{if(!e)return n??{};if(!n)return e;const t={...e};let r;for(r in n)r==="fallback"?t.fallback=Tv(e.fallback,n.fallback):t[r]=n[r];return t},Tv=(e,n)=>{e=Ru(e),n=Ru(n);const t={};let r;for(r in Ne.defaultConfig.fallback)t[r]=n[r]??n.default??e[r]??e.default??Ne.defaultConfig.fallback[r];return t},Ru=e=>typeof e=="function"?{default:e}:e??{};class zn extends(Vf=cu,Df=Vt,Vf){constructor({prefixPath:t,relativePath:r,...i},s){super();y(this,Df,"error");y(this,"path");y(this,"data");y(this,"nodeConfig");y(this,"input");y(this,"ctx");this.input=i,this.ctx=s,Uy(this,i);const o=s.data;i.code==="union"&&(i.errors=i.errors.flatMap(c=>{const l=c.hasCode("union")?c.errors:[c];return!t&&!r?l:l.map(u=>u.transform(d=>({...d,path:Py(t,d.path,r)})))})),this.nodeConfig=s.config[this.code];const a=[...i.path??s.path];r&&a.push(...r),t&&a.unshift(...t),this.path=new Su(...a),this.data="data"in i?i.data:o}transform(t){return new zn(t({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(t){return this.code===t}get propString(){return Mr(this.path)}get expected(){var r;if(this.input.expected)return this.input.expected;const t=((r=this.meta)==null?void 0:r.expected)??this.nodeConfig.expected;return typeof t=="function"?t(this.input):t}get actual(){var r;if(this.input.actual)return this.input.actual;const t=((r=this.meta)==null?void 0:r.actual)??this.nodeConfig.actual;return typeof t=="function"?t(this.data):t}get problem(){var r;if(this.input.problem)return this.input.problem;const t=((r=this.meta)==null?void 0:r.problem)??this.nodeConfig.problem;return typeof t=="function"?t(this):t}get message(){var r;if(this.input.message)return this.input.message;const t=((r=this.meta)==null?void 0:r.message)??this.nodeConfig.message;return typeof t=="function"?t(this):t}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class Jt extends(Lf=ou,Ff=Vt,Lf){constructor(t){super();y(this,Ff,"errors");y(this,"ctx");y(this,"byPath",Object.create(null));y(this,"byAncestorPath",Object.create(null));y(this,"count",0);y(this,"mutable",this);this.ctx=t}get flatByPath(){return xe(this.byPath,(t,r)=>[t,r.flat])}get flatProblemsByPath(){return xe(this.byPath,(t,r)=>[t,r.flat.map(i=>i.problem)])}throw(){throw this.toTraversalError()}toTraversalError(){return new Rv(this)}add(t){this.includes(t)||this._add(t)}transform(t){const r=new Jt(this.ctx);for(const i of this)r.add(t(i));return r}merge(t){for(const r of t)this.includes(r)||this._add(new zn({...r,path:[...this.ctx.path,...r.path]},this.ctx))}affectsPath(t){return this.length===0?!1:t.stringifyAncestors().some(r=>r in this.byPath)||t.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(t=>t.toJSON())]}toString(){return this.join(`
`)}_add(t){const r=this.byPath[t.propString];if(r){if(r.hasCode("union")&&r.errors.length===0)return;const i=t.hasCode("union")&&t.errors.length===0?t:new zn({code:"intersection",errors:r.hasCode("intersection")?[...r.errors,t]:[r,t]},this.ctx),s=this.indexOf(r);this.mutable[s===-1?this.length:s]=i,this.byPath[t.propString]=i,this.addAncestorPaths(t)}else this.byPath[t.propString]=t,this.addAncestorPaths(t),this.mutable.push(t);this.count++}addAncestorPaths(t){for(const r of t.path.stringifyAncestors())this.byAncestorPath[r]=_e(this.byAncestorPath[r],t)}}class Rv extends Error{constructor(t){var n=(...YS)=>(super(...YS),y(this,"name","TraversalError"),this);t.length===1?n(t.summary):n(`
`+t.map(r=>`  • ${Nv(r)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:t,enumerable:!1})}}const Nv=e=>e.toString().split(`
`).join(`
  `);class Bn{constructor(n,t){y(this,"path",[]);y(this,"errors",new Jt(this));y(this,"root");y(this,"config");y(this,"queuedMorphs",[]);y(this,"branches",[]);y(this,"seen",{});this.root=n,this.config=t}get data(){let n=this.root;for(const t of this.path)n=n==null?void 0:n[t];return n}get propString(){return Mr(this.path)}reject(n){return this.error(n),!1}mustBe(n){return this.error(n),!1}error(n){const t=typeof n=="object"?n.code?n:{...n,code:"predicate"}:{code:"predicate",expected:n};return this.errorFromContext(t)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(n){const t={path:new Su(...this.path),morphs:n};this.currentBranch?this.currentBranch.queuedMorphs.push(t):this.queuedMorphs.push(t)}finalize(n){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?n?n(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(n){return this.errorFromContext(n)}errorFromContext(n){const t=new zn(n,this);return this.currentBranch?this.currentBranch.error=t:this.errors.add(t),t}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const n=this.queuedMorphs;this.queuedMorphs=[];for(const{path:t,morphs:r}of n)this.errors.affectsPath(t)||this.applyMorphsAtPath(t,r)}}applyMorphsAtPath(n,t){const r=n.at(-1);let i;if(r!==void 0){i=this.root;for(let s=0;s<n.length-1;s++)i=i[n[s]]}this.path=[...n];for(const s of t){const o=Ze(s),a=s(i===void 0?this.root:i[r],this);if(a instanceof zn){this.errors.add(a);break}if(a instanceof Jt){o||this.errors.merge(a);break}i===void 0?this.root=a:i[r]=a,this.applyQueuedMorphs()}}}const Ft=(e,n,t)=>{if(!t)return n();t.path.push(e);const r=n();return t.path.pop(),r};class Nu extends Fn{constructor(t,r){var s;super((o,a,c=this.onFail)=>a?(this.traverseApply(o,a),a.hasError()?a.errors:a.data):this.rootApply(o,c),{attach:t});y(this,"attachments");y(this,"$");y(this,"onFail");y(this,"includesTransform");y(this,"includesContextualPredicate");y(this,"isCyclic");y(this,"allowsRequiresContext");y(this,"rootApplyStrategy");y(this,"contextFreeMorph");y(this,"rootApply");y(this,"referencesById");y(this,"shallowReferences");y(this,"flatRefs");y(this,"flatMorphs");y(this,"allows");y(this,"compiledMeta",Vv(this.metaJson));y(this,"precedence",Ai(this.kind));y(this,"precompilation");y(this,"assert",(t,r)=>this(t,r,i=>i.throw()));this.attachments=t,this.$=r,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((o,a)=>Fv(o,a.shallowReferences),[this]);const i=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let o=0;o<this.children.length;o++){if(this.includesTransform||(this.includesTransform=this.children[o].includesTransform),this.includesContextualPredicate||(this.includesContextualPredicate=this.children[o].includesContextualPredicate),this.isCyclic||(this.isCyclic=this.children[o].isCyclic),!i){const a=this.children[o].flatRefs;for(let c=0;c<a.length;c++){const l=a[c];if(!this.flatRefs.some(u=>Du(u,l))){this.flatRefs.push(l);for(const u of l.node.branches)(u.hasKind("morph")||u.hasKind("intersection")&&((s=u.structure)==null?void 0:s.structuralMorph)!==void 0)&&this.flatMorphs.push({path:l.path,propString:l.propString,node:u})}}}Object.assign(this.referencesById,this.children[o].referencesById)}this.flatRefs.sort((o,a)=>o.path.length>a.path.length?1:o.path.length<a.path.length?-1:o.propString>a.propString?1:o.propString<a.propString||o.node.expression<a.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(o=>o.length===1||o.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(o=>o.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?o=>this.traverseAllows(o,new Bn(o,this.$.resolvedConfig)):o=>this.traverseAllows(o)}get shallowMorphs(){return[]}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(r,i)=>{if(this.allows(r))return r;const s=new Bn(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"contextual":return(r,i)=>{const s=new Bn(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const t=this.$.resolvedConfig.clone;return(r,i)=>{if(this.allows(r))return this.contextFreeMorph(t&&(typeof r=="object"&&r!==null||typeof r=="function")?t(r):r);const s=new Bn(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,Ae(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get description(){var t;return this.cacheGetter("description",((t=this.meta)==null?void 0:t.description)??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}traverse(t,r){return this(t,r,null)}get in(){return this.cacheGetter("in",this.getIo("in"))}get out(){return this.cacheGetter("out",this.getIo("out"))}getIo(t){if(!this.includesTransform)return this;const r={};for(const[i,s]of this.innerEntries){const o=this.impl.keys[i];if(o.reduceIo)o.reduceIo(t,r,s);else if(o.child){const a=s;r[i]=We(a)?a.map(c=>c[t]):a[t]}else r[i]=s}return this.$.node(this.kind,r)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(t){const r=Ze(t)?t:this.$.parseDefinition(t);return this.innerHash===r.innerHash}ifEquals(t){return this.equals(t)?this:void 0}hasKind(t){return this.kind===t}assertHasKind(t){return this.kind!==t&&Dn(`${this.kind} node was not of asserted kind ${t}`),this}hasKindIn(...t){return t.includes(this.kind)}assertHasKindIn(...t){return ln(t,this.kind)||Dn(`${this.kind} node was not one of asserted kinds ${t}`),this}isBasis(){return ln(Ev,this.kind)}isConstraint(){return ln(Oo,this.kind)}isStructural(){return ln(Ei,this.kind)}isRefinement(){return ln(Ou,this.kind)}isRoot(){return ln(Oi,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(t){return this.hasKind("unit")&&this.allows(t)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(t){const r=Or.normalize(t);return this._select(r)}_select(t){let r=Or.applyBoundary[t.boundary??"references"](this);return t.kind&&(r=r.filter(i=>i.kind===t.kind)),t.where&&(r=r.filter(t.where)),Or.applyMethod[t.method??"filter"](r,this,t)}transform(t,r){return this._transform(t,this._createTransformContext(r))}_createTransformContext(t){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:(t==null?void 0:t.prereduced)??!1},undeclaredKeyHandling:void 0,...t}}_transform(t,r){var d;const i=r.bindScope??this.$;if(r.seen[this.id])return this.$.lazilyResolve(r.seen[this.id]);if(((d=r.shouldTransform)==null?void 0:d.call(r,this,r))===!1)return this;let s;r.seen[this.id]=()=>s,this.hasKind("structure")&&this.undeclared!==r.undeclaredKeyHandling&&(r={...r,undeclaredKeyHandling:this.undeclared});const o=xe(this.inner,(h,f)=>{if(!this.impl.keys[h].child)return[h,f];const p=f;if(!We(p)){const v=p._transform(t,r);return v?[h,v]:[]}if(p.length===0)return[h,f];const g=p.flatMap(v=>v._transform(t,r)??[]);return g.length?[h,g]:[]});delete r.seen[this.id];const a=Object.assign(o,{meta:this.meta}),c=r.selected&&!r.selected.includes(this)?a:t(this.kind,a,r);if(c===null)return null;if(Ze(c))return s=c;const l=Object.keys(c);return(l.length===0||l.length===1&&l[0]==="meta")&&!wr(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in c)?r.undeclaredKeyHandling?{...c,value:P.intrinsic.unknown}:null:(this.kind==="morph"&&(c.in??(c.in=P.intrinsic.unknown)),s=i.node(this.kind,c,r.parseOptions))}configureReferences(t,r="references"){const i=Or.normalize(r),s=typeof t=="string"?(l,u)=>({...u,meta:{...u.meta,description:t}}):typeof t=="function"?(l,u)=>({...u,meta:t(u.meta)}):(l,u)=>({...u,meta:{...u.meta,...t}});if(i.boundary==="self")return this.$.node(this.kind,s(this.kind,{...this.inner,meta:this.meta}));const o=this._select(i),a=o&&xr(o),c=i.boundary==="child"?(l,u)=>u.root.children.includes(l):i.boundary==="shallow"?l=>l.kind!=="structure":()=>!0;return this.$.finalize(this.transform(s,{shouldTransform:c,selected:a}))}}const Or={applyBoundary:{self:e=>[e],child:e=>[...e.children],shallow:e=>[...e.shallowReferences],references:e=>[...e.references]},applyMethod:{filter:e=>e,assertFilter:(e,n,t)=>(e.length===0&&Dn(Pu(n,t)),e),find:e=>e[0],assertFind:(e,n,t)=>(e.length===0&&Dn(Pu(n,t)),e[0])},normalize:e=>typeof e=="function"?{boundary:"references",method:"filter",where:e}:typeof e=="string"?kt(e,Or.applyBoundary)?{method:"filter",boundary:e}:{boundary:"references",method:"filter",kind:e}:{boundary:"references",method:"filter",...e}},Pu=(e,n)=>`${e} had no references matching ${ye(n)}.`,Pv=e=>Mr(e,{stringifyNonKey:n=>n.expression}),Dv=/"(\$ark\.[^"]+)"/g,Vv=e=>JSON.stringify(e).replaceAll(Dv,"$1"),Yt=(e,n)=>({path:e,node:n,propString:Pv(e)}),Du=(e,n)=>e.propString===n.propString&&e.node.equals(n.node),Vu=(e,n)=>un(e,n,{isEqual:Du}),Fv=(e,n)=>un(e,n,{isEqual:(t,r)=>t.equals(r)});class z extends Array{static init(n,t,r,i){return new z({kind:n,l:t,r,path:(i==null?void 0:i.path)??[],optional:(i==null?void 0:i.optional)??!1})}add(n,t,r,i){return this.push({kind:n,l:t,r,path:(i==null?void 0:i.path)??[],optional:(i==null?void 0:i.optional)??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:n,l:t,r}=this[0],i=Mr(n);return Lu(`Intersection${i&&` at ${i}`} of ${Fu(t,r)}`)}return`The following intersections result in unsatisfiable types:
• ${this.map(({path:n,l:t,r})=>`${n}: ${Fu(t,r)}`).join(`
• `)}`}throw(){return R(this.describeReasons())}invert(){const n=this.map(t=>({...t,l:t.r,r:t.l}));return n instanceof z?n:new z(...n)}withPrefixKey(n,t){return this.map(r=>({...r,path:[n,...r.path],optional:r.optional||t==="optional"}))}toNeverIfDisjoint(){return P.intrinsic.never}}const Fu=(e,n)=>`${To(e)} and ${To(n)}`,To=e=>Ze(e)?e.expression:We(e)?e.map(To).join(" | ")||"never":String(e),Lu=e=>`${e} results in an unsatisfiable type`,jn={},Lt=(e,n,t)=>De(e,n,{$:t,invert:!1,pipe:!1}),Ro=(e,n,t)=>De(e,n,{$:t,invert:!1,pipe:!0}),De=(e,n,t)=>{const r=t.pipe?"|>":"&",i=`${e.hash}${r}${n.hash}`;if(jn[i]!==void 0)return jn[i];if(!t.pipe){const a=`${n.hash}${r}${e.hash}`;if(jn[a]!==void 0){const c=jn[a],l=c instanceof z?c.invert():c;return jn[i]=l,l}}const s=!t.pipe||!e.includesTransform&&!n.includesTransform;if(s&&e.equals(n))return e;let o=s?No(e,n,t):e.hasKindIn(...Oi)?Lv(e,n,t):No(e,n,t);return Ze(o)&&(e.equals(o)?o=e:n.equals(o)&&(o=n)),jn[i]=o,o},No=(e,n,t)=>{const r=e.precedence<n.precedence?e.kind:n.kind,i=e.impl.intersections[n.kind]??n.impl.intersections[e.kind];if(i===void 0)return null;if(r===e.kind)return i(e,n,t);{let s=i(n,e,{...t,invert:!t.invert});return s instanceof z&&(s=s.invert()),s}},Lv=(e,n,t)=>e.includesTransform||n.includesTransform?t.invert?zu(n,e,t):zu(e,n,t):No(e,n,t),zu=(e,n,t)=>e.distribute(r=>zv(r,n,t),r=>{const i=r.filter(Ze);if(i.length===0)return z.init("union",e.branches,n.branches);if(i.length<e.branches.length||!e.branches.every((o,a)=>o.in.equals(i[a].in)))return t.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return t.$.parseSchema(s)}),zv=(e,n,t)=>{if(e.hasKind("morph")){const i=[...e.morphs];if(e.lastMorphIfNode){const s=De(e.lastMorphIfNode,n,t);if(s instanceof z)return s;i[i.length-1]=s}else i.push(n);return t.$.node("morph",{morphs:i,in:e.inner.in})}if(n.hasKind("morph")){const i=De(e,n.in,t);return i instanceof z?i:t.$.node("morph",{morphs:[n],in:i})}return t.$.node("morph",{morphs:[n],in:e})};class qn extends Nu{constructor(t,r){super(t,r);y(this,"impliedSiblings");Object.defineProperty(this,Vt,{value:"constraint",enumerable:!1})}intersect(t){return Lt(this,t,this.$)}}class Ri extends qn{constructor(){super(...arguments);y(this,"traverseApply",(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)})}compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`${t.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Ti(this.errorContext)}}const rt=e=>(n,t)=>{if(We(n)){if(n.length===0)return;const i=n.map(s=>t.$.node(e,s));return e==="predicate"?i:i.sort((s,o)=>s.hash<o.hash?-1:1)}const r=t.$.node(e,n);return r.hasOpenIntersection()?[r]:r},Ni=e=>{const n=e.r.shift();if(!n){let r=e.l.length===0&&e.kind==="structure"?P.intrinsic.unknown.internal:e.ctx.$.node(e.kind,Object.assign(e.baseInner,Bv(e.l)),{prereduced:!0});for(const i of e.roots){if(r instanceof z)return r;r=De(i,r,e.ctx)}return r}let t=!1;for(let r=0;r<e.l.length;r++){const i=De(e.l[r],n,e.ctx);if(i!==null){if(i instanceof z)return i;if(t){if(!e.l.includes(i))return Ae(`Unexpectedly encountered multiple distinct intersection results for refinement ${i}`)}else{if(i.isRoot())return e.roots.push(i),e.l.splice(r),Ni(e);e.l[r]=i,t=!0}}}if(t||e.l.push(n),e.kind==="intersection"&&n.impliedSiblings)for(const r of n.impliedSiblings)un(e.r,r);return Ni(e)},Pi=e=>Object.entries(e).flatMap(([t,r])=>t in Iu?r:[]).sort((t,r)=>t.precedence<r.precedence?-1:t.precedence>r.precedence?1:t.kind==="predicate"&&r.kind==="predicate"?0:t.hash<r.hash?-1:1),Bv=e=>{const n={};for(const t of e)if(t.hasOpenIntersection())n[t.kind]=_e(n[t.kind],t);else{if(n[t.kind])return Ae(`Unexpected intersection of closed refinements of kind ${t.kind}`);n[t.kind]=t}return n},jv=(...e)=>R(qv(...e)),qv=(e,n,t)=>{const r=t.hasKind("morph")?"a morph":t.isUnknown()?"unknown":t.exclude(n).defaultShortDescription;return`${nv(e)} operand must be ${n.description} (was ${r})`},Uv=(e,n,t)=>new Di(e,n,t,t,null);class Bu extends Fn{}class Di extends(Bf=Fn,zf=Vt,Bf){constructor(t,r,i,s,o){super((...a)=>{const c=xe(this.names,(l,u)=>{const d=this.arg$.parse(a[l]);return d.extends(this.constraints[l])||R(Kv(u,this.constraints[l].expression,d.expression)),[u,d]});if(this.defIsLazy()){const l=this.bodyDef(c);return this.$.parse(l)}return this.$.parse(r,{args:c})});y(this,zf,"generic");y(this,"paramDefs");y(this,"bodyDef");y(this,"$");y(this,"arg$");y(this,"baseInstantiation");y(this,"hkt");y(this,"description");this.paramDefs=t,this.bodyDef=r,this.$=i,this.arg$=s,this.hkt=o,this.description=o?new o().description??`a generic type for ${o.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof Bu}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get json(){return this.cacheGetter("json",{params:this.params.map(t=>t[1].isUnknown()?t[0]:[t[0],t[1].json]),body:_v(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(t=>typeof t=="string"?[t,P.intrinsic.unknown]:[t[0],this.$.parse(t[1])]))}get names(){return this.cacheGetter("names",this.params.map(t=>t[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(t=>t[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const Kv=(e,n,t)=>`${e} must be assignable to ${n} (was ${t})`,Wv=Ee({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:e=>typeof e=="function"?{predicate:e}:e,defaults:{description:e=>`valid according to ${e.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class Hv extends qn{constructor(){super(...arguments);y(this,"serializedPredicate",Ye(this.predicate));y(this,"compiledCondition",`${this.serializedPredicate}(data, ctx)`);y(this,"compiledNegation",`!${this.compiledCondition}`);y(this,"impliedBasis",null);y(this,"expression",this.serializedPredicate);y(this,"traverseAllows",this.predicate);y(this,"errorContext",{code:"predicate",description:this.description,meta:this.meta});y(this,"compiledErrorContext",Ti(this.errorContext));y(this,"traverseApply",(t,r)=>{!this.predicate(t,r.external)&&!r.hasError()&&r.errorFromNodeContext(this.errorContext)})}compile(t){if(t.traversalKind==="Allows"){t.return(this.compiledCondition);return}t.if(`${this.compiledNegation} && !ctx.hasError()`,()=>t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(t,r){return r.fallback.predicate({code:"predicate",base:t,predicate:this.predicate})}}const ju={implementation:Wv,Node:Hv},Gv=Ee({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:e=>Number.isInteger(e)?e:R(Yv(e))}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>e.rule===1?"an integer":e.rule===2?"even":`a multiple of ${e.rule}`},intersections:{divisor:(e,n,t)=>t.$.node("divisor",{rule:Math.abs(e.rule*n.rule/Zv(e.rule,n.rule))})},obviatesBasisDescription:!0});class Jv extends Ri{constructor(){super(...arguments);y(this,"traverseAllows",t=>t%this.rule===0);y(this,"compiledCondition",`data % ${this.rule} === 0`);y(this,"compiledNegation",`data % ${this.rule} !== 0`);y(this,"impliedBasis",P.intrinsic.number.internal);y(this,"expression",`% ${this.rule}`)}reduceJsonSchema(t){return t.type="integer",this.rule===1||(t.multipleOf=this.rule),t}}const qu={implementation:Gv,Node:Jv},Yv=e=>`divisor must be an integer (was ${e})`,Zv=(e,n)=>{let t,r=e,i=n;for(;i!==0;)t=i,i=r%i,r=t;return r};class Un extends Ri{constructor(){super(...arguments);y(this,"boundOperandKind",tb[this.kind]);y(this,"compiledActual",this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()");y(this,"comparator",nb(this.kind,this.exclusive));y(this,"numericLimit",this.rule.valueOf());y(this,"expression",`${this.comparator} ${this.rule}`);y(this,"compiledCondition",`${this.compiledActual} ${this.comparator} ${this.numericLimit}`);y(this,"compiledNegation",`${this.compiledActual} ${Xv[this.comparator]} ${this.numericLimit}`);y(this,"stringLimit",this.boundOperandKind==="date"?rb(this.numericLimit):`${this.numericLimit}`);y(this,"limitKind",this.comparator[0]==="<"?"upper":"lower")}isStricterThan(t){return(this.limitKind==="upper"?this.numericLimit<t.numericLimit:this.numericLimit>t.numericLimit)||this.numericLimit===t.numericLimit&&this.exclusive===!0&&!t.exclusive}overlapsRange(t){return!(this.isStricterThan(t)||this.numericLimit===t.numericLimit&&(this.exclusive||t.exclusive))}overlapIsUnit(t){return this.numericLimit===t.numericLimit&&!this.exclusive&&!t.exclusive}}const Xv={"<":">=","<=":">",">":"<=",">=":"<"},Qv={min:"max",minLength:"maxLength",after:"before"},Uu={parse:e=>e||void 0},Ku=e=>n=>{if(typeof n=="number")return{rule:n};const{exclusive:t,...r}=n;return t?{...r,rule:e==="minLength"?r.rule+1:r.rule-1}:r},Wu=e=>n=>{if(typeof n=="number"||typeof n=="string"||n instanceof Date)return{rule:n};const{exclusive:t,...r}=n;if(!t)return r;const i=typeof r.rule=="number"?r.rule:typeof r.rule=="string"?new Date(r.rule).valueOf():r.rule.valueOf();return t?{...r,rule:e==="after"?i+1:i-1}:r},Hu=e=>typeof e=="string"||typeof e=="number"?new Date(e):e,eb=(e,n)=>`${e} bound must be a positive integer (was ${n})`,Po=e=>n=>((!Number.isInteger(n)||n<0)&&R(eb(e,n)),n),tb={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},nb=(e,n)=>`${kt(e,Qv)?">":"<"}${n?"":"="}`,rb=e=>typeof e=="string"?e:new Date(e).toLocaleString(),ib=e=>`Bounded expression ${e} must be exactly one of number, string, Array, or Date`,sb=Ee({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Hu,serialize:e=>e.toISOString()}},normalize:Wu("after"),defaults:{description:e=>`${e.collapsibleLimitString} or later`,actual:Cr},intersections:{after:(e,n)=>e.isStricterThan(n)?e:n}});class ob extends Un{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.Date.internal);y(this,"collapsibleLimitString",Cr(this.rule));y(this,"traverseAllows",t=>t>=this.rule)}reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,after:this.rule})}}const Gu={implementation:sb,Node:ob},ab=Ee({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Hu,serialize:e=>e.toISOString()}},normalize:Wu("before"),defaults:{description:e=>`${e.collapsibleLimitString} or earlier`,actual:Cr},intersections:{before:(e,n)=>e.isStricterThan(n)?e:n,after:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("unit",{unit:e.rule}):null:z.init("range",e,n)}});class lb extends Un{constructor(){super(...arguments);y(this,"collapsibleLimitString",Cr(this.rule));y(this,"traverseAllows",t=>t<=this.rule);y(this,"impliedBasis",P.intrinsic.Date.internal)}reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,before:this.rule})}}const Ju={implementation:ab,Node:lb},cb=Ee({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:Po("exactLength")}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>`exactly length ${e.rule}`,actual:e=>`${e.length}`},intersections:{exactLength:(e,n,t)=>z.init("unit",t.$.node("unit",{unit:e.rule}),t.$.node("unit",{unit:n.rule}),{path:["length"]}),minLength:(e,n)=>e.rule>=n.rule?e:z.init("range",e,n),maxLength:(e,n)=>e.rule<=n.rule?e:z.init("range",e,n)}});class ub extends Ri{constructor(){super(...arguments);y(this,"traverseAllows",t=>t.length===this.rule);y(this,"compiledCondition",`data.length === ${this.rule}`);y(this,"compiledNegation",`data.length !== ${this.rule}`);y(this,"impliedBasis",P.intrinsic.lengthBoundable.internal);y(this,"expression",`== ${this.rule}`)}reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t.maxLength=this.rule,t;case"array":return t.minItems=this.rule,t.maxItems=this.rule,t;default:return Ne.throwInternalOperandError("exactLength",t)}}}const Yu={implementation:cb,Node:ub},db=Ee({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Uu},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"negative":"non-positive":`${e.exclusive?"less than":"at most"} ${e.rule}`},intersections:{max:(e,n)=>e.isStricterThan(n)?e:n,min:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("unit",{unit:e.rule}):null:z.init("range",e,n)},obviatesBasisDescription:!0});class hb extends Un{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.number.internal);y(this,"traverseAllows",this.exclusive?t=>t<this.rule:t=>t<=this.rule)}reduceJsonSchema(t){return this.exclusive?t.exclusiveMaximum=this.rule:t.maximum=this.rule,t}}const Zu={implementation:db,Node:hb},fb=Ee({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Po("maxLength")}},reduce:(e,n)=>e.rule===0?n.node("exactLength",e):void 0,normalize:Ku("maxLength"),defaults:{description:e=>`at most length ${e.rule}`,actual:e=>`${e.length}`},intersections:{maxLength:(e,n)=>e.isStricterThan(n)?e:n,minLength:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("exactLength",{rule:e.rule}):null:z.init("range",e,n)}});class pb extends Un{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.lengthBoundable.internal);y(this,"traverseAllows",t=>t.length<=this.rule)}reduceJsonSchema(t){switch(t.type){case"string":return t.maxLength=this.rule,t;case"array":return t.maxItems=this.rule,t;default:return Ne.throwInternalOperandError("maxLength",t)}}}const Xu={implementation:fb,Node:pb},mb=Ee({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Uu},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"positive":"non-negative":`${e.exclusive?"more than":"at least"} ${e.rule}`},intersections:{min:(e,n)=>e.isStricterThan(n)?e:n},obviatesBasisDescription:!0});class gb extends Un{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.number.internal);y(this,"traverseAllows",this.exclusive?t=>t>this.rule:t=>t>=this.rule)}reduceJsonSchema(t){return this.exclusive?t.exclusiveMinimum=this.rule:t.minimum=this.rule,t}}const Qu={implementation:mb,Node:gb},yb=Ee({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Po("minLength")}},reduce:e=>e.rule===0?P.intrinsic.unknown:void 0,normalize:Ku("minLength"),defaults:{description:e=>e.rule===1?"non-empty":`at least length ${e.rule}`,actual:e=>e.length===0?"":`${e.length}`},intersections:{minLength:(e,n)=>e.isStricterThan(n)?e:n}});class vb extends Un{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.lengthBoundable.internal);y(this,"traverseAllows",t=>t.length>=this.rule)}reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t;case"array":return t.minItems=this.rule,t;default:return Ne.throwInternalOperandError("minLength",t)}}}const ed={implementation:yb,Node:vb},bb={min:Qu.implementation,max:Zu.implementation,minLength:ed.implementation,maxLength:Xu.implementation,exactLength:Yu.implementation,after:Gu.implementation,before:Ju.implementation},_b={min:Qu.Node,max:Zu.Node,minLength:ed.Node,maxLength:Xu.Node,exactLength:Yu.Node,after:Gu.Node,before:Ju.Node},xb=Ee({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:e=>typeof e=="string"?{rule:e}:e instanceof RegExp?e.flags?{rule:e.source,flags:e.flags}:{rule:e.source}:e,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:e=>`matched by ${e.rule}`},intersections:{pattern:()=>null}});class wb extends Ri{constructor(){super(...arguments);y(this,"instance",new RegExp(this.rule,this.flags));y(this,"expression",`${this.instance}`);y(this,"traverseAllows",this.instance.test.bind(this.instance));y(this,"compiledCondition",`${this.expression}.test(data)`);y(this,"compiledNegation",`!${this.compiledCondition}`);y(this,"impliedBasis",P.intrinsic.string.internal)}reduceJsonSchema(t,r){return t.pattern?r.fallback.patternIntersection({code:"patternIntersection",base:t,pattern:this.rule}):(t.pattern=this.rule,t)}}const td={implementation:xb,Node:wb},Vi=(e,n)=>{const t=Sb(e);return n&&!n.includes(t)?R(`Root of kind ${t} should be one of ${n}`):t},Sb=e=>{if(H(e,"root"))return e.kind;if(typeof e=="string")return e[0]==="$"?"alias":e in Pt?"domain":"proto";if(typeof e=="function")return"proto";if(typeof e!="object"||e===null)return R(nd(e));if("morphs"in e)return"morph";if("branches"in e||We(e))return"union";if("unit"in e)return"unit";if("reference"in e)return"alias";const n=Object.keys(e);return n.length===0||n.some(t=>t in Iu)?"intersection":"proto"in e?"proto":"domain"in e?"domain":R(nd(e))},nd=e=>`${ye(e)} is not a valid type schema`,Fi={},$b=e=>We(e)?e.map(n=>n.collapsibleJson):e.collapsibleJson,ct={};P.nodesByRegisteredId=ct;const rd=e=>(Fi[e]??(Fi[e]=0),`${e}${++Fi[e]}`),id=e=>{var l;const n=ji[e.kind],t=((l=n.applyConfig)==null?void 0:l.call(n,e.def,e.$.resolvedConfig))??e.def,r={},{meta:i,...s}=t,o=i===void 0?{}:typeof i=="string"?{description:i}:i,a=lu(s).sort(([u],[d])=>Ii(u)?Ii(d)?Ai(u)-Ai(d):1:Ii(d)||u<d?-1:1).filter(([u,d])=>{if(u.startsWith("meta.")){const h=u.slice(5);return o[h]=d,!1}return!0});for(const u of a){const d=u[0],h=n.keys[d];if(!h)return R(`Key ${d} is not valid on ${e.kind} schema`);const f=h.parse?h.parse(u[1],e):u[1];f!==Dt&&(f!==void 0||h.preserveUndefined)&&(r[d]=f)}if(n.reduce&&!e.prereduced){const u=n.reduce(r,e.$);if(u)return u instanceof z?u.throw():Cb(u,o)}return Do({id:e.id,kind:e.kind,inner:r,meta:o,$:e.$})},Do=({id:e,kind:n,inner:t,meta:r,$:i,ignoreCache:s})=>{const o=ji[n],a=lu(t),c=[];let l={};for(const[b,_]of a){const $=o.keys[b],k=$.serialize??($.child?$b:hn);if(l[b]=k(_),$.child===!0){const x=_;We(x)?c.push(...x):c.push(x)}else typeof $.child=="function"&&c.push(...$.child(_))}o.finalizeInnerJson&&(l=o.finalizeInnerJson(l));let u={...l},d={};wr(r)||(d=xe(r,(b,_)=>[b,b==="examples"?_:hn(_)]),u.meta=Li(d,"description",!0)),l=Li(l,o.collapsibleKey,!1);const h=JSON.stringify({kind:n,...l});u=Li(u,o.collapsibleKey,!1);const f=Li(u,o.collapsibleKey,!0),p=JSON.stringify({kind:n,...u});if(i.nodesByHash[p]&&!s)return i.nodesByHash[p];const g={id:e,kind:n,impl:o,inner:t,innerEntries:a,innerJson:l,innerHash:h,meta:r,metaJson:d,json:u,hash:p,collapsibleJson:f,children:c};if(n!=="intersection")for(const b in t)b!=="in"&&b!=="out"&&(g[b]=t[b]);const v=new I_[n](g,i);return i.nodesByHash[p]=v},kb=(e,n)=>e.id===n?e:(Ze(ct[n])&&Ae(`Unexpected attempt to overwrite node id ${n}`),Do({id:n,kind:e.kind,inner:e.inner,meta:e.meta,$:e.$,ignoreCache:!0})),Cb=(e,n,t)=>Do({id:rd(n.alias??e.kind),kind:e.kind,inner:e.inner,meta:n,$:e.$}),Li=(e,n,t)=>{const r=Object.keys(e);if(r.length===1&&r[0]===n){const i=e[n];if(t||dn(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return e},Vo=(e,n,t)=>{if(e.key!==n.key)return null;const r=e.key;let i=De(e.value,n.value,t);const s=e.required||n.required?"required":"optional";if(i instanceof z)if(s==="optional")i=P.intrinsic.never.internal;else return i.withPrefixKey(e.key,e.required&&n.required?"required":"optional");if(s==="required")return t.$.node("required",{key:r,value:i});const o=e.hasDefault()?n.hasDefault()?e.default===n.default?e.default:R(od(e.default,n.default)):e.default:n.hasDefault()?n.default:Dt;return t.$.node("optional",{key:r,value:i,default:o})};class sd extends qn{constructor(){super(...arguments);y(this,"required",this.kind==="required");y(this,"optional",this.kind==="optional");y(this,"impliedBasis",P.intrinsic.object.internal);y(this,"serializedKey",Er(this.key));y(this,"compiledKey",typeof this.key=="string"?this.key:this.serializedKey);y(this,"flatRefs",_e(this.value.flatRefs.map(t=>Yt([this.key,...t.path],t.node)),Yt([this.key],this.value)));y(this,"traverseAllows",(t,r)=>this.key in t?Ft(this.key,()=>this.value.traverseAllows(t[this.key],r),r):this.optional);y(this,"traverseApply",(t,r)=>{this.key in t?Ft(this.key,()=>this.value.traverseApply(t[this.key],r),r):this.hasKind("required")&&r.errorFromNodeContext(this.errorContext)})}_transform(t,r){r.path.push(this.key);const i=super._transform(t,r);return r.path.pop(),i}hasDefault(){return"default"in this.inner}compile(t){t.if(`${this.serializedKey} in data`,()=>t.traverseKey(this.serializedKey,`data${t.prop(this.key)}`,this.value)),this.hasKind("required")&&t.else(()=>t.traversalKind==="Apply"?t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):t.return(!1)),t.traversalKind==="Allows"&&t.return(!0)}}const od=(e,n)=>`Invalid intersection of default values ${ye(e)} & ${ye(n)}`,Mb=Ee({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)},default:{preserveUndefined:!0}},normalize:e=>e,reduce:(e,n)=>{if(n.resolvedConfig.exactOptionalPropertyTypes===!1&&!e.value.allows(void 0))return n.node("optional",{...e,value:e.value.or(te.undefined)},{prereduced:!0})},defaults:{description:e=>`${e.compiledKey}?: ${e.value.description}`},intersections:{optional:Vo}});class Eb extends sd{constructor(...t){super(...t);y(this,"expression",this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${ye(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`);y(this,"defaultValueMorph",Ob(this));y(this,"defaultValueMorphRef",this.defaultValueMorph&&Ye(this.defaultValueMorph));"default"in this.inner&&zo(this.value,this.inner.default,this.key)}get outProp(){if(!this.hasDefault())return this;const{default:t,...r}=this.inner;return this.cacheGetter("outProp",this.$.node("required",r,{prereduced:!0}))}}const Fo={implementation:Mb,Node:Eb},Lo={},Ob=e=>{if(!e.hasDefault())return;const n=`{${e.compiledKey}: ${e.value.id} = ${hn(e.default)}}`;return Lo[n]??(Lo[n]=ad(e.key,e.value,e.default))},ad=(e,n,t)=>{if(typeof t=="function")return n.includesTransform?(i,s)=>(Ft(e,()=>n(i[e]=t(),s),s),i):i=>(i[e]=t(),i);const r=n.includesTransform?n.assert(t):t;return dn(r,"object")?(i,s)=>(Ft(e,()=>n(i[e]=t,s),s),i):i=>(i[e]=r,i)},zo=(e,n,t)=>{const r=$i(n);dn(n,"object")&&!r&&R(Ib(t));const i=e.in(r?n():n);if(i instanceof Jt){t===null&&R(`Default ${i.summary}`);const s=i.transform(o=>o.transform(a=>({...a,prefixPath:[t]})));R(`Default for ${s.summary}`)}return n},Ib=e=>`Non-primitive default ${e===null?"":typeof e=="number"?`for value at [${e}] `:`for ${Er(e)} `}must be specified as a function like () => ({my: 'object'})`;class Ir extends Nu{constructor(t,r){super(t,r);y(this,"branches",this.hasKind("union")?this.inner.branches:[this]);y(this,"_keyof");y(this,"pipe",Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)}));Object.defineProperty(this,Vt,{value:"root",enumerable:!1})}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:t=>{const r=this(t);return r instanceof Jt?r:{value:r}}}}as(){return this}brand(t){return t===""?R(Ab):this}readonly(){return this}distribute(t,r){const i=this.branches.map(t);return(r==null?void 0:r(i))??i}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(t={}){const r=Tu(this.$.resolvedConfig.toJsonSchema,t);r.useRefs||(r.useRefs=this.isCyclic);const i=typeof r.dialect=="string"?{$schema:r.dialect}:{};return Object.assign(i,this.toJsonSchemaRecurse(r)),r.useRefs&&(i.$defs=xe(this.references,(s,o)=>o.isRoot()&&!o.alwaysExpandJsonSchema?[o.id,o.toResolvedJsonSchema(r)]:[])),i}toJsonSchemaRecurse(t){return t.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(t)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(t){const r=this.innerToJsonSchema(t);return Object.assign(r,this.metaJson)}intersect(t){const r=this.$.parseDefinition(t),i=this.rawIntersect(r);return i instanceof z?i:this.$.finalize(i)}rawIntersect(t){return Lt(this,t,this.$)}toNeverIfDisjoint(){return this}and(t){const r=this.intersect(t);return r instanceof z?r.throw():r}rawAnd(t){const r=this.rawIntersect(t);return r instanceof z?r.throw():r}or(t){const r=this.$.parseDefinition(t);return this.$.finalize(this.rawOr(r))}rawOr(t){const r=[...this.branches,...t.branches];return this.$.node("union",r)}map(t){return this.$.schema(this.applyStructuralOperation("map",[t]))}pick(...t){return this.$.schema(this.applyStructuralOperation("pick",t))}omit(...t){return this.$.schema(this.applyStructuralOperation("omit",t))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}keyof(){if(this._keyof)return this._keyof;const t=this.applyStructuralOperation("keyof",[]).reduce((r,i)=>r.intersect(i).toNeverIfDisjoint(),P.intrinsic.unknown.internal);return t.branches.length===0&&R(Lu(`keyof ${this.expression}`)),this._keyof=this.$.finalize(t)}get props(){return this.branches.length!==1?R(Tb(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(t){const r=this.$.parseDefinition(t);return this.$.schema(r.distribute(i=>this.applyStructuralOperation("merge",[ld(i)??R(cd("merge",i.expression))])))}applyStructuralOperation(t,r){return this.distribute(i=>{if(i.equals(P.intrinsic.object)&&t!=="merge")return i;const s=ld(i);if(s||R(cd(t,i.expression)),t==="keyof")return s.keyof();if(t==="get")return s.get(...r);if(t==="props")return s.props;const o=t==="required"?"require":t==="partial"?"optionalize":t;return this.$.node("intersection",{...i.inner,structure:s[o](...r)})})}get(...t){return t[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",t))}extract(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(i=>i.extends(r)))}exclude(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(i=>!i.extends(r)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(t){return!(this.intersect(t)instanceof z)}extends(t){const r=this.intersect(t);return!(r instanceof z)&&this.equals(r)}ifExtends(t){return this.extends(t)?this:void 0}subsumes(t){return this.$.parseDefinition(t).extends(this)}configure(t,r="shallow"){return this.configureReferences(t,r)}describe(t,r="shallow"){return this.configure({description:t},r)}optional(){return[this,"?"]}default(t){return zo(this,t,null),[this,"=",t]}from(t){return this.assert(t)}_pipe(...t){const r=t.reduce((i,s)=>i.rawPipeOnce(s),this);return this.$.finalize(r)}tryPipe(...t){const r=t.reduce((i,s)=>i.rawPipeOnce(H(s,"root")?s:(o,a)=>{try{return s(o,a)}catch(c){return a.error({code:"predicate",predicate:s,actual:`aborted due to error:
    ${c}
`})}}),this);return this.$.finalize(r)}to(t){return this.$.finalize(this.toNode(this.$.parseDefinition(t)))}toNode(t){const r=Ro(this,t,this.$);return r instanceof z?r.throw():r}rawPipeOnce(t){return H(t,"root")?this.toNode(t):this.distribute(r=>r.hasKind("morph")?this.$.node("morph",{in:r.inner.in,morphs:[...r.morphs,t]}):this.$.node("morph",{in:r,morphs:[t]}),this.$.parseSchema)}narrow(t){return this.constrainOut("predicate",t)}constrain(t,r){return this._constrain("root",t,r)}constrainIn(t,r){return this._constrain("in",t,r)}constrainOut(t,r){return this._constrain("out",t,r)}_constrain(t,r,i){const s=this.$.node(r,i);if(s.isRoot())return s.isUnknown()?this:Ae(`Unexpected constraint node ${s}`);const o=t==="root"?this:this[t];if(o.hasKind("morph")||s.impliedBasis&&!o.extends(s.impliedBasis))return jv(r,s.impliedBasis,this);const a=this.$.node("intersection",{[s.kind]:s}),c=t==="out"?Ro(this,a,this.$):Lt(this,a,this.$);return c instanceof z&&c.throw(),this.$.finalize(c)}onUndeclaredKey(t){const r=typeof t=="string"?t:t.rule,i=typeof t=="string"?!1:t.deep;return this.$.finalize(this.transform((s,o)=>s==="structure"?r==="ignore"?qy(o,{undeclared:1}):{...o,undeclared:r}:o,i?void 0:{shouldTransform:s=>!ln(Ei,s.kind)}))}hasEqualMorphs(t){return!this.includesTransform&&!t.includesTransform?!0:!(!Pn(this.shallowMorphs,t.shallowMorphs)||!Pn(this.flatMorphs,t.flatMorphs,{isEqual:(r,i)=>{var s,o;return r.propString===i.propString&&(r.node.hasKind("morph")&&i.node.hasKind("morph")?r.node.hasEqualMorphs(i.node):r.node.hasKind("intersection")&&i.node.hasKind("intersection")?((s=r.node.structure)==null?void 0:s.structuralMorphRef)===((o=i.node.structure)==null?void 0:o.structuralMorphRef):!1)}}))}onDeepUndeclaredKey(t){return this.onUndeclaredKey({rule:t,deep:!0})}filter(t){return this.constrainIn("predicate",t)}divisibleBy(t){return this.constrain("divisor",t)}matching(t){return this.constrain("pattern",t)}atLeast(t){return this.constrain("min",t)}atMost(t){return this.constrain("max",t)}moreThan(t){return this.constrain("min",Kn(t))}lessThan(t){return this.constrain("max",Kn(t))}atLeastLength(t){return this.constrain("minLength",t)}atMostLength(t){return this.constrain("maxLength",t)}moreThanLength(t){return this.constrain("minLength",Kn(t))}lessThanLength(t){return this.constrain("maxLength",Kn(t))}exactlyLength(t){return this.constrain("exactLength",t)}atOrAfter(t){return this.constrain("after",t)}atOrBefore(t){return this.constrain("before",t)}laterThan(t){return this.constrain("after",Kn(t))}earlierThan(t){return this.constrain("before",Kn(t))}}const Ab="Expected a non-empty brand name after #",Kn=e=>typeof e=="object"&&!(e instanceof Date)?{...e,exclusive:!0}:{rule:e,exclusive:!0},zi=(e,n)=>H(n,"root")?H(e,"root")?e.extends(n):n.allows(e):H(e,"root")?e.hasUnit(n):n===e,ld=e=>{var n;return e.hasKind("morph")?null:e.hasKind("intersection")?e.inner.structure??(((n=e.basis)==null?void 0:n.domain)==="object"?e.$.bindReference(P.intrinsic.emptyStructure):null):e.isBasis()&&e.domain==="object"?e.$.bindReference(P.intrinsic.emptyStructure):null},Tb=e=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${e}`,cd=(e,n)=>`${e} operand must be an object (was ${n})`,Ar=(e,n)=>xe(Io(e),(t,r)=>[r,n]),Rb=e=>typeof e=="string"?{reference:e}:e,ud=e=>e instanceof z?P.intrinsic.never.internal:e,Nb=Ee({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:e=>e.startsWith("$")?e:`$ark.${e}`},resolve:{}},normalize:Rb,defaults:{description:e=>e.reference},intersections:{alias:(e,n,t)=>t.$.lazilyResolve(()=>ud(De(e.resolution,n.resolution,t)),`${e.reference}${t.pipe?"=>":"&"}${n.reference}`),...Ar("alias",(e,n,t)=>n.isUnknown()?e:n.isNever()?n:n.isBasis()&&!n.overlaps(P.intrinsic.object)?z.init("assignability",P.intrinsic.object,n):t.$.lazilyResolve(()=>ud(De(e.resolution,n,t)),`${e.reference}${t.pipe?"=>":"&"}${n.id}`))}});class Pb extends Ir{constructor(){super(...arguments);y(this,"expression",this.reference);y(this,"structure");y(this,"traverseAllows",(t,r)=>{const i=r.seen[this.reference];return i!=null&&i.includes(t)?!0:(r.seen[this.reference]=_e(i,t),this.resolution.traverseAllows(t,r))});y(this,"traverseApply",(t,r)=>{const i=r.seen[this.reference];i!=null&&i.includes(t)||(r.seen[this.reference]=_e(i,t),this.resolution.traverseApply(t,r))})}get resolution(){const t=this._resolve();return ct[this.id]=t}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const t=this.reference;let r=ct[t];const i=[];for(;H(r,"context");){if(i.includes(r.id))return R(Db(r.id,i));i.push(r.id),r=ct[r.id]}return H(r,"root")?r:Ae(`Unexpected resolution for reference ${this.reference}
Seen: [${i.join("->")}] 
Resolution: ${ye(r)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const t=this.reference.slice(1),r=this.$.resolutions[t];return typeof r=="string"?r:H(r,"root")?r.id:Ae(`Unexpected resolution for reference ${this.reference}: ${ye(r)}`)}get defaultShortDescription(){return Pt.object}innerToJsonSchema(t){return this.resolution.toJsonSchemaRecurse(t)}compile(t){const r=this.resolutionId;t.if(`ctx.seen.${r} && ctx.seen.${r}.includes(data)`,()=>t.return(!0)),t.if(`!ctx.seen.${r}`,()=>t.line(`ctx.seen.${r} = []`)),t.line(`ctx.seen.${r}.push(data)`),t.return(t.invoke(r))}}const Db=(e,n)=>`Alias '${e}' has a shallow resolution cycle: ${[...n,e].join("->")}`,Bo={implementation:Nb,Node:Pb};class jo extends Ir{constructor(){super(...arguments);y(this,"traverseApply",(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)})}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Ti(this.errorContext)}compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`${t.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}}const Vb=Ee({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:e=>typeof e=="string"?{domain:e}:go(e,"numberAllowsNaN")&&e.domain!=="number"?R(qo.writeBadAllowNanMessage(e.domain)):e,applyConfig:(e,n)=>e.numberAllowsNaN===void 0&&e.domain==="number"&&n.numberAllowsNaN?{...e,numberAllowsNaN:!0}:e,defaults:{description:e=>Pt[e.domain],actual:e=>Number.isNaN(e)?"NaN":Pt[ft(e)]},intersections:{domain:(e,n)=>e.domain==="number"&&n.domain==="number"?e.numberAllowsNaN?n:e:z.init("domain",e,n)}});class Fb extends jo{constructor(){super(...arguments);y(this,"requiresNaNCheck",this.domain==="number"&&!this.numberAllowsNaN);y(this,"traverseAllows",this.requiresNaNCheck?t=>typeof t=="number"&&!Number.isNaN(t):t=>ft(t)===this.domain);y(this,"compiledCondition",this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`);y(this,"compiledNegation",this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`);y(this,"expression",this.numberAllowsNaN?"number | NaN":this.domain)}get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Pt[this.domain]}innerToJsonSchema(t){return this.domain==="bigint"||this.domain==="symbol"?t.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const qo={implementation:Vb,Node:Fb,writeBadAllowNanMessage:e=>`numberAllowsNaN may only be specified with domain "number" (was ${e})`},Lb=Ee({kind:"intersection",hasAssociatedError:!0,normalize:e=>{if(Ze(e))return e;const{structure:n,...t}=e,r=!!n,i=n??{},s=xe(t,(o,a)=>kt(o,Iv)?(r&&R(`Flattened structure key ${o} cannot be specified alongside a root 'structure' key.`),i[o]=a,[]):[o,a]);return(H(i,"constraint")||!wr(i))&&(s.structure=i),s},finalizeInnerJson:({structure:e,...n})=>dn(e,"object")?{...e,...n}:n,keys:{domain:{child:!0,parse:(e,n)=>n.$.node("domain",e)},proto:{child:!0,parse:(e,n)=>n.$.node("proto",e)},structure:{child:!0,parse:(e,n)=>n.$.node("structure",e),serialize:e=>{var o;if(!((o=e.sequence)!=null&&o.minLength))return e.collapsibleJson;const{sequence:n,...t}=e.collapsibleJson,{minVariadicLength:r,...i}=n,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...t,sequence:s}}},divisor:{child:!0,parse:rt("divisor")},max:{child:!0,parse:rt("max")},min:{child:!0,parse:rt("min")},maxLength:{child:!0,parse:rt("maxLength")},minLength:{child:!0,parse:rt("minLength")},exactLength:{child:!0,parse:rt("exactLength")},before:{child:!0,parse:rt("before")},after:{child:!0,parse:rt("after")},pattern:{child:!0,parse:rt("pattern")},predicate:{child:!0,parse:rt("predicate")}},reduce:(e,n)=>hd({},e,{$:n,invert:!1,pipe:!1}),defaults:{description:e=>{if(e.children.length===0)return"unknown";if(e.structure)return e.structure.description;const n=[];if(e.basis&&!e.refinements.some(t=>t.impl.obviatesBasisDescription)&&n.push(e.basis.description),e.refinements.length){const t=e.refinements.toSorted((r,i)=>r.kind==="min"&&i.kind==="max"?-1:0).map(r=>r.description);n.push(...t)}return e.inner.predicate&&n.push(...e.inner.predicate.map(t=>t.description)),n.join(" and ")},expected:e=>`  ◦ ${e.errors.map(n=>n.expected).join(`
  ◦ `)}`,problem:e=>`(${e.actual}) must be...
${e.expected}`},intersections:{intersection:(e,n,t)=>hd(e.inner,n.inner,t),...Ar("intersection",(e,n,t)=>{var c;if(e.children.length===0)return n;const{domain:r,proto:i,...s}=e.inner,o=i??r,a=o?De(o,n,t):n;return a instanceof z?a:(c=e==null?void 0:e.basis)!=null&&c.equals(a)?e:e.$.node("intersection",{...s,[a.kind]:a},{prereduced:!0})})}});class zb extends Ir{constructor(){super(...arguments);y(this,"basis",this.inner.domain??this.inner.proto??null);y(this,"refinements",this.children.filter(t=>t.isRefinement()));y(this,"structure",this.inner.structure);y(this,"expression",Bb(this));y(this,"traverseAllows",(t,r)=>this.children.every(i=>i.traverseAllows(t,r)));y(this,"traverseApply",(t,r)=>{const i=r.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(t,r),r.currentErrorCount>i))){if(this.refinements.length){for(let s=0;s<this.refinements.length-1;s++)if(this.refinements[s].traverseApply(t,r),r.failFast&&r.currentErrorCount>i)return;if(this.refinements.at(-1).traverseApply(t,r),r.currentErrorCount>i)return}if(!(this.structure&&(this.structure.traverseApply(t,r),r.currentErrorCount>i))&&this.inner.predicate){for(let s=0;s<this.inner.predicate.length-1;s++)if(this.inner.predicate[s].traverseApply(t,r),r.failFast&&r.currentErrorCount>i)return;this.inner.predicate.at(-1).traverseApply(t,r)}}})}get shallowMorphs(){var t;return(t=this.inner.structure)!=null&&t.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){var t;return((t=this.basis)==null?void 0:t.defaultShortDescription)??"present"}innerToJsonSchema(t){return this.children.reduce((r,i)=>i.isBasis()?i.toJsonSchemaRecurse(t):i.reduceJsonSchema(r,t),{})}compile(t){if(t.traversalKind==="Allows"){for(const r of this.children)t.check(r);t.return(!0);return}if(t.initializeErrorCount(),this.basis&&(t.check(this.basis),this.children.length>1&&t.returnIfFail()),this.refinements.length){for(let r=0;r<this.refinements.length-1;r++)t.check(this.refinements[r]),t.returnIfFailFast();t.check(this.refinements.at(-1)),(this.structure||this.inner.predicate)&&t.returnIfFail()}if(this.structure&&(t.check(this.structure),this.inner.predicate&&t.returnIfFail()),this.inner.predicate){for(let r=0;r<this.inner.predicate.length-1;r++)t.check(this.inner.predicate[r]),t.returnIfFail();t.check(this.inner.predicate.at(-1))}}}const dd={implementation:Lb,Node:zb},Bb=e=>{var t;let n=((t=e.structure)==null?void 0:t.expression)||`${e.basis&&!e.refinements.some(r=>r.impl.obviatesBasisExpression)?e.basis.nestableExpression+" ":""}${e.refinements.map(r=>r.expression).join(" & ")}`||"unknown";return n==="Array == 0"&&(n="[]"),n},hd=(e,n,t)=>{const r={},i=e.proto??e.domain,s=n.proto??n.domain,o=i?s?De(i,s,t):i:s;return o instanceof z?o:(o&&(r[o.kind]=o),Ni({kind:"intersection",baseInner:r,l:Pi(e),r:Pi(n),roots:[],ctx:t}))},jb=Ee({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(e,n)=>n.$.parseSchema(e)},morphs:{parse:xr,serialize:e=>e.map(n=>H(n,"root")?n.json:Ye(n))},declaredIn:{child:!1,serialize:e=>e.json},declaredOut:{child:!1,serialize:e=>e.json}},normalize:e=>e,defaults:{description:e=>{var n;return`a morph from ${e.in.description} to ${((n=e.out)==null?void 0:n.description)??"unknown"}`}},intersections:{morph:(e,n,t)=>{if(!e.hasEqualMorphs(n))return R(Ub(e.expression,n.expression));const r=De(e.in,n.in,t);if(r instanceof z)return r;const i={morphs:e.morphs};if(e.declaredIn||n.declaredIn){const s=De(e.in,n.in,t);if(s instanceof z)return s.throw();i.declaredIn=s}if(e.declaredOut||n.declaredOut){const s=De(e.out,n.out,t);if(s instanceof z)return s.throw();i.declaredOut=s}return r.distribute(s=>t.$.node("morph",{...i,in:s}),t.$.parseSchema)},...Ar("morph",(e,n,t)=>{const r=e.inner.in?De(e.inner.in,n,t):n;return r instanceof z?r:r.equals(e.inner.in)?e:t.$.node("morph",{...e.inner,in:r})})}});class qb extends Ir{constructor(){super(...arguments);y(this,"serializedMorphs",this.morphs.map(Ye));y(this,"compiledMorphs",`[${this.serializedMorphs}]`);y(this,"lastMorph",this.inner.morphs.at(-1));y(this,"lastMorphIfNode",H(this.lastMorph,"root")?this.lastMorph:void 0);y(this,"introspectableIn",this.inner.in);y(this,"introspectableOut",this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.out:void 0);y(this,"expression",`(In: ${this.in.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.out.expression}>`);y(this,"traverseAllows",(t,r)=>!this.introspectableIn||this.introspectableIn.traverseAllows(t,r));y(this,"traverseApply",(t,r)=>{this.introspectableIn&&this.introspectableIn.traverseApply(t,r),r.queueMorphs(this.morphs)})}get shallowMorphs(){var t;return Array.isArray((t=this.inner.in)==null?void 0:t.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get in(){var t;return this.declaredIn??((t=this.inner.in)==null?void 0:t.in)??P.intrinsic.unknown.internal}get out(){return this.declaredOut??this.introspectableOut??P.intrinsic.unknown.internal}declareIn(t){return this.$.node("morph",{...this.inner,declaredIn:t})}declareOut(t){return this.$.node("morph",{...this.inner,declaredOut:t})}get defaultShortDescription(){return this.in.meta.description??this.in.defaultShortDescription}innerToJsonSchema(t){var r;return t.fallback.morph({code:"morph",base:this.in.toJsonSchemaRecurse(t),out:((r=this.introspectableOut)==null?void 0:r.toJsonSchemaRecurse(t))??null})}compile(t){if(t.traversalKind==="Allows"){if(!this.introspectableIn)return;t.return(t.invoke(this.introspectableIn));return}this.introspectableIn&&t.line(t.invoke(this.introspectableIn)),t.line(`ctx.queueMorphs(${this.compiledMorphs})`)}hasEqualMorphs(t){return Pn(this.morphs,t.morphs,{isEqual:(r,i)=>r===i||H(r,"root")&&H(i,"root")&&r.equals(i)})}}const fd={implementation:jb,Node:qb},Ub=(e,n)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${e}
Right: ${n}`,Kb=Ee({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:e=>bo(e)??hn(e)},dateAllowsInvalid:{}},normalize:e=>{const n=typeof e=="string"?{proto:Vn[e]}:typeof e=="function"?Ze(e)?e:{proto:e}:typeof e.proto=="string"?{...e,proto:Vn[e.proto]}:e;return typeof n.proto!="function"&&R(Bi.writeInvalidSchemaMessage(n.proto)),go(n,"dateAllowsInvalid")&&n.proto!==Date&&R(Bi.writeBadInvalidDateMessage(n.proto)),n},applyConfig:(e,n)=>e.dateAllowsInvalid===void 0&&e.proto===Date&&n.dateAllowsInvalid?{...e,dateAllowsInvalid:!0}:e,defaults:{description:e=>e.builtinName?Gy[e.builtinName]:`an instance of ${e.proto.name}`,actual:e=>e instanceof Date&&e.toString()==="Invalid Date"?"an invalid Date":vo(e)},intersections:{proto:(e,n)=>e.proto===Date&&n.proto===Date?e.dateAllowsInvalid?n:e:fu(e.proto,n.proto)?e:fu(n.proto,e.proto)?n:z.init("proto",e,n),domain:(e,n)=>n.domain==="object"?e:z.init("domain",P.intrinsic.object.internal,n)}});class Wb extends jo{constructor(){super(...arguments);y(this,"builtinName",bo(this.proto));y(this,"serializedConstructor",this.json.proto);y(this,"requiresInvalidDateCheck",this.proto===Date&&!this.dateAllowsInvalid);y(this,"traverseAllows",this.requiresInvalidDateCheck?t=>t instanceof Date&&t.toString()!=="Invalid Date":t=>t instanceof this.proto);y(this,"compiledCondition",`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`);y(this,"compiledNegation",`!(${this.compiledCondition})`);y(this,"expression",this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name);y(this,"domain","object")}innerToJsonSchema(t){var r,i;switch(this.builtinName){case"Array":return{type:"array"};case"Date":return((i=(r=t.fallback).date)==null?void 0:i.call(r,{code:"date",base:{}}))??t.fallback.proto({code:"proto",base:{},proto:this.proto});default:return t.fallback.proto({code:"proto",base:{},proto:this.proto})}}get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}get defaultShortDescription(){return this.description}}const Bi={implementation:Kb,Node:Wb,writeBadInvalidDateMessage:e=>`dateAllowsInvalid may only be specified with constructor Date (was ${e.name})`,writeInvalidSchemaMessage:e=>`instanceOf operand must be a function (was ${ft(e)})`},Hb=Ee({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(e,n)=>{const t=[];for(const r of e){const i=H(r,"root")?r.branches:n.$.parseSchema(r).branches;for(const s of i)if(s.hasKind("morph")){const o=t.findIndex(a=>a.hasKind("morph")&&a.hasEqualMorphs(s));if(o===-1)t.push(s);else{const a=t[o];t[o]=n.$.node("morph",{...a.inner,in:a.in.rawOr(s.in)})}}else t.push(s)}return n.def.ordered||t.sort((r,i)=>r.hash<i.hash?-1:1),t}}},normalize:e=>We(e)?{branches:e}:e,reduce:(e,n)=>{const t=i_(e);if(t.length===1)return t[0];if(t.length!==e.branches.length)return n.node("union",{...e,branches:t},{prereduced:!0})},defaults:{description:e=>e.distribute(n=>n.description,Wn),expected:e=>{const n=Dy(e.errors,"propString"),t=Object.entries(n).map(([r,i])=>{const s=[];for(const c of i)un(s,c.expected);const o=Wn(s),a=i.every(c=>c.actual===i[0].actual)?i[0].actual:ye(i[0].data);return`${r&&`${r} `}must be ${o}${a&&` (was ${a})`}`});return Wn(t)},problem:e=>e.expected,message:e=>e.problem},intersections:{union:(e,n,t)=>{if(e.isNever!==n.isNever)return z.init("presence",e,n);let r;return e.ordered?(n.ordered&&R(o_(e.expression,n.expression)),r=Uo(n.branches,e.branches,t),r instanceof z&&r.invert()):r=Uo(e.branches,n.branches,t),r instanceof z?r:t.$.parseSchema(e.ordered||n.ordered?{branches:r,ordered:!0}:{branches:r})},...Ar("union",(e,n,t)=>{const r=Uo(e.branches,[n],t);return r instanceof z?r:r.length===1?r[0]:t.$.parseSchema(e.ordered?{branches:r,ordered:!0}:{branches:r})})}});class Gb extends Ir{constructor(){super(...arguments);y(this,"isBoolean",this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0));y(this,"unitBranches",this.branches.filter(t=>t.in.hasKind("unit")));y(this,"discriminant",this.discriminate());y(this,"discriminantJson",this.discriminant?t_(this.discriminant):null);y(this,"expression",this.distribute(t=>t.nestableExpression,r_));y(this,"traverseAllows",(t,r)=>this.branches.some(i=>i.traverseAllows(t,r)));y(this,"traverseApply",(t,r)=>{const i=[];for(let s=0;s<this.branches.length;s++){if(r.pushBranch(),this.branches[s].traverseApply(t,r),!r.hasError())return this.branches[s].includesTransform?r.queuedMorphs.push(...r.popBranch().queuedMorphs):r.popBranch();i.push(r.popBranch().error)}r.errorFromNodeContext({code:"union",errors:i,meta:this.meta})});y(this,"traverseOptimistic",t=>{for(let r=0;r<this.branches.length;r++){const i=this.branches[r];if(i.traverseAllows(t))return i.contextFreeMorph?i.contextFreeMorph(t):t}return Dt})}get branchGroups(){const t=[];let r=-1;for(const i of this.branches){if(i.hasKind("unit")&&i.domain==="boolean"){r===-1?(r=t.length,t.push(i)):t[r]=P.intrinsic.boolean;continue}t.push(i)}return t}createBranchedOptimisticRootApply(){return(t,r)=>{const i=this.traverseOptimistic(t);if(i!==Dt)return i;const s=new Bn(t,this.$.resolvedConfig);return this.traverseApply(t,s),s.finalize(r)}}get shallowMorphs(){return this.branches.reduce((t,r)=>un(t,r.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(t=>t.defaultShortDescription,Wn)}innerToJsonSchema(t){if(this.branchGroups.length===1&&this.branchGroups[0].equals(P.intrinsic.boolean))return{type:"boolean"};const r=this.branchGroups.map(i=>i.toJsonSchemaRecurse(t));return r.every(i=>Object.keys(i).length===1&&go(i,"const"))?{enum:r.map(i=>i.const)}:{anyOf:r}}compile(t){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(t);let r=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(r=`typeof ${r} === "object" ? ${r} === null ? "null" : "object" : typeof ${r} === "function" ? "object" : typeof ${r}`);const i=this.discriminant.cases,s=Object.keys(i),{optimistic:o}=t;if(t.optimistic=!1,t.block(`switch(${r})`,()=>{for(const d in i){const h=i[d],f=d==="default"?d:`case ${d}`;t.line(`${f}: return ${h===!0?o?t.data:h:o?`${t.invoke(h)} ? ${h.contextFreeMorph?`${Ye(h.contextFreeMorph)}(${t.data})`:t.data} : "${Dt}"`:t.invoke(h)}`)}return t}),t.traversalKind==="Allows"){t.return(o?`"${Dt}"`:!1);return}const a=Wn(this.discriminant.kind==="domain"?s.map(d=>{const h=d.slice(1,-1);return h==="function"?Pt.object:Pt[h]}):s),c=this.discriminant.path.map(d=>typeof d=="symbol"?Ye(d):JSON.stringify(d)),l=JSON.stringify(a),u=this.discriminant.kind==="domain"?`${Qb}[${r}]`:`${e_}(${r})`;t.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${l},
	actual: ${u},
	relativePath: [${c}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(t){if(t.traversalKind==="Apply"){t.const("errors","[]");for(const r of this.branches)t.line("ctx.pushBranch()").line(t.invoke(r)).if("!ctx.hasError()",()=>t.return(r.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");t.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:r}=t;t.optimistic=!1;for(const i of this.branches)t.if(`${t.invoke(i)}`,()=>t.return(r?i.contextFreeMorph?`${Ye(i.contextFreeMorph)}(${t.data})`:t.data:!0));t.return(r?`"${Dt}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){var o,a;if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const c=xe(this.unitBranches,(l,u)=>[`${u.in.serializedValue}`,u.hasKind("morph")?u:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:c}}const t=[];for(let c=0;c<this.branches.length-1;c++){const l=this.branches[c];for(let u=c+1;u<this.branches.length;u++){const d=this.branches[u],h=Lt(l.in,d.in,l.$);if(h instanceof z)for(const f of h){if(!f.kind||f.optional)continue;let p,g;if(f.kind==="domain"){const b=f.l,_=f.r;p=`"${typeof b=="string"?b:b.domain}"`,g=`"${typeof _=="string"?_:_.domain}"`}else if(f.kind==="unit")p=f.l.serializedValue,g=f.r.serializedValue;else continue;const v=t.find(b=>Pn(b.path,f.path)&&b.kind===f.kind);v?(v.cases[p]?v.cases[p].branchIndices=un(v.cases[p].branchIndices,c):(o=v.cases)[p]??(o[p]={branchIndices:[c],condition:f.l}),v.cases[g]?v.cases[g].branchIndices=un(v.cases[g].branchIndices,u):(a=v.cases)[g]??(a[g]={branchIndices:[u],condition:f.r})):t.push({kind:f.kind,cases:{[p]:{branchIndices:[c],condition:f.l},[g]:{branchIndices:[u],condition:f.r}},path:f.path})}}}const r=this.ordered?Zb(t,this.branches):t;if(!r.length)return null;const i=Jb(r,this),s={};for(const c in i.best.cases){const l=Yb(i,c);if(l===null){s[c]=!0;continue}if(l.length===this.branches.length)return null;this.ordered&&l.sort((h,f)=>h.originalIndex-f.originalIndex);const u=l.map(h=>h.branch),d=u.length===1?u[0]:this.$.node("union",this.ordered?{branches:u,ordered:!0}:u);Object.assign(this.referencesById,d.referencesById),s[c]=d}if(i.defaultEntries.length){const c=i.defaultEntries.map(l=>l.branch);s.default=this.$.node("union",this.ordered?{branches:c,ordered:!0}:c,{prereduced:!0}),Object.assign(this.referencesById,s.default.referencesById)}return Object.assign(i.location,{cases:s})}}const Jb=(e,n)=>{const t=e.sort((s,o)=>Object.keys(o.cases).length-Object.keys(s.cases).length)[0],r={kind:t.kind,path:t.path,optionallyChainedPropString:pd(t.path)},i=n.branches.map((s,o)=>({originalIndex:o,branch:s}));return{best:t,location:r,defaultEntries:i,node:n}},Yb=(e,n)=>{const t=e.best.cases[n],r=Xb(t.condition,e.location.path,e.node.$);let i=[];const s=[];for(let o=0;o<e.defaultEntries.length;o++){const a=e.defaultEntries[o];if(t.branchIndices.includes(a.originalIndex)){const c=gd(e.node.branches[a.originalIndex],e.location);c===null?i=null:i==null||i.push({originalIndex:a.originalIndex,branch:c})}else if(a.branch.hasKind("alias")&&r.hasKind("domain")&&r.domain==="object")i==null||i.push(a);else{if(a.branch.in.overlaps(r)){const c=gd(a.branch,e.location);i==null||i.push({originalIndex:a.originalIndex,branch:c})}s.push(a)}}return e.defaultEntries=s,i},Zb=(e,n)=>e.filter(r=>{const i=Object.values(r.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const c=i[a];for(const l of o)for(const u of c)if(l>u&&n[l].overlaps(n[u]))return!1}}return!0}),Xb=(e,n,t)=>{let r=e==="undefined"?t.node("unit",{unit:void 0}):e==="null"?t.node("unit",{unit:null}):e==="boolean"?t.units([!0,!1]):e;for(let i=n.length-1;i>=0;i--){const s=n[i];r=t.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...Ny(s).map(o=>({})),r]}:{domain:"object",required:[{key:s,value:r}]})}return r},pd=e=>e.reduce((n,t)=>n+Cu(t,!0),"data"),Qb=Ye(Vy),e_=Ye(ye),md={implementation:Hb,Node:Gb},t_=e=>({kind:e.kind,path:e.path.map(n=>typeof n=="string"?n:Er(n)),cases:xe(e.cases,(n,t)=>[n,t===!0?t:t.hasKind("union")&&t.discriminantJson?t.discriminantJson:t.json])}),n_={delimiter:" | ",finalDelimiter:" | "},r_=e=>Wn(e,n_),Wn=(e,n)=>{const t=(n==null?void 0:n.delimiter)??", ",r=(n==null?void 0:n.finalDelimiter)??" or ";if(e.length===0)return"never";if(e.length===1)return e[0];if(e.length===2&&e[0]==="false"&&e[1]==="true"||e[0]==="true"&&e[1]==="false")return"boolean";const i={},s=e.filter(a=>i[a]?!1:i[a]=!0),o=s.pop();return`${s.join(t)}${s.length?r:""}${o}`},Uo=(e,n,t)=>{const r=n.map(()=>[]);for(let s=0;s<e.length;s++){let o={};for(let a=0;a<n.length;a++){if(r[a]===null)continue;if(e[s].equals(n[a])){r[a]=null,o={};break}const c=De(e[s],n[a],t);if(!(c instanceof z)){if(c.equals(e[s])){r[a].push(e[s]),o={};break}c.equals(n[a])?r[a]=null:o[a]=c}}for(const a in o)r[a][s]=o[a]}const i=r.flatMap((s,o)=>(s==null?void 0:s.flatMap(a=>a.branches))??n[o]);return i.length===0?z.init("union",e,n):i},i_=({branches:e,ordered:n})=>{if(e.length<2)return e;const t=e.map(()=>!0);for(let r=0;r<e.length;r++)for(let i=r+1;i<e.length&&t[r]&&t[i];i++){if(e[r].equals(e[i])){t[i]=!1;continue}const s=Lt(e[r].in,e[i].in,e[0].$);s instanceof z||(n||s_(e[r],e[i]),s.equals(e[r].in)?t[r]=!!n:s.equals(e[i].in)&&(t[i]=!1))}return e.filter((r,i)=>t[i])},s_=(e,n)=>{!e.includesTransform&&!n.includesTransform||(Pn(e.shallowMorphs,n.shallowMorphs)||R(yd(e.expression,n.expression)),Pn(e.flatMorphs,n.flatMorphs,{isEqual:(t,r)=>{var i,s;return t.propString===r.propString&&(t.node.hasKind("morph")&&r.node.hasKind("morph")?t.node.hasEqualMorphs(r.node):t.node.hasKind("intersection")&&r.node.hasKind("intersection")?((i=t.node.structure)==null?void 0:i.structuralMorphRef)===((s=r.node.structure)==null?void 0:s.structuralMorphRef):!1)}})||R(yd(e.expression,n.expression)))},gd=(e,n)=>e.transform((t,r)=>t==="domain"||t==="unit"?null:r,{shouldTransform:(t,r)=>{const i=pd(r.path);return n.optionallyChainedPropString.startsWith(i)?t.hasKind("domain")&&t.domain==="object"||(t.hasKind("domain")||n.kind==="unit")&&i===n.optionallyChainedPropString?!0:t.children.length!==0&&t.kind!=="index":!1}}),yd=(e,n)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${e}
Right: ${n}`,o_=(e,n)=>`The intersection of two ordered unions is indeterminate:
Left: ${e}
Right: ${n}`,a_=Ee({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:e=>e instanceof Date?e.toISOString():hn(e)}},normalize:e=>e,defaults:{description:e=>ye(e.unit),problem:({expected:e,actual:n})=>`${e===n?`must be reference equal to ${e} (serialized to the same value)`:`must be ${e} (was ${n})`}`},intersections:{unit:(e,n)=>z.init("unit",e,n),...Ar("unit",(e,n)=>{if(n.allows(e.unit))return e;const t=n.hasKind("intersection")?n.basis:n;if(t){const r=t.hasKind("domain")?t:P.intrinsic.object;if(e.domain!==r.domain){const i=e.domain==="undefined"||e.domain==="null"||e.domain==="boolean"?e.domain:P.intrinsic[e.domain];return z.init("domain",i,r)}}return z.init("assignability",e,n.hasKind("intersection")?n.children.find(r=>!r.allows(e.unit)):n)})}});class l_ extends jo{constructor(){super(...arguments);y(this,"compiledValue",this.json.unit);y(this,"serializedValue",typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`);y(this,"compiledCondition",bd(this.unit,this.serializedValue));y(this,"compiledNegation",bd(this.unit,this.serializedValue,"negated"));y(this,"expression",ye(this.unit));y(this,"domain",ft(this.unit));y(this,"traverseAllows",this.unit instanceof Date?t=>t instanceof Date&&t.toISOString()===this.compiledValue:Number.isNaN(this.unit)?t=>Number.isNaN(t):t=>t===this.unit)}get defaultShortDescription(){return this.domain==="object"?Pt.object:this.description}innerToJsonSchema(t){return this.unit===null?{type:"null"}:P.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:t.fallback.unit({code:"unit",base:{},unit:this.unit})}}const vd={implementation:a_,Node:l_},bd=(e,n,t)=>{if(e instanceof Date){const r=`data instanceof Date && data.toISOString() === ${n}`;return t?`!(${r})`:r}return Number.isNaN(e)?`${t?"!":""}Number.isNaN(data)`:`data ${t?"!":"="}== ${n}`},c_=Ee({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(e,n)=>{const t=n.$.parseSchema(e);if(!t.extends(P.intrinsic.key))return R(h_(t.expression));const r=t.branches.filter(i=>i.hasKind("unit"));return r.length?R(d_(r.map(i=>ye(i.unit)))):t}},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`[${e.signature.expression}]: ${e.value.description}`},intersections:{index:(e,n,t)=>{if(e.signature.equals(n.signature)){const r=De(e.value,n.value,t),i=r instanceof z?P.intrinsic.never.internal:r;return t.$.node("index",{signature:e.signature,value:i})}return e.signature.extends(n.signature)&&e.value.subsumes(n.value)?n:n.signature.extends(e.signature)&&n.value.subsumes(e.value)?e:null}}});class u_ extends qn{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.object.internal);y(this,"expression",`[${this.signature.expression}]: ${this.value.expression}`);y(this,"flatRefs",_e(this.value.flatRefs.map(t=>Yt([this.signature,...t.path],t.node)),Yt([this.signature],this.value)));y(this,"traverseAllows",(t,r)=>Si(t).every(i=>this.signature.traverseAllows(i[0],r)?Ft(i[0],()=>this.value.traverseAllows(i[1],r),r):!0));y(this,"traverseApply",(t,r)=>{for(const i of Si(t))this.signature.traverseAllows(i[0],r)&&Ft(i[0],()=>this.value.traverseApply(i[1],r),r)})}_transform(t,r){r.path.push(this.signature);const i=super._transform(t,r);return r.path.pop(),i}compile(){}}const _d={implementation:c_,Node:u_},d_=e=>`Index keys ${e.join(", ")} should be specified as named props.`,h_=e=>`Indexed key definition '${e}' must be a string or symbol`,f_=Ee({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`${e.compiledKey}: ${e.value.description}`,expected:e=>e.missingValueDescription,actual:()=>"missing"},intersections:{required:Vo,optional:Vo}});class p_ extends sd{constructor(){super(...arguments);y(this,"expression",`${this.compiledKey}: ${this.value.expression}`);y(this,"errorContext",Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta}));y(this,"compiledErrorContext",Ti(this.errorContext))}}const xd={implementation:f_,Node:p_},m_=Ee({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}},optionals:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}},defaultables:{child:e=>e.map(n=>n[0]),parse:(e,n)=>{if(e.length!==0)return e.map(t=>{const r=n.$.parseSchema(t[0]);return zo(r,t[1],null),[r,t[1]]})},serialize:e=>e.map(n=>[n[0].collapsibleJson,hn(n[1])])},variadic:{child:!0,parse:(e,n)=>n.$.parseSchema(e,n)},minVariadicLength:{parse:e=>e===0?void 0:e},postfix:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}}},normalize:e=>{var n,t,r;if(typeof e=="string")return{variadic:e};if("variadic"in e||"prefix"in e||"defaultables"in e||"optionals"in e||"postfix"in e||"minVariadicLength"in e){if((n=e.postfix)!=null&&n.length){if(!e.variadic)return R(b_);if((t=e.optionals)!=null&&t.length||(r=e.defaultables)!=null&&r.length)return R($d)}return e.minVariadicLength&&!e.variadic?R("minVariadicLength may not be specified without a variadic element"):e}return{variadic:e}},reduce:(e,n)=>{var a,c,l,u,d,h,f;let t=e.minVariadicLength??0;const r=((a=e.prefix)==null?void 0:a.slice())??[],i=((c=e.defaultables)==null?void 0:c.slice())??[],s=((l=e.optionals)==null?void 0:l.slice())??[],o=((u=e.postfix)==null?void 0:u.slice())??[];if(e.variadic){for(;(d=s.at(-1))!=null&&d.equals(e.variadic);)s.pop();if(s.length===0&&i.length===0)for(;(h=r.at(-1))!=null&&h.equals(e.variadic);)r.pop(),t++;for(;(f=o[0])!=null&&f.equals(e.variadic);)o.shift(),t++}else s.length===0&&i.length===0&&r.push(...o.splice(0));if(t!==e.minVariadicLength||e.prefix&&e.prefix.length!==r.length)return n.node("sequence",{...e,prefix:r,defaultables:i,optionals:s,postfix:o,minVariadicLength:t},{prereduced:!0})},defaults:{description:e=>e.isVariadicOnly?`${e.variadic.nestableExpression}[]`:`[${e.tuple.map(t=>t.kind==="defaultables"?`${t.node.nestableExpression} = ${ye(t.default)}`:t.kind==="optionals"?`${t.node.nestableExpression}?`:t.kind==="variadic"?`...${t.node.nestableExpression}[]`:t.node.expression).join(", ")}]`},intersections:{sequence:(e,n,t)=>{const r=Tr({l:e.tuple,r:n.tuple,disjoint:new z,result:[],fixedVariants:[],ctx:t}),i=r.disjoint.length===0?[r,...r.fixedVariants]:r.fixedVariants;return i.length===0?r.disjoint:i.length===1?t.$.node("sequence",Sd(i[0].result)):t.$.node("union",i.map(s=>({proto:Array,sequence:Sd(s.result)})))}}});class g_ extends qn{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.Array.internal);y(this,"tuple",v_(this.inner));y(this,"prefixLength",((jf=this.prefix)==null?void 0:jf.length)??0);y(this,"defaultablesLength",((qf=this.defaultables)==null?void 0:qf.length)??0);y(this,"optionalsLength",((Uf=this.optionals)==null?void 0:Uf.length)??0);y(this,"postfixLength",((Kf=this.postfix)==null?void 0:Kf.length)??0);y(this,"defaultablesAndOptionals",[]);y(this,"prevariadic",this.tuple.filter(t=>t.kind==="defaultables"||t.kind==="optionals"?(this.defaultablesAndOptionals.push(t.node),!0):t.kind==="prefix"));y(this,"variadicOrPostfix",cn(this.variadic&&[this.variadic],this.postfix));y(this,"flatRefs",this.addFlatRefs());y(this,"isVariadicOnly",this.prevariadic.length+this.postfixLength===0);y(this,"minVariadicLength",this.inner.minVariadicLength??0);y(this,"minLength",this.prefixLength+this.minVariadicLength+this.postfixLength);y(this,"minLengthNode",this.minLength===0?null:this.$.node("minLength",this.minLength));y(this,"maxLength",this.variadic?null:this.tuple.length);y(this,"maxLengthNode",this.maxLength===null?null:this.$.node("maxLength",this.maxLength));y(this,"impliedSiblings",this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[]);y(this,"defaultValueMorphs",y_(this));y(this,"defaultValueMorphsReference",this.defaultValueMorphs.length?Ye(this.defaultValueMorphs):void 0);y(this,"traverseAllows",(t,r)=>{for(let i=0;i<t.length;i++)if(!this.elementAtIndex(t,i).node.traverseAllows(t[i],r))return!1;return!0});y(this,"traverseApply",(t,r)=>{let i=0;for(;i<t.length;i++)Ft(i,()=>this.elementAtIndex(t,i).node.traverseApply(t[i],r),r)});y(this,"expression",this.description)}addFlatRefs(){return Vu(this.flatRefs,this.prevariadic.flatMap((t,r)=>_e(t.node.flatRefs.map(i=>Yt([`${r}`,...i.path],i.node)),Yt([`${r}`],t.node)))),Vu(this.flatRefs,this.variadicOrPostfix.flatMap(t=>_e(t.flatRefs.map(r=>Yt([P.intrinsic.nonNegativeIntegerString.internal,...r.path],r.node)),Yt([P.intrinsic.nonNegativeIntegerString.internal],t)))),this.flatRefs}elementAtIndex(t,r){if(r<this.prevariadic.length)return this.tuple[r];const i=t.length-this.postfixLength;return r>=i?{kind:"postfix",node:this.postfix[r-i]}:{kind:"variadic",node:this.variadic??Ae(`Unexpected attempt to access index ${r} on ${this}`)}}get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(t){if(this.prefix)for(const[r,i]of this.prefix.entries())t.traverseKey(`${r}`,`data[${r}]`,i);for(const[r,i]of this.defaultablesAndOptionals.entries()){const s=`${r+this.prefixLength}`;t.if(`${s} >= ${t.data}.length`,()=>t.traversalKind==="Allows"?t.return(!0):t.return()),t.traverseKey(s,`data[${s}]`,i)}if(this.variadic&&(this.postfix&&t.const("firstPostfixIndex",`${t.data}.length${this.postfix?`- ${this.postfix.length}`:""}`),t.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>t.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[r,i]of this.postfix.entries()){const s=`firstPostfixIndex + ${r}`;t.traverseKey(s,`data[${s}]`,i)}t.traversalKind==="Allows"&&t.return(!0)}_transform(t,r){r.path.push(P.intrinsic.nonNegativeIntegerString.internal);const i=super._transform(t,r);return r.path.pop(),i}reduceJsonSchema(t,r){if(this.prevariadic.length&&(t.prefixItems=this.prevariadic.map(i=>{const s=i.node.toJsonSchemaRecurse(r);if(i.kind==="defaultables"){const o=typeof i.default=="function"?i.default():i.default;s.default=P.intrinsic.jsonData.allows(o)?o:r.fallback.defaultValue({code:"defaultValue",base:s,value:o})}return s})),this.minLength&&(t.minItems=this.minLength),this.variadic){const i=Object.assign(t,{items:this.variadic.toJsonSchemaRecurse(r)});if(this.maxLength&&(i.maxItems=this.maxLength),this.postfix){const s=this.postfix.map(o=>o.toJsonSchemaRecurse(r));t=r.fallback.arrayPostfix({code:"arrayPostfix",base:i,elements:s})}}else t.items=!1,delete t.maxItems;return t}}const Ko={},y_=e=>{if(!e.defaultables)return[];const n=[];let t="[";const r=e.prefixLength+e.defaultablesLength-1;for(let i=e.prefixLength;i<=r;i++){const[s,o]=e.defaultables[i-e.prefixLength];n.push(ad(i,s,o)),t+=`${i}: ${s.id} = ${hn(o)}, `}return t+="]",Ko[t]??(Ko[t]=n)},wd={implementation:m_,Node:g_},v_=e=>{const n=[];if(e.prefix)for(const t of e.prefix)n.push({kind:"prefix",node:t});if(e.defaultables)for(const[t,r]of e.defaultables)n.push({kind:"defaultables",node:t,default:r});if(e.optionals)for(const t of e.optionals)n.push({kind:"optionals",node:t});if(e.variadic&&n.push({kind:"variadic",node:e.variadic}),e.postfix)for(const t of e.postfix)n.push({kind:"postfix",node:t});return n},Sd=e=>e.reduce((n,t)=>(t.kind==="variadic"?n.variadic=t.node:t.kind==="defaultables"?n.defaultables=_e(n.defaultables,[[t.node,t.default]]):n[t.kind]=_e(n[t.kind],t.node),n),{}),$d="A postfix required element cannot follow an optional or defaultable element",b_="A postfix element requires a variadic element",Tr=e=>{var d,h;const[n,...t]=e.l,[r,...i]=e.r;if(!n||!r)return e;const s=((d=t.at(-1))==null?void 0:d.kind)==="postfix",o=((h=i.at(-1))==null?void 0:h.kind)==="postfix",a=n.kind==="prefix"||r.kind==="prefix"?"prefix":n.kind==="postfix"||r.kind==="postfix"?"postfix":n.kind==="variadic"&&r.kind==="variadic"?"variadic":s||o?"prefix":n.kind==="defaultables"||r.kind==="defaultables"?"defaultables":"optionals";if(n.kind==="prefix"&&r.kind==="variadic"&&o){const f=Tr({...e,fixedVariants:[],r:i.map(p=>({...p,kind:"prefix"}))});f.disjoint.length===0&&e.fixedVariants.push(f)}else if(r.kind==="prefix"&&n.kind==="variadic"&&s){const f=Tr({...e,fixedVariants:[],l:t.map(p=>({...p,kind:"prefix"}))});f.disjoint.length===0&&e.fixedVariants.push(f)}const c=De(n.node,r.node,e.ctx);if(c instanceof z)if(a==="prefix"||a==="postfix")e.disjoint.push(...c.withPrefixKey(a==="prefix"?e.result.length:`-${t.length+1}`,"required")),e.result=[...e.result,{kind:a,node:P.intrinsic.never.internal}];else return a==="optionals"||a==="defaultables"?e:Tr({...e,fixedVariants:[],l:t.map(f=>({...f,kind:"prefix"})),r:t.map(f=>({...f,kind:"prefix"}))});else a==="defaultables"?(n.kind==="defaultables"&&r.kind==="defaultables"&&n.default!==r.default&&R(od(n.default,r.default)),e.result=[...e.result,{kind:a,node:c,default:n.kind==="defaultables"?n.default:r.kind==="defaultables"?r.default:Ae(`Unexpected defaultable intersection from ${n.kind} and ${r.kind} elements.`)}]):e.result=[...e.result,{kind:a,node:c}];const l=e.l.length,u=e.r.length;return(n.kind!=="variadic"||l>=u&&(r.kind==="variadic"||u===1))&&(e.l=t),(r.kind!=="variadic"||u>=l&&(n.kind==="variadic"||l===1))&&(e.r=i),Tr(e)},kd=e=>n=>{var t,r;if(n.props.length||n.index){const i=((t=n.index)==null?void 0:t.map(o=>o[e]))??[];for(const o of n.props)i.push(o[e]);n.undeclared&&i.push(`+ (undeclared): ${n.undeclared}`);const s=`{ ${i.join(", ")} }`;return n.sequence?`${s} & ${n.sequence.description}`:s}return((r=n.sequence)==null?void 0:r.description)??"{}"},__=kd("description"),x_=kd("expression"),Cd=(e,n,t)=>{const r=e.required?"required":"optional";if(!n.signature.allows(e.key))return null;const i=Lt(e.value,n.value,t);return i instanceof z?r==="optional"?t.node("optional",{key:e.key,value:P.intrinsic.never.internal}):i.withPrefixKey(e.key,e.kind):null},w_=Ee({kind:"structure",hasAssociatedError:!1,normalize:e=>e,applyConfig:(e,n)=>!e.undeclared&&n.onUndeclaredKey!=="ignore"?{...e,undeclared:n.onUndeclaredKey}:e,keys:{required:{child:!0,parse:rt("required"),reduceIo:(e,n,t)=>{n.required=_e(n.required,t.map(r=>r[e]))}},optional:{child:!0,parse:rt("optional"),reduceIo:(e,n,t)=>{if(e==="in"){n.optional=t.map(r=>r.in);return}for(const r of t)n[r.outProp.kind]=_e(n[r.outProp.kind],r.outProp.out)}},index:{child:!0,parse:rt("index")},sequence:{child:!0,parse:rt("sequence")},undeclared:{parse:e=>e==="ignore"?void 0:e,reduceIo:(e,n,t)=>{t==="delete"&&(e==="in"?delete n.undeclared:n.undeclared="reject")}}},defaults:{description:__},intersections:{structure:(e,n,t)=>{const r={...e.inner},i={...n.inner},s=new z;if(e.undeclared){const c=e.keyof();for(const l of n.requiredKeys)c.allows(l)||s.add("presence",P.intrinsic.never.internal,n.propsByKey[l].value,{path:[l]});i.optional&&(i.optional=i.optional.filter(l=>c.allows(l.key))),i.index&&(i.index=i.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Lt(c,l.signature,t.$);if(u instanceof z)return[];const d=Ho(u,l.value,t.$);return d.required&&(i.required=cn(i.required,d.required)),d.optional&&(i.optional=cn(i.optional,d.optional)),d.index??[]}))}if(n.undeclared){const c=n.keyof();for(const l of e.requiredKeys)c.allows(l)||s.add("presence",e.propsByKey[l].value,P.intrinsic.never.internal,{path:[l]});r.optional&&(r.optional=r.optional.filter(l=>c.allows(l.key))),r.index&&(r.index=r.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Lt(c,l.signature,t.$);if(u instanceof z)return[];const d=Ho(u,l.value,t.$);return d.required&&(r.required=cn(r.required,d.required)),d.optional&&(r.optional=cn(r.optional,d.optional)),d.index??[]}))}const o={};(e.undeclared||n.undeclared)&&(o.undeclared=e.undeclared==="reject"||n.undeclared==="reject"?"reject":"delete");const a=Ni({kind:"structure",baseInner:o,l:Pi(r),r:Pi(i),roots:[],ctx:t});return a instanceof z&&s.push(...a),s.length?s:a}},reduce:(e,n)=>{if(e.index){if(!(e.required||e.optional))return;let t=!1;const r=e.required??[],i=e.optional??[],s=[...i];for(const o of e.index){for(const a of r){const c=Cd(a,o,n);if(c instanceof z)return c}for(const[a,c]of i.entries()){const l=Cd(c,o,n);if(l instanceof z)return l;l!==null&&(s[a]=l,t=!0)}}if(t)return n.node("structure",{...e,optional:s},{prereduced:!0})}}});class S_ extends qn{constructor(){super(...arguments);y(this,"impliedBasis",P.intrinsic.object.internal);y(this,"impliedSiblings",this.children.flatMap(t=>t.impliedSiblings??[]));y(this,"props",cn(this.required,this.optional));y(this,"propsByKey",xe(this.props,(t,r)=>[r.key,r]));y(this,"propsByKeyReference",Ye(this.propsByKey));y(this,"expression",x_(this));y(this,"requiredKeys",((Wf=this.required)==null?void 0:Wf.map(t=>t.key))??[]);y(this,"optionalKeys",((Hf=this.optional)==null?void 0:Hf.map(t=>t.key))??[]);y(this,"literalKeys",[...this.requiredKeys,...this.optionalKeys]);y(this,"_keyof");y(this,"traverseAllows",(t,r)=>this._traverse("Allows",t,r));y(this,"traverseApply",(t,r)=>this._traverse("Apply",t,r));y(this,"_traverse",(t,r,i)=>{const s=(i==null?void 0:i.currentErrorCount)??0;for(let o=0;o<this.props.length;o++)if(t==="Allows"){if(!this.props[o].traverseAllows(r,i))return!1}else if(this.props[o].traverseApply(r,i),i.failFast&&i.currentErrorCount>s)return!1;if(this.sequence){if(t==="Allows"){if(!this.sequence.traverseAllows(r,i))return!1}else if(this.sequence.traverseApply(r,i),i.failFast&&i.currentErrorCount>s)return!1}if(this.index||this.undeclared==="reject"){const o=Object.keys(r);o.push(...Object.getOwnPropertySymbols(r));for(let a=0;a<o.length;a++){const c=o[a];if(this.index){for(const l of this.index)if(l.signature.traverseAllows(c,i)){if(t==="Allows"){if(!Ft(c,()=>l.value.traverseAllows(r[c],i),i))return!1}else if(Ft(c,()=>l.value.traverseApply(r[c],i),i),i.failFast&&i.currentErrorCount>s)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(c)&&(t==="Allows"||(i.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[c],meta:this.meta}),i.failFast)))return!1}}return this.structuralMorph&&i&&!i.hasError()&&i.queueMorphs([this.structuralMorph]),!0});y(this,"declaresKey",t=>{var r;return t in this.propsByKey||((r=this.index)==null?void 0:r.some(i=>i.signature.allows(t)))||this.sequence!==void 0&&P.intrinsic.nonNegativeIntegerString.allows(t)});y(this,"structuralMorphRef",this.structuralMorph&&Ye(this.structuralMorph))}keyof(){if(this._keyof)return this._keyof;let t=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:r}of this.index)t=t.concat(r.branches);return this._keyof=this.$.node("union",t)}map(t){return this.$.node("structure",this.props.flatMap(t).reduce((r,i)=>{const s=this.propsByKey[i.key];if(Ze(i))return i.kind!=="required"&&i.kind!=="optional"?R(`Map result must have kind "required" or "optional" (was ${i.kind})`):(r[i.kind]=_e(r[i.kind],i),r);const o=i.kind??(s==null?void 0:s.kind)??"required",a=xe(i,(c,l)=>c in Fo.implementation.keys?[c,l]:[]);return r[o]=_e(r[o],this.$.node(o,a)),r},{}))}assertHasKeys(t){const r=t.filter(i=>!zi(i,this.keyof()));if(r.length)return R(Ed(this.expression,r))}get(t,...r){var c;let i,s=!1;const o=M_(t);if((typeof o=="string"||typeof o=="symbol")&&this.propsByKey[o]&&(i=this.propsByKey[o].value,s=this.propsByKey[o].required),this.index)for(const l of this.index)zi(o,l.signature)&&(i=(i==null?void 0:i.and(l.value))??l.value);if(this.sequence&&zi(o,P.intrinsic.nonNegativeIntegerString))if(H(o,"root"))this.sequence.variadic&&(i=(i==null?void 0:i.and(this.sequence.element))??this.sequence.element);else{const l=Number.parseInt(o);if(l<this.sequence.prevariadic.length){const u=this.sequence.prevariadic[l].node;i=(i==null?void 0:i.and(u))??u,s||(s=l<this.sequence.prefixLength)}else if(this.sequence.variadic){const u=this.$.node("union",this.sequence.variadicOrPostfix);i=(i==null?void 0:i.and(u))??u}}if(!i)return(c=this.sequence)!=null&&c.variadic&&H(o,"root")&&o.extends(P.intrinsic.number)?R(E_(o.expression,this.sequence.expression)):R(Ed(this.expression,[o]));const a=i.get(...r);return s?a:a.or(P.intrinsic.undefined)}pick(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("pick",t))}omit(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("omit",t))}optionalize(){const{required:t,...r}=this.inner;return this.$.node("structure",{...r,optional:this.props.map(i=>i.hasKind("required")?this.$.node("optional",i.inner):i)})}require(){const{optional:t,...r}=this.inner;return this.$.node("structure",{...r,required:this.props.map(i=>i.hasKind("optional")?{key:i.key,value:i.value}:i)})}merge(t){const r=this.filterKeys("omit",[t.keyof()]);return t.required&&(r.required=_e(r.required,t.required)),t.optional&&(r.optional=_e(r.optional,t.optional)),t.index&&(r.index=_e(r.index,t.index)),t.sequence&&(r.sequence=t.sequence),t.undeclared?r.undeclared=t.undeclared:delete r.undeclared,this.$.node("structure",r)}filterKeys(t,r){const i=Eu(this.inner),s=o=>{const a=r.some(c=>zi(o,c));return t==="pick"?a:!a};return i.required&&(i.required=i.required.filter(o=>s(o.key))),i.optional&&(i.optional=i.optional.filter(o=>s(o.key))),i.index&&(i.index=i.index.filter(o=>s(o.signature))),i}get defaultable(){var t;return this.cacheGetter("defaultable",((t=this.optional)==null?void 0:t.filter(r=>r.hasDefault()))??[])}_compileDeclaresKey(t){const r=[];if(this.props.length&&r.push(`k in ${this.propsByKeyReference}`),this.index)for(const i of this.index)r.push(t.invoke(i.signature,{kind:"Allows",arg:"k"}));return this.sequence&&r.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),r.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",k_(this))}compile(t){t.traversalKind==="Apply"&&t.initializeErrorCount();for(const r of this.props)t.check(r),t.traversalKind==="Apply"&&t.returnIfFailFast();if(this.sequence&&(t.check(this.sequence),t.traversalKind==="Apply"&&t.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(t.const("keys","Object.keys(data)"),t.line("keys.push(...Object.getOwnPropertySymbols(data))"),t.for("i < keys.length",()=>this.compileExhaustiveEntry(t))),t.traversalKind==="Allows")return t.return(!0);this.structuralMorphRef&&t.if("ctx && !ctx.hasError()",()=>(t.line("ctx.queueMorphs(["),C_(t,this),t.line("])")))}compileExhaustiveEntry(t){if(t.const("k","keys[i]"),this.index)for(const r of this.index)t.if(`${t.invoke(r.signature,{arg:"k",kind:"Allows"})}`,()=>t.traverseKey("k","data[k]",r.value));return this.undeclared==="reject"&&t.if(`!(${this._compileDeclaresKey(t)})`,()=>t.traversalKind==="Allows"?t.return(!1):t.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>t.return())),t}reduceJsonSchema(t,r){var i;switch(t.type){case"object":return this.reduceObjectJsonSchema(t,r);case"array":const s=((i=this.sequence)==null?void 0:i.reduceJsonSchema(t,r))??t;return this.props.length||this.index?r.fallback.arrayObject({code:"arrayObject",base:s,object:this.reduceObjectJsonSchema({type:"object"},r)}):s;default:return Ne.throwInternalOperandError("structure",t)}}reduceObjectJsonSchema(t,r){if(this.props.length){t.properties={};for(const i of this.props){const s=i.value.toJsonSchemaRecurse(r);if(typeof i.key=="symbol"){r.fallback.symbolKey({code:"symbolKey",base:t,key:i.key,value:s,optional:i.optional});continue}if(i.hasDefault()){const o=typeof i.default=="function"?i.default():i.default;s.default=P.intrinsic.jsonData.allows(o)?o:r.fallback.defaultValue({code:"defaultValue",base:s,value:o})}t.properties[i.key]=s}this.requiredKeys.length&&t.properties&&(t.required=this.requiredKeys.filter(i=>typeof i=="string"&&i in t.properties))}if(this.index)for(const i of this.index){const s=i.value.toJsonSchemaRecurse(r);if(i.signature.equals(P.intrinsic.string)){t.additionalProperties=s;continue}for(const o of i.signature.branches){if(!o.extends(P.intrinsic.string)){t=r.fallback.symbolKey({code:"symbolKey",base:t,key:null,value:s,optional:!1});continue}let a={type:"string"};if(o.hasKind("morph")&&(a=r.fallback.morph({code:"morph",base:o.in.toJsonSchemaRecurse(r),out:o.out.toJsonSchemaRecurse(r)})),!o.hasKind("intersection"))return Ae(`Unexpected index branch kind ${o.kind}.`);const{pattern:c}=o.inner;if(c){const l=Object.assign(a,{pattern:c[0].rule});for(let u=1;u<c.length;u++)a=r.fallback.patternIntersection({code:"patternIntersection",base:l,pattern:c[u].rule});t.patternProperties??(t.patternProperties={}),t.patternProperties[l.pattern]=s}}}return this.undeclared&&!t.additionalProperties&&(t.additionalProperties=!1),t}}const Wo={},$_=e=>{var t,r;let n="";for(let i=0;i<e.defaultable.length;i++)n+=e.defaultable[i].defaultValueMorphRef;if((t=e.sequence)!=null&&t.defaultValueMorphsReference&&(n+=(r=e.sequence)==null?void 0:r.defaultValueMorphsReference),e.undeclared==="delete"){if(n+="delete !(",e.required)for(const i of e.required)n+=i.compiledKey+" | ";if(e.optional)for(const i of e.optional)n+=i.compiledKey+" | ";if(e.index)for(const i of e.index)n+=i.signature.id+" | ";if(e.sequence)if(e.sequence.maxLength===null)n+=te.nonNegativeIntegerString.id;else for(let i=0;i<e.sequence.tuple.length;i++)n+=i+" | ";n+=")"}return n},k_=e=>{const n=$_(e);if(!n)return;if(Wo[n])return Wo[n];const t=(r,i)=>{var s;for(let o=0;o<e.defaultable.length;o++)e.defaultable[o].key in r||e.defaultable[o].defaultValueMorph(r,i);if((s=e.sequence)!=null&&s.defaultables)for(let o=r.length-e.sequence.prefixLength;o<e.sequence.defaultables.length;o++)e.sequence.defaultValueMorphs[o](r,i);if(e.undeclared==="delete")for(const o in r)e.declaresKey(o)||delete r[o];return r};return Wo[n]=t},C_=(e,n)=>{var i;const r=`(data${n.defaultable.some(s=>s.defaultValueMorph.length===2)||((i=n.sequence)==null?void 0:i.defaultValueMorphs.some(s=>s.length===2))?", ctx":""})`;return e.block(`${r} => `,s=>{var o;for(let a=0;a<n.defaultable.length;a++){const{serializedKey:c,defaultValueMorphRef:l}=n.defaultable[a];s.if(`!(${c} in data)`,u=>u.line(`${l}${r}`))}return(o=n.sequence)!=null&&o.defaultables&&s.for(`i < ${n.sequence.defaultables.length}`,a=>a.set("data[i]",5),`data.length - ${n.sequence.prefixLength}`),n.undeclared==="delete"&&s.forIn("data",a=>a.if(`!(${n._compileDeclaresKey(a)})`,c=>c.line("delete data[k]"))),s.return("data")})},Md={implementation:w_,Node:S_},M_=e=>(H(e,"root")&&e.hasKind("unit")&&(e=e.unit),typeof e=="number"&&(e=`${e}`),e),E_=(e,n)=>`${e} is not allowed as an array index on ${n}. Use the 'nonNegativeIntegerString' keyword instead.`,Ho=(e,n,t)=>{const[r,i]=Ry(e.branches,o=>o.hasKind("unit"));if(!r.length)return{index:t.node("index",{signature:e,value:n})};const s={};for(const o of r){const a=t.node("required",{key:o.unit,value:n});s[a.kind]=_e(s[a.kind],a)}return i.length&&(s.index=t.node("index",{signature:i,value:n})),s},O_=e=>H(e,"root")?e.expression:ye(e),Ed=(e,n)=>`Key${n.length===1?"":"s"} ${n.map(O_).join(", ")} ${n.length===1?"does":"do"} not exist on ${e}`,ji={...bb,alias:Bo.implementation,domain:qo.implementation,unit:vd.implementation,proto:Bi.implementation,union:md.implementation,morph:fd.implementation,intersection:dd.implementation,divisor:qu.implementation,pattern:td.implementation,predicate:ju.implementation,required:xd.implementation,optional:Fo.implementation,index:_d.implementation,sequence:wd.implementation,structure:Md.implementation};P.defaultConfig=Ky(Object.assign(xe(ji,(e,n)=>[e,n.defaults]),{jitless:Xy(),clone:Jy,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:Ne.defaultConfig})),P.resolvedConfig=Ao(P.defaultConfig,P.config);const I_={..._b,alias:Bo.Node,domain:qo.Node,unit:vd.Node,proto:Bi.Node,union:md.Node,morph:fd.Node,intersection:dd.Node,divisor:qu.Node,pattern:td.Node,predicate:ju.Node,required:xd.Node,optional:Fo.Node,index:_d.Node,sequence:wd.Node,structure:Md.Node};class Go extends zy{get[Vt](){return"module"}}const Od=(e,n)=>new Go(xe(e,(t,r)=>[t,H(r,"module")?Od(r,n):n.bindReference(r)])),A_=e=>We(e)?e:"branches"in e&&We(e.branches)?e.branches:void 0,T_=(e,n)=>R(`Node of kind ${n} is not valid as a ${e} definition`),Id=e=>`#${e} duplicates public alias ${e}`,Jo={};P.ambient??(P.ambient={});let Ad;const Td="function $",R_=e=>Rd(e,Nd(e)),Rd=(e,n)=>{const t=n.write(Td,4),r=n.compile()();for(const i of e)i.precompilation||(i.traverseAllows=r[`${i.id}Allows`].bind(r),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=r[`${i.id}Apply`].bind(r),r[`${i.id}Optimistic`]&&(i.traverseOptimistic=r[`${i.id}Optimistic`].bind(r)),i.precompilation=t)},Nd=e=>new ku().return(e.reduce((n,t)=>{const r=new Eo({kind:"Allows"}).indent();t.compile(r);const i=r.write(`${t.id}Allows`),s=new Eo({kind:"Apply"}).indent();t.compile(s);const o=s.write(`${t.id}Apply`),a=`${n}${i},
${o},
`;if(!t.hasKind("union"))return a;const c=new Eo({kind:"Allows",optimistic:!0}).indent();t.compile(c);const l=c.write(`${t.id}Optimistic`);return`${a}${l},
`},`{
`)+"}");class Pd{constructor(n,t){y(this,"config");y(this,"resolvedConfig");y(this,"name");y(this,"referencesById",{});y(this,"references",[]);y(this,"resolutions",{});y(this,"exportedNames",[]);y(this,"aliases",{});y(this,"resolved",!1);y(this,"nodesByHash",{});y(this,"intrinsic");y(this,"_json");y(this,"generic",(...n)=>{const t=this;return(r,i)=>new Di(n,i?new Bu(r):r,t,t,i??null)});y(this,"units",(n,t)=>{const r=[];for(const s of n)r.includes(s)||r.push(s);const i=r.map(s=>this.node("unit",{unit:s},t));return this.node("union",i,{...t,prereduced:!0})});y(this,"lazyResolutions",[]);y(this,"schema",(n,t)=>this.finalize(this.parseSchema(n,t)));y(this,"parseSchema",(n,t)=>this.node(Vi(n),n,t));y(this,"precompilation");y(this,"_exportedResolutions");y(this,"_exports");y(this,"node",(n,t,r={})=>{const i=this.preparseNode(n,t,r);if(Ze(i))return this.bindReference(i);const s=this.createParseContext(i),o=id(s),a=this.bindReference(o);return ct[s.id]=a});y(this,"parse",(n,t={})=>this.finalize(this.parseDefinition(n,t)));this.config=Ao(P.config,t),this.resolvedConfig=Ao(P.resolvedConfig,t),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(Jo).length}`,this.name in Jo&&R(`A Scope already named ${this.name} already exists`),Jo[this.name]=this;const r=Object.entries(n).map(i=>this.preparseOwnAliasEntry(...i));for(const[i,s]of r){let o=i;if(i[0]==="#"?(o=i.slice(1),o in this.aliases&&R(Id(o)),this.aliases[o]=s):(o in this.aliases&&R(Id(i)),this.aliases[o]=s,this.exportedNames.push(o)),!H(s,"module")&&!H(s,"generic")&&!$i(s)){const a=this.preparseOwnDefinitionFormat(s,{alias:o});this.resolutions[o]=H(a,"root")?this.bindReference(a):this.createParseContext(a).id}}Ad??(Ad=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0})),this.nodesByHash[Ad.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=P.intrinsic?xe(P.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}get[Vt](){return"scope"}cacheGetter(n,t){return Object.defineProperty(this,n,{value:t}),t}get internal(){return this}get json(){return this._json||this.export(),this._json}defineSchema(n){return n}lazilyResolve(n,t){const r=this.node("alias",{reference:t??"synthetic",resolve:n},{prereduced:!0});return this.resolved||this.lazyResolutions.push(r),r}preparseNode(n,t,r){var a;let i=typeof n=="string"?n:Vi(t,n);if(Ze(t)&&t.kind===i)return t;if(i==="alias"&&!(r!=null&&r.prereduced)){const{reference:c}=Bo.implementation.normalize(t,this);if(c.startsWith("$")){const l=this.resolveRoot(c.slice(1));t=l,i=l.kind}}else if(i==="union"&&dn(t,"object")){const c=A_(t);(c==null?void 0:c.length)===1&&(t=c[0],i=Vi(t))}if(Ze(t)&&t.kind===i)return t;const s=ji[i],o=((a=s.normalize)==null?void 0:a.call(s,t,this))??t;return Ze(o)?o.kind===i?o:T_(i,o.kind):{...r,$:this,kind:i,def:o,prefix:r.alias??i}}bindReference(n){let t;return Ze(n)?t=n.$===this?n:new n.constructor(n.attachments,this):t=n.$===this?n:new Di(n.params,n.bodyDef,n.$,this,n.hkt),this.resolved||Object.assign(this.referencesById,t.referencesById),t}resolveRoot(n){return this.maybeResolveRoot(n)??R(zd(n))}maybeResolveRoot(n){const t=this.maybeResolve(n);if(!H(t,"generic"))return t}maybeResolveSubalias(n){return Yo(this.aliases,n)??Yo(this.ambient,n)}get ambient(){return P.ambient}maybeResolve(n){var i;const t=this.resolutions[n];if(t){if(typeof t!="string")return this.bindReference(t);const s=ct[t];if(H(s,"root"))return this.resolutions[n]=s;if(H(s,"context")){if(s.phase==="resolving")return this.node("alias",{reference:`$${n}`},{prereduced:!0});if(s.phase==="resolved")return Ae(`Unexpected resolved context for was uncached by its scope: ${ye(s)}`);s.phase="resolving";const o=this.bindReference(this.parseOwnDefinitionFormat(s.def,s));return s.phase="resolved",ct[o.id]=o,ct[s.id]=o,this.resolutions[n]=o}return Ae(`Unexpected nodesById entry for ${t}: ${ye(s)}`)}let r=this.aliases[n]??((i=this.ambient)==null?void 0:i[n]);return r?(r=this.normalizeRootScopeValue(r),H(r,"generic")?this.resolutions[n]=this.bindReference(r):H(r,"module")?(r.root||R(Bd(n)),this.resolutions[n]=this.bindReference(r.root)):this.resolutions[n]=this.parse(r,{alias:n})):this.maybeResolveSubalias(n)}createParseContext(n){const t=n.id??rd(n.prefix);return ct[t]=Object.assign(n,{[Vt]:"context",$:this,id:t,phase:"unresolved"})}traversal(n){return new Bn(n,this.resolvedConfig)}import(...n){return new Go(xe(this.export(...n),(t,r)=>[`#${t}`,r]))}export(...n){if(!this._exports){this._exports={};for(const r of this.exportedNames){const i=this.aliases[r];this._exports[r]=H(i,"module")?Od(i,this):Vd(this.maybeResolve(r))}for(const r of this.lazyResolutions)r.resolution;if(this._exportedResolutions=Ld(this,this._exports),this._json=Fd(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const r=Nd(this.references);this.precompilation=r.write(Td,4),Rd(this.references,r)}this.resolved=!0}const t=n.length?n:this.exportedNames;return new Go(xe(t,(r,i)=>[i,this._exports[i]]))}resolve(n){return this.export()[n]}parseDefinition(n,t={}){if(H(n,"root"))return this.bindReference(n);const r=this.preparseOwnDefinitionFormat(n,t);if(H(r,"root"))return this.bindReference(r);const i=this.createParseContext(r);ct[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(n,i));return s.isCyclic&&(s=kb(s,i.id)),ct[i.id]=s,s}finalize(n){return Vd(n),!n.precompilation&&!this.resolvedConfig.jitless&&R_(n.references),n}}class Dd extends Pd{parseOwnDefinitionFormat(n,t){return id(t)}preparseOwnDefinitionFormat(n,t){return this.preparseNode(Vi(n),n,t)}preparseOwnAliasEntry(n,t){return[n,t]}normalizeRootScopeValue(n){return n}}const Vd=e=>{const n=e.references.filter(t=>t.hasKind("alias"));for(const t of n){Object.assign(t.referencesById,t.resolution.referencesById);for(const r of e.references)t.id in r.referencesById&&Object.assign(r.referencesById,t.referencesById)}return e},Fd=e=>xe(e,(n,t)=>[n,H(t,"root")||H(t,"generic")?t.json:H(t,"module")?Fd(t):Ae(`Unexpected resolution ${ye(t)}`)]),Yo=(e,n)=>{const t=n.indexOf(".");if(t===-1)return;const r=n.slice(0,t),i=e[r];if(i===void 0)return;if(!H(i,"module"))return R(N_(r));const s=n.slice(t+1),o=i[s];if(o===void 0)return Yo(i,s);if(H(o,"root")||H(o,"generic"))return o;if(H(o,"module"))return o.root??R(Bd(n));Ae(`Unexpected resolution for alias '${n}': ${ye(o)}`)},Zo=(e,n)=>new Dd(e,n),Rr=new Dd({}),Ld=(e,n)=>{const t={};for(const r in n){const i=n[r];if(H(i,"module")){const s=Ld(e,i),o=xe(s,(a,c)=>[`${r}.${a}`,c]);Object.assign(t,o)}else H(i,"root")||H(i,"generic")?t[r]=i:Ae(`Unexpected scope resolution ${ye(i)}`)}return t},zd=e=>`'${e}' is unresolvable`,N_=e=>`'${e}' must reference a module to be accessed using dot syntax`,Bd=e=>`Reference to submodule '${e}' must specify an alias`;Rr.export();const we=Rr.schema,Xo=Rr.node;Rr.defineSchema;const zt=Rr.generic,jd="^(?:0|[1-9]\\d*)$",P_=new RegExp(jd);Ye(P_);const qd=Zo({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();P.intrinsic={...qd};const Ud=Zo({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:jd}},{prereducedAliases:!0}).export();Object.assign(P.intrinsic,Ud);const D_=Zo({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),te={...qd,...Ud,...D_,emptyStructure:Xo("structure",{},{prereduced:!0})};P.intrinsic={...te};const V_=e=>typeof e=="string"&&e[0]==="d"&&(e[1]==="'"||e[1]==='"')&&e.at(-1)===e[1],Kd=e=>e.toString()!=="Invalid Date",F_=e=>e.slice(2,-1),Wd=e=>`'${e}' could not be parsed by the Date constructor`,L_=(e,n)=>z_(e,n),z_=(e,n)=>{const t=new Date(e);if(Kd(t))return t;const r=mv(e);if(r!==void 0){const i=new Date(r);if(Kd(i))return i}return n?R(n===!0?Wd(e):n):void 0},Hd=(e,n)=>{const t=e.scanner.shiftUntil(j_[Jd[n]]);if(e.scanner.lookahead==="")return e.error(U_(t,n));if(e.scanner.shift(),n==="/"){try{new RegExp(t)}catch(r){R(String(r))}e.root=e.ctx.$.node("intersection",{domain:"string",pattern:t},{prereduced:!0})}else if(kt(n,Gd))e.root=e.ctx.$.node("unit",{unit:t});else{const r=L_(t,Wd(t));e.root=e.ctx.$.node("unit",{meta:t,unit:r})}},Gd={"'":1,'"':1},B_={"/":1,"'":1,'"':1},Jd={"d'":"'",'d"':'"',"'":"'",'"':'"',"/":"/"},j_={"'":e=>e.lookahead==="'",'"':e=>e.lookahead==='"',"/":e=>e.lookahead==="/"},q_={'"':"double-quote","'":"single-quote","/":"forward slash"},U_=(e,n)=>`${n}${e} requires a closing ${q_[Jd[n]]}`,K_=e=>`Private type references should not include '#'. Use '${e}' instead.`,Yd="Optional definitions like 'string?' are only valid as properties in an object or tuple",Zd="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",W_={">":!0,">=":!0},H_={"<":!0,"<=":!0},qi={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},G_=e=>`Unmatched )${e===""?"":` before ${e}`}`,Xd=e=>`Missing ${e}`,J_=(e,n)=>`Left bounds are only valid when paired with right bounds (try ...${n}${e})`,Qd=e=>`Left-bounded expressions must specify their limits using < or <= (was ${e})`,Y_=(e,n,t,r)=>`An expression may have at most one left bound (parsed ${e}${qi[n]}, ${t}${qi[r]})`,Z_=(e,n,t)=>eh(e,n,t,[]),eh=(e,n,t,r)=>{const i=t.parseUntilFinalizer();return r.push(i.root),i.finalizer===">"?r.length!==n.params.length?t.error(th(e,n.names,r.map(s=>s.expression))):r:i.finalizer===","?eh(e,n,t,r):i.error(Xd(">"))},th=(e,n,t)=>`${e}<${n.join(", ")}> requires exactly ${n.length} args (got ${t.length}${t.length===0?"":`: ${t.join(", ")}`})`,nh=e=>{const n=e.scanner.shiftUntilNextTerminator();n==="keyof"?e.addPrefix("keyof"):e.root=Q_(e,n)},X_=(e,n,t)=>{if(t.scanner.shiftUntilNonWhitespace(),t.scanner.shift()!=="<")return t.error(th(e,n.names,[]));const i=Z_(e,n,t);return n(...i)},Q_=(e,n)=>e0(e,n)??t0(e,n)??e.error(n===""?e.scanner.lookahead==="#"?K_(e.shiftedByOne().scanner.shiftUntilNextTerminator()):rh(e):zd(n)),e0=(e,n)=>{var r;if((r=e.ctx.args)!=null&&r[n]){const i=e.ctx.args[n];return typeof i!="string"?i:e.ctx.$.node("alias",{reference:i},{prereduced:!0})}const t=e.ctx.$.maybeResolve(n);if(H(t,"root"))return t;if(t!==void 0)return H(t,"generic")?X_(n,t,e):R(`Unexpected resolution ${ye(t)}`)},t0=(e,n)=>{const t=gv(n);if(t!==void 0)return e.ctx.$.node("unit",{unit:t});const r=vv(n);if(r!==void 0)return e.ctx.$.node("unit",{unit:r})},rh=e=>{const n=e.previousOperator();return n?ih(n,e.scanner.unscanned):n0(e.scanner.unscanned)},ih=(e,n="")=>`Token '${e}' requires a right operand${n?` before '${n}'`:""}`,n0=e=>`Expected an expression${e?` before '${e}'`:""}`,sh=e=>e.scanner.lookahead===""?e.error(rh(e)):e.scanner.lookahead==="("?e.shiftedByOne().reduceGroupOpen():e.scanner.lookaheadIsIn(B_)?Hd(e,e.scanner.shift()):e.scanner.lookaheadIsIn(ki)?sh(e.shiftedByOne()):e.scanner.lookahead==="d"&&e.scanner.nextLookahead in Gd?Hd(e,`${e.scanner.shift()}${e.scanner.shift()}`):nh(e),vn=class vn extends $v{shiftUntilNextTerminator(){return this.shiftUntilNonWhitespace(),this.shiftUntil(()=>this.lookahead in vn.terminatingChars)}};y(vn,"terminatingChars",{"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...ki}),y(vn,"finalizingLookaheads",{">":1,",":1,"":1,"=":1,"?":1}),y(vn,"lookaheadIsFinalizing",(n,t)=>n===">"?t[0]==="="?t[1]==="=":t.trimStart()===""||kt(t.trimStart()[0],vn.terminatingChars):n==="="?t[0]!=="=":n===","||n==="?");let Nr=vn;const r0=(e,n)=>{const t=s0(e,n);if(e.root.hasKind("unit")){if(typeof e.root.unit=="number"){e.reduceLeftBound(e.root.unit,t),e.unsetRoot();return}if(e.root.unit instanceof Date){const r=`d'${e.root.description??e.root.unit.toISOString()}'`;e.unsetRoot(),e.reduceLeftBound(r,t);return}}return a0(e,t)},i0={"<":1,">":1,"=":1},s0=(e,n)=>e.scanner.lookaheadIs("=")?`${n}${e.scanner.shift()}`:n,oh=(e,n,t,r)=>t.extends(P.intrinsic.number)?typeof n!="number"?R(Qo(e,n,r)):e==="=="?["min","max"]:e[0]===">"?["min"]:["max"]:t.extends(P.intrinsic.lengthBoundable)?typeof n!="number"?R(Qo(e,n,r)):e==="=="?["exactLength"]:e[0]===">"?["minLength"]:["maxLength"]:t.extends(P.intrinsic.Date)?e==="=="?["after","before"]:e[0]===">"?["after"]:["before"]:R(ib(t.expression)),o0=e=>({rule:V_(e.limit)?F_(e.limit):e.limit,exclusive:e.comparator.length===1}),a0=(e,n)=>{const t=e.unsetRoot(),r=e.scanner.location;e.parseOperand();const i=e.unsetRoot(),s=e.scanner.sliceChars(r,e.scanner.location);if(e.root=t,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return e.error(Qo(n,s,"right"));const o=i.unit,a=n.length===1,c=oh(n,typeof o=="number"?o:s,t,"right");for(const u of c)e.constrainRoot(u,n==="=="?{rule:o}:{rule:o,exclusive:a});if(!e.branches.leftBound)return;if(!kt(n,H_))return e.error(Qd(n));const l=oh(e.branches.leftBound.comparator,e.branches.leftBound.limit,t,"left");e.constrainRoot(l[0],o0(e.branches.leftBound)),e.branches.leftBound=null},Qo=(e,n,t)=>`Comparator ${t==="left"?qi[e]:e} must be ${t==="left"?"preceded":"followed"} by a corresponding literal (was ${n})`,l0=e=>{e.scanner.shiftUntilNonWhitespace();const n=e.scanner.shiftUntilNextTerminator();e.root=e.root.brand(n)},c0=e=>{const n=e.scanner.shiftUntilNextTerminator(),t=yv(n,{errorOnFail:ah(n)});t===0&&e.error(ah(0)),e.root=e.root.constrain("divisor",t)},ah=e=>`% operator must be followed by a non-zero integer literal (was ${e})`,lh=e=>{const n=e.scanner.shift();return n===""?e.finalize(""):n==="["?e.scanner.shift()==="]"?e.setRoot(e.root.array()):e.error(u0):n==="|"?e.scanner.lookahead===">"?e.shiftedByOne().pushRootToBranch("|>"):e.pushRootToBranch(n):n==="&"?e.pushRootToBranch(n):n===")"?e.finalizeGroup():Nr.lookaheadIsFinalizing(n,e.scanner.unscanned)?e.finalize(n):kt(n,i0)?r0(e,n):n==="%"?c0(e):n==="#"?l0(e):n in ki?lh(e):e.error(ea(n))},ea=(e,n="")=>`'${e}' is not allowed here${n&&` (should be ${n})`}`,u0="Missing expected ']'",d0=e=>{const n=e.unsetRoot();e.parseOperand();const t=e.unsetRoot();if(!t.hasKind("unit"))return e.error(h0(t.expression));const r=t.unit instanceof Date?()=>new Date(t.unit):t.unit;return[n,"=",r]},h0=e=>`Default value '${e}' must a literal value`,ch=(e,n)=>{const t=n.$.maybeResolveRoot(e);if(t)return t;if(e.endsWith("[]")){const s=n.$.maybeResolveRoot(e.slice(0,-2));if(s)return s.array()}const r=new Ui(new Nr(e),n),i=f0(r);return r.finalizer===">"&&R(ea(">")),i},f0=e=>{e.parseOperand();let n=ta(e).root;return n?(e.finalizer==="="?n=d0(e):e.finalizer==="?"&&(n=[n,"?"]),e.scanner.shiftUntilNonWhitespace(),e.scanner.lookahead&&R(ea(e.scanner.lookahead)),n):Ae(`Root was unexpectedly unset after parsing string '${e.scanner.scanned}'`)},ta=e=>{for(;e.finalizer===void 0;)p0(e);return e},p0=e=>e.hasRoot()?e.parseOperator():e.parseOperand();class Ui{constructor(n,t){y(this,"root");y(this,"branches",{prefixes:[],leftBound:null,intersection:null,union:null,pipe:null});y(this,"finalizer");y(this,"groups",[]);y(this,"scanner");y(this,"ctx");this.scanner=n,this.ctx=t}error(n){return R(n)}hasRoot(){return this.root!==void 0}setRoot(n){this.root=n}unsetRoot(){const n=this.root;return this.root=void 0,n}constrainRoot(...n){this.root=this.root.constrain(n[0],n[1])}finalize(n){if(this.groups.length)return this.error(Xd(")"));this.finalizeBranches(),this.finalizer=n}reduceLeftBound(n,t){const r=qi[t];if(!kt(r,W_))return this.error(Qd(t));if(this.branches.leftBound)return this.error(Y_(this.branches.leftBound.limit,this.branches.leftBound.comparator,n,r));this.branches.leftBound={comparator:r,limit:n}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const n=this.groups.pop();if(!n)return this.error(G_(this.scanner.unscanned));this.branches=n}addPrefix(n){this.branches.prefixes.push(n)}applyPrefixes(){for(;this.branches.prefixes.length;){const n=this.branches.prefixes.pop();this.root=n==="keyof"?this.root.keyof():Ae(`Unexpected prefix '${n}'`)}}pushRootToBranch(n){var r,i,s;this.assertRangeUnset(),this.applyPrefixes();const t=this.root;this.root=void 0,this.branches.intersection=((r=this.branches.intersection)==null?void 0:r.rawAnd(t))??t,n!=="&"&&(this.branches.union=((i=this.branches.union)==null?void 0:i.rawOr(this.branches.intersection))??this.branches.intersection,this.branches.intersection=null,n!=="|"&&(this.branches.pipe=((s=this.branches.pipe)==null?void 0:s.rawPipeOnce(this.branches.union))??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return ta(new Ui(this.scanner,this.ctx))}parseOperator(){return lh(this)}parseOperand(){return sh(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(J_(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){var n;return((n=this.branches.leftBound)==null?void 0:n.comparator)??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const m0="An empty string is not a valid generic parameter name",na=(e,n,t)=>{e.shiftUntilNonWhitespace();const r=e.shiftUntilNextTerminator();return r===""?e.lookahead===""&&n.length?n:R(m0):(e.shiftUntilNonWhitespace(),g0(e,r,n,t))},uh="extends ",g0=(e,n,t,r)=>{if(e.shiftUntilNonWhitespace(),e.unscanned.startsWith(uh))e.jumpForward(uh.length);else return e.lookahead===","&&e.shift(),t.push(n),na(e,t,r);const i=ta(new Ui(e,r));return t.push([n,i.root]),na(e,t,r)};class y0 extends Fn{constructor(t){super((...r)=>new Ki(t)(...r),{bind:t});y(this,"$");this.$=t}in(t){return new Ki(this.$,t===void 0?void 0:this.$.parse(t))}at(t,r){return new Ki(this.$).at(t,r)}case(t,r){return new Ki(this.$).case(t,r)}}class Ki extends Fn{constructor(t,r){super(i=>this.caseEntries(Object.entries(i).map(([s,o])=>s==="default"?[s,o]:[this.$.parse(s),o])));y(this,"$");y(this,"in");y(this,"key");y(this,"branches",[]);this.$=t,this.in=r}at(t,r){return this.key&&R(b0),this.branches.length&&R(v0),this.key=t,r?this.match(r):this}case(t,r){return this.caseEntry(this.$.parse(t),r)}caseEntry(t,r){const s=(this.key?this.$.parse({[this.key]:t}):t).pipe(r);return this.branches.push(s),this}match(t){return this(t)}strings(t){return this.caseEntries(Object.entries(t).map(([r,i])=>r==="default"?[r,i]:[this.$.node("unit",{unit:r}),i]))}caseEntries(t){for(let r=0;r<t.length;r++){const[i,s]=t[r];if(i==="default")return r!==t.length-1&&R("default may only be specified as the last key of a switch definition"),this.default(s);if(typeof s!="function")return R(`Value for case "${i}" must be a function (was ${ft(s)})`);this.caseEntry(i,s)}return this}default(t){typeof t=="function"&&this.case(te.unknown,t);const r={branches:this.branches,ordered:!0};(t==="never"||t==="assert")&&(r.meta={onFail:dh});const i=this.$.node("union",r);if(!this.in)return this.$.finalize(i);let s=this.in.pipe(i);return(t==="never"||t==="assert")&&(s=s.configureReferences({onFail:dh},"self")),this.$.finalize(s)}}const dh=e=>e.throw(),v0="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",b0="At most one key matcher may be specified per expression",hh=(e,n)=>{if(We(e)){if(e[1]==="=")return[n.$.parseOwnDefinitionFormat(e[0],n),"=",e[2]];if(e[1]==="?")return[n.$.parseOwnDefinitionFormat(e[0],n),"?"]}return wh(e,n)},_0="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",x0="Only required keys may specify default values, e.g. { value: 'number = 0' }",w0=(e,n)=>{var o;let t;const r={},i=Si(e);for(const[a,c]of i){const l=k0(a);if(l.kind==="spread"){if(!wr(r))return R($0);const p=n.$.parseOwnDefinitionFormat(c,n);if(p.equals(te.object))continue;if(!p.hasKind("intersection")||!((o=p.basis)!=null&&o.equals(te.object)))return R(C0(p.expression));t=p.structure;continue}if(l.kind==="undeclared"){c!=="reject"&&c!=="delete"&&c!=="ignore"&&R(S0(c)),r.undeclared=c;continue}const u=hh(c,n),d=l;if(l.kind==="required"){We(u)?ra(r,"optional",u[1]==="="?{key:l.normalized,value:u[0],default:u[2]}:{key:l.normalized,value:u[0]},n):ra(r,"required",{key:l.normalized,value:u},n);continue}if(We(u)&&(u[1]==="?"&&R(_0),u[1]==="="&&R(x0)),l.kind==="optional"){ra(r,"optional",{key:l.normalized,value:u},n);continue}const h=n.$.parseOwnDefinitionFormat(d.normalized,n),f=Ho(h,u,n.$);f.index&&(r.index=_e(r.index,f.index)),f.required&&(r.required=_e(r.required,f.required))}const s=n.$.node("structure",r);return n.$.parseSchema({domain:"object",structure:(t==null?void 0:t.merge(s))??s})},ra=(e,n,t,r)=>{e[n]=_e(e[n],r.$.node(n,t))},S0=e=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${ye(e)})`,$0="Spread operator may only be used as the first key in an object",k0=e=>typeof e=="symbol"?{kind:"required",normalized:e}:e.at(-1)==="?"?e.at(-2)===_o?{kind:"required",normalized:`${e.slice(0,-2)}?`}:{kind:"optional",normalized:e.slice(0,-1)}:e[0]==="["&&e.at(-1)==="]"?{kind:"index",normalized:e.slice(1,-1)}:e[0]===_o&&e[1]==="["&&e.at(-1)==="]"?{kind:"required",normalized:e.slice(1)}:e==="..."?{kind:"spread"}:e==="+"?{kind:"undeclared"}:{kind:"required",normalized:e==="\\..."?"...":e==="\\+"?"+":e},C0=e=>`Spread operand must resolve to an object literal type (was ${e})`,M0=(e,n)=>D0(e)?gh[e[0]](e,n):P0(e)?mh[e[1]](e,n):null,E0=(e,n)=>n.$.parseOwnDefinitionFormat(e[1],n).keyof(),ia=(e,n)=>{if(e[2]===void 0)return R(ih(e[1],""));const t=n.$.parseOwnDefinitionFormat(e[0],n),r=n.$.parseOwnDefinitionFormat(e[2],n);if(e[1]==="|")return n.$.node("union",{branches:[t,r]});const i=e[1]==="&"?Lt(t,r,n.$):Ro(t,r,n.$);return i instanceof z?i.throw():i},O0=(e,n)=>n.$.parseOwnDefinitionFormat(e[0],n).array(),I0=(e,n)=>typeof e[2]!="function"?R(fh("=>",e[2])):n.$.parseOwnDefinitionFormat(e[0],n).pipe(e[2]),fh=(e,n)=>`${e===":"?"Narrow":"Morph"} expression requires a function following '${e}' (was ${typeof n})`,A0=(e,n)=>typeof e[2]!="function"?R(fh(":",e[2])):n.$.parseOwnDefinitionFormat(e[0],n).constrain("predicate",e[2]),T0=(e,n)=>n.$.parseOwnDefinitionFormat(e[0],n).configureReferences(e[2],"shallow"),ph=e=>e,R0=ph({"[]":O0,"?":()=>R(Yd)}),N0=ph({"|":ia,"&":ia,":":A0,"=>":I0,"|>":ia,"@":T0,"=":()=>R(Zd)}),mh={...R0,...N0},P0=e=>mh[e[1]]!==void 0,gh=(e=>e)({keyof:E0,instanceof:(e,n)=>{if(typeof e[1]!="function")return R(yh(vo(e[1])));const t=e.slice(1).map(r=>typeof r=="function"?n.$.node("proto",{proto:r}):R(yh(vo(r))));return t.length===1?t[0]:n.$.node("union",{branches:t})},"===":(e,n)=>n.$.units(e.slice(1))}),D0=e=>gh[e[0]]!==void 0,yh=e=>`Expected a constructor following 'instanceof' operator (was ${e})`,V0=(e,n)=>{let t=[{}],r=0;for(;r<e.length;){let i=!1;e[r]==="..."&&r<e.length-1&&(i=!0,r++);const s=hh(e[r],n),[o,a,c]=We(s)?s:[s];if(r++,i){if(!o.extends(P.intrinsic.Array))return R(z0(o.expression));t=t.flatMap(l=>o.distribute(u=>L0(Eu(l),u)))}else t=t.map(l=>a==="?"?vh(l,o):a==="="?F0(l,o,c):sa(l,o))}return n.$.parseSchema(t.map(i=>wr(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},sa=(e,n)=>e.defaultables||e.optionals?R(e.variadic?$d:B0):(e.variadic?e.postfix=_e(e.postfix,n):e.prefix=_e(e.prefix,n),e),vh=(e,n)=>e.variadic?R(xh):(e.optionals=_e(e.optionals,n),e),F0=(e,n,t)=>e.variadic?R(xh):e.optionals?R(j0):(e.defaultables=_e(e.defaultables,[[n,t]]),e),bh=(e,n)=>(e.postfix&&R(_h),e.variadic?e.variadic.equals(n)||R(_h):e.variadic=n.internal,e),L0=(e,n)=>{const t=n.select({method:"find",kind:"sequence"});if(!t)return bh(e,P.intrinsic.unknown);if(t.prefix)for(const r of t.prefix)sa(e,r);if(t.optionals)for(const r of t.optionals)vh(e,r);if(t.variadic&&bh(e,t.variadic),t.postfix)for(const r of t.postfix)sa(e,r);return e},z0=e=>`Spread element must be an array (was ${e})`,_h="A tuple may have at most one variadic element",B0="A required element may not follow an optional element",xh="An optional element may not follow a variadic element",j0="A defaultable element may not follow an optional element without a default",oa={},wh=(e,n)=>{var t;if(typeof e=="string"){if(n.args&&Object.keys(n.args).some(i=>e.includes(i)))return ch(e,n);const r=oa[t=n.$.name]??(oa[t]={});return r[e]??(r[e]=ch(e,n))}return dn(e,"object")?q0(e,n):R(aa(ft(e)))},q0=(e,n)=>{const t=yo(e);switch(t){case void 0:return H(e,"root")?e:w0(e,n);case"Array":return U0(e,n);case"RegExp":return n.$.node("intersection",{domain:"string",pattern:e},{prereduced:!0});case"Function":{const r=$i(e)?e():e;return H(r,"root")?r:R(aa("Function"))}default:return R(aa(t??ye(e)))}},U0=(e,n)=>M0(e,n)??V0(e,n),aa=e=>`Type definitions must be strings or objects (was ${e})`;class K0 extends Fn{constructor(n){const t=Object.assign({errors:Jt,hkt:Ct,$:n,raw:n.parse,module:n.constructor.module,scope:n.constructor.scope,define:n.define,match:n.match,generic:n.generic,schema:n.schema,keywords:n.ambient,unit:n.unit,enumerated:n.enumerated,instanceOf:n.instanceOf,valueOf:n.valueOf,or:n.or,and:n.and,merge:n.merge,pipe:n.pipe},n.ambientAttachments);super((...r)=>{if(r.length===1)return n.parse(r[0]);if(r.length===2&&typeof r[0]=="string"&&r[0][0]==="<"&&r[0].at(-1)===">"){const i=r[0].slice(1,-1),s=n.parseGenericParams(i,{});return new Di(s,r[1],n,n,null)}return n.parse(r)},{bind:n,attach:t})}}const Pr=P,Xn=class Xn extends Pd{constructor(){super(...arguments);y(this,"unit",t=>this.units([t]));y(this,"valueOf",t=>this.units(Wy(t)));y(this,"enumerated",(...t)=>this.units(t));y(this,"instanceOf",t=>this.node("proto",{proto:t},{prereduced:!0}));y(this,"or",(...t)=>this.schema(t.map(r=>this.parse(r))));y(this,"and",(...t)=>t.reduce((r,i)=>r.and(this.parse(i)),this.intrinsic.unknown));y(this,"merge",(...t)=>t.reduce((r,i)=>r.merge(this.parse(i)),this.intrinsic.object));y(this,"pipe",(...t)=>this.intrinsic.unknown.pipe(...t));y(this,"match",new y0(this));y(this,"declare",()=>({type:this.type}));y(this,"type",new K0(this))}get ambientAttachments(){if(Pr.typeAttachments)return this.cacheGetter("ambientAttachments",xe(Pr.typeAttachments,(t,r)=>[t,this.bindReference(r)]))}preparseOwnAliasEntry(t,r){var a;const i=t.indexOf("<");if(i===-1){if(H(r,"module")||H(r,"generic"))return[t,r];const c=this.name==="ark"?t:t==="root"?this.name:`${this.name}.${t}`,l=(a=this.resolvedConfig.keywords)==null?void 0:a[c];return l&&(r=[r,"@",l]),[t,r]}t.at(-1)!==">"&&R("'>' must be the last character of a generic declaration in a scope");const s=t.slice(0,i),o=t.slice(i+1,-1);return[s,()=>{const c=this.parseGenericParams(o,{alias:s});return Uv(c,r,this)}]}parseGenericParams(t,r){return na(new Nr(t),[],this.createParseContext({...r,def:t,prefix:"generic"}))}normalizeRootScopeValue(t){return $i(t)&&!H(t,"generic")?t():t}preparseOwnDefinitionFormat(t,r){return{...r,def:t,prefix:r.alias??"type"}}parseOwnDefinitionFormat(t,r){!(r.alias&&r.alias in this.aliases)&&!r.args&&(r.args={this:r.id});const s=wh(t,r);if(We(s)){if(s[1]==="=")return R(Zd);if(s[1]==="?")return R(Yd)}return s}define(t){return t}};y(Xn,"scope",(t,r={})=>new Xn(t,r)),y(Xn,"module",(t,r={})=>Xn.scope(t,r).export());let Wi=Xn;const W0=Object.assign(Wi.scope,{define:e=>e}),he=Wi;class H0 extends Ct{constructor(){super(...arguments);y(this,"description",'merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`')}}const G0=zt(["base",te.object],["props",te.object])(e=>e.base.merge(e.props),H0),J0=he.module({Key:te.key,Merge:G0});class Y0 extends Ct{}const Z0=zt("element")(e=>{const n=e.element.exclude(te.Array),t=n.array();return n.rawOr(t).pipe(xr).distribute(r=>r.assertHasKind("morph").declareOut(t),we)},Y0),X0=he.module({root:te.Array,readonly:"root",index:te.nonNegativeIntegerString,liftFrom:Z0},{name:"Array"}),la=we(["string",Sr.FileConstructor]),Q0=la.rawOr(la.array()),Sh=we({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:Q0}}),ex=he.module({root:["instanceof",FormData],value:la,parsed:Sh,parse:we({in:FormData,morphs:e=>{const n={};for(const[t,r]of e)if(t in n){const i=n[t];typeof i=="string"||i instanceof Sr.FileConstructor?n[t]=[i,r]:i.push(r)}else n[t]=r;return n},declaredOut:Sh})},{name:"FormData"}),tx=he.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),nx={Boolean:1,Number:1,String:1},rx=he.module({...xe({...uu,...hu},(e,n)=>e in nx?[]:[e,["instanceof",n]]),Array:X0,TypedArray:tx,FormData:ex}),ix=we({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),sx=we({domain:"number",divisor:1}),$h=he.module({root:te.number,integer:sx,epoch:ix,safe:we({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),Se=(e,n,t)=>{const r={domain:"string",pattern:{rule:e.source,flags:e.flags,meta:n}};return t&&(r.meta={format:t}),Xo("intersection",r)},kh=Se(Ci,"a well-formed integer string"),Ch=he.module({root:kh,parse:we({in:kh,morphs:(e,n)=>{const t=Number.parseInt(e);return Number.isSafeInteger(t)?t:n.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:te.integer})},{name:"string.integer"}),ox=Se(/^[\dA-Fa-f]+$/,"hex characters only"),ax=he.module({root:Se(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:Se(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),Mh=Se(/^[A-Z].*$/,"capitalized"),lx=he.module({root:we({in:"string",morphs:e=>e.charAt(0).toUpperCase()+e.slice(1),declaredOut:Mh}),preformatted:Mh},{name:"string.capitalize"}),cx=e=>{const n=e.replaceAll(/[ -]+/g,"");let t=0,r,i,s=!1;for(let o=n.length-1;o>=0;o--)r=n.substring(o,o+1),i=Number.parseInt(r,10),s?(i*=2,t+=i>=10?i%10+1:i):t+=i,s=!s;return!!(t%10===0&&n)},ux=we({domain:"string",pattern:{meta:"a credit card number",rule:/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/.source},predicate:{meta:"a credit card number",predicate:cx}}),dx=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Eh=we({domain:"string",predicate:{meta:"a parsable date",predicate:e=>!Number.isNaN(new Date(e).valueOf())}}).assertHasKind("intersection"),Oh=Ch.root.internal.narrow((e,n)=>{const t=Number.parseInt(e),r=$h.epoch(t);return r instanceof Jt?(n.errors.merge(r),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),hx=he.module({root:Oh,parse:we({in:Oh,morphs:e=>new Date(e),declaredOut:te.Date})},{name:"string.date.epoch"}),Ih=Se(dx,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),fx=he.module({root:Ih,parse:we({in:Ih,morphs:e=>new Date(e),declaredOut:te.Date})},{name:"string.date.iso"}),px=he.module({root:Eh,parse:we({declaredIn:Eh,in:"string",morphs:(e,n)=>{const t=new Date(e);return Number.isNaN(t.valueOf())?n.error("a parsable date"):t},declaredOut:te.Date}),iso:fx,epoch:hx},{name:"string.date"}),mx=Se(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),Ah="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",Zt=`(${Ah}[.]){3}${Ah}`,gx=new RegExp(`^${Zt}$`),Te="(?:[0-9a-fA-F]{1,4})",yx=new RegExp(`^((?:${Te}:){7}(?:${Te}|:)|(?:${Te}:){6}(?:${Zt}|:${Te}|:)|(?:${Te}:){5}(?::${Zt}|(:${Te}){1,2}|:)|(?:${Te}:){4}(?:(:${Te}){0,1}:${Zt}|(:${Te}){1,3}|:)|(?:${Te}:){3}(?:(:${Te}){0,2}:${Zt}|(:${Te}){1,4}|:)|(?:${Te}:){2}(?:(:${Te}){0,3}:${Zt}|(:${Te}){1,5}|:)|(?:${Te}:){1}(?:(:${Te}){0,4}:${Zt}|(:${Te}){1,6}|:)|(?::((?::${Te}){0,5}:${Zt}|(?::${Te}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),vx=he.module({root:["v4 | v6","@","an IP address"],v4:Se(gx,"an IPv4 address","ipv4"),v6:Se(yx,"an IPv6 address","ipv6")},{name:"string.ip"}),Hn="a JSON string",Th=e=>{if(!(e instanceof SyntaxError))throw e;return`must be ${Hn} (${e})`},bx=we({meta:Hn,domain:"string",predicate:{meta:Hn,predicate:(e,n)=>{try{return JSON.parse(e),!0}catch(t){return n.reject({code:"predicate",expected:Hn,problem:Th(t)})}}}}),_x=(e,n)=>{if(e.length===0)return n.error({code:"predicate",expected:Hn,actual:"empty"});try{return JSON.parse(e)}catch(t){return n.error({code:"predicate",expected:Hn,problem:Th(t)})}},xx=he.module({root:bx,parse:we({meta:"safe JSON string parser",in:"string",morphs:_x,declaredOut:te.jsonObject})},{name:"string.json"}),Rh=Se(/^[a-z]*$/,"only lowercase letters"),wx=he.module({root:we({in:"string",morphs:e=>e.toLowerCase(),declaredOut:Rh}),preformatted:Rh},{name:"string.lower"}),Nh=["NFC","NFD","NFKC","NFKD"],Dr=xe(Nh,(e,n)=>[n,we({domain:"string",predicate:t=>t.normalize(n)===t,meta:`${n}-normalized unicode`})]),Hi=xe(Nh,(e,n)=>[n,we({in:"string",morphs:t=>t.normalize(n),declaredOut:Dr[n]})]),Sx=he.module({root:Hi.NFC,preformatted:Dr.NFC},{name:"string.normalize.NFC"}),$x=he.module({root:Hi.NFD,preformatted:Dr.NFD},{name:"string.normalize.NFD"}),kx=he.module({root:Hi.NFKC,preformatted:Dr.NFKC},{name:"string.normalize.NFKC"}),Cx=he.module({root:Hi.NFKD,preformatted:Dr.NFKD},{name:"string.normalize.NFKD"}),Mx=he.module({root:"NFC",NFC:Sx,NFD:$x,NFKC:kx,NFKD:Cx},{name:"string.normalize"}),Ph=Se(xo,"a well-formed numeric string"),Ex=he.module({root:Ph,parse:we({in:Ph,morphs:e=>Number.parseFloat(e),declaredOut:te.number})},{name:"string.numeric"}),Dh="a regex pattern",Ox=we({domain:"string",predicate:{meta:Dh,predicate:(e,n)=>{try{return new RegExp(e),!0}catch(t){return n.reject({code:"predicate",expected:Dh,problem:String(t)})}}},meta:{format:"regex"}}),Ix=Se(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,"a semantic version (see https://semver.org/)"),Vh=Se(/^\S.*\S$|^\S?$/,"trimmed"),Ax=he.module({root:we({in:"string",morphs:e=>e.trim(),declaredOut:Vh}),preformatted:Vh},{name:"string.trim"}),Fh=Se(/^[A-Z]*$/,"only uppercase letters"),Tx=he.module({root:we({in:"string",morphs:e=>e.toUpperCase(),declaredOut:Fh}),preformatted:Fh},{name:"string.upper"}),Lh=we({domain:"string",predicate:{meta:"a URL string",predicate:e=>{if(URL.canParse)return URL.canParse(e);try{return new URL(e),!0}catch{return!1}}},meta:{format:"uri"}}),Rx=he.module({root:Lh,parse:we({declaredIn:Lh,in:"string",morphs:(e,n)=>{try{return new URL(e)}catch{return n.error("a URL string")}},declaredOut:we(URL)})},{name:"string.url"}),Nx=he.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:Se(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:Se(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:Se(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:Se(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:Se(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:Se(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:Se(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:Se(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),Px=he.module({root:te.string,alpha:Se(/^[A-Za-z]*$/,"only letters"),alphanumeric:Se(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex:ox,base64:ax,capitalize:lx,creditCard:ux,date:px,digits:Se(/^\d*$/,"only digits 0-9"),email:mx,integer:Ch,ip:vx,json:xx,lower:wx,normalize:Mx,numeric:Ex,regex:Ox,semver:Ix,trim:Ax,upper:Tx,url:Rx,uuid:Nx},{name:"string"}),Dx=he.module({bigint:te.bigint,boolean:te.boolean,false:te.false,never:te.never,null:te.null,number:te.number,object:te.object,string:te.string,symbol:te.symbol,true:te.true,unknown:te.unknown,undefined:te.undefined}),Vx=he.module({root:te.unknown,any:te.unknown},{name:"unknown"}),Fx=he.module({root:te.jsonObject,stringify:Xo("morph",{in:te.jsonObject,morphs:e=>JSON.stringify(e),declaredOut:te.string})},{name:"object.json"}),Lx=he.module({root:te.object,json:Fx},{name:"object"});class zx extends Ct{constructor(){super(...arguments);y(this,"description",'instantiate an object from an index signature and corresponding value type like `Record("string", "number")`')}}const Bx=zt(["K",te.key],"V")(e=>({domain:"object",index:{signature:e.K,value:e.V}}),zx);class jx extends Ct{constructor(){super(...arguments);y(this,"description",'pick a set of properties from an object like `Pick(User, "name | age")`')}}const qx=zt(["T",te.object],["K",te.key])(e=>e.T.pick(e.K),jx);class Ux extends Ct{constructor(){super(...arguments);y(this,"description",'omit a set of properties from an object like `Omit(User, "age")`')}}const Kx=zt(["T",te.object],["K",te.key])(e=>e.T.omit(e.K),Ux);class Wx extends Ct{constructor(){super(...arguments);y(this,"description","make all named properties of an object optional like `Partial(User)`")}}const Hx=zt(["T",te.object])(e=>e.T.partial(),Wx);class Gx extends Ct{constructor(){super(...arguments);y(this,"description","make all named properties of an object required like `Required(User)`")}}const Jx=zt(["T",te.object])(e=>e.T.required(),Gx);class Yx extends Ct{constructor(){super(...arguments);y(this,"description",'exclude branches of a union like `Exclude("boolean", "true")`')}}const Zx=zt("T","U")(e=>e.T.exclude(e.U),Yx);class Xx extends Ct{constructor(){super(...arguments);y(this,"description",'extract branches of a union like `Extract("0 | false | 1", "number")`')}}const Qx=zt("T","U")(e=>e.T.extract(e.U),Xx),ew=he.module({Exclude:Zx,Extract:Qx,Omit:Kx,Partial:Hx,Pick:qx,Record:Bx,Required:Jx}),fn=W0({...Dx,...ew,...rx,...J0,string:Px,number:$h,object:Lx,unknown:Vx},{prereducedAliases:!0,name:"ark"}),Ve=fn.export();Object.assign(Pr.ambient,Ve),Pr.typeAttachments={string:Ve.string.root,number:Ve.number.root,bigint:Ve.bigint,boolean:Ve.boolean,symbol:Ve.symbol,undefined:Ve.undefined,null:Ve.null,object:Ve.object.root,unknown:Ve.unknown.root,false:Ve.false,true:Ve.true,never:Ve.never,arrayIndex:Ve.Array.index,Key:Ve.Key,Record:Ve.Record,Array:Ve.Array.root,Date:Ve.Date};const pt=Object.assign(fn.type,Pr.typeAttachments);fn.match,fn.generic,fn.schema,fn.define,fn.declare,pt("'more-info' | 'toggle' | 'navigate' | 'url' | 'perform-action' | 'assist'"),pt("'tap' | 'hold' | 'double_tap'");const ca=pt({action:"'perform-action'",perform_action:"string",target:"object",data:"object"}).or({action:"'assist'","pipeline_id?":"string"}).or({action:"'url'",url_path:"string"}).or({action:"'navigate'",navigation_path:"string"}).or({action:"'more-info'","entity?":"string","camera_image?":"string"}).or({action:"'toggle'","entity?":"string"}).or({action:"'none'"}),zh=pt({"entity?":"string","camera_image?":"string","tap_action?":ca.or("undefined"),"hold_action?":ca.or("undefined"),"double_tap_action?":ca.or("undefined")}),Bh=pt({"always_show_power_button?":"boolean | null"}),tw=pt({"icon?":"string","name?":"string",media_type:"string"}),jh=pt({type:"string",entity_id:"string","use_art_colors?":"boolean","action?":zh,"speaker_group?":{"entity_id?":pt("string").or("null"),entities:"string[]"},"custom_buttons?":pt({icon:"string > 0",name:"string > 0"}).and(zh).array(),"ma_entity_id?":pt("string").or("null"),"search?":{"enabled?":"boolean | null","show_favorites?":"boolean | null","entity_id?":pt("string").or("null"),"media_types?":tw.array()},"options?":Bh,"grid_options?":"unknown","visibility?":"unknown"}),nw=jh.and({"tap_opens_popup?":"boolean","options?":Bh.and({"always_show_custom_buttons?":"boolean | null"})}),rw=jh.and({mode:"'panel'|'card'|'in-card'|'popup'"}),Gn=new WeakMap,Gi=new WeakMap,Ji={current:[]};let ua=!1,Vr=0;const Fr=new Set,Yi=new Map;function qh(e){const n=Array.from(e).sort((t,r)=>t instanceof Bt&&t.options.deps.includes(r)?1:r instanceof Bt&&r.options.deps.includes(t)?-1:0);for(const t of n){if(Ji.current.includes(t))continue;Ji.current.push(t),t.recompute();const r=Gi.get(t);if(r)for(const i of r){const s=Gn.get(i);s&&qh(s)}}}function iw(e){e.listeners.forEach(n=>n({prevVal:e.prevState,currentVal:e.state}))}function sw(e){e.listeners.forEach(n=>n({prevVal:e.prevState,currentVal:e.state}))}function Uh(e){if(Vr>0&&!Yi.has(e)&&Yi.set(e,e.prevState),Fr.add(e),!(Vr>0)&&!ua)try{for(ua=!0;Fr.size>0;){const n=Array.from(Fr);Fr.clear();for(const t of n){const r=Yi.get(t)??t.prevState;t.prevState=r,iw(t)}for(const t of n){const r=Gn.get(t);r&&(Ji.current.push(t),qh(r))}for(const t of n){const r=Gn.get(t);if(r)for(const i of r)sw(i)}}}finally{ua=!1,Ji.current=[],Yi.clear()}}function Mt(e){Vr++;try{e()}finally{if(Vr--,Vr===0){const n=Array.from(Fr)[0];n&&Uh(n)}}}function ow(e){return typeof e=="function"}class da{constructor(n,t){this.listeners=new Set,this.subscribe=r=>{var i,s;this.listeners.add(r);const o=(s=(i=this.options)==null?void 0:i.onSubscribe)==null?void 0:s.call(i,r,this);return()=>{this.listeners.delete(r),o==null||o()}},this.prevState=n,this.state=n,this.options=t}setState(n){var t,r,i;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(n):ow(n)?this.state=n(this.prevState):this.state=n,(i=(r=this.options)==null?void 0:r.onUpdate)==null||i.call(r),Uh(this)}}class Bt{constructor(n){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],r=[];for(const i of this.options.deps)t.push(i.prevState),r.push(i.state);return this.lastSeenDepValues=r,{prevDepVals:t,currDepVals:r,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,r;this.prevState=this.state;const{prevDepVals:i,currDepVals:s,prevVal:o}=this.getDepVals();this.state=this.options.fn({prevDepVals:i,currDepVals:s,prevVal:o}),(r=(t=this.options).onUpdate)==null||r.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const s of this.options.deps)s instanceof Bt&&s.checkIfRecalculationNeededDeeply();let t=!1;const r=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let s=0;s<i.length;s++)if(i[s]!==r[s]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var r,i;this.listeners.add(t);const s=(i=(r=this.options).onSubscribe)==null?void 0:i.call(r,t,this);return()=>{this.listeners.delete(t),s==null||s()}},this.options=n,this.state=n.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(n=this.options.deps){for(const t of n)if(t instanceof Bt)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof da){let r=Gn.get(t);r||(r=new Set,Gn.set(t,r)),r.add(this);let i=Gi.get(this);i||(i=new Set,Gi.set(this,i)),i.add(t)}}unregisterFromGraph(n=this.options.deps){for(const t of n)if(t instanceof Bt)this.unregisterFromGraph(t.options.deps);else if(t instanceof da){const r=Gn.get(t);r&&r.delete(this);const i=Gi.get(this);i&&i.delete(t)}}}function Zi(e,n){return typeof e=="function"?e(n):e}function Lr(e,n){return fa(n).reduce((r,i)=>{if(r===null)return null;if(typeof r<"u")return r[i]},e)}function Xi(e,n,t){const r=fa(n);function i(s){if(!r.length)return Zi(t,s);const o=r.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[o]:i(s[o])}):{[o]:i()};if(Array.isArray(s)&&typeof o=="number"){const a=s.slice(0,o);return[...a.length?a:new Array(o),i(s[o]),...s.slice(o+1)]}return[...new Array(o),i()]}return i(e)}function aw(e,n){const t=fa(n);function r(i){if(!i)return;if(t.length===1){const o=t[0];if(Array.isArray(i)&&typeof o=="number")return i.filter((l,u)=>u!==o);const{[o]:a,...c}=i;return c}const s=t.shift();if(typeof s=="string"&&typeof i=="object")return{...i,[s]:r(i[s])};if(typeof s=="number"&&Array.isArray(i)){if(s>=i.length)return i;const o=i.slice(0,s);return[...o.length?o:new Array(s),r(i[s]),...i.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return r(e)}const lw=/^(\d+)$/gm,cw=/\.(\d+)(?=\.)/gm,uw=/^(\d+)\./gm,dw=/\.(\d+$)/gm,hw=/\.{2,}/gm,ha="__int__",Qi=`${ha}$1`;function fa(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(lw,Qi).replace(cw,`.${Qi}.`).replace(uw,`${Qi}.`).replace(dw,`.${Qi}`).replace(hw,".").split(".").map(n=>n.indexOf(ha)===0?parseInt(n.substring(ha.length),10):n)}function fw(e){return!(Array.isArray(e)&&e.length===0)}function pa(e,n){const{asyncDebounceMs:t}=n,{onChangeAsync:r,onBlurAsync:i,onSubmitAsync:s,onBlurAsyncDebounceMs:o,onChangeAsyncDebounceMs:a}=n.validators||{},c=t??0,l={cause:"change",validate:r,debounceMs:a??c},u={cause:"blur",validate:i,debounceMs:o??c},d={cause:"submit",validate:s,debounceMs:0},h=f=>({...f,debounceMs:0});switch(e){case"submit":return[h(l),h(u),d];case"blur":return[u];case"change":return[l];case"server":default:return[]}}function ma(e,n){const{onChange:t,onBlur:r,onSubmit:i,onMount:s}=n.validators||{},o={cause:"change",validate:t},a={cause:"blur",validate:r},c={cause:"submit",validate:i},l={cause:"mount",validate:s},u={cause:"server",validate:()=>{}};switch(e){case"mount":return[l];case"submit":return[o,a,c,u];case"server":return[u];case"blur":return[a,u];case"change":default:return[o,u]}}const ga=e=>!!e&&typeof e=="object"&&"fields"in e;function Jn(e,n){if(Object.is(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(const[i,s]of e)if(!n.has(i)||!Object.is(s,n.get(i)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(const i of e)if(!n.has(i))return!1;return!0}const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const i of t)if(!r.includes(i)||!Jn(e[i],n[i]))return!1;return!0}const Kh=({newFormValidatorError:e,isPreviousErrorFromFormValidator:n,previousErrorValue:t})=>e?{newErrorValue:e,newSource:"form"}:n?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},Wh=({formLevelError:e,fieldLevelError:n})=>n?{newErrorValue:n,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function pw(e){const n=new Map;for(const t of e){const r=[...t.path??[]].map(i=>{const s=typeof i=="object"?i.key:i;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");n.set(r,(n.get(r)??[]).concat(t))}return Object.fromEntries(n)}const Hh=e=>{const n=pw(e);return{form:n,fields:n}},Yn={validate({value:e,validationSource:n},t){const r=t["~standard"].validate(e);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return n==="field"?r.issues:Hh(r.issues)},async validateAsync({value:e,validationSource:n},t){const r=await t["~standard"].validate(e);if(r.issues)return n==="field"?r.issues:Hh(r.issues)}},Gh=e=>!!e&&"~standard"in e,es={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function ts(e){function n(d,h,f,p){const g=r(d,h,f,p);({insert:()=>a(g,d,h),remove:()=>c(g),swap:()=>p!==void 0&&u(g,d,h,p),move:()=>p!==void 0&&l(g,d,h,p)})[f]()}function t(d,h){return`${d}[${h}]`}function r(d,h,f,p){const g=[t(d,h)];if(f==="swap")g.push(t(d,p));else if(f==="move"){const[v,b]=[Math.min(h,p),Math.max(h,p)];for(let _=v;_<=b;_++)g.push(t(d,_))}else{const v=e.getFieldValue(d),b=Array.isArray(v)?v.length:0;for(let _=h+1;_<b;_++)g.push(t(d,_))}return Object.keys(e.fieldInfo).filter(v=>g.some(b=>v.startsWith(b)))}function i(d,h){return d.replace(/\[(\d+)\]/,(f,p)=>{const g=parseInt(p,10);return`[${h==="up"?g+1:Math.max(0,g-1)}]`})}function s(d,h){(h==="up"?d:[...d].reverse()).forEach(p=>{const g=i(p.toString(),h),v=e.getFieldMeta(g);v?e.setFieldMeta(p,v):e.setFieldMeta(p,o())})}const o=()=>es,a=(d,h,f)=>{s(d,"down"),d.forEach(p=>{p.toString().startsWith(t(h,f))&&e.setFieldMeta(p,o())})},c=d=>{s(d,"up")},l=(d,h,f,p)=>{const g=new Map(Object.keys(e.fieldInfo).filter(v=>v.startsWith(t(h,f))).map(v=>[v,e.getFieldMeta(v)]));s(d,f<p?"up":"down"),Object.keys(e.fieldInfo).filter(v=>v.startsWith(t(h,p))).forEach(v=>{const b=v.replace(t(h,p),t(h,f)),_=g.get(b);_&&e.setFieldMeta(v,_)})},u=(d,h,f,p)=>{d.forEach(g=>{if(!g.toString().startsWith(t(h,f)))return;const v=g.toString().replace(t(h,f),t(h,p)),[b,_]=[e.getFieldMeta(g),e.getFieldMeta(v)];b&&e.setFieldMeta(v,b),_&&e.setFieldMeta(g,_)})};return{handleArrayFieldMetaShift:n}}function ya(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class mw{constructor(n){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var r,i;const s=this.fieldMetaDerived.mount(),o=this.store.mount(),a=()=>{s(),o()};(i=(r=this.options.listeners)==null?void 0:r.onMount)==null||i.call(r,{formApi:this});const{onMount:c}=this.options.validators||{};return c&&this.validateSync("mount"),a},this.update=r=>{var i,s;if(!r)return;const o=this.options;this.options=r;const a=!!((s=(i=r.transform)==null?void 0:i.deps)!=null&&s.some((u,d)=>u!==this.prevTransformArray[d])),c=r.defaultValues&&!Jn(r.defaultValues,o.defaultValues)&&!this.state.isTouched,l=!Jn(r.defaultState,o.defaultState)&&!this.state.isTouched;!c&&!l&&!a||Mt(()=>{this.baseStore.setState(()=>ya(Object.assign({},this.state,l?r.defaultState:{},c?{values:r.defaultValues}:{},a?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(r,i)=>{const{fieldMeta:s}=this.state,o=this.resetFieldMeta(s);r&&!(i!=null&&i.keepDefaultValues)&&(this.options={...this.options,defaultValues:r}),this.baseStore.setState(()=>{var a;return ya({...this.options.defaultState,values:r??this.options.defaultValues??((a=this.options.defaultState)==null?void 0:a.values),fieldMetaBase:o})})},this.validateAllFields=async r=>{const i=[];return Mt(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const a=o.instance;i.push(Promise.resolve().then(()=>a.validate(r,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(c=>({...c,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null,c=[`${r}[${i}]`];for(let h=i+1;h<=(a??0);h++)c.push(`${r}[${h}]`);const l=Object.keys(this.fieldInfo).filter(h=>c.some(f=>h.startsWith(f))),u=[];return Mt(()=>{l.forEach(h=>{u.push(Promise.resolve().then(()=>this.validateField(h,s)))})}),(await Promise.all(u)).flat()},this.validateField=(r,i)=>{var s;const o=(s=this.fieldInfo[r])==null?void 0:s.instance;return o?(o.state.meta.isTouched||o.setMeta(a=>({...a,isTouched:!0})),o.validate(i)):[]},this.validateSync=r=>{const i=ma(r,this.options);let s=!1;const o={};return Mt(()=>{var a,c;for(const u of i){if(!u.validate)continue;const d=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:f}=ns(d),p=rs(u.cause);for(const g of Object.keys(this.state.fieldMeta)){const v=this.getFieldMeta(g);if(!v)continue;const{errorMap:b,errorSourceMap:_}=v,$=f==null?void 0:f[g],{newErrorValue:k,newSource:x}=Kh({newFormValidatorError:$,isPreviousErrorFromFormValidator:(_==null?void 0:_[p])==="form",previousErrorValue:b==null?void 0:b[p]});x==="form"&&(o[g]={...o[g],[p]:$}),(b==null?void 0:b[p])!==k&&this.setFieldMeta(g,C=>({...C,errorMap:{...C.errorMap,[p]:k},errorSourceMap:{...C.errorSourceMap,[p]:x}}))}((a=this.state.errorMap)==null?void 0:a[p])!==h&&this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[p]:h}})),(h||f)&&(s=!0)}const l=rs("submit");(c=this.state.errorMap)!=null&&c[l]&&r!=="submit"&&!s&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[l]:void 0}}))}),{hasErrored:s,fieldsErrorMap:o}},this.validateAsync=async r=>{const i=pa(r,this.options);this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const s=[];let o;for(const l of i){if(!l.validate)continue;const u=rs(l.cause),d=this.state.validationMetaMap[u];d==null||d.lastAbortController.abort();const h=new AbortController;this.state.validationMetaMap[u]={lastAbortController:h},s.push(new Promise(async f=>{let p;try{p=await new Promise((_,$)=>{setTimeout(async()=>{if(h.signal.aborted)return _(void 0);try{_(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:h.signal},type:"validateAsync"}))}catch(k){$(k)}},l.debounceMs)})}catch(_){p=_}const{formError:g,fieldErrors:v}=ns(p);v&&(o=o?{...o,...v}:v);const b=rs(l.cause);for(const _ of Object.keys(this.state.fieldMeta)){const $=this.getFieldMeta(_);if(!$)continue;const{errorMap:k,errorSourceMap:x}=$,C=o==null?void 0:o[_],{newErrorValue:M,newSource:O}=Kh({newFormValidatorError:C,isPreviousErrorFromFormValidator:(x==null?void 0:x[b])==="form",previousErrorValue:k==null?void 0:k[b]});(k==null?void 0:k[b])!==M&&this.setFieldMeta(_,I=>({...I,errorMap:{...I.errorMap,[b]:M},errorSourceMap:{...I.errorSourceMap,[b]:O}}))}this.baseStore.setState(_=>({..._,errorMap:{..._.errorMap,[b]:g}})),f(o?{fieldErrors:o,errorMapKey:b}:void 0)}))}let a=[];const c={};if(s.length){a=await Promise.all(s);for(const l of a)if(l!=null&&l.fieldErrors){const{errorMapKey:u}=l;for(const[d,h]of Object.entries(l.fieldErrors)){const p={...c[d]||{},[u]:h};c[d]=p}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),c},this.validate=r=>{const{hasErrored:i,fieldsErrorMap:s}=this.validateSync(r);return i&&!this.options.asyncAlways?s:this.validateAsync(r)},this.getFieldValue=r=>Lr(this.state.values,r),this.getFieldMeta=r=>this.state.fieldMeta[r],this.getFieldInfo=r=>{var i;return(i=this.fieldInfo)[r]||(i[r]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(r,i)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[r]:Zi(i,s.fieldMetaBase[r])}}))},this.resetFieldMeta=r=>Object.keys(r).reduce((i,s)=>{const o=s;return i[o]=es,i},{}),this.setFieldValue=(r,i,s)=>{const o=(s==null?void 0:s.dontUpdateMeta)??!1;Mt(()=>{o||this.setFieldMeta(r,a=>({...a,isTouched:!0,isDirty:!0,errorMap:{...a==null?void 0:a.errorMap,onMount:void 0}})),this.baseStore.setState(a=>({...a,values:Xi(a.values,r,i)}))})},this.deleteField=r=>{const s=[...Object.keys(this.fieldInfo).filter(o=>{const a=r.toString();return o!==a&&o.startsWith(a)}),r];this.baseStore.setState(o=>{const a={...o};return s.forEach(c=>{a.values=aw(a.values,c),delete this.fieldInfo[c],delete a.fieldMetaBase[c]}),a})},this.pushFieldValue=(r,i,s)=>{this.setFieldValue(r,o=>[...Array.isArray(o)?o:[],i],s),this.validateField(r,"change")},this.insertFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>[...a.slice(0,i),s,...a.slice(i)],o),await this.validateField(r,"change"),ts(this).handleArrayFieldMetaShift(r,i,"insert"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.replaceFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>a.map((c,l)=>l===i?s:c),o),await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.removeFieldValue=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(r,c=>c.filter((l,u)=>u!==i),s),ts(this).handleArrayFieldMetaShift(r,i,"remove"),a!==null){const c=`${r}[${a}]`;this.deleteField(c)}await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.swapFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>{const c=a[i],l=a[s];return Xi(Xi(a,`${i}`,l),`${s}`,c)},o),ts(this).handleArrayFieldMetaShift(r,i,"swap",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.moveFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>(a.splice(s,0,a.splice(i,1)[0]),a),o),ts(this).handleArrayFieldMetaShift(r,i,"move",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.clearFieldValues=(r,i)=>{const s=this.getFieldValue(r),o=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(r,[],i),o!==null)for(let a=0;a<=o;a++){const c=`${r}[${a}]`;this.deleteField(c)}this.validateField(r,"change")},this.resetField=r=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[r]:es},values:this.options.defaultValues?Xi(i.values,r,Lr(this.options.defaultValues,r)):i.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((r,[i,s])=>(Object.keys(s).length&&s.errors.length&&(r[i]={errors:s.errors,errorMap:s.errorMap}),r),{})}),this.parseValuesWithSchema=r=>Yn.validate({value:this.state.values,validationSource:"form"},r),this.parseValuesWithSchemaAsync=r=>Yn.validateAsync({value:this.state.values,validationSource:"form"},r),this.baseStore=new da(ya({...n==null?void 0:n.defaultState,values:(n==null?void 0:n.defaultValues)??((t=n==null?void 0:n.defaultState)==null?void 0:t.values)})),this.fieldMetaDerived=new Bt({deps:[this.baseStore],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var o,a,c;const l=s,u=r==null?void 0:r[0],d=i[0];let h=0;const f={};for(const p of Object.keys(d.fieldMetaBase)){const g=d.fieldMetaBase[p],v=u==null?void 0:u.fieldMetaBase[p],b=l==null?void 0:l[p],_=Lr(d.values,p);let $=b==null?void 0:b.errors;if(!v||g.errorMap!==v.errorMap){$=Object.values(g.errorMap??{}).filter(O=>O!==void 0);const M=(o=this.getFieldInfo(p))==null?void 0:o.instance;M&&!M.options.disableErrorFlat&&($=$==null?void 0:$.flat(1))}const k=!fw($??[]),x=!g.isDirty,C=Jn(_,Lr(this.options.defaultValues,p))||Jn(_,(c=(a=this.getFieldInfo(p))==null?void 0:a.instance)==null?void 0:c.options.defaultValue);if(b&&b.isPristine===x&&b.isValid===k&&b.isDefaultValue===C&&b.errors===$&&g===v){f[p]=b,h++;continue}f[p]={...g,errors:$,isPristine:x,isValid:k,isDefaultValue:C}}return Object.keys(d.fieldMetaBase).length&&l&&h===Object.keys(d.fieldMetaBase).length?l:f}}),this.store=new Bt({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var o,a,c,l;const u=s,d=r==null?void 0:r[0],h=i[0],f=i[1],p=Object.values(f).filter(Boolean),g=p.some(ee=>ee.isValidating),v=p.every(ee=>ee.isValid),b=p.some(ee=>ee.isTouched),_=p.some(ee=>ee.isBlurred),$=p.every(ee=>ee.isDefaultValue),k=b&&((o=h.errorMap)==null?void 0:o.onMount),x=p.some(ee=>ee.isDirty),C=!x,M=!!((a=h.errorMap)!=null&&a.onMount||p.some(ee=>{var Q;return(Q=ee==null?void 0:ee.errorMap)==null?void 0:Q.onMount})),O=!!g;let I=(u==null?void 0:u.errors)??[];(!d||h.errorMap!==d.errorMap)&&(I=Object.values(h.errorMap).reduce((ee,Q)=>Q===void 0?ee:Q&&ga(Q)?(ee.push(Q.form),ee):(ee.push(Q),ee),[]));const T=I.length===0,N=v&&T,j=this.options.canSubmitWhenInvalid??!1,Z=h.submissionAttempts===0&&!b&&!M||!O&&!h.isSubmitting&&N||j;let ne=h.errorMap;if(k&&(I=I.filter(ee=>ee!==h.errorMap.onMount),ne=Object.assign(ne,{onMount:void 0})),u&&d&&u.errorMap===ne&&u.fieldMeta===this.fieldMetaDerived.state&&u.errors===I&&u.isFieldsValidating===g&&u.isFieldsValid===v&&u.isFormValid===T&&u.isValid===N&&u.canSubmit===Z&&u.isTouched===b&&u.isBlurred===_&&u.isPristine===C&&u.isDefaultValue===$&&u.isDirty===x&&Jn(d,h))return u;let ve={...h,errorMap:ne,fieldMeta:this.fieldMetaDerived.state,errors:I,isFieldsValidating:g,isFieldsValid:v,isFormValid:T,isValid:N,canSubmit:Z,isTouched:b,isBlurred:_,isPristine:C,isDefaultValue:$,isDirty:x};const ke=((c=this.options.transform)==null?void 0:c.deps)??[];if(ke.length!==this.prevTransformArray.length||ke.some((ee,Q)=>ee!==this.prevTransformArray[Q])){const ee=Object.assign({},this,{state:ve});(l=this.options.transform)==null||l.fn(ee),ve=ee.state,this.prevTransformArray=ke}return ve}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(n||{})}get state(){return this.store.state}runValidator(n){return Gh(n.validate)?Yn[n.type](n.value,n.validate):n.validate(n.value)}async handleSubmit(n){var t,r,i,s,o,a,c,l;if(this.baseStore.setState(d=>({...d,isSubmitted:!1,submissionAttempts:d.submissionAttempts+1,isSubmitSuccessful:!1})),Mt(()=>{Object.values(this.fieldInfo).forEach(d=>{d.instance&&(d.instance.state.meta.isTouched||d.instance.setMeta(h=>({...h,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(d=>({...d,isSubmitting:!0}));const u=()=>{this.baseStore.setState(d=>({...d,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){u(),(r=(t=this.options).onSubmitInvalid)==null||r.call(t,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){u(),(s=(i=this.options).onSubmitInvalid)==null||s.call(i,{value:this.state.values,formApi:this});return}Mt(()=>{Object.values(this.fieldInfo).forEach(d=>{var h,f,p;(p=(f=(h=d.instance)==null?void 0:h.options.listeners)==null?void 0:f.onSubmit)==null||p.call(f,{value:d.instance.state.value,fieldApi:d.instance})})}),(a=(o=this.options.listeners)==null?void 0:o.onSubmit)==null||a.call(o,{formApi:this});try{await((l=(c=this.options).onSubmit)==null?void 0:l.call(c,{value:this.state.values,formApi:this,meta:n??this.options.onSubmitMeta})),Mt(()=>{this.baseStore.setState(d=>({...d,isSubmitted:!0,isSubmitSuccessful:!0})),u()})}catch(d){throw this.baseStore.setState(h=>({...h,isSubmitSuccessful:!1})),u(),d}}setErrorMap(n){Mt(()=>{Object.entries(n).forEach(([t,r])=>{const i=t;if(ga(r)){const{formError:s,fieldErrors:o}=ns(r);for(const a of Object.keys(this.fieldInfo))this.getFieldMeta(a)&&this.setFieldMeta(a,l=>({...l,errorMap:{...l.errorMap,[i]:o==null?void 0:o[a]},errorSourceMap:{...l.errorSourceMap,[i]:"form"}}));this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[i]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[i]:r}}))})})}}function ns(e){if(e){if(ga(e)){const n=ns(e.form).formError,t=e.fields;return{formError:n,fieldErrors:t}}return{formError:e}}return{formError:void 0}}function rs(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class gw{constructor(n){this.options={},this.mount=()=>{var t,r;const i=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const s=this.getInfo();s.instance=this,this.update(this.options);const{onMount:o}=this.options.validators||{};if(o){const a=this.runValidator({validate:o,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});a&&this.setMeta(c=>({...c,errorMap:{...c==null?void 0:c.errorMap,onMount:a},errorSourceMap:{...c==null?void 0:c.errorSourceMap,onMount:"field"}}))}return(r=(t=this.options.listeners)==null?void 0:t.onMount)==null||r.call(t,{value:this.state.value,fieldApi:this}),i},this.update=t=>{this.options=t;const r=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const i=Lr(t.form.options.defaultValues,t.name),s=t.defaultValue??i;r?this.setValue(o=>o||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,r)=>{this.form.setFieldValue(this.name,t,r),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,r)=>{this.form.pushFieldValue(this.name,t,r),this.triggerOnChangeListener()},this.insertValue=(t,r,i)=>{this.form.insertFieldValue(this.name,t,r,i),this.triggerOnChangeListener()},this.replaceValue=(t,r,i)=>{this.form.replaceFieldValue(this.name,t,r,i),this.triggerOnChangeListener()},this.removeValue=(t,r)=>{this.form.removeFieldValue(this.name,t,r),this.triggerOnChangeListener()},this.swapValues=(t,r,i)=>{this.form.swapFieldValues(this.name,t,r,i),this.triggerOnChangeListener()},this.moveValue=(t,r,i)=>{this.form.moveFieldValues(this.name,t,r,i),this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,t),this.triggerOnChangeListener()},this.getLinkedFields=t=>{const r=Object.values(this.form.fieldInfo),i=[];for(const s of r){if(!s.instance)continue;const{onChangeListenTo:o,onBlurListenTo:a}=s.instance.options.validators||{};t==="change"&&(o!=null&&o.includes(this.name))&&i.push(s.instance),t==="blur"&&(a!=null&&a.includes(this.name))&&i.push(s.instance)}return i},this.validateSync=(t,r)=>{var i;const s=ma(t,this.options),a=this.getLinkedFields(t).reduce((u,d)=>{const h=ma(t,d.options);return h.forEach(f=>{f.field=d}),u.concat(h)},[]);let c=!1;Mt(()=>{const u=(d,h)=>{var f;const p=is(h.cause),g=h.validate?Jh(d.runValidator({validate:h.validate,value:{value:d.store.state.value,validationSource:"field",fieldApi:d},type:"validate"})):void 0,v=r[p],{newErrorValue:b,newSource:_}=Wh({formLevelError:v,fieldLevelError:g});((f=d.state.meta.errorMap)==null?void 0:f[p])!==b&&d.setMeta($=>({...$,errorMap:{...$.errorMap,[p]:b},errorSourceMap:{...$.errorSourceMap,[p]:_}})),b&&(c=!0)};for(const d of s)u(this,d);for(const d of a)d.validate&&u(d.field,d)});const l=is("submit");return(i=this.state.meta.errorMap)!=null&&i[l]&&t!=="submit"&&!c&&this.setMeta(u=>({...u,errorMap:{...u.errorMap,[l]:void 0},errorSourceMap:{...u.errorSourceMap,[l]:void 0}})),{hasErrored:c}},this.validateAsync=async(t,r)=>{const i=pa(t,this.options),s=await r,o=this.getLinkedFields(t),a=o.reduce((h,f)=>{const p=pa(t,f.options);return p.forEach(g=>{g.field=f}),h.concat(p)},[]);this.state.meta.isValidating||this.setMeta(h=>({...h,isValidating:!0}));for(const h of o)h.setMeta(f=>({...f,isValidating:!0}));const c=[],l=[],u=(h,f,p)=>{const g=is(f.cause),v=h.getInfo().validationMetaMap[g];v==null||v.lastAbortController.abort();const b=new AbortController;this.getInfo().validationMetaMap[g]={lastAbortController:b},p.push(new Promise(async _=>{var $;let k;try{k=await new Promise((I,T)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(b.signal.aborted)return I(void 0);try{I(await this.runValidator({validate:f.validate,value:{value:h.store.state.value,fieldApi:h,signal:b.signal,validationSource:"field"},type:"validateAsync"}))}catch(N){T(N)}},f.debounceMs)})}catch(I){k=I}if(b.signal.aborted)return _(void 0);const x=Jh(k),C=($=s[this.name])==null?void 0:$[g],{newErrorValue:M,newSource:O}=Wh({formLevelError:C,fieldLevelError:x});h.setMeta(I=>({...I,errorMap:{...I==null?void 0:I.errorMap,[g]:M},errorSourceMap:{...I.errorSourceMap,[g]:O}})),_(M)}))};for(const h of i)h.validate&&u(this,h,c);for(const h of a)h.validate&&u(h.field,h,l);let d=[];(c.length||l.length)&&(d=await Promise.all(c),await Promise.all(l)),this.setMeta(h=>({...h,isValidating:!1}));for(const h of o)h.setMeta(f=>({...f,isValidating:!1}));return d.filter(Boolean)},this.validate=(t,r)=>{var i;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=r!=null&&r.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:o}=this.validateSync(t,s[this.name]??{});if(o&&!this.options.asyncAlways)return(i=this.getInfo().validationMetaMap[is(t)])==null||i.lastAbortController.abort(),this.state.meta.errors;const a=r!=null&&r.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,a)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||(this.setMeta(r=>({...r,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(r=>({...r,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>Yn.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>Yn.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=n.form,this.name=n.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new Bt({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),r=this.form.getFieldMeta(this.name)??{...es,...n.defaultMeta};return{value:t,meta:r}}}),this.options=n}get state(){return this.store.state}runValidator(n){return Gh(n.validate)?Yn[n.type](n.value,n.validate):n.validate(n.value)}setErrorMap(n){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...n}}))}triggerOnBlurListener(){var n,t,r,i,s,o;const a=(n=this.form.options.listeners)==null?void 0:n.onBlurDebounceMs;a&&a>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{formApi:this.form,fieldApi:this})},a)):(r=(t=this.form.options.listeners)==null?void 0:t.onBlur)==null||r.call(t,{formApi:this.form,fieldApi:this});const c=(i=this.options.listeners)==null?void 0:i.onBlurDebounceMs;c&&c>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{value:this.state.value,fieldApi:this})},c)):(o=(s=this.options.listeners)==null?void 0:s.onBlur)==null||o.call(s,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var n,t,r,i,s,o;const a=(n=this.form.options.listeners)==null?void 0:n.onChangeDebounceMs;a&&a>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{formApi:this.form,fieldApi:this})},a)):(r=(t=this.form.options.listeners)==null?void 0:t.onChange)==null||r.call(t,{formApi:this.form,fieldApi:this});const c=(i=this.options.listeners)==null?void 0:i.onChangeDebounceMs;c&&c>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{value:this.state.value,fieldApi:this})},c)):(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})}}function Jh(e){if(e)return e}function is(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}var ss={exports:{}},va={};const os=Jp(Xr);var as={exports:{}},ba={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yh;function yw(){if(Yh)return ba;Yh=1;var e=os;function n(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var t=typeof Object.is=="function"?Object.is:n,r=e.useState,i=e.useEffect,s=e.useLayoutEffect,o=e.useDebugValue;function a(d,h){var f=h(),p=r({inst:{value:f,getSnapshot:h}}),g=p[0].inst,v=p[1];return s(function(){g.value=f,g.getSnapshot=h,c(g)&&v({inst:g})},[d,f,h]),i(function(){return c(g)&&v({inst:g}),d(function(){c(g)&&v({inst:g})})},[d]),o(f),f}function c(d){var h=d.getSnapshot;d=d.value;try{var f=h();return!t(d,f)}catch{return!0}}function l(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return ba.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,ba}var _a={},Zh;function vw(){if(Zh)return _a;Zh=1;var e={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){function n(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}function t(p,g){d||s.startTransition===void 0||(d=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var v=g();if(!h){var b=g();o(v,b)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),h=!0)}b=a({inst:{value:v,getSnapshot:g}});var _=b[0].inst,$=b[1];return l(function(){_.value=v,_.getSnapshot=g,r(_)&&$({inst:_})},[p,v,g]),c(function(){return r(_)&&$({inst:_}),p(function(){r(_)&&$({inst:_})})},[p]),u(v),v}function r(p){var g=p.getSnapshot;p=p.value;try{var v=g();return!o(p,v)}catch{return!0}}function i(p,g){return g()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var s=os,o=typeof Object.is=="function"?Object.is:n,a=s.useState,c=s.useEffect,l=s.useLayoutEffect,u=s.useDebugValue,d=!1,h=!1,f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?i:t;_a.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:f,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),_a}var Xh;function Qh(){if(Xh)return as.exports;Xh=1;var e={};return e.NODE_ENV==="production"?as.exports=yw():as.exports=vw(),as.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ef;function bw(){if(ef)return va;ef=1;var e=os,n=Qh();function t(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:t,i=n.useSyncExternalStore,s=e.useRef,o=e.useEffect,a=e.useMemo,c=e.useDebugValue;return va.useSyncExternalStoreWithSelector=function(l,u,d,h,f){var p=s(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=a(function(){function b(C){if(!_){if(_=!0,$=C,C=h(C),f!==void 0&&g.hasValue){var M=g.value;if(f(M,C))return k=M}return k=C}if(M=k,r($,C))return M;var O=h(C);return f!==void 0&&f(M,O)?($=C,M):($=C,k=O)}var _=!1,$,k,x=d===void 0?null:d;return[function(){return b(u())},x===null?void 0:function(){return b(x())}]},[u,d,h,f]);var v=i(l,p[0],p[1]);return o(function(){g.hasValue=!0,g.value=v},[v]),c(v),v},va}var xa={},tf;function _w(){if(tf)return xa;tf=1;var e={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){function n(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var t=os,r=Qh(),i=typeof Object.is=="function"?Object.is:n,s=r.useSyncExternalStore,o=t.useRef,a=t.useEffect,c=t.useMemo,l=t.useDebugValue;xa.useSyncExternalStoreWithSelector=function(u,d,h,f,p){var g=o(null);if(g.current===null){var v={hasValue:!1,value:null};g.current=v}else v=g.current;g=c(function(){function _(M){if(!$){if($=!0,k=M,M=f(M),p!==void 0&&v.hasValue){var O=v.value;if(p(O,M))return x=O}return x=M}if(O=x,i(k,M))return O;var I=f(M);return p!==void 0&&p(O,I)?(k=M,O):(k=M,x=I)}var $=!1,k,x,C=h===void 0?null:h;return[function(){return _(d())},C===null?void 0:function(){return _(C())}]},[d,h,f,p]);var b=s(u,g[0],g[1]);return a(function(){v.hasValue=!0,v.value=b},[b]),l(b),b},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),xa}var nf;function xw(){if(nf)return ss.exports;nf=1;var e={};return e.NODE_ENV==="production"?ss.exports=bw():ss.exports=_w(),ss.exports}var ww=xw();function zr(e,n=t=>t){return ww.useSyncExternalStoreWithSelector(e.subscribe,()=>e.state,()=>e.state,n,Sw)}function Sw(e,n){if(Object.is(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(const[r,i]of e)if(!n.has(r)||!Object.is(i,n.get(r)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(const r of e)if(!n.has(r))return!1;return!0}const t=Object.keys(e);if(t.length!==Object.keys(n).length)return!1;for(let r=0;r<t.length;r++)if(!Object.prototype.hasOwnProperty.call(n,t[r])||!Object.is(e[t[r]],n[t[r]]))return!1;return!0}const ls=typeof window<"u"?It:ce;function $w(e){const[n]=F(()=>{const r=new gw({...e,form:e.form,name:e.name});return r.Field=rf,r});return ls(n.mount,[n]),ls(()=>{n.update(e)}),zr(n.store,e.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),n}const rf=({children:e,...n})=>{const t=$w(n),r=W(()=>Zi(e,t),[e,t,t.state.value,t.state.meta]);return Re(Oe,{children:r})};function kw({form:e,selector:n,children:t}){const r=zr(e.store,n);return Zi(t,r)}function sf(e){const[n]=F(()=>{const t=new mw(e),r=t;return r.Field=function(s){return Re(rf,{...s,form:t})},r.Subscribe=i=>Re(kw,{form:t,selector:i.selector,children:i.children}),r});return ls(n.mount,[]),zr(n.store,t=>t.isSubmitting),ls(()=>{n.update(e)}),n}const Xt={root:S({border:"1px solid var(--outline-color, #e0e0e0)",borderRadius:"6px",position:"relative",marginBottom:"16px"}),rootError:S({borderColor:"var(--error-color, #ff5252)"}),header:S({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",borderBottom:"none"}),headerButtons:S({display:"flex",gap:"8px",alignItems:"center"}),headerExpanded:S({borderBottom:"1px solid var(--outline-color, #e0e0e0)"}),title:S({margin:0,fontSize:"14px",fontWeight:500}),content:S({padding:12,display:"none"}),contentExpanded:S({display:"block"})},je=({title:e,children:n,initiallyExpanded:t=!1,buttons:r=[],error:i})=>{const[s,o]=F(t);return A("div",{css:[Xt.root,!!i&&Xt.rootError],children:[A("div",{css:[Xt.header,s&&Xt.headerExpanded],children:[m("div",{css:Xt.title,children:e}),A("div",{css:Xt.headerButtons,children:[r.map((a,c)=>m(ae,{icon:a.icon,onClick:a.onClick,type:"button",size:"small"},c+a.icon)),m(ae,{onClick:()=>o(!s),icon:s?"mdi:chevron-up":"mdi:chevron-down",type:"button",size:"small"})]})]}),m("div",{css:[Xt.content,s&&Xt.contentExpanded],children:n})]})},Cw={buttons:S({display:"flex",flexDirection:"row",gap:"8px"})},of=({hass:e,entityId:n,mediaTypes:t,onChange:r})=>{const[i,s]=F(null),o=D(async()=>{var c;const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:n},return_response:!0};try{const l=await e.connection.sendMessagePromise(a);return l?((c=l.response[n])==null?void 0:c.children.filter(u=>!u.media_content_id||u.media_content_id&&!u.media_content_id.startsWith("media-source")).map(u=>({name:u.title,media_type:u.media_content_type,icon:Mw(u)})))||[]:[]}catch(l){return s(l instanceof Error?l.message:String(l)),[]}},[n]);return m(je,{title:"Media Types (optional)",children:A(Oe,{children:[m(En,{children:"Use custom media types. If none added sensible defaults will be used. Be aware that not all media types are necessarily searchable."}),t.map((a,c)=>A(je,{title:a.name??a.media_type,error:!a.media_type,buttons:[{icon:"mdi:arrow-up",onClick:()=>{if(c===0)return;const l=[...t],u=l[c-1];l[c-1]=l[c],l[c]=u,r(l)}},{icon:"mdi:arrow-down",onClick:()=>{if(c===t.length-1)return;const l=[...t],u=l[c+1];l[c+1]=l[c],l[c]=u,r(l)}},{icon:"mdi:delete",onClick:()=>{const l=[...t];l.splice(c,1),r(l)}}],children:[m(on,{hass:e,value:a.name||"",label:"Name",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],name:l},r(u)}}),m(on,{hass:e,value:a.icon??"",isIconInput:!0,label:"Icon",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],icon:l},r(u)}}),m(on,{hass:e,value:a.media_type||"",label:"Media Type",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],media_type:l},r(u)}})]},c+a.media_type)),A("div",{css:Cw.buttons,children:[m(pr,{type:"button",onClick:()=>r([...t,{name:"",media_type:""}]),children:"Add"}),m(pr,{type:"button",onClick:async()=>{const a=await o();a.length!==0&&r(a)},children:"Generate"}),m(pr,{type:"button",onClick:()=>r([]),children:"Clear"})]}),i&&m(Ys,{children:i})]})})},Mw=e=>{if(e.thumbnail)return e.thumbnail;switch(e.media_class){case"album":return"mdi:album";case"artist":return"mdi:account-music";case"track":return"mdi:music-note";case"playlist":return"mdi:playlist-music";default:return"mdi:folder-music"}},af=e=>{var n,t,r,i,s,o,a,c;return{type:e.type??"custom:mediocre-media-player-card",entity_id:(e==null?void 0:e.entity_id)??"",use_art_colors:(e==null?void 0:e.use_art_colors)??!1,tap_opens_popup:(e==null?void 0:e.tap_opens_popup)??!1,action:(e==null?void 0:e.action)??{},speaker_group:{entity_id:((n=e==null?void 0:e.speaker_group)==null?void 0:n.entity_id)??null,entities:((t=e==null?void 0:e.speaker_group)==null?void 0:t.entities)??[]},search:{enabled:((r=e==null?void 0:e.search)==null?void 0:r.enabled)??!1,show_favorites:((i=e==null?void 0:e.search)==null?void 0:i.show_favorites)??!1,entity_id:((s=e==null?void 0:e.search)==null?void 0:s.entity_id)??null,media_types:((o=e==null?void 0:e.search)==null?void 0:o.media_types)??[]},ma_entity_id:(e==null?void 0:e.ma_entity_id)??null,custom_buttons:(e==null?void 0:e.custom_buttons)??[],options:{always_show_power_button:((a=e==null?void 0:e.options)==null?void 0:a.always_show_power_button)??!1,always_show_custom_buttons:((c=e==null?void 0:e.options)==null?void 0:c.always_show_custom_buttons)??!1},grid_options:e==null?void 0:e.grid_options,visibility:e==null?void 0:e.visibility}},lf=e=>{var n,t,r,i,s,o,a;return{type:e.type??"custom:mediocre-massive-media-player-card",entity_id:(e==null?void 0:e.entity_id)??"",use_art_colors:(e==null?void 0:e.use_art_colors)??!1,mode:(e==null?void 0:e.mode)??"card",action:(e==null?void 0:e.action)??{},speaker_group:{entity_id:((n=e==null?void 0:e.speaker_group)==null?void 0:n.entity_id)??null,entities:((t=e==null?void 0:e.speaker_group)==null?void 0:t.entities)??[]},search:{enabled:((r=e==null?void 0:e.search)==null?void 0:r.enabled)??!1,show_favorites:((i=e==null?void 0:e.search)==null?void 0:i.show_favorites)??!1,entity_id:((s=e==null?void 0:e.search)==null?void 0:s.entity_id)??null,media_types:((o=e==null?void 0:e.search)==null?void 0:o.media_types)??[]},ma_entity_id:(e==null?void 0:e.ma_entity_id)??null,custom_buttons:(e==null?void 0:e.custom_buttons)??[],options:{always_show_power_button:((a=e==null?void 0:e.options)==null?void 0:a.always_show_power_button)??!1},grid_options:e==null?void 0:e.grid_options,visibility:e==null?void 0:e.visibility}},cf=e=>{var t,r,i,s,o,a,c,l,u,d,h,f;const n={...e};return n.use_art_colors||delete n.use_art_colors,n.tap_opens_popup||delete n.tap_opens_popup,(!n.action||Object.keys(n.action).length===0)&&delete n.action,n.ma_entity_id||delete n.ma_entity_id,(!n.custom_buttons||n.custom_buttons.length===0)&&delete n.custom_buttons,((t=n.speaker_group)==null?void 0:t.entity_id)===null&&delete n.speaker_group.entity_id,!((r=n.speaker_group)!=null&&r.entity_id)&&(!((i=n.speaker_group)!=null&&i.entities)||n.speaker_group.entities.length===0)&&delete n.speaker_group,((s=n.search)==null?void 0:s.entity_id)===null&&delete n.search.entity_id,((a=(o=n.search)==null?void 0:o.media_types)==null?void 0:a.length)===0&&delete n.search.media_types,!((c=n.search)!=null&&c.enabled)&&!((l=n.search)!=null&&l.show_favorites)&&!((u=n.search)!=null&&u.entity_id)&&!((d=n.search)!=null&&d.media_types)&&delete n.search,((h=n.options)==null?void 0:h.always_show_power_button)===!1&&delete n.options.always_show_power_button,((f=n.options)==null?void 0:f.always_show_custom_buttons)===!1&&delete n.options.always_show_custom_buttons,Object.keys(n.options??{}).length===0&&delete n.options,n},uf=e=>{var t,r,i,s,o,a,c,l,u,d,h,f;const n={...e};return n.use_art_colors||delete n.use_art_colors,(!n.action||Object.keys(n.action).length===0)&&delete n.action,n.ma_entity_id||delete n.ma_entity_id,(!n.custom_buttons||n.custom_buttons.length===0)&&delete n.custom_buttons,((t=n.speaker_group)==null?void 0:t.entity_id)===null&&delete n.speaker_group.entity_id,!((r=n.speaker_group)!=null&&r.entity_id)&&(!((i=n.speaker_group)!=null&&i.entities)||n.speaker_group.entities.length===0)&&delete n.speaker_group,((s=n.search)==null?void 0:s.entity_id)===null&&delete n.search.entity_id,((a=(o=n.search)==null?void 0:o.media_types)==null?void 0:a.length)===0&&delete n.search.media_types,!((c=n.search)!=null&&c.enabled)&&!((l=n.search)!=null&&l.show_favorites)&&!((u=n.search)!=null&&u.entity_id)&&!((d=n.search)!=null&&d.media_types)&&delete n.search,((h=n.options)==null?void 0:h.always_show_power_button)===!1&&delete n.options.always_show_power_button,(f=n.options)!=null&&f.always_show_power_button||delete n.options,n},Ew=({config:e,rootElement:n,hass:t})=>{const r=D(l=>{const u=new Event("config-changed",{bubbles:!0,composed:!0});u.detail={config:l},n.dispatchEvent(u)},[n]),i=sf({defaultValues:lf(e),validators:{onChange:rw},listeners:{onChange:({formApi:l})=>{if(l.state.isValid){const u=uf(l.state.values);JSON.stringify(e)!==JSON.stringify(uf(u))&&r(u)}else console.log(l.state.errors)},onChangeDebounceMs:500}}),s=zr(i.store,l=>l.errorMap),o=D(l=>!!Object.keys((s==null?void 0:s.onChange)??{}).find(u=>u.startsWith(l)),[s]),a=D(()=>{const l=i.getFieldValue("custom_buttons")||[];i.setFieldValue("custom_buttons",[...l,{icon:"mdi:paper-roll",name:"New Button",tap_action:{action:"toggle"}}])},[i]),c=D(l=>{const d=[...i.getFieldValue("custom_buttons")||[]];d.splice(l,1),i.setFieldValue("custom_buttons",d)},[i]);return ce(()=>{const l=i.state.values,u=lf(e);JSON.stringify(l)!==JSON.stringify(u)&&i.reset(u)},[e,i]),!e||!t?null:A("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),i.handleSubmit()},children:[m(i.Field,{name:"entity_id",children:l=>m(tt,{children:m($t,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??""),label:"Media Player Entity",domains:["media_player"],error:pn(l),required:!0})})}),m(tt,{css:S({display:"flex",flexDirection:"row",gap:"16px"}),children:m(i.Field,{name:"use_art_colors",children:l=>A(xt,{children:[m(St,{id:"use_art_colors",checked:l.state.value,onChange:u=>{var d;return l.handleChange(((d=u.target)==null?void 0:d.checked)??!1)}}),m(wt,{htmlFor:"use_art_colors",children:"Use album art colors"})]})})}),m(je,{title:"Display Mode",error:o("mode"),children:m(i.Field,{name:"mode",children:l=>m(xm,{options:[{name:"Panel",value:"panel"},{name:"Card",value:"card"},{name:"In Card",value:"in-card"}],onSelected:u=>l.handleChange(u),selected:e.mode||"panel"})})}),m(je,{title:"Interactions",error:o("action"),children:m(i.Field,{name:"action",children:l=>m(ui,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??{})})})}),A(je,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[m(i.Field,{name:"speaker_group.entity_id",children:l=>m(tt,{children:m($t,{hass:t,value:l.state.value||"",onChange:u=>{l.handleChange(u??null)},label:"Main Speaker Entity ID (Optional)",error:pn(l),domains:["media_player"]})})}),m(i.Field,{name:"speaker_group.entities",children:l=>m(tt,{children:m(lc,{hass:t,value:l.state.value??[],onChange:u=>{l.handleChange(u??[])},label:"Select Speakers (including main speaker)",domains:["media_player"]})})})]}),A(je,{title:"Search (optional)",error:o("search"),children:[m(i.Field,{name:"ma_entity_id",children:l=>{var u;return m(dr,{children:(((u=l.state.value)==null?void 0:u.length)??0)>0&&m(En,{children:"ma_entity_id is already set. Any change in this section will not have any effect."})})}}),A(tt,{children:[m(i.Field,{name:"search.enabled",children:l=>A(xt,{children:[m(St,{type:"checkbox",id:"search.enabled",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"search.enabled",children:"Enable Search"})]})}),m(i.Field,{name:"search.enabled",children:l=>m(dr,{children:l.state.value&&m(i.Field,{name:"search.show_favorites",children:u=>A(xt,{children:[m(St,{type:"checkbox",id:"search.show_favorites",checked:u.state.value??!1,onChange:d=>u.handleChange(d.target.checked)}),m(wt,{htmlFor:"search.show_favorites",children:"Show Favorites when not searching"})]})})})}),m(i.Field,{name:"search.entity_id",children:l=>m($t,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Search target (Optional, if not set, will use the main entity_id)",error:pn(l),domains:["media_player"]})})]}),m(i.Field,{name:"search.media_types",children:l=>{var u;return m(of,{entityId:((u=e.search)==null?void 0:u.entity_id)??e.entity_id??"",hass:t,mediaTypes:l.state.value??[],onChange:d=>{l.handleChange(d??[])}})}})]}),m(i.Field,{name:"ma_entity_id",children:l=>m(je,{title:"Music Assistant Configuration (optional)",error:pn(l),children:m(tt,{children:m($t,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Music Assistant Entity ID (Optional)",error:pn(l),domains:["media_player"]})})})}),m(je,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:A(oc,{children:[m(i.Field,{name:"custom_buttons",children:l=>{var u;return(u=l.state.value)==null?void 0:u.map((d,h)=>A(je,{title:`Button ${h} - ${d.name}`,error:o(`custom_buttons[${h}]`),children:[A(tt,{children:[m(i.Field,{name:`custom_buttons[${h}].name`,children:f=>m(ci,{children:m(on,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,label:"Name",error:pn(f)})})}),m(i.Field,{name:`custom_buttons[${h}].icon`,children:f=>m(ci,{children:m(on,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,isIconInput:!0,label:"Icon",error:pn(f)})})}),m(En,{children:"Interactions"}),m(i.Field,{name:`custom_buttons[${h}]`,children:f=>{const p=f.state.value??{icon:"",name:""},{name:g,icon:v,...b}=p;return m(ui,{hass:t,value:b,onChange:_=>{f.handleChange({name:g,icon:v,..._})}})}})]}),m(ac,{type:"button",onClick:()=>c(h),children:"Remove Button"})]},h))}}),m(pr,{type:"button",onClick:a,children:"Add Custom Button"})]})}),m(je,{title:"Additional options (optional)",error:o("options"),children:m(i.Field,{name:"options.always_show_power_button",children:l=>A(xt,{children:[m(St,{id:"options.always_show_power_button",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"options.always_show_power_button",children:"Always show power button"})]})})})]})},pn=e=>e.state.meta.isValid?void 0:e.state.meta.errors.map(n=>typeof n=="string"?n:(n==null?void 0:n.message)||String(n)).filter(Boolean).join(", "),df={root:S({display:"flex",flexDirection:"row",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"},paddingTop:"16px",paddingBottom:"16px",borderTop:`0.5px solid ${Me.colors.onCardDivider}`,gap:"2px"}),chip:S({"&:first-child":{marginLeft:16},"&:last-child":{marginRight:16}})},Ow=()=>{const{config:e}=me(Be),{custom_buttons:n}=e;return m("div",{css:df.root,children:n==null?void 0:n.map((t,r)=>m(hf,{button:t},r))})},hf=({button:e,type:n="chip"})=>{const{rootElement:t,config:r}=me(Be),{icon:i,name:s,...o}=e,a=Rn({rootElement:t,actionConfig:{...o,entity:r.entity_id}});return n==="icon-button"?m(ae,{icon:e.icon??"mdi:dots-vertical",size:"x-small",...a}):A(sn,{css:df.chip,icon:i,...a,children:[!!s&&m("span",{children:s}),a.renderLongPressIndicator()]})},Iw=hr`
  from {
    transform: translateY(15%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`,ff=58,mn={overlay:S({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:8,transition:"opacity 0.3s ease-in-out",display:"flex",justifyContent:"center",alignItems:"flex-end","@media screen and (min-height: 832px)":{alignItems:"center"}}),clickableBackground:S({position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),popUpContainer:S({animation:`${Iw} 0.55s cubic-bezier(0.25, 1, 0.5, 1) forwards`,maxHeight:"98vh",height:"fit-content",width:"424px",maxWidth:"98vw",backgroundColor:Me.colors.dialog,overflow:"hidden",boxShadow:"0px 10px 20px var(--clear-background-color)",borderTopLeftRadius:"var(--ha-dialog-border-radius, 28px)",borderTopRightRadius:"var(--ha-dialog-border-radius, 28px)","@media screen and (min-height: 832px)":{borderRadius:"var(--ha-dialog-border-radius, 28px)",boxShadow:"0px 0px 20px var(--clear-background-color)"},"@media (prefers-color-scheme: light)":{boxShadow:"0px 10px 20px rgba(0, 0, 0, 0.2)"}}),popUpContent:S({display:"grid",height:"100%"}),popUpHeader:S({display:"flex",height:ff,justifyContent:"flex-start",alignItems:"center",padding:"0px 16px",borderBottom:"1px solid var(--divider-color, rgba(0, 0, 0, 0.12))",gap:"8px"}),title:S({margin:0,fontSize:"18px",fontWeight:500,color:Me.colors.onDialog,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"auto"}),massiveCard:S({maxHeight:`calc(98vh - ${ff}px)`,maxWidth:"98vw",width:"100%",height:"100%",overflow:"hidden"})},Aw=({visible:e,setVisible:n})=>{var p,g;const t=An(),{config:r,rootElement:i}=me(Be),{entity_id:s,speaker_group:o}=r,{attributes:{friendly_name:a,icon:c,device_class:l}}=He(),u=(g=(p=t.states[(o==null?void 0:o.entity_id)??s])==null?void 0:p.attributes)==null?void 0:g.group_members,d=Js({icon:c,deviceClass:l}),h=W(()=>{const{tap_opens_popup:v,...b}=r;return{...b,mode:"popup"}},[r]),f=Rn({rootElement:i,actionConfig:{tap_action:{action:"more-info"},entity:s}});return e?A("div",{css:mn.overlay,children:[m("div",{css:mn.clickableBackground,onClick:()=>n(!1)}),A("div",{css:mn.popUpContainer,children:[A("div",{css:mn.popUpHeader,children:[m(At,{size:"small",icon:d}),A("h2",{css:mn.title,children:[a,(u==null?void 0:u.length)>1&&A("span",{children:[" +",u.length-1]})]}),m(ae,{size:"small",...f,icon:"mdi:dots-vertical"}),m(ae,{icon:"mdi:close",size:"small",onClick:()=>n(!1)})]}),m("div",{css:mn.popUpContent,children:m(rc,{rootElement:i,config:h,children:m(su,{css:mn.massiveCard})})})]})]}):null},pf=it({player:{}}),Tw=({hass:e,children:n,entityId:t})=>{const r=W(()=>{const i=e.states[t];if(!i)return{player:{entity_id:t,state:"unavailable",attributes:{},title:"Unavailable",subtitle:`${t} unavailable`}};const{attributes:{media_title:s,media_artist:o,media_album_name:a,source:c,friendly_name:l},state:u}=i;if(u==="off")return{player:{...i,title:l??t,subtitle:void 0}};if(u==="unavailable")return{player:{...i,title:"Unavailable",subtitle:`${t} unavailable`}};let d=s;(!d||d==="")&&(c&&typeof c=="string"&&!c.startsWith("media_player.")?d=c:d=l??t);const h=a||o?`${a&&a!==d?`${a} - `:""}${o??""}`:void 0;return{player:{...i,title:d,subtitle:h}}},[e.states,t]);return m(pf.Provider,{value:r,children:n})},He=()=>{const e=me(pf);if(!e)throw new Error("useHass must be used within a HassContextProvider");return e.player},mf={titleText:S({margin:0,fontSize:"16px",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:Me.colors.onCard}),artistText:S({margin:0,fontSize:"14px",color:Me.colors.onCardMuted,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},Rw=()=>{const{title:e,subtitle:n}=He();return A(Oe,{children:[!!e&&m("h3",{css:mf.titleText,children:e}),!!n&&m("p",{css:mf.artistText,children:n})]})},Br={root:S({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",marginTop:"auto",height:"36px",marginLeft:"-4px"}),buttonMuted:S({opacity:.8}),shuffleButton:S({"@container (max-width: 150px)":{display:"none"}}),repeatButton:S({"@container (max-width: 130px)":{display:"none"}})},Nw=()=>{const{config:e}=me(Be),{attributes:{shuffle:n,repeat:t},state:r}=He(),i=r==="playing",{supportPreviousTrack:s,supportNextTrack:o,supportsShuffle:a,supportsRepeat:c,supportsTogglePlayPause:l}=po(),u=D(()=>{ge().callService("media_player","media_play_pause",{entity_id:e.entity_id})},[]),d=D(()=>{ge().callService("media_player","media_next_track",{entity_id:e.entity_id})},[]),h=D(()=>{ge().callService("media_player","media_previous_track",{entity_id:e.entity_id})},[]),f=D(()=>{ge().callService("media_player","shuffle_set",{entity_id:e.entity_id,shuffle:!n})},[n]),p=D(()=>{const g=t==="off"?"one":t==="one"?"all":"off";ge().callService("media_player","repeat_set",{entity_id:e.entity_id,repeat:g})},[t]);return A("div",{css:Br.root,children:[!!a&&m(ae,{css:[Br.shuffleButton,...n?[]:[Br.buttonMuted]],size:"x-small",onClick:f,icon:n?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),!!s&&m(ae,{size:"small",onClick:h,icon:"mdi:skip-previous"}),l&&m(ae,{size:"medium",onClick:u,icon:i?"mdi:pause-circle":"mdi:play-circle"}),!!o&&m(ae,{size:"small",onClick:d,icon:"mdi:skip-next"}),!!c&&m(ae,{css:[Br.repeatButton,...t==="off"?[Br.buttonMuted]:[]],size:"x-small",onClick:p,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},wa={root:S({display:"flex",flexDirection:"row",alignItems:"center",gap:"4px"}),friendlyName:S({fontSize:"11px",color:Me.colors.onCardMuted,opacity:.8,fontStyle:"italic"})},Pw=()=>{var u,d;const e=An(),{config:n}=me(Be),{entity_id:t,speaker_group:r}=n,{attributes:{friendly_name:i,icon:s,device_class:o},state:a}=He(),c=(d=(u=e.states[(r==null?void 0:r.entity_id)??t])==null?void 0:u.attributes)==null?void 0:d.group_members,l=Js({icon:s,deviceClass:o});return a==="off"?null:A("div",{css:wa.root,children:[m(At,{icon:l,size:"xx-small"}),m("span",{css:wa.friendlyName,children:i}),c&&c.length>1&&A("span",{css:wa.friendlyName,children:["+",c.length-1]})]})},Dw={root:S({maxHeight:300,paddingTop:12,paddingBottom:12,borderTop:`0.5px solid ${Me.colors.onCardDivider}`,overflowY:"auto"})},Vw=()=>{const{config:e}=me(Be),{ma_entity_id:n,search:t,entity_id:r}=e,i=()=>n?m(Zc,{maEntityId:n,horizontalPadding:12}):t!=null&&t.enabled?m(Sc,{entityId:t.entity_id??r,showFavorites:t.show_favorites??!1,horizontalPadding:12,filterConfig:t.media_types}):null;return m("div",{css:Dw.root,children:i()})},gn={speakerGroupContainer:S({display:"flex",flexDirection:"column",paddingTop:"12px",paddingBottom:"16px",borderTop:`0.5px solid ${Me.colors.onCardDivider}`,gap:"12px"}),groupTitle:S({fontSize:"16px",fontWeight:500,color:Me.colors.onCard,margin:"0px 16px"}),syncContainer:S({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",marginRight:"19px"}),syncText:S({fontSize:"12px",color:Me.colors.onCardMuted}),groupedSpeakers:S({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),titleRow:S({display:"flex",alignItems:"center"})},Fw=()=>{var c,l;const e=An(),{config:n}=me(Be),{entity_id:t,speaker_group:r}=n,[i,s]=F(!0),o=(r==null?void 0:r.entity_id)||t,a=e.states[o];return A("div",{css:gn.speakerGroupContainer,children:[((l=(c=a==null?void 0:a.attributes)==null?void 0:c.group_members)==null?void 0:l.length)>1&&A(Oe,{children:[A("div",{css:gn.titleRow,children:[m("h3",{css:gn.groupTitle,children:"Grouped Speakers"}),A("div",{css:gn.syncContainer,children:[m("span",{css:gn.syncText,onClick:()=>s(!i),children:"Link Volume"}),m(ae,{icon:i?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>s(!i)})]})]}),m("div",{css:gn.groupedSpeakers,children:m(uc,{config:{entity_id:t,speaker_group:r},syncMainSpeaker:i})})]}),m("h3",{css:gn.groupTitle,children:"Add speakers to group"}),m(Zs,{config:{entity_id:t,speaker_group:r},showGrouped:!1,layout:{horizontalMargin:16}})]})},Lw={root:S({display:"flex",alignItems:"center",transition:"all 0.3s ease",width:"100%",gap:"4px"})},zw=()=>{var a,c;const e=He(),n=e.entity_id,t=((a=e.attributes)==null?void 0:a.volume_level)??0,r=((c=e.attributes)==null?void 0:c.is_volume_muted)??!1,i=D(l=>{ge().callService("media_player","volume_set",{entity_id:n,volume_level:l})},[]),s=D(()=>{ge().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!r})},[r]),o=W(()=>fr(t,r),[t,r]);return A("div",{css:Lw.root,children:[m(ae,{size:"x-small",onClick:s,icon:o}),m(Ea,{min:0,max:1,step:.01,value:t,sliderSize:"small",onChange:i})]})},Bw=({sliderVisible:e,setSliderVisible:n})=>{var o,a;const t=He(),r=((o=t.attributes)==null?void 0:o.volume_level)??0,i=((a=t.attributes)==null?void 0:a.is_volume_muted)??!1,s=fr(r,i);return m(Oe,{children:e?m(ae,{size:"x-small",onClick:()=>n(!1),icon:"mdi:chevron-left"}):m(ae,{size:"x-small",onClick:()=>n(!0),icon:s})})},mt={card:S({borderRadius:"var(--ha-card-border-radius, 12px)",overflow:"hidden"}),cardArtBackground:S({background:`
      radial-gradient( circle at bottom right, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top center, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at bottom center, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top left, var(--art-color, transparent) -500%, transparent 40% )`}),cardContent:S({display:"flex",gap:"14px",padding:"12px",opacity:1,transition:"opacity 0.3s ease",position:"relative"}),cardRowRight:S({display:"grid",gridTemplateColumns:"repeat(3, auto)",gap:"4px",minWidth:"max-content"}),cardRow:S({display:"flex",flexDirection:"row",gap:"8px",alignItems:"center",justifyContent:"space-between"}),alignStart:S({alignItems:"start"}),cardColumn:S({display:"flex",flexDirection:"column",flex:1}),grid:S({display:"grid"}),controlsContainer:S({display:"flex",flexGrow:1,containerType:"inline-size"})},jw=()=>{const{rootElement:e,config:n}=me(Be),{entity_id:t,custom_buttons:r,action:i,tap_opens_popup:s,use_art_colors:o,ma_entity_id:a,search:c,options:{always_show_power_button:l,always_show_custom_buttons:u}={}}=n,d=r&&r.length>0,f=a&&a.length>0||(c==null?void 0:c.enabled),[p,g]=F(!1),[v,b]=F(u??!1),[_,$]=F(!1),[k,x]=F(!1),{artVars:C,haVars:M}=tu(),{state:O,subtitle:I}=He(),T=po(),N=!T.supportsTogglePlayPause&&!T.supportNextTrack&&!T.supportPreviousTrack&&!T.supportsShuffle&&!T.supportsRepeat,j=O!=="off"&&O!=="unavailable",Z=n.speaker_group&&n.speaker_group.entities&&n.speaker_group.entities.length>0,ne=()=>{g(!p)},[ve,ke]=F(!1),$e=O==="off"||!I&&N?68:100,Q=Rn({rootElement:e,actionConfig:{...i??{tap_action:{action:"more-info"}},entity:n.entity_id},overrideCallback:s?{onTap:()=>{ke(!0)}}:{}}),qe=D(()=>{ge().callService("media_player","toggle",{entity_id:t})},[t]);return m("ha-card",{children:A("div",{css:[mt.card,o&&mt.cardArtBackground],style:{...C??{},...M&&o?M:{}},children:[A("div",{css:mt.cardContent,style:{opacity:j?1:.7},children:[m(nc,{size:$e,iconSize:"large",...Q}),A("div",{css:mt.cardColumn,children:[A("div",{css:[mt.cardRow,mt.alignStart],children:[A("div",{css:mt.grid,children:[m(Rw,{}),m(Pw,{})]}),A("div",{css:mt.cardRowRight,children:[d&&!u&&m(Oe,{children:r.length===1?m(hf,{button:r[0],type:"icon-button"}):m(ae,{size:"x-small",onClick:()=>b(!v),icon:"mdi:dots-vertical"})}),f&&m(ae,{size:"x-small",onClick:()=>x(!k),icon:"mdi:magnify"})]})]}),A("div",{css:mt.cardRow,style:{marginTop:"auto",minHeight:N?"unset":"36px"},children:[m("div",{css:mt.controlsContainer,children:_||N?m(zw,{}):m(Nw,{})}),A("div",{css:mt.cardRowRight,children:[!!j&&!N&&m(Bw,{sliderVisible:_,setSliderVisible:$}),!!j&&Z&&m(ae,{size:"x-small",onClick:ne,icon:"mdi:speaker-multiple"}),(!j||N||l)&&m(ae,{size:"x-small",onClick:qe,icon:"mdi:power"})]})]})]})]}),p&&Z&&m(Fw,{}),v&&m(Ow,{}),k&&m(Vw,{}),ve&&m(Aw,{visible:ve,setVisible:ke})]})})},qw=({config:e,rootElement:n,hass:t})=>{const r=D(l=>{const u=new Event("config-changed",{bubbles:!0,composed:!0});u.detail={config:l},n.dispatchEvent(u)},[n]),i=sf({defaultValues:af(e),validators:{onChange:nw},listeners:{onChange:({formApi:l})=>{if(l.state.isValid){const u=cf(l.state.values);JSON.stringify(e)!==JSON.stringify(cf(u))&&r(u)}else console.log(l.state.errors)},onChangeDebounceMs:500}}),s=zr(i.store,l=>l.errorMap),o=D(l=>!!Object.keys((s==null?void 0:s.onChange)??{}).find(u=>u.startsWith(l)),[s]),a=D(()=>{const l=i.getFieldValue("custom_buttons")||[];i.setFieldValue("custom_buttons",[...l,{icon:"mdi:paper-roll",name:"New Button",tap_action:{action:"toggle"}}])},[i]),c=D(l=>{const d=[...i.getFieldValue("custom_buttons")||[]];d.splice(l,1),i.setFieldValue("custom_buttons",d)},[i]);return ce(()=>{const l=i.state.values,u=af(e);JSON.stringify(l)!==JSON.stringify(u)&&i.reset(u)},[e,i]),!e||!t?null:A("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),i.handleSubmit()},children:[m(i.Field,{name:"entity_id",children:l=>m(tt,{children:m($t,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??""),label:"Media Player Entity",domains:["media_player"],error:yn(l),required:!0})})}),A(tt,{css:S({display:"flex",flexDirection:"row",gap:"16px"}),children:[m(i.Field,{name:"use_art_colors",children:l=>A(xt,{children:[m(St,{id:"use_art_colors",checked:l.state.value,onChange:u=>{var d;return l.handleChange(((d=u.target)==null?void 0:d.checked)??!1)}}),m(wt,{htmlFor:"use_art_colors",children:"Use album art colors"})]})}),m(i.Field,{name:"tap_opens_popup",children:l=>A(xt,{children:[m(St,{id:"tap_opens_popup",checked:l.state.value,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"tap_opens_popup",children:"Tap opens popup."})]})})]}),A(je,{title:"Interactions",error:o("action"),children:[m(i.Field,{name:"tap_opens_popup",children:l=>m(dr,{children:l.state.value&&m(En,{children:'Tap action overridden by "tap opens popup".'})})}),m(i.Field,{name:"action",children:l=>m(ui,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??{})})})]}),A(je,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[m(i.Field,{name:"speaker_group.entity_id",children:l=>m(tt,{children:m($t,{hass:t,value:l.state.value||"",onChange:u=>{l.handleChange(u??null)},label:"Main Speaker Entity ID (Optional)",error:yn(l),domains:["media_player"]})})}),m(i.Field,{name:"speaker_group.entities",children:l=>m(tt,{children:m(lc,{hass:t,value:l.state.value??[],onChange:u=>{l.handleChange(u??[])},label:"Select Speakers (including main speaker)",domains:["media_player"]})})})]}),A(je,{title:"Search (optional)",error:o("search"),children:[m(i.Field,{name:"ma_entity_id",children:l=>{var u;return m(dr,{children:(((u=l.state.value)==null?void 0:u.length)??0)>0&&m(En,{children:"ma_entity_id is already set. Any change in this section will not have any effect."})})}}),A(tt,{children:[m(i.Field,{name:"search.enabled",children:l=>A(xt,{children:[m(St,{type:"checkbox",id:"search.enabled",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"search.enabled",children:"Enable Search"})]})}),m(i.Field,{name:"search.enabled",children:l=>m(dr,{children:l.state.value&&m(i.Field,{name:"search.show_favorites",children:u=>A(xt,{children:[m(St,{type:"checkbox",id:"search.show_favorites",checked:u.state.value??!1,onChange:d=>u.handleChange(d.target.checked)}),m(wt,{htmlFor:"search.show_favorites",children:"Show Favorites when not searching"})]})})})}),m(i.Field,{name:"search.entity_id",children:l=>m($t,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Search target (Optional, if not set, will use the main entity_id)",error:yn(l),domains:["media_player"]})})]}),m(i.Field,{name:"search.media_types",children:l=>{var u;return m(of,{entityId:((u=e.search)==null?void 0:u.entity_id)??e.entity_id??"",hass:t,mediaTypes:l.state.value??[],onChange:d=>{l.handleChange(d??[])}})}})]}),m(i.Field,{name:"ma_entity_id",children:l=>m(je,{title:"Music Assistant Configuration (optional)",error:yn(l),children:m(tt,{children:m($t,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Music Assistant Entity ID (Optional)",error:yn(l),domains:["media_player"]})})})}),m(je,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:A(oc,{children:[m(i.Field,{name:"custom_buttons",children:l=>{var u;return(u=l.state.value)==null?void 0:u.map((d,h)=>A(je,{title:`Button ${h} - ${d.name}`,error:o(`custom_buttons[${h}]`),children:[A(tt,{children:[m(i.Field,{name:`custom_buttons[${h}].name`,children:f=>m(ci,{children:m(on,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,label:"Name",error:yn(f)})})}),m(i.Field,{name:`custom_buttons[${h}].icon`,children:f=>m(ci,{children:m(on,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,isIconInput:!0,label:"Icon",error:yn(f)})})}),m(En,{children:"Interactions"}),m(i.Field,{name:`custom_buttons[${h}]`,children:f=>{const p=f.state.value??{icon:"",name:""},{name:g,icon:v,...b}=p;return m(ui,{hass:t,value:b,onChange:_=>{f.handleChange({name:g,icon:v,..._})}})}})]}),m(ac,{type:"button",onClick:()=>c(h),children:"Remove Button"})]},h))}}),m(pr,{type:"button",onClick:a,children:"Add Custom Button"})]})}),A(je,{title:"Additional options (optional)",error:o("options"),children:[m(i.Field,{name:"options.always_show_power_button",children:l=>A(xt,{children:[m(St,{id:"options.always_show_power_button",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"options.always_show_power_button",children:"Always show power button"})]})}),m(i.Field,{name:"options.always_show_custom_buttons",children:l=>A(xt,{children:[m(St,{id:"options.always_show_custom_buttons",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(wt,{htmlFor:"options.always_show_custom_buttons",children:"Always show custom buttons panel below card"})]})})]})]})},yn=e=>e.state.meta.isValid?void 0:e.state.meta.errors.map(n=>typeof n=="string"?n:(n==null?void 0:n.message)||String(n)).filter(Boolean).join(", "),gf={root:S({display:"flex",flexDirection:"row",height:"4px",width:"100%",backgroundColor:"var(--divider-color)",borderRadius:"2px",overflow:"hidden"}),progress:S({height:"100%",backgroundColor:"var(--secondary-text-color)",width:"0%",transition:"width 1s linear"})},Uw=({min:e,max:n,value:t})=>{const r=(t-e)/(n-e)*100;return m("div",{css:gf.root,children:m("div",{css:gf.progress,style:{width:`${r}%`}})})},yf=()=>{};var Kw={};const Sa=it({register:()=>{},unregister:()=>{},map:new Map,elementsRef:{current:[]}});Kw.NODE_ENV!=="production"&&(Sa.displayName="CompositeListContext");function Ww(){return me(Sa)}var Hw={};function Gw(e,n){const t=e.compareDocumentPosition(n);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}function vf(e){const{children:n,elementsRef:t,labelsRef:r,onMapChange:i}=e,[s,o]=F(()=>new Map),a=D((d,h)=>{o(f=>new Map(f).set(d,h??null))},[]),c=D(d=>{o(h=>{const f=new Map(h);return f.delete(d),f})},[]),l=W(()=>{const d=new Map;return Array.from(s.keys()).sort(Gw).forEach((f,p)=>{const g=s.get(f)??{};d.set(f,{...g,index:p})}),d},[s]);Je(()=>{i==null||i(l)},[l,i]);const u=W(()=>({register:a,unregister:c,map:l,elementsRef:t,labelsRef:r}),[a,c,l,t,r]);return Re(Sa.Provider,{value:u,children:n})}Hw.NODE_ENV!=="production"&&(vf.propTypes={children:w.node,elementsRef:w.any,labelsRef:w.shape({current:w.arrayOf(w.string).isRequired}),onMapChange:w.func});const cs={activeThumbIndex:()=>null,max:()=>null,min:()=>null,minStepsBetweenValues:()=>null,step:()=>null,values:()=>null};function bf(e){let n=e.activeElement;for(;((t=n)==null||(t=t.shadowRoot)==null?void 0:t.activeElement)!=null;){var t;n=n.shadowRoot.activeElement}return n}function $a(e,n,t=(r,i)=>r===i){return e.length===n.length&&e.every((r,i)=>t(r,n[i]))}function jt(e,n=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER){return Math.max(n,Math.min(e,t))}function jr(e){return e&&e.ownerDocument||document}function qr(e,n,t){return(e-n)*100/(t-n)}var _f={};let ka;_f.NODE_ENV!=="production"&&(ka=new Set);function Jw(...e){if(_f.NODE_ENV!=="production"){const n=e.join(" ");ka.has(n)||(ka.add(n),console.warn(`Base UI: ${n}`))}}var Yw={};const xf=it(void 0);Yw.NODE_ENV!=="production"&&(xf.displayName="DirectionContext");function wf(e=!0){const n=me(xf);if(n===void 0&&!e)throw new Error("Base UI: DirectionContext is missing.");return(n==null?void 0:n.direction)??"ltr"}function Sf(e,n){return e-n}function us(e,n,t){const r=e.slice();return r[n]=t,r.sort(Sf)}function $f(e,n,t,r,i,s){let o=e;return o=jt(o,t,r),i&&(o=us(s,n,jt(o,s[n-1]||-1/0,s[n+1]||1/0))),o}function Zw(e){if(Math.abs(e)<1){const t=e.toExponential().split("e-"),r=t[0].split(".")[1];return(r?r.length:0)+parseInt(t[1],10)}const n=e.toString().split(".")[1];return n?n.length:0}function kf(e,n,t){const r=Math.round((e-t)/n)*n+t;return Number(r.toFixed(Zw(n)))}let ds=function(e){return e.index="data-index",e.dragging="data-dragging",e.orientation="data-orientation",e.disabled="data-disabled",e.readonly="data-readonly",e.required="data-required",e.valid="data-valid",e.invalid="data-invalid",e.touched="data-touched",e.dirty="data-dirty",e.focused="data-focused",e}({});function Xw(e,n){return typeof e=="number"&&typeof n=="number"?e===n:Array.isArray(e)&&Array.isArray(n)?$a(e,n):!1}function Qw(e,n,t){let r,i;for(let s=0;s<e.length;s+=1){const o=Math.abs(n-e[s]);(i===void 0||(e[s]===t?o<i:o<=i))&&(r=s,i=o)}return r}function Ca(e,n,t){const r=[];for(let i=0;i<e.length;i+=1)r.push(jt(qr(e[i],n,t),0,100));return r}function hs(e,n,t){if(!n.current)return;const r=bf(jr(n.current));(r==null||!n.current.contains(r)||Number(r.getAttribute(ds.index))!==e)&&n.current.querySelector(`[type="range"][${ds.index}="${e}"]`).focus(),t&&t(e)}function Cf(e,n,t){if(!Array.isArray(e))return!0;const r=e.reduce((i,s,o,a)=>(o===a.length-1||i.push(Math.abs(s-a[o+1])),i),[]);return Math.min(...r)>=n*t}function eS(e,n){if(!e)return{start:0,end:0};const t=n==="horizontal"?"InlineStart":"Top",r=n==="horizontal"?"InlineEnd":"Bottom";return{start:parseFloat(e[`border${t}Width`])+parseFloat(e[`padding${t}`]),end:parseFloat(e[`border${r}Width`])+parseFloat(e[`padding${r}`])}}function tS(e){const{"aria-labelledby":n,defaultValue:t,disabled:r=!1,id:i,largeStep:s=10,max:o=100,min:a=0,minStepsBetweenValues:c=0,name:l,onValueChange:u,onValueCommitted:d,orientation:h="horizontal",rootRef:f,step:p=1,value:g}=e,v=wf(),{setControlId:b,setTouched:_,setDirty:$,validityData:k,validationMode:x}=ot(),{getValidationProps:C,inputRef:M,commitValidation:O}=gi(),[I,T]=Wc({controlled:g,default:t??a,name:"Slider"}),N=le(null),j=le(null),Z=le([]),ne=le(null),[ve,ke]=F(()=>new Map);Je(()=>(b(i),()=>{b(void 0)}),[i,b]),Kc({id:i,commitValidation:O,value:I,controlRef:j});const[$e,ee]=F(-1),[Q,qe]=F(!1),E=le(null),V=D(ie=>{ie&&(j.current=ie,E.current==null&&(E.current=getComputedStyle(ie)),M.current=ie.querySelector('input[type="range"]'))},[M]),B=Array.isArray(I),G=W(()=>B?I.slice().sort(Sf):[jt(I,a,o)],[o,a,B,I]);function J(){return Ca(G,a,o)}const[X,U]=F(J),K=ht((ie,Fe,gt,Ge)=>{if(Number.isNaN(ie)||Xw(ie,I))return;T(ie),U(Fe);const Kr=new Ge.constructor(Ge.type,Ge);Object.defineProperty(Kr,"target",{writable:!0,value:{value:ie,name:l}}),ne.current=ie,u(ie,Kr,gt)}),q=ht((ie,Fe)=>{if(Array.isArray(ie)){const gt=Ca(ie,a,o);$a(gt,X)||U(gt)}else typeof ie=="number"&&U([qr(ie,a,o)]);d(ie,Fe)}),oe=Tn(f,N),re=ht((ie,Fe,gt)=>{const Ge=$f(ie,Fe,a,o,B,G);B&&hs(Fe,N),Cf(Ge,p,c)&&(Array.isArray(Ge)?K(Ge,us(X,Fe,qr(Ge[Fe],a,o)),Fe,gt.nativeEvent):K(Ge,[qr(Ge,a,o)],Fe,gt.nativeEvent),$(Ge!==k.initialValue),_(!0),d(ne.current??Ge,gt.nativeEvent),x==="onChange"&&O(ne.current??Ge))}),Ue=le(null),L=ht((ie,Fe=!1,gt=0)=>{if(ie==null)return null;const Ge=j.current;if(!Ge)return null;const Kr=v==="rtl",OS=h==="vertical",{width:IS,height:AS,bottom:TS,left:RS,right:NS}=Ge.getBoundingClientRect(),bn=eS(E.current,h);let _n=OS?(TS-bn.end-ie.y)/(AS-bn.start-bn.end)+gt:(Kr?NS-bn.start-ie.x:ie.x-RS-bn.start)/(IS-bn.start-bn.end)+gt*(Kr?-1:1);_n=jt(_n,0,1);let qt=(o-a)*_n+a;if(qt=kf(qt,p,a),qt=jt(qt,a,o),!B)return{value:qt,valueRescaled:_n,percentageValues:[_n*100],thumbIndex:0};Fe&&(Ue.current=Qw(G,qt,o)??0);const xn=Ue.current??0,Ia=c*p,Gf=Ia*100/(o-a);qt=jt(qt,G[xn-1]+Ia||-1/0,G[xn+1]-Ia||1/0);const PS=jt(_n*100,X[xn-1]+Gf||-1/0,X[xn+1]-Gf||1/0);return{value:us(G,xn,qt),valueRescaled:_n,percentageValues:us(X,xn,PS),thumbIndex:xn}});Je(()=>{if(!(g===void 0||Q)){if(a>=o&&Jw("Slider `max` must be greater than `min`"),typeof I=="number"){const ie=jt(qr(I,a,o),0,100);ie!==X[0]&&!Number.isNaN(ie)&&U([ie])}else if(Array.isArray(I)){const ie=Ca(I,a,o);$a(ie,X)||U(ie)}}},[Q,a,o,X,U,g,I]),Je(()=>{var Fe;const ie=bf(jr(N.current));r&&((Fe=N.current)!=null&&Fe.contains(ie))&&ie.blur()},[r]),r&&$e!==-1&&ee(-1);const at=D((ie={})=>nt({"aria-labelledby":n,id:i,ref:oe,role:"group"},C(ie)),[n,C,oe,i]);return W(()=>({"aria-labelledby":n,active:$e,commitValue:q,disabled:r,dragging:Q,getFingerState:L,getRootProps:at,handleInputChange:re,largeStep:s,lastChangedValueRef:ne,max:o,min:a,minStepsBetweenValues:c,name:l,onValueCommitted:d,orientation:h,percentageValues:X,range:B,registerSliderControl:V,setActive:ee,setDragging:qe,setThumbMap:ke,setValue:K,step:p,thumbMap:ve,thumbRefs:Z,values:G}),[$e,n,q,r,Q,L,at,re,s,ne,o,a,c,l,d,h,X,B,V,ee,qe,ke,K,p,ve,Z,G])}var nS={};const Ma=it(void 0);nS.NODE_ENV!=="production"&&(Ma.displayName="SliderRootContext");function fs(){const e=me(Ma);if(e===void 0)throw new Error("Base UI: SliderRootContext is missing. Slider parts must be placed within <Slider.Root>.");return e}var rS={};const Mf=Qe(function(n,t){const{className:r,defaultValue:i,disabled:s=!1,id:o,format:a,largeStep:c=10,render:l,max:u=100,min:d=0,minStepsBetweenValues:h=0,name:f,onValueChange:p,onValueCommitted:g,orientation:v="horizontal",step:b=1,tabIndex:_,value:$,...k}=n,x=an(o),{labelId:C,state:M,disabled:O,name:I}=ot(),T=O||s,N=I??f??"",{getRootProps:j,...Z}=tS({"aria-labelledby":n["aria-labelledby"]??C,defaultValue:i,disabled:T,id:x??"",largeStep:c,max:u,min:d,minStepsBetweenValues:h,name:N,onValueChange:p??yf,onValueCommitted:g??yf,orientation:v,rootRef:t,step:b,value:$}),ne=W(()=>({...M,activeThumbIndex:Z.active,disabled:T,dragging:Z.dragging,orientation:v,max:Z.max,min:Z.min,minStepsBetweenValues:Z.minStepsBetweenValues,step:Z.step,values:Z.values}),[M,T,v,Z.active,Z.dragging,Z.max,Z.min,Z.minStepsBetweenValues,Z.step,Z.values]),ve=W(()=>({...Z,format:a,state:ne,tabIndex:_??null}),[Z,a,ne,_]),{renderElement:ke}=Tt({propGetter:j,render:l??"div",state:ne,className:r,extraProps:k,customStyleHookMapping:cs});return Re(Ma.Provider,{value:ve,children:Re(vf,{elementsRef:Z.thumbRefs,onMapChange:Z.setThumbMap,children:ke()})})});rS.NODE_ENV!=="production"&&(Mf.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),defaultValue:w.oneOfType([w.arrayOf(w.number),w.number]),disabled:w.bool,format:w.shape({compactDisplay:w.oneOf(["long","short"]),currency:w.string,currencyDisplay:w.oneOf(["code","name","narrowSymbol","symbol"]),currencySign:w.oneOf(["accounting","standard"]),localeMatcher:w.oneOf(["best fit","lookup"]),maximumFractionDigits:w.number,maximumSignificantDigits:w.number,minimumFractionDigits:w.number,minimumIntegerDigits:w.number,minimumSignificantDigits:w.number,notation:w.oneOf(["compact","engineering","scientific","standard"]),numberingSystem:w.string,signDisplay:w.oneOf(["always","auto","exceptZero","never"]),style:w.oneOf(["currency","decimal","percent","unit"]),unit:w.string,unitDisplay:w.oneOf(["long","narrow","short"]),useGrouping:w.bool}),id:w.string,largeStep:w.number,max:w.number,min:w.number,minStepsBetweenValues:w.number,name:w.string,onValueChange:w.func,onValueCommitted:w.func,orientation:w.oneOf(["horizontal","vertical"]),render:w.oneOfType([w.element,w.func]),step:w.number,tabIndex:w.number,value:w.oneOfType([w.arrayOf(w.number),w.number])});const Ef=new Map;function iS(e,n){const t=JSON.stringify({locale:e,options:n}),r=Ef.get(t);if(r)return r;const i=new Intl.NumberFormat(e,n);return Ef.set(t,i),i}function ps(e,n,t){return e==null?"":iS(n,t).format(e)}const sS=2;function ms(e,n){if(n.current!==void 0&&e.changedTouches){const t=e;for(let r=0;r<t.changedTouches.length;r+=1){const i=t.changedTouches[r];if(i.identifier===n.current)return{x:i.clientX,y:i.clientY}}return null}return{x:e.clientX,y:e.clientY}}function oS(e){const{disabled:n,dragging:t,getFingerState:r,lastChangedValueRef:i,minStepsBetweenValues:s,commitValue:o,percentageValues:a,registerSliderControl:c,rootRef:l,setActive:u,setDragging:d,setValue:h,step:f,thumbRefs:p}=e,{commitValidation:g}=gi(),v=le(null),b=Tn(l,c,v),_=le(null),$=le(0),k=le(0),x=ht(T=>{const N=ms(T,_);if(N==null)return;if($.current+=1,T.type==="pointermove"&&T.buttons===0){C(T);return}const j=r(N,!1,k.current);j!=null&&(hs(j.thumbIndex,v,u),Cf(j.value,f,s)&&(!t&&$.current>sS&&d(!0),h(j.value,j.percentageValues,j.thumbIndex,T)))}),C=ht(T=>{const N=ms(T,_);if(d(!1),N==null)return;const j=r(N,!1);j!=null&&(u(-1),g(i.current??j.value),o(i.current??j.value,T),_.current=null,O())}),M=ht(T=>{if(n)return;const N=T.changedTouches[0];N!=null&&(_.current=N.identifier);const j=ms(T,_);if(j!=null){const ne=r(j,!0);if(ne==null)return;hs(ne.thumbIndex,v,u),h(ne.value,ne.percentageValues,ne.thumbIndex,T)}$.current=0;const Z=jr(v.current);Z.addEventListener("touchmove",x,{passive:!0}),Z.addEventListener("touchend",C,{passive:!0})}),O=ht(()=>{k.current=0;const T=jr(v.current);T.removeEventListener("pointermove",x),T.removeEventListener("pointerup",C),T.removeEventListener("touchmove",x),T.removeEventListener("touchend",C)});ce(()=>{const{current:T}=v;return T?(T.addEventListener("touchstart",M,{passive:!0}),()=>{T.removeEventListener("touchstart",M),O()}):()=>O()},[O,M,v]),ce(()=>{n&&O()},[n,O]);const I=D((T={})=>nt({onPointerDown(N){if(n||N.defaultPrevented||N.button!==0)return;N.preventDefault();const j=ms(N,_);if(j!=null){const ne=r(j,!0);if(ne==null)return;hs(ne.thumbIndex,v,u),p.current.includes(N.target)?k.current=a[ne.thumbIndex]/100-ne.valueRescaled:h(ne.value,ne.percentageValues,ne.thumbIndex,N.nativeEvent)}$.current=0;const Z=jr(v.current);Z.addEventListener("pointermove",x,{passive:!0}),Z.addEventListener("pointerup",C)},ref:b},T),[n,r,b,x,C,h,a,u,p]);return W(()=>({getRootProps:I}),[I])}var aS={};const Of=Qe(function(n,t){const{render:r,className:i,...s}=n,{commitValue:o,disabled:a,dragging:c,getFingerState:l,lastChangedValueRef:u,minStepsBetweenValues:d,percentageValues:h,registerSliderControl:f,setActive:p,setDragging:g,setValue:v,state:b,step:_,thumbRefs:$}=fs(),{getRootProps:k}=oS({commitValue:o,disabled:a,dragging:c,getFingerState:l,lastChangedValueRef:u,minStepsBetweenValues:d,percentageValues:h,registerSliderControl:f,rootRef:t,setActive:p,setDragging:g,setValue:v,step:_,thumbRefs:$}),{renderElement:x}=Tt({propGetter:k,render:r??"div",state:b,className:i,extraProps:s,customStyleHookMapping:cs});return x()});aS.NODE_ENV!=="production"&&(Of.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),render:w.oneOfType([w.element,w.func])});var lS={};const If=Qe(function(n,t){const{render:r,className:i,...s}=n,{state:o}=fs(),{renderElement:a}=Tt({render:r??"div",state:o,className:i,ref:t,extraProps:{...s,style:{position:"relative",...s.style}},customStyleHookMapping:cs});return a()});lS.NODE_ENV!=="production"&&(If.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),render:w.oneOfType([w.element,w.func]),style:w.object});const Af={clip:"rect(0 0 0 0)",overflow:"hidden",whiteSpace:"nowrap",position:"fixed",top:0,left:0,border:0,padding:0,width:1,height:1,margin:-1},cS="ArrowUp",uS="ArrowDown",dS="ArrowLeft",hS="ArrowRight",fS="Home",pS="End";function mS(e={}){const{label:n,metadata:t}=e,{register:r,unregister:i,map:s,elementsRef:o,labelsRef:a}=Ww(),[c,l]=F(null),u=le(null),d=D(h=>{if(u.current=h,c!==null&&(o.current[c]=h,a)){const f=n!==void 0;a.current[c]=f?n:(h==null?void 0:h.textContent)??null}},[c,o,a,n]);return Je(()=>{const h=u.current;if(h)return r(h,t),()=>{i(h)}},[r,i,t]),Je(()=>{var f;const h=u.current?(f=s.get(u.current))==null?void 0:f.index:null;h!=null&&l(h)},[s]),W(()=>({ref:d,index:c??-1}),[c,d])}function Zn(e,n,t,r,i){return t===1?Math.min(e+n,i):Math.max(e-n,r)}function gS(e,n,t){if(!(n<0))return e.length===2?n===0?`${ps(e[n],[],t)} start range`:`${ps(e[n],[],t)} end range`:t?ps(e[n],[],t):void 0}function yS(e){const{active:n,"aria-label":t,"aria-labelledby":r,"aria-valuetext":i,handleInputChange:s,disabled:o,format:a,getAriaLabel:c=null,getAriaValueText:l=null,id:u,inputId:d,largeStep:h,max:f,min:p,minStepsBetweenValues:g,name:v,orientation:b,percentageValues:_,rootRef:$,step:k,tabIndex:x,values:C}=e,M=wf(),{setTouched:O,setFocused:I,validationMode:T}=ot(),{getInputValidationProps:N,inputRef:j,commitValidation:Z}=gi(),ne=le(null),ve=le(null),ke=Tn(ve,j),$e=W(()=>({inputId:d}),[d]),{ref:ee,index:Q}=mS({metadata:$e}),qe=Tn($,ee,ne),E=C[Q],V=_.length===1?_[0]:_[Q],B=M==="rtl",G=D(()=>{const U=b==="vertical";return Number.isFinite(V)?{position:"absolute",[{horizontal:"insetInlineStart",vertical:"bottom"}[b]]:`${V}%`,[U?"left":"top"]:"50%",transform:`translate(${(U||!B?-1:1)*50}%, ${(U?1:-1)*50}%)`,zIndex:n===Q?1:void 0}:Af},[n,B,b,V,Q]),J=D((U={})=>nt({[ds.index]:Q,id:u,onFocus(){I(!0)},onBlur(){ne.current&&(O(!0),I(!1),T==="onBlur"&&Z($f(E,Q,p,f,C.length>1,C)))},onKeyDown(K){let q=null;const oe=C.length>1,re=kf(E,k,p);switch(K.key){case cS:q=Zn(re,K.shiftKey?h:k,1,p,f);break;case hS:q=Zn(re,K.shiftKey?h:k,B?-1:1,p,f);break;case uS:q=Zn(re,K.shiftKey?h:k,-1,p,f);break;case dS:q=Zn(re,K.shiftKey?h:k,B?1:-1,p,f);break;case"PageUp":q=Zn(re,h,1,p,f);break;case"PageDown":q=Zn(re,h,-1,p,f);break;case pS:q=f,oe&&(q=Number.isFinite(C[Q+1])?C[Q+1]-k*g:f);break;case fS:q=p,oe&&(q=Number.isFinite(C[Q-1])?C[Q-1]+k*g:p);break}q!==null&&(s(q,Q,K),K.preventDefault())},ref:qe,style:G(),tabIndex:x??(o?void 0:0)},U),[Z,o,x,G,s,Q,B,h,f,qe,p,g,I,O,C,k,u,E,T]),X=D((U={})=>{let K;return b==="vertical"&&(K=B?"vertical-rl":"vertical-lr"),nt({"aria-label":c!=null?c(Q):t,"aria-labelledby":r,"aria-orientation":b,"aria-valuemax":f,"aria-valuemin":p,"aria-valuenow":E,"aria-valuetext":l!=null?l(ps(E,[],a??void 0),E,Q):i||gS(C,Q,a??void 0),[ds.index]:Q,disabled:o,id:d,max:f,min:p,name:v,onChange(q){s(q.target.valueAsNumber,Q,q)},ref:ke,step:k,style:{...Af,width:"100%",height:"100%",writingMode:K},tabIndex:-1,type:"range",value:E??""},N(U))},[t,r,i,s,o,a,c,l,N,Q,B,f,ke,p,v,b,C,k,d,E]);return W(()=>({getRootProps:J,getThumbInputProps:X,disabled:o,index:Q}),[J,X,o,Q])}var vS={};function bS(e,n){const{children:t,...r}=e;return Re("div",{...r,children:[t,Re("input",{...n})]})}const Tf=Qe(function(n,t){const{render:r,className:i,disabled:s=!1,getAriaLabel:o,getAriaValueText:a,id:c,inputId:l,onBlur:u,onFocus:d,onKeyDown:h,tabIndex:f,...p}=n,g=an(c),v=an(l),b=r??bS,{active:_,"aria-labelledby":$,handleInputChange:k,disabled:x,format:C=null,largeStep:M,max:O,min:I,minStepsBetweenValues:T,name:N,orientation:j,state:Z,percentageValues:ne,step:ve,tabIndex:ke,values:$e}=fs();let ee=null;typeof b!="function"&&(ee=Vc(19)?b.props.ref:b.ref);const Q=Tn(ee,t),{getRootProps:qe,getThumbInputProps:E,disabled:V,index:B}=yS({active:_,"aria-label":n["aria-label"],"aria-labelledby":$,"aria-valuetext":n["aria-valuetext"],handleInputChange:k,disabled:s||x,format:C,getAriaLabel:o??null,getAriaValueText:a??null,id:g,inputId:v,largeStep:M,max:O,min:I,minStepsBetweenValues:T,name:N,orientation:j,percentageValues:ne,rootRef:Q,step:ve,tabIndex:f??ke,values:$e}),G=W(()=>Rc({disabled:V,dragging:B!==-1&&_===B}),[_,V,B]),J=qe({...G,...p,className:Nc(i,Z)}),X=E({disabled:V});if(typeof b=="function")return b(J,X,Z);const{children:U,...K}=b.props,q=J.children??U;return Yr(b,{...nt({...J,children:Re(Oe,{children:[typeof q=="function"?q():q,Re("input",{...X})]})},K),ref:J.ref})});vS.NODE_ENV!=="production"&&(Tf.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),disabled:w.bool,getAriaLabel:w.func,getAriaValueText:w.func,id:w.string,inputId:w.string,onBlur:w.func,onFocus:w.func,onKeyDown:w.func,onPointerLeave:w.func,onPointerOver:w.func,render:w.oneOfType([w.func,w.node]),tabIndex:w.number});function _S(e,n,t){return e==="vertical"?{position:"absolute",bottom:`${n}%`,height:`${t}%`,width:"inherit"}:{position:"relative",insetInlineStart:`${n}%`,width:`${t}%`,height:"inherit"}}function xS(e){const{orientation:n,percentageValues:t}=e;let r;if(t.length>1){const s=t[0],o=t[t.length-1]-s;r=_S(n,s,o)}else n==="vertical"?r={position:"absolute",bottom:0,height:`${t[0]}%`,width:"inherit"}:r={position:"relative",insetInlineStart:0,width:`${t[0]}%`,height:"inherit"};const i=D((s={})=>nt({style:r},s),[r]);return W(()=>({getRootProps:i}),[i])}var wS={};const Rf=Qe(function(n,t){const{render:r,className:i,...s}=n,{disabled:o,orientation:a,state:c,percentageValues:l}=fs(),{getRootProps:u}=xS({orientation:a,percentageValues:l}),{renderElement:d}=Tt({propGetter:u,render:r??"div",state:c,className:i,ref:t,extraProps:s,customStyleHookMapping:cs});return d()});wS.NODE_ENV!=="production"&&(Rf.propTypes={children:w.node,className:w.oneOfType([w.func,w.string]),render:w.oneOfType([w.element,w.func])});const Ur={root:S({width:"100%","--unselected-color":"var(--divider-color)",margin:"0"}),control:S({position:"relative",cursor:"pointer"}),track:S({background:"var(--unselected-color)",height:"var(--mmpc-slider-height)",borderRadius:"6px",overflow:"hidden"}),indicator:S({background:"var(--primary-color)",height:"100%",borderRadius:"4px"}),thumb:S({width:"6px",height:"64%",backgroundColor:"var(--text-primary-color)","@media (prefers-color-scheme: light)":{backgroundColor:"var(--art-surface-color, rgba(255, 255, 255, 0.8))"},cursor:"pointer",borderRadius:"2px",marginLeft:"-8px"})},Ea=({min:e,max:n,step:t,value:r,sliderSize:i="medium",onChange:s})=>{const[o,a]=F(r),c=le(),l=D(u=>{a(u),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{s(u)},200)},[s]);return ce(()=>{r!==o&&a(r)},[r]),m(Mf,{css:Ur.root,value:o,onValueChange:l,min:e,max:n,step:t,children:m(Of,{css:Ur.control,children:A(If,{css:Ur.track,style:{"--mmpc-slider-height":SS(i)},children:[m(Rf,{css:Ur.indicator}),m(Tf,{css:Ur.thumb})]})})})},SS=e=>{switch(e){case"xsmall":return"16px";case"small":return"22px";case"medium":return"28px";case"large":return"32px"}};class Nf extends HTMLElement{constructor(){super(...arguments),this._config=null,this.Card=null,this.extraProps={},this._hass=null}set hass(n){this._hass=n}setConfig(n){this._config=n,!(!this._hass||!this.Card)&&tn(m(sc,{rootElement:this,children:m(Sm,{children:m(this.Card,{config:this._config,hass:this._hass,rootElement:this,...this.extraProps})})}),this)}}class Oa extends HTMLElement{constructor(){super(...arguments),this.Card=null,this.config=null,this.shouldUpdate=null,this._previousHass=null}set hass(n){var i,s;if(!this.Card)throw new Error("Preact Card is not defined");const t=(i=this.config)==null?void 0:i.entity_id;!!t&&((s=this.shouldUpdate)==null?void 0:s.call(this,this._previousHass,n))?(this._previousHass=n,tn(m(sc,{rootElement:this,children:m(rc,{rootElement:this,config:this.config,children:m(Gm,{hass:n,children:m(Tw,{hass:n,entityId:t,children:m(this.Card,{})})})})}),this)):this._previousHass=n}getCardSize(){return 1}}class $S extends Oa{constructor(){super(...arguments),this.Card=Gg,this.shouldUpdate=(n,t)=>!t||!n||!this.config||!n&&t?!0:rn(n.states[this.config.entity_id],t.states[this.config.entity_id])}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");if(!n.entities)throw new Error("You need to define entities");this.config=n}getCardSize(){return 1}getLayoutOptions(){return{grid_rows:1,grid_columns:6,grid_min_rows:1,grid_max_rows:1}}}customElements.define("mediocre-chip-media-player-group-card",$S);class kS extends Nf{constructor(){super(...arguments),this.Card=Ew,this.extraProps={isMassive:!0,className:void 0}}}customElements.define("mediocre-massive-media-player-card-editor",kS);class CS extends Oa{constructor(){super(...arguments),this.Card=su,this.shouldUpdate=(n,t)=>{var r,i;if(!t||!n||!this.config||!n&&t||rn(n.states[this.config.entity_id],t.states[this.config.entity_id])||(r=this.config.speaker_group)!=null&&r.entity_id&&rn(n.states[this.config.speaker_group.entity_id],t.states[this.config.speaker_group.entity_id]))return!0;if((i=this.config.speaker_group)!=null&&i.entities){for(const s of this.config.speaker_group.entities)if(rn(n.states[s],t.states[s],!0))return!0}return!1}}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");this.config=n}static getConfigElement(){return document.createElement("mediocre-massive-media-player-card-editor")}static getStubConfig(n){return{entity_id:Object.keys(n.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??"",mode:"card"}}}customElements.define("mediocre-massive-media-player-card",CS),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-massive-media-player-card",name:"Mediocre Massive Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"});class MS extends Nf{constructor(){super(...arguments),this.Card=qw}}customElements.define("mediocre-media-player-card-editor",MS);class ES extends Oa{constructor(){super(...arguments),this.Card=jw,this.shouldUpdate=(n,t)=>{var r,i;if(!t||!n||!this.config||!n&&t||rn(n.states[this.config.entity_id],t.states[this.config.entity_id])||(r=this.config.speaker_group)!=null&&r.entity_id&&rn(n.states[this.config.speaker_group.entity_id],t.states[this.config.speaker_group.entity_id]))return!0;if((i=this.config.speaker_group)!=null&&i.entities){for(const s of this.config.speaker_group.entities)if(rn(n.states[s],t.states[s],!0))return!0}return!1}}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");this.config=n}static getConfigElement(){return document.createElement("mediocre-media-player-card-editor")}static getStubConfig(n){return{entity_id:Object.keys(n.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??""}}getCardSize(){return 2}getGridOptions(){return{columns:12,min_columns:8}}}customElements.define("mediocre-media-player-card",ES),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-media-player-card",name:"Mediocre Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"})});
