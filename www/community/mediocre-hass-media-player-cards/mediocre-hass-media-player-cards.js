(function(Je){typeof define=="function"&&define.amd?define(Je):Je()})(function(){"use strict";var R1=Object.defineProperty;var P1=(Je,q,en)=>q in Je?R1(Je,q,{enumerable:!0,configurable:!0,writable:!0,value:en}):Je[q]=en;var y=(Je,q,en)=>P1(Je,typeof q!="symbol"?q+"":q,en);var Hf,Gf,Jf,Yf,Zf,Xf,Qf,ep,tp,np,rp,ip,sp;var Je,q,en,tn,qa,Ua,Ka,ja,Os,Is,As,Wa,ir={},Ha=[],op=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,sr=Array.isArray;function _t(e,n){for(var t in n)e[t]=n[t];return e}function Ns(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Be(e,n,t){var r,i,s,o={};for(s in n)s=="key"?r=n[s]:s=="ref"?i=n[s]:o[s]=n[s];if(arguments.length>2&&(o.children=arguments.length>3?Je.call(arguments,2):t),typeof e=="function"&&e.defaultProps!=null)for(s in e.defaultProps)o[s]===void 0&&(o[s]=e.defaultProps[s]);return or(e,o,r,i,null)}function or(e,n,t,r,i){var s={type:e,props:n,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++en,__i:-1,__u:0};return i==null&&q.vnode!=null&&q.vnode(s),s}function Ga(){return{current:null}}function xe(e){return e.children}function ft(e,n){this.props=e,this.context=n}function wn(e,n){if(n==null)return e.__?wn(e.__,e.__i+1):null;for(var t;n<e.__k.length;n++)if((t=e.__k[n])!=null&&t.__e!=null)return t.__e;return typeof e.type=="function"?wn(e):null}function Ja(e){var n,t;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,n=0;n<e.__k.length;n++)if((t=e.__k[n])!=null&&t.__e!=null){e.__e=e.__c.base=t.__e;break}return Ja(e)}}function Rs(e){(!e.__d&&(e.__d=!0)&&tn.push(e)&&!Zr.__r++||qa!=q.debounceRendering)&&((qa=q.debounceRendering)||Ua)(Zr)}function Zr(){for(var e,n,t,r,i,s,o,a=1;tn.length;)tn.length>a&&tn.sort(Ka),e=tn.shift(),a=tn.length,e.__d&&(t=void 0,i=(r=(n=e).__v).__e,s=[],o=[],n.__P&&((t=_t({},r)).__v=r.__v+1,q.vnode&&q.vnode(t),Ps(n.__P,t,r,n.__n,n.__P.namespaceURI,32&r.__u?[i]:null,s,i??wn(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,el(s,t,o),t.__e!=i&&Ja(t)));Zr.__r=0}function Ya(e,n,t,r,i,s,o,a,c,l,u){var d,h,f,p,g,b,_,v=r&&r.__k||Ha,S=n.length;for(c=ap(t,n,v,c,S),d=0;d<S;d++)(f=t.__k[d])!=null&&(h=f.__i==-1?ir:v[f.__i]||ir,f.__i=d,b=Ps(e,f,h,i,s,o,a,c,l,u),p=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&Ts(h.ref,null,f),u.push(f.ref,f.__c||p,f)),g==null&&p!=null&&(g=p),(_=!!(4&f.__u))||h.__k===f.__k?c=Za(f,c,e,_):typeof f.type=="function"&&b!==void 0?c=b:p&&(c=p.nextSibling),f.__u&=-7);return t.__e=g,c}function ap(e,n,t,r,i){var s,o,a,c,l,u=t.length,d=u,h=0;for(e.__k=new Array(i),s=0;s<i;s++)(o=n[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=s+h,(o=e.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?or(null,o,null,null,null):sr(o)?or(xe,{children:o},null,null,null):o.constructor==null&&o.__b>0?or(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=e,o.__b=e.__b+1,a=null,(l=o.__i=lp(o,t,c,d))!=-1&&(d--,(a=t[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(i>u?h--:i<u&&h++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,o.__u|=4))):e.__k[s]=null;if(d)for(s=0;s<u;s++)(a=t[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=wn(a)),nl(a,a));return r}function Za(e,n,t,r){var i,s;if(typeof e.type=="function"){for(i=e.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=e,n=Za(i[s],n,t,r));return n}e.__e!=n&&(r&&(n&&e.type&&!n.parentNode&&(n=wn(e)),t.insertBefore(e.__e,n||null)),n=e.__e);do n=n&&n.nextSibling;while(n!=null&&n.nodeType==8);return n}function Nt(e,n){return n=n||[],e==null||typeof e=="boolean"||(sr(e)?e.some(function(t){Nt(t,n)}):n.push(e)),n}function lp(e,n,t,r){var i,s,o,a=e.key,c=e.type,l=n[t],u=l!=null&&(2&l.__u)==0;if(l===null&&e.key==null||u&&a==l.key&&c==l.type)return t;if(r>(u?1:0)){for(i=t-1,s=t+1;i>=0||s<n.length;)if((l=n[o=i>=0?i--:s++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function Xa(e,n,t){n[0]=="-"?e.setProperty(n,t??""):e[n]=t==null?"":typeof t!="number"||op.test(n)?t:t+"px"}function Xr(e,n,t,r,i){var s,o;e:if(n=="style")if(typeof t=="string")e.style.cssText=t;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(n in r)t&&n in t||Xa(e.style,n,"");if(t)for(n in t)r&&t[n]==r[n]||Xa(e.style,n,t[n])}else if(n[0]=="o"&&n[1]=="n")s=n!=(n=n.replace(ja,"$1")),o=n.toLowerCase(),n=o in e||n=="onFocusOut"||n=="onFocusIn"?o.slice(2):n.slice(2),e.l||(e.l={}),e.l[n+s]=t,t?r?t.u=r.u:(t.u=Os,e.addEventListener(n,s?As:Is,s)):e.removeEventListener(n,s?As:Is,s);else{if(i=="http://www.w3.org/2000/svg")n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(n!="width"&&n!="height"&&n!="href"&&n!="list"&&n!="form"&&n!="tabIndex"&&n!="download"&&n!="rowSpan"&&n!="colSpan"&&n!="role"&&n!="popover"&&n in e)try{e[n]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&n[4]!="-"?e.removeAttribute(n):e.setAttribute(n,n=="popover"&&t==1?"":t))}}function Qa(e){return function(n){if(this.l){var t=this.l[n.type+e];if(n.t==null)n.t=Os++;else if(n.t<t.u)return;return t(q.event?q.event(n):n)}}}function Ps(e,n,t,r,i,s,o,a,c,l){var u,d,h,f,p,g,b,_,v,S,k,x,$,M,E,C,N,R=n.type;if(n.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=n.__e=t.__e]),(u=q.__b)&&u(n);e:if(typeof R=="function")try{if(_=n.props,v="prototype"in R&&R.prototype.render,S=(u=R.contextType)&&r[u.__c],k=u?S?S.props.value:u.__:r,t.__c?b=(d=n.__c=t.__c).__=d.__E:(v?n.__c=d=new R(_,k):(n.__c=d=new ft(_,k),d.constructor=R,d.render=up),S&&S.sub(d),d.props=_,d.state||(d.state={}),d.context=k,d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),v&&d.__s==null&&(d.__s=d.state),v&&R.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=_t({},d.__s)),_t(d.__s,R.getDerivedStateFromProps(_,d.__s))),f=d.props,p=d.state,d.__v=n,h)v&&R.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),v&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(v&&R.getDerivedStateFromProps==null&&_!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(_,k),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(_,d.__s,k)===!1||n.__v==t.__v){for(n.__v!=t.__v&&(d.props=_,d.state=d.__s,d.__d=!1),n.__e=t.__e,n.__k=t.__k,n.__k.some(function(F){F&&(F.__=n)}),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(_,d.__s,k),v&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,p,g)})}if(d.context=k,d.props=_,d.__P=e,d.__e=!1,$=q.__r,M=0,v){for(d.state=d.__s,d.__d=!1,$&&$(n),u=d.render(d.props,d.state,d.context),E=0;E<d._sb.length;E++)d.__h.push(d._sb[E]);d._sb=[]}else do d.__d=!1,$&&$(n),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++M<25);d.state=d.__s,d.getChildContext!=null&&(r=_t(_t({},r),d.getChildContext())),v&&!h&&d.getSnapshotBeforeUpdate!=null&&(g=d.getSnapshotBeforeUpdate(f,p)),C=u,u!=null&&u.type===xe&&u.key==null&&(C=tl(u.props.children)),a=Ya(e,sr(C)?C:[C],n,t,r,i,s,o,a,c,l),d.base=n.__e,n.__u&=-161,d.__h.length&&o.push(d),b&&(d.__E=d.__=null)}catch(F){if(n.__v=null,c||s!=null)if(F.then){for(n.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,n.__e=a}else{for(N=s.length;N--;)Ns(s[N]);Ds(n)}else n.__e=t.__e,n.__k=t.__k,F.then||Ds(n);q.__e(F,n,t)}else s==null&&n.__v==t.__v?(n.__k=t.__k,n.__e=t.__e):a=n.__e=cp(t.__e,n,t,r,i,s,o,c,l);return(u=q.diffed)&&u(n),128&n.__u?void 0:a}function Ds(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Ds)}function el(e,n,t){for(var r=0;r<t.length;r++)Ts(t[r],t[++r],t[++r]);q.__c&&q.__c(n,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(s){s.call(i)})}catch(s){q.__e(s,i.__v)}})}function tl(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:sr(e)?e.map(tl):_t({},e)}function cp(e,n,t,r,i,s,o,a,c){var l,u,d,h,f,p,g,b=t.props,_=n.props,v=n.type;if(v=="svg"?i="http://www.w3.org/2000/svg":v=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((f=s[l])&&"setAttribute"in f==!!v&&(v?f.localName==v:f.nodeType==3)){e=f,s[l]=null;break}}if(e==null){if(v==null)return document.createTextNode(_);e=document.createElementNS(i,v,_.is&&_),a&&(q.__m&&q.__m(n,s),a=!1),s=null}if(v==null)b===_||a&&e.data==_||(e.data=_);else{if(s=s&&Je.call(e.childNodes),b=t.props||ir,!a&&s!=null)for(b={},l=0;l<e.attributes.length;l++)b[(f=e.attributes[l]).name]=f.value;for(l in b)if(f=b[l],l!="children"){if(l=="dangerouslySetInnerHTML")d=f;else if(!(l in _)){if(l=="value"&&"defaultValue"in _||l=="checked"&&"defaultChecked"in _)continue;Xr(e,l,null,f,i)}}for(l in _)f=_[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?u=f:l=="value"?p=f:l=="checked"?g=f:a&&typeof f!="function"||b[l]===f||Xr(e,l,f,b[l],i);if(u)a||d&&(u.__html==d.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),n.__k=[];else if(d&&(e.innerHTML=""),Ya(n.type=="template"?e.content:e,sr(h)?h:[h],n,t,r,v=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&wn(t,0),a,c),s!=null)for(l=s.length;l--;)Ns(s[l]);a||(l="value",v=="progress"&&p==null?e.removeAttribute("value"):p!=null&&(p!==e[l]||v=="progress"&&!p||v=="option"&&p!=b[l])&&Xr(e,l,p,b[l],i),l="checked",g!=null&&g!=e[l]&&Xr(e,l,g,b[l],i))}return e}function Ts(e,n,t){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&n==null||(e.__u=e(n))}else e.current=n}catch(i){q.__e(i,t)}}function nl(e,n,t){var r,i;if(q.unmount&&q.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Ts(r,null,n)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){q.__e(s,n)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&nl(r[i],n,t||typeof e.type!="function");t||Ns(e.__e),e.__c=e.__=e.__e=void 0}function up(e,n,t){return this.constructor(e,t)}function nn(e,n,t){var r,i,s,o;n==document&&(n=document.documentElement),q.__&&q.__(e,n),i=(r=typeof t=="function")?null:t&&t.__k||n.__k,s=[],o=[],Ps(n,e=(!r&&t||n).__k=Be(xe,null,[e]),i||ir,ir,n.namespaceURI,!r&&t?[t]:i?null:n.firstChild?Je.call(n.childNodes):null,s,!r&&t?t:i?i.__e:n.firstChild,r,o),el(s,e,o)}function rl(e,n){nn(e,n,rl)}function dp(e,n,t){var r,i,s,o,a=_t({},e.props);for(s in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),n)s=="key"?r=n[s]:s=="ref"?i=n[s]:a[s]=n[s]===void 0&&o!=null?o[s]:n[s];return arguments.length>2&&(a.children=arguments.length>3?Je.call(arguments,2):t),or(e.type,a,r||e.key,i||e.ref,null)}function st(e){function n(t){var r,i;return this.getChildContext||(r=new Set,(i={})[n.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&r.forEach(function(o){o.__e=!0,Rs(o)})},this.sub=function(s){r.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){r&&r.delete(s),o&&o.call(s)}}),t.children}return n.__c="__cC"+Wa++,n.__=e,n.Provider=n.__l=(n.Consumer=function(t,r){return t.children(r)}).contextType=n,n}Je=Ha.slice,q={__e:function(e,n,t,r){for(var i,s,o;n=n.__;)if((i=n.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(e)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,r||{}),o=i.__d),o)return i.__E=i}catch(a){e=a}throw e}},en=0,ft.prototype.setState=function(e,n){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=_t({},this.state),typeof e=="function"&&(e=e(_t({},t),this.props)),e&&_t(t,e),e!=null&&this.__v&&(n&&this._sb.push(n),Rs(this))},ft.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Rs(this))},ft.prototype.render=xe,tn=[],Ua=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ka=function(e,n){return e.__v.__b-n.__v.__b},Zr.__r=0,ja=/(PointerCapture)$|Capture$/i,Os=0,Is=Qa(!1),As=Qa(!0),Wa=0;var Rt,ue,Fs,il,Sn=0,sl=[],_e=q,ol=_e.__b,al=_e.__r,ll=_e.diffed,cl=_e.__c,ul=_e.unmount,dl=_e.__;function rn(e,n){_e.__h&&_e.__h(ue,e,Sn||n),Sn=0;var t=ue.__H||(ue.__H={__:[],__h:[]});return e>=t.__.length&&t.__.push({}),t.__[e]}function P(e){return Sn=1,ar(fl,e)}function ar(e,n,t){var r=rn(Rt++,2);if(r.t=e,!r.__c&&(r.__=[t?t(n):fl(void 0,n),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=ue,!ue.__f)){var i=function(a,c,l){if(!r.__c.__H)return!0;var u=r.__c.__H.__.filter(function(h){return!!h.__c});if(u.every(function(h){return!h.__N}))return!s||s.call(this,a,c,l);var d=r.__c.props!==a;return u.forEach(function(h){if(h.__N){var f=h.__[0];h.__=h.__N,h.__N=void 0,f!==h.__[0]&&(d=!0)}}),s&&s.call(this,a,c,l)||d};ue.__f=!0;var s=ue.shouldComponentUpdate,o=ue.componentWillUpdate;ue.componentWillUpdate=function(a,c,l){if(this.__e){var u=s;s=void 0,i(a,c,l),s=u}o&&o.call(this,a,c,l)},ue.shouldComponentUpdate=i}return r.__N||r.__}function Q(e,n){var t=rn(Rt++,3);!_e.__s&&qs(t.__H,n)&&(t.__=e,t.u=n,ue.__H.__h.push(t))}function xt(e,n){var t=rn(Rt++,4);!_e.__s&&qs(t.__H,n)&&(t.__=e,t.u=n,ue.__h.push(t))}function Z(e){return Sn=5,W(function(){return{current:e}},[])}function Vs(e,n,t){Sn=6,xt(function(){if(typeof e=="function"){var r=e(n());return function(){e(null),r&&typeof r=="function"&&r()}}if(e)return e.current=n(),function(){return e.current=null}},t==null?t:t.concat(e))}function W(e,n){var t=rn(Rt++,7);return qs(t.__H,n)&&(t.__=e(),t.__H=n,t.__h=e),t.__}function D(e,n){return Sn=8,W(function(){return e},n)}function le(e){var n=ue.context[e.__c],t=rn(Rt++,9);return t.c=e,n?(t.__==null&&(t.__=!0,n.sub(ue)),n.props.value):e.__}function Ls(e,n){_e.useDebugValue&&_e.useDebugValue(n?n(e):e)}function hp(e){var n=rn(Rt++,10),t=P();return n.__=e,ue.componentDidCatch||(ue.componentDidCatch=function(r,i){n.__&&n.__(r,i),t[1](r)}),[t[0],function(){t[1](void 0)}]}function zs(){var e=rn(Rt++,11);if(!e.__){for(var n=ue.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;var t=n.__m||(n.__m=[0,0]);e.__="P"+t[0]+"-"+t[1]++}return e.__}function fp(){for(var e;e=sl.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Qr),e.__H.__h.forEach(Bs),e.__H.__h=[]}catch(n){e.__H.__h=[],_e.__e(n,e.__v)}}_e.__b=function(e){ue=null,ol&&ol(e)},_e.__=function(e,n){e&&n.__k&&n.__k.__m&&(e.__m=n.__k.__m),dl&&dl(e,n)},_e.__r=function(e){al&&al(e),Rt=0;var n=(ue=e.__c).__H;n&&(Fs===ue?(n.__h=[],ue.__h=[],n.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(n.__h.forEach(Qr),n.__h.forEach(Bs),n.__h=[],Rt=0)),Fs=ue},_e.diffed=function(e){ll&&ll(e);var n=e.__c;n&&n.__H&&(n.__H.__h.length&&(sl.push(n)!==1&&il===_e.requestAnimationFrame||((il=_e.requestAnimationFrame)||pp)(fp)),n.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),Fs=ue=null},_e.__c=function(e,n){n.some(function(t){try{t.__h.forEach(Qr),t.__h=t.__h.filter(function(r){return!r.__||Bs(r)})}catch(r){n.some(function(i){i.__h&&(i.__h=[])}),n=[],_e.__e(r,t.__v)}}),cl&&cl(e,n)},_e.unmount=function(e){ul&&ul(e);var n,t=e.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{Qr(r)}catch(i){n=i}}),t.__H=void 0,n&&_e.__e(n,t.__v))};var hl=typeof requestAnimationFrame=="function";function pp(e){var n,t=function(){clearTimeout(r),hl&&cancelAnimationFrame(n),setTimeout(e)},r=setTimeout(t,35);hl&&(n=requestAnimationFrame(t))}function Qr(e){var n=ue,t=e.__c;typeof t=="function"&&(e.__c=void 0,t()),ue=n}function Bs(e){var n=ue;e.__c=e.__(),ue=n}function qs(e,n){return!e||e.length!==n.length||n.some(function(t,r){return t!==e[r]})}function fl(e,n){return typeof n=="function"?n(e):n}function pl(e,n){for(var t in n)e[t]=n[t];return e}function Us(e,n){for(var t in e)if(t!=="__source"&&!(t in n))return!0;for(var r in n)if(r!=="__source"&&e[r]!==n[r])return!0;return!1}function Ks(e,n){var t=n(),r=P({t:{__:t,u:n}}),i=r[0].t,s=r[1];return xt(function(){i.__=t,i.u=n,js(i)&&s({t:i})},[e,t,n]),Q(function(){return js(i)&&s({t:i}),e(function(){js(i)&&s({t:i})})},[e]),t}function js(e){var n,t,r=e.u,i=e.__;try{var s=r();return!((n=i)===(t=s)&&(n!==0||1/n==1/t)||n!=n&&t!=t)}catch{return!0}}function Ws(e){e()}function Hs(e){return e}function Gs(){return[!1,Ws]}var Js=xt;function ei(e,n){this.props=e,this.context=n}function ml(e,n){function t(i){var s=this.props.ref,o=s==i.ref;return!o&&s&&(s.call?s(null):s.current=null),n?!n(this.props,i)||!o:Us(this.props,i)}function r(i){return this.shouldComponentUpdate=t,Be(e,i)}return r.displayName="Memo("+(e.displayName||e.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r.type=e,r}(ei.prototype=new ft).isPureReactComponent=!0,ei.prototype.shouldComponentUpdate=function(e,n){return Us(this.props,e)||Us(this.state,n)};var gl=q.__b;q.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),gl&&gl(e)};var mp=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function pt(e){function n(t){var r=pl({},t);return delete r.ref,e(r,t.ref||null)}return n.$$typeof=mp,n.render=e,n.prototype.isReactComponent=n.__f=!0,n.displayName="ForwardRef("+(e.displayName||e.name)+")",n}var yl=function(e,n){return e==null?null:Nt(Nt(e).map(n))},bl={map:yl,forEach:yl,count:function(e){return e?Nt(e).length:0},only:function(e){var n=Nt(e);if(n.length!==1)throw"Children.only";return n[0]},toArray:Nt},gp=q.__e;q.__e=function(e,n,t,r){if(e.then){for(var i,s=n;s=s.__;)if((i=s.__c)&&i.__c)return n.__e==null&&(n.__e=t.__e,n.__k=t.__k),i.__c(e,n)}gp(e,n,t,r)};var vl=q.unmount;function _l(e,n,t){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),e.__c.__H=null),(e=pl({},e)).__c!=null&&(e.__c.__P===t&&(e.__c.__P=n),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(r){return _l(r,n,t)})),e}function xl(e,n,t){return e&&t&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(r){return xl(r,n,t)}),e.__c&&e.__c.__P===n&&(e.__e&&t.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=t)),e}function lr(){this.__u=0,this.o=null,this.__b=null}function wl(e){var n=e.__.__c;return n&&n.__a&&n.__a(e)}function Sl(e){var n,t,r;function i(s){if(n||(n=e()).then(function(o){t=o.default||o},function(o){r=o}),r)throw r;if(!t)throw n;return Be(t,s)}return i.displayName="Lazy",i.__f=!0,i}function kn(){this.i=null,this.l=null}q.unmount=function(e){var n=e.__c;n&&n.__R&&n.__R(),n&&32&e.__u&&(e.type=null),vl&&vl(e)},(lr.prototype=new ft).__c=function(e,n){var t=n.__c,r=this;r.o==null&&(r.o=[]),r.o.push(t);var i=wl(r.__v),s=!1,o=function(){s||(s=!0,t.__R=null,i?i(a):a())};t.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=xl(c,c.__c.__P,c.__c.__O)}var l;for(r.setState({__a:r.__b=null});l=r.o.pop();)l.forceUpdate()}};r.__u++||32&n.__u||r.setState({__a:r.__b=r.__v.__k[0]}),e.then(o,o)},lr.prototype.componentWillUnmount=function(){this.o=[]},lr.prototype.render=function(e,n){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=_l(this.__b,t,r.__O=r.__P)}this.__b=null}var i=n.__a&&Be(xe,null,e.fallback);return i&&(i.__u&=-33),[Be(xe,null,n.__a?null:e.children),i]};var kl=function(e,n,t){if(++t[1]===t[0]&&e.l.delete(n),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(t=e.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;e.i=t=t[2]}};function yp(e){return this.getChildContext=function(){return e.context},e.children}function bp(e){var n=this,t=e.h;if(n.componentWillUnmount=function(){nn(null,n.v),n.v=null,n.h=null},n.h&&n.h!==t&&n.componentWillUnmount(),!n.v){for(var r=n.__v;r!==null&&!r.__m&&r.__!==null;)r=r.__;n.h=t,n.v={nodeType:1,parentNode:t,childNodes:[],__k:{__m:r.__m},contains:function(){return!0},insertBefore:function(i,s){this.childNodes.push(i),n.h.insertBefore(i,s)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),n.h.removeChild(i)}}}nn(Be(yp,{context:n.context},e.__v),n.v)}function $l(e,n){var t=Be(bp,{__v:e,h:n});return t.containerInfo=n,t}(kn.prototype=new ft).__a=function(e){var n=this,t=wl(n.__v),r=n.l.get(e);return r[0]++,function(i){var s=function(){n.props.revealOrder?(r.push(i),kl(n,e,r)):i()};t?t(s):s()}},kn.prototype.render=function(e){this.i=null,this.l=new Map;var n=Nt(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&n.reverse();for(var t=n.length;t--;)this.l.set(n[t],this.i=[1,0,this.i]);return e.children},kn.prototype.componentDidUpdate=kn.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(n,t){kl(e,t,n)})};var Cl=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,vp=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,_p=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,xp=/[A-Z0-9]/g,wp=typeof document<"u",Sp=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};function Ml(e,n,t){return n.__k==null&&(n.textContent=""),nn(e,n),typeof t=="function"&&t(),e?e.__c:null}function El(e,n,t){return rl(e,n),typeof t=="function"&&t(),e?e.__c:null}ft.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(ft.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(n){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:n})}})});var Ol=q.event;function kp(){}function $p(){return this.cancelBubble}function Cp(){return this.defaultPrevented}q.event=function(e){return Ol&&(e=Ol(e)),e.persist=kp,e.isPropagationStopped=$p,e.isDefaultPrevented=Cp,e.nativeEvent=e};var Ys,Mp={enumerable:!1,configurable:!0,get:function(){return this.class}},Il=q.vnode;q.vnode=function(e){typeof e.type=="string"&&function(n){var t=n.props,r=n.type,i={},s=r.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||wp&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||r!=="input"&&r!=="textarea"||Sp(t.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":_p.test(o)&&(o=c):c=o="oninput":s&&vp.test(o)?o=o.replace(xp,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&i[o=c]&&(o="oninputCapture"),i[o]=a}}r=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Nt(t.children).forEach(function(l){l.props.selected=i.value.indexOf(l.props.value)!=-1})),r=="select"&&i.defaultValue!=null&&(i.value=Nt(t.children).forEach(function(l){l.props.selected=i.multiple?i.defaultValue.indexOf(l.props.value)!=-1:i.defaultValue==l.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",Mp)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),n.props=i}(e),e.$$typeof=Cl,Il&&Il(e)};var Al=q.__r;q.__r=function(e){Al&&Al(e),Ys=e.__c};var Nl=q.diffed;q.diffed=function(e){Nl&&Nl(e);var n=e.props,t=e.__e;t!=null&&e.type==="textarea"&&"value"in n&&n.value!==t.value&&(t.value=n.value==null?"":n.value),Ys=null};var Rl={ReactCurrentDispatcher:{current:{readContext:function(e){return Ys.__n[e.__c].props.value},useCallback:D,useContext:le,useDebugValue:Ls,useDeferredValue:Hs,useEffect:Q,useId:zs,useImperativeHandle:Vs,useInsertionEffect:Js,useLayoutEffect:xt,useMemo:W,useReducer:ar,useRef:Z,useState:P,useSyncExternalStore:Ks,useTransition:Gs}}},Pl="18.3.1";function Dl(e){return Be.bind(null,e)}function cr(e){return!!e&&e.$$typeof===Cl}function Tl(e){return cr(e)&&e.type===xe}function Fl(e){return!!e&&!!e.displayName&&(typeof e.displayName=="string"||e.displayName instanceof String)&&e.displayName.startsWith("Memo(")}function ti(e){return cr(e)?dp.apply(null,arguments):e}function Vl(e){return!!e.__k&&(nn(null,e),!0)}function Ll(e){return e&&(e.base||e.nodeType===1&&e)||null}var zl=function(e,n){return e(n)},ni=function(e,n){return e(n)},Bl=xe,ql=cr,Ep={useState:P,useId:zs,useReducer:ar,useEffect:Q,useLayoutEffect:xt,useInsertionEffect:Js,useTransition:Gs,useDeferredValue:Hs,useSyncExternalStore:Ks,startTransition:Ws,useRef:Z,useImperativeHandle:Vs,useMemo:W,useCallback:D,useContext:le,useDebugValue:Ls,version:"18.3.1",Children:bl,render:Ml,hydrate:El,unmountComponentAtNode:Vl,createPortal:$l,createElement:Be,createContext:st,createFactory:Dl,cloneElement:ti,createRef:Ga,Fragment:xe,isValidElement:cr,isElement:ql,isFragment:Tl,isMemo:Fl,findDOMNode:Ll,Component:ft,PureComponent:ei,memo:ml,forwardRef:pt,flushSync:ni,unstable_batchedUpdates:zl,StrictMode:Bl,Suspense:lr,SuspenseList:kn,lazy:Sl,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Rl};const ur=Object.freeze(Object.defineProperty({__proto__:null,Children:bl,Component:ft,Fragment:xe,PureComponent:ei,StrictMode:Bl,Suspense:lr,SuspenseList:kn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Rl,cloneElement:ti,createContext:st,createElement:Be,createFactory:Dl,createPortal:$l,createRef:Ga,default:Ep,findDOMNode:Ll,flushSync:ni,forwardRef:pt,hydrate:El,isElement:ql,isFragment:Tl,isMemo:Fl,isValidElement:cr,lazy:Sl,memo:ml,render:Ml,startTransition:Ws,unmountComponentAtNode:Vl,unstable_batchedUpdates:zl,useCallback:D,useContext:le,useDebugValue:Ls,useDeferredValue:Hs,useEffect:Q,useErrorBoundary:hp,useId:zs,useImperativeHandle:Vs,useInsertionEffect:Js,useLayoutEffect:xt,useMemo:W,useReducer:ar,useRef:Z,useState:P,useSyncExternalStore:Ks,useTransition:Gs,version:Pl},Symbol.toStringTag,{value:"Module"}));var Op=0;function Ie(e,n,t,r,i,s){n||(n={});var o,a,c=n;if("ref"in c)for(a in c={},n)a=="ref"?o=n[a]:c[a]=n[a];var l={type:e,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Op,__i:-1,__u:0,__source:i,__self:s};if(typeof e=="function"&&(o=e.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return q.vnode&&q.vnode(l),l}function Ip(e){if(e.sheet)return e.sheet;for(var n=0;n<document.styleSheets.length;n++)if(document.styleSheets[n].ownerNode===e)return document.styleSheets[n]}function Ap(e){var n=document.createElement("style");return n.setAttribute("data-emotion",e.key),e.nonce!==void 0&&n.setAttribute("nonce",e.nonce),n.appendChild(document.createTextNode("")),n.setAttribute("data-s",""),n}var Np=function(){function e(t){var r=this;this._insertTag=function(i){var s;r.tags.length===0?r.insertionPoint?s=r.insertionPoint.nextSibling:r.prepend?s=r.container.firstChild:s=r.before:s=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,s),r.tags.push(i)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var n=e.prototype;return n.hydrate=function(r){r.forEach(this._insertTag)},n.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Ap(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var s=Ip(i);try{s.insertRule(r,s.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},n.flush=function(){this.tags.forEach(function(r){var i;return(i=r.parentNode)==null?void 0:i.removeChild(r)}),this.tags=[],this.ctr=0},e}(),qe="-ms-",ri="-moz-",ee="-webkit-",Ul="comm",Zs="rule",Xs="decl",Rp="@import",Kl="@keyframes",Pp="@layer",Dp=Math.abs,ii=String.fromCharCode,Tp=Object.assign;function Fp(e,n){return Fe(e,0)^45?(((n<<2^Fe(e,0))<<2^Fe(e,1))<<2^Fe(e,2))<<2^Fe(e,3):0}function jl(e){return e.trim()}function Vp(e,n){return(e=n.exec(e))?e[0]:e}function te(e,n,t){return e.replace(n,t)}function Qs(e,n){return e.indexOf(n)}function Fe(e,n){return e.charCodeAt(n)|0}function dr(e,n,t){return e.slice(n,t)}function wt(e){return e.length}function eo(e){return e.length}function si(e,n){return n.push(e),e}function Lp(e,n){return e.map(n).join("")}var oi=1,$n=1,Wl=0,Ye=0,Me=0,Cn="";function ai(e,n,t,r,i,s,o){return{value:e,root:n,parent:t,type:r,props:i,children:s,line:oi,column:$n,length:o,return:""}}function hr(e,n){return Tp(ai("",null,null,"",null,null,0),e,{length:-e.length},n)}function zp(){return Me}function Bp(){return Me=Ye>0?Fe(Cn,--Ye):0,$n--,Me===10&&($n=1,oi--),Me}function tt(){return Me=Ye<Wl?Fe(Cn,Ye++):0,$n++,Me===10&&($n=1,oi++),Me}function St(){return Fe(Cn,Ye)}function li(){return Ye}function fr(e,n){return dr(Cn,e,n)}function pr(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Hl(e){return oi=$n=1,Wl=wt(Cn=e),Ye=0,[]}function Gl(e){return Cn="",e}function ci(e){return jl(fr(Ye-1,to(e===91?e+2:e===40?e+1:e)))}function qp(e){for(;(Me=St())&&Me<33;)tt();return pr(e)>2||pr(Me)>3?"":" "}function Up(e,n){for(;--n&&tt()&&!(Me<48||Me>102||Me>57&&Me<65||Me>70&&Me<97););return fr(e,li()+(n<6&&St()==32&&tt()==32))}function to(e){for(;tt();)switch(Me){case e:return Ye;case 34:case 39:e!==34&&e!==39&&to(Me);break;case 40:e===41&&to(e);break;case 92:tt();break}return Ye}function Kp(e,n){for(;tt()&&e+Me!==57;)if(e+Me===84&&St()===47)break;return"/*"+fr(n,Ye-1)+"*"+ii(e===47?e:tt())}function jp(e){for(;!pr(St());)tt();return fr(e,Ye)}function Wp(e){return Gl(ui("",null,null,null,[""],e=Hl(e),0,[0],e))}function ui(e,n,t,r,i,s,o,a,c){for(var l=0,u=0,d=o,h=0,f=0,p=0,g=1,b=1,_=1,v=0,S="",k=i,x=s,$=r,M=S;b;)switch(p=v,v=tt()){case 40:if(p!=108&&Fe(M,d-1)==58){Qs(M+=te(ci(v),"&","&\f"),"&\f")!=-1&&(_=-1);break}case 34:case 39:case 91:M+=ci(v);break;case 9:case 10:case 13:case 32:M+=qp(p);break;case 92:M+=Up(li()-1,7);continue;case 47:switch(St()){case 42:case 47:si(Hp(Kp(tt(),li()),n,t),c);break;default:M+="/"}break;case 123*g:a[l++]=wt(M)*_;case 125*g:case 59:case 0:switch(v){case 0:case 125:b=0;case 59+u:_==-1&&(M=te(M,/\f/g,"")),f>0&&wt(M)-d&&si(f>32?Yl(M+";",r,t,d-1):Yl(te(M," ","")+";",r,t,d-2),c);break;case 59:M+=";";default:if(si($=Jl(M,n,t,l,u,i,a,S,k=[],x=[],d),s),v===123)if(u===0)ui(M,n,$,$,k,s,d,a,x);else switch(h===99&&Fe(M,3)===110?100:h){case 100:case 108:case 109:case 115:ui(e,$,$,r&&si(Jl(e,$,$,0,0,i,a,S,i,k=[],d),x),i,x,d,a,r?k:x);break;default:ui(M,$,$,$,[""],x,0,a,x)}}l=u=f=0,g=_=1,S=M="",d=o;break;case 58:d=1+wt(M),f=p;default:if(g<1){if(v==123)--g;else if(v==125&&g++==0&&Bp()==125)continue}switch(M+=ii(v),v*g){case 38:_=u>0?1:(M+="\f",-1);break;case 44:a[l++]=(wt(M)-1)*_,_=1;break;case 64:St()===45&&(M+=ci(tt())),h=St(),u=d=wt(S=M+=jp(li())),v++;break;case 45:p===45&&wt(M)==2&&(g=0)}}return s}function Jl(e,n,t,r,i,s,o,a,c,l,u){for(var d=i-1,h=i===0?s:[""],f=eo(h),p=0,g=0,b=0;p<r;++p)for(var _=0,v=dr(e,d+1,d=Dp(g=o[p])),S=e;_<f;++_)(S=jl(g>0?h[_]+" "+v:te(v,/&\f/g,h[_])))&&(c[b++]=S);return ai(e,n,t,i===0?Zs:a,c,l,u)}function Hp(e,n,t){return ai(e,n,t,Ul,ii(zp()),dr(e,2,-2),0)}function Yl(e,n,t,r){return ai(e,n,t,Xs,dr(e,0,r),dr(e,r+1,-1),r)}function Mn(e,n){for(var t="",r=eo(e),i=0;i<r;i++)t+=n(e[i],i,e,n)||"";return t}function Gp(e,n,t,r){switch(e.type){case Pp:if(e.children.length)break;case Rp:case Xs:return e.return=e.return||e.value;case Ul:return"";case Kl:return e.return=e.value+"{"+Mn(e.children,r)+"}";case Zs:e.value=e.props.join(",")}return wt(t=Mn(e.children,r))?e.return=e.value+"{"+t+"}":""}function Jp(e){var n=eo(e);return function(t,r,i,s){for(var o="",a=0;a<n;a++)o+=e[a](t,r,i,s)||"";return o}}function Yp(e){return function(n){n.root||(n=n.return)&&e(n)}}function Zp(e){var n=Object.create(null);return function(t){return n[t]===void 0&&(n[t]=e(t)),n[t]}}var Xp=function(n,t,r){for(var i=0,s=0;i=s,s=St(),i===38&&s===12&&(t[r]=1),!pr(s);)tt();return fr(n,Ye)},Qp=function(n,t){var r=-1,i=44;do switch(pr(i)){case 0:i===38&&St()===12&&(t[r]=1),n[r]+=Xp(Ye-1,t,r);break;case 2:n[r]+=ci(i);break;case 4:if(i===44){n[++r]=St()===58?"&\f":"",t[r]=n[r].length;break}default:n[r]+=ii(i)}while(i=tt());return n},em=function(n,t){return Gl(Qp(Hl(n),t))},Zl=new WeakMap,tm=function(n){if(!(n.type!=="rule"||!n.parent||n.length<1)){for(var t=n.value,r=n.parent,i=n.column===r.column&&n.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(n.props.length===1&&t.charCodeAt(0)!==58&&!Zl.get(r))&&!i){Zl.set(n,!0);for(var s=[],o=em(t,s),a=r.props,c=0,l=0;c<o.length;c++)for(var u=0;u<a.length;u++,l++)n.props[l]=s[c]?o[c].replace(/&\f/g,a[u]):a[u]+" "+o[c]}}},nm=function(n){if(n.type==="decl"){var t=n.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(n.return="",n.value="")}};function Xl(e,n){switch(Fp(e,n)){case 5103:return ee+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ee+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return ee+e+ri+e+qe+e+e;case 6828:case 4268:return ee+e+qe+e+e;case 6165:return ee+e+qe+"flex-"+e+e;case 5187:return ee+e+te(e,/(\w+).+(:[^]+)/,ee+"box-$1$2"+qe+"flex-$1$2")+e;case 5443:return ee+e+qe+"flex-item-"+te(e,/flex-|-self/,"")+e;case 4675:return ee+e+qe+"flex-line-pack"+te(e,/align-content|flex-|-self/,"")+e;case 5548:return ee+e+qe+te(e,"shrink","negative")+e;case 5292:return ee+e+qe+te(e,"basis","preferred-size")+e;case 6060:return ee+"box-"+te(e,"-grow","")+ee+e+qe+te(e,"grow","positive")+e;case 4554:return ee+te(e,/([^-])(transform)/g,"$1"+ee+"$2")+e;case 6187:return te(te(te(e,/(zoom-|grab)/,ee+"$1"),/(image-set)/,ee+"$1"),e,"")+e;case 5495:case 3959:return te(e,/(image-set\([^]*)/,ee+"$1$`$1");case 4968:return te(te(e,/(.+:)(flex-)?(.*)/,ee+"box-pack:$3"+qe+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ee+e+e;case 4095:case 3583:case 4068:case 2532:return te(e,/(.+)-inline(.+)/,ee+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(wt(e)-1-n>6)switch(Fe(e,n+1)){case 109:if(Fe(e,n+4)!==45)break;case 102:return te(e,/(.+:)(.+)-([^]+)/,"$1"+ee+"$2-$3$1"+ri+(Fe(e,n+3)==108?"$3":"$2-$3"))+e;case 115:return~Qs(e,"stretch")?Xl(te(e,"stretch","fill-available"),n)+e:e}break;case 4949:if(Fe(e,n+1)!==115)break;case 6444:switch(Fe(e,wt(e)-3-(~Qs(e,"!important")&&10))){case 107:return te(e,":",":"+ee)+e;case 101:return te(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ee+(Fe(e,14)===45?"inline-":"")+"box$3$1"+ee+"$2$3$1"+qe+"$2box$3")+e}break;case 5936:switch(Fe(e,n+11)){case 114:return ee+e+qe+te(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return ee+e+qe+te(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return ee+e+qe+te(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return ee+e+qe+e+e}return e}var rm=function(n,t,r,i){if(n.length>-1&&!n.return)switch(n.type){case Xs:n.return=Xl(n.value,n.length);break;case Kl:return Mn([hr(n,{value:te(n.value,"@","@"+ee)})],i);case Zs:if(n.length)return Lp(n.props,function(s){switch(Vp(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Mn([hr(n,{props:[te(s,/:(read-\w+)/,":"+ri+"$1")]})],i);case"::placeholder":return Mn([hr(n,{props:[te(s,/:(plac\w+)/,":"+ee+"input-$1")]}),hr(n,{props:[te(s,/:(plac\w+)/,":"+ri+"$1")]}),hr(n,{props:[te(s,/:(plac\w+)/,qe+"input-$1")]})],i)}return""})}},im=[rm],Ql=function(n){var t=n.key;if(t==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(g){var b=g.getAttribute("data-emotion");b.indexOf(" ")!==-1&&(document.head.appendChild(g),g.setAttribute("data-s",""))})}var i=n.stylisPlugins||im,s={},o,a=[];o=n.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(g){for(var b=g.getAttribute("data-emotion").split(" "),_=1;_<b.length;_++)s[b[_]]=!0;a.push(g)});var c,l=[tm,nm];{var u,d=[Gp,Yp(function(g){u.insert(g)})],h=Jp(l.concat(i,d)),f=function(b){return Mn(Wp(b),h)};c=function(b,_,v,S){u=v,f(b?b+"{"+_.styles+"}":_.styles),S&&(p.inserted[_.name]=!0)}}var p={key:t,sheet:new Np({key:t,container:o,nonce:n.nonce,speedy:n.speedy,prepend:n.prepend,insertionPoint:n.insertionPoint}),nonce:n.nonce,inserted:s,registered:{},insert:c};return p.sheet.hydrate(a),p};function sm(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var n=e.default;if(typeof n=="function"){var t=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};t.prototype=n.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),t}var di={exports:{}},re={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ec;function om(){if(ec)return re;ec=1;var e=typeof Symbol=="function"&&Symbol.for,n=e?Symbol.for("react.element"):60103,t=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,c=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,p=e?Symbol.for("react.lazy"):60116,g=e?Symbol.for("react.block"):60121,b=e?Symbol.for("react.fundamental"):60117,_=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function S(x){if(typeof x=="object"&&x!==null){var $=x.$$typeof;switch($){case n:switch(x=x.type,x){case c:case l:case r:case s:case i:case d:return x;default:switch(x=x&&x.$$typeof,x){case a:case u:case p:case f:case o:return x;default:return $}}case t:return $}}}function k(x){return S(x)===l}return re.AsyncMode=c,re.ConcurrentMode=l,re.ContextConsumer=a,re.ContextProvider=o,re.Element=n,re.ForwardRef=u,re.Fragment=r,re.Lazy=p,re.Memo=f,re.Portal=t,re.Profiler=s,re.StrictMode=i,re.Suspense=d,re.isAsyncMode=function(x){return k(x)||S(x)===c},re.isConcurrentMode=k,re.isContextConsumer=function(x){return S(x)===a},re.isContextProvider=function(x){return S(x)===o},re.isElement=function(x){return typeof x=="object"&&x!==null&&x.$$typeof===n},re.isForwardRef=function(x){return S(x)===u},re.isFragment=function(x){return S(x)===r},re.isLazy=function(x){return S(x)===p},re.isMemo=function(x){return S(x)===f},re.isPortal=function(x){return S(x)===t},re.isProfiler=function(x){return S(x)===s},re.isStrictMode=function(x){return S(x)===i},re.isSuspense=function(x){return S(x)===d},re.isValidElementType=function(x){return typeof x=="string"||typeof x=="function"||x===r||x===l||x===s||x===i||x===d||x===h||typeof x=="object"&&x!==null&&(x.$$typeof===p||x.$$typeof===f||x.$$typeof===o||x.$$typeof===a||x.$$typeof===u||x.$$typeof===b||x.$$typeof===_||x.$$typeof===v||x.$$typeof===g)},re.typeOf=S,re}var ie={},tc;function am(){if(tc)return ie;tc=1;var e={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,o=n?Symbol.for("react.profiler"):60114,a=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,u=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,p=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,b=n?Symbol.for("react.block"):60121,_=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,S=n?Symbol.for("react.scope"):60119;function k(T){return typeof T=="string"||typeof T=="function"||T===i||T===u||T===o||T===s||T===h||T===f||typeof T=="object"&&T!==null&&(T.$$typeof===g||T.$$typeof===p||T.$$typeof===a||T.$$typeof===c||T.$$typeof===d||T.$$typeof===_||T.$$typeof===v||T.$$typeof===S||T.$$typeof===b)}function x(T){if(typeof T=="object"&&T!==null){var We=T.$$typeof;switch(We){case t:var $e=T.type;switch($e){case l:case u:case i:case o:case s:case h:return $e;default:var rt=$e&&$e.$$typeof;switch(rt){case c:case d:case g:case p:case a:return rt;default:return We}}case r:return We}}}var $=l,M=u,E=c,C=a,N=t,R=d,F=i,z=g,U=p,Y=r,Te=o,pe=s,H=h,K=!1;function me(T){return K||(K=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),Xe(T)||x(T)===l}function Xe(T){return x(T)===u}function Se(T){return x(T)===c}function Qe(T){return x(T)===a}function L(T){return typeof T=="object"&&T!==null&&T.$$typeof===t}function ve(T){return x(T)===d}function se(T){return x(T)===i}function ke(T){return x(T)===g}function oe(T){return x(T)===p}function vt(T){return x(T)===r}function ae(T){return x(T)===o}function Qt(T){return x(T)===s}function je(T){return x(T)===h}ie.AsyncMode=$,ie.ConcurrentMode=M,ie.ContextConsumer=E,ie.ContextProvider=C,ie.Element=N,ie.ForwardRef=R,ie.Fragment=F,ie.Lazy=z,ie.Memo=U,ie.Portal=Y,ie.Profiler=Te,ie.StrictMode=pe,ie.Suspense=H,ie.isAsyncMode=me,ie.isConcurrentMode=Xe,ie.isContextConsumer=Se,ie.isContextProvider=Qe,ie.isElement=L,ie.isForwardRef=ve,ie.isFragment=se,ie.isLazy=ke,ie.isMemo=oe,ie.isPortal=vt,ie.isProfiler=ae,ie.isStrictMode=Qt,ie.isSuspense=je,ie.isValidElementType=k,ie.typeOf=x}(),ie}var nc;function lm(){if(nc)return di.exports;nc=1;var e={};return e.NODE_ENV==="production"?di.exports=om():di.exports=am(),di.exports}var no,rc;function cm(){if(rc)return no;rc=1;var e=lm(),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[e.ForwardRef]=r,s[e.Memo]=i;function o(p){return e.isMemo(p)?i:s[p.$$typeof]||n}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,h=Object.prototype;function f(p,g,b){if(typeof g!="string"){if(h){var _=d(g);_&&_!==h&&f(p,_,b)}var v=c(g);l&&(v=v.concat(l(g)));for(var S=o(p),k=o(g),x=0;x<v.length;++x){var $=v[x];if(!t[$]&&!(b&&b[$])&&!(k&&k[$])&&!(S&&S[$])){var M=u(g,$);try{a(p,$,M)}catch{}}}}return p}return no=f,no}cm();var um=!0;function dm(e,n,t){var r="";return t.split(" ").forEach(function(i){e[i]!==void 0?n.push(e[i]+";"):i&&(r+=i+" ")}),r}var ic=function(n,t,r){var i=n.key+"-"+t.name;(r===!1||um===!1)&&n.registered[i]===void 0&&(n.registered[i]=t.styles)},hm=function(n,t,r){ic(n,t,r);var i=n.key+"-"+t.name;if(n.inserted[t.name]===void 0){var s=t;do n.insert(t===s?"."+i:"",s,n.sheet,!0),s=s.next;while(s!==void 0)}};function fm(e){for(var n=0,t,r=0,i=e.length;i>=4;++r,i-=4)t=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,n=(t&65535)*1540483477+((t>>>16)*59797<<16)^(n&65535)*1540483477+((n>>>16)*59797<<16);switch(i){case 3:n^=(e.charCodeAt(r+2)&255)<<16;case 2:n^=(e.charCodeAt(r+1)&255)<<8;case 1:n^=e.charCodeAt(r)&255,n=(n&65535)*1540483477+((n>>>16)*59797<<16)}return n^=n>>>13,n=(n&65535)*1540483477+((n>>>16)*59797<<16),((n^n>>>15)>>>0).toString(36)}var pm={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},mm=/[A-Z]|^ms/g,gm=/_EMO_([^_]+?)_([^]*?)_EMO_/g,sc=function(n){return n.charCodeAt(1)===45},oc=function(n){return n!=null&&typeof n!="boolean"},ro=Zp(function(e){return sc(e)?e:e.replace(mm,"-$&").toLowerCase()}),ac=function(n,t){switch(n){case"animation":case"animationName":if(typeof t=="string")return t.replace(gm,function(r,i,s){return kt={name:i,styles:s,next:kt},i})}return pm[n]!==1&&!sc(n)&&typeof t=="number"&&t!==0?t+"px":t};function mr(e,n,t){if(t==null)return"";var r=t;if(r.__emotion_styles!==void 0)return r;switch(typeof t){case"boolean":return"";case"object":{var i=t;if(i.anim===1)return kt={name:i.name,styles:i.styles,next:kt},i.name;var s=t;if(s.styles!==void 0){var o=s.next;if(o!==void 0)for(;o!==void 0;)kt={name:o.name,styles:o.styles,next:kt},o=o.next;var a=s.styles+";";return a}return ym(e,n,t)}case"function":{if(e!==void 0){var c=kt,l=t(e);return kt=c,mr(e,n,l)}break}}var u=t;return u}function ym(e,n,t){var r="";if(Array.isArray(t))for(var i=0;i<t.length;i++)r+=mr(e,n,t[i])+";";else for(var s in t){var o=t[s];if(typeof o!="object"){var a=o;oc(a)&&(r+=ro(s)+":"+ac(s,a)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&n==null)for(var c=0;c<o.length;c++)oc(o[c])&&(r+=ro(s)+":"+ac(s,o[c])+";");else{var l=mr(e,n,o);switch(s){case"animation":case"animationName":{r+=ro(s)+":"+l+";";break}default:r+=s+"{"+l+"}"}}}return r}var lc=/label:\s*([^\s;{]+)\s*(;|$)/g,kt;function cc(e,n,t){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var r=!0,i="";kt=void 0;var s=e[0];if(s==null||s.raw===void 0)r=!1,i+=mr(t,n,s);else{var o=s;i+=o[0]}for(var a=1;a<e.length;a++)if(i+=mr(t,n,e[a]),r){var c=s;i+=c[a]}lc.lastIndex=0;for(var l="",u;(u=lc.exec(i))!==null;)l+="-"+u[1];var d=fm(i)+l;return{name:d,styles:i,next:kt}}var bm=function(n){return n()},vm=ur.useInsertionEffect?ur.useInsertionEffect:!1,_m=vm||bm,uc=st(typeof HTMLElement<"u"?Ql({key:"css"}):null),xm=uc.Provider,wm=function(n){return pt(function(t,r){var i=le(uc);return n(t,i,r)})},Sm=st({}),gr={}.hasOwnProperty,io="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",so=function(n,t){var r={};for(var i in t)gr.call(t,i)&&(r[i]=t[i]);return r[io]=n,r},km=function(n){var t=n.cache,r=n.serialized,i=n.isStringTag;return ic(t,r,i),_m(function(){return hm(t,r,i)}),null},$m=wm(function(e,n,t){var r=e.css;typeof r=="string"&&n.registered[r]!==void 0&&(r=n.registered[r]);var i=e[io],s=[r],o="";typeof e.className=="string"?o=dm(n.registered,s,e.className):e.className!=null&&(o=e.className+" ");var a=cc(s,void 0,le(Sm));o+=n.key+"-"+a.name;var c={};for(var l in e)gr.call(e,l)&&l!=="css"&&l!==io&&(c[l]=e[l]);return c.className=o,t&&(c.ref=t),Be(xe,null,Be(km,{cache:n,serialized:a,isStringTag:typeof i=="string"}),Be(i,c))}),oo=$m,yr=xe,m=function(n,t,r){return gr.call(t,"css")?Ie(oo,so(n,t),r):Ie(n,t,r)},O=function(n,t,r){return gr.call(t,"css")?Ie(oo,so(n,t),r):Ie(n,t,r)};const de={colors:{dialog:"var(--mmpc-dialog, var(--ha-dialog-surface-background, var(--mdc-theme-surface,#fff)))",onDialog:"var(--mmpc-on-dialog, var(--primary-text-color, #333))",onDialogMuted:"var(--mmpc-on-dialog-muted, var(--secondary-text-color, #888))",card:"var(--mmpc-card, var(--card-background-color))",onCard:"var(--mmpc-on-card, var(--primary-text-color, #333))",onCardMuted:"var(--mmpc-on-card-muted, var(--secondary-text-color, #666))",onCardDivider:"var(--mmpc-on-card-divider, var(--divider-color, rgba(0, 0, 0, 0.12)))"}};var dc=function(n,t){var r=arguments;if(t==null||!gr.call(t,"css"))return Be.apply(void 0,r);var i=r.length,s=new Array(i);s[0]=oo,s[1]=so(n,t);for(var o=2;o<i;o++)s[o]=r[o];return Be.apply(null,s)};(function(e){var n;n||(n=e.JSX||(e.JSX={}))})(dc||(dc={}));function w(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return cc(n)}function En(){var e=w.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const Cm=({hass:e,action:n,target:t,data:r})=>{const i=n.split(".")[0],s=n.split(".")[1],o={...r,...t};return e.callService(i,s,o)},ao=async(e,n,t,r)=>{const i=n[t+"_action"];if((i==null?void 0:i.action)==="perform-action")return Cm({hass:r,action:i.perform_action,target:i.target,data:i.data});const s=new CustomEvent("hass-action",{bubbles:!0,composed:!0,detail:{config:{...n,entity_id:n==null?void 0:n.entity},action:t}});return e.dispatchEvent(s),Promise.resolve()},lo=({icon:e,deviceClass:n})=>{if(e)return e;switch(n){case"speaker":return"mdi:speaker";case"receiver":return"mdi:audio-video";default:return"mdi:speaker"}},sn=(e,n,t)=>{const r=t?["state","attributes.volume_level","attributes.is_volume_muted","attributes.group_members"]:["state","attributes.media_duration","attributes.media_title","attributes.media_artist","attributes.media_album_name","attributes.icon","attributes.friendly_name","attributes.entity_picture","attributes.entity_picture_local","attributes.volume_level","attributes.is_volume_muted","attributes.source","attributes.shuffle","attributes.repeat","attributes.supported_features","attributes.group_members","attributes.active_child"],i=(o,a)=>a.split(".").reduce((l,u)=>l&&l[u]!==void 0?l[u]:void 0,o),s=(o,a)=>{if(o.length!==a.length)return!1;for(let c=0;c<o.length;c++)if(o[c]!==a[c])return!1;return!0};for(const o of r){const a=i(e,o),c=i(n,o);if(Array.isArray(a)&&Array.isArray(c)){if(!s(a,c))return!0}else if(a!==c)return!0}return!1};function X(){return document.querySelector("home-assistant").hass}const br=(e,n)=>e===0||n?"mdi:volume-off":e<.5?"mdi:volume-medium":"mdi:volume-high",Mm=(e,n,t=!1)=>{var s;const r=X(),i=r.states[e];if(i&&(r.callService("media_player","volume_set",{entity_id:e,volume_level:n}),t&&((s=i.attributes.group_members)==null?void 0:s.length)>0)){const o=i.attributes.volume_level||0,a=o>0?n/o:1;i.attributes.group_members.slice(1).forEach(c=>{const l=r.states[c];if(!l)return;const u=l.attributes.volume_level||0,d=Math.min(Math.max(u*a,0),1);r.callService("media_player","volume_set",{entity_id:c,volume_level:d})})}};async function Em(e,n){const t=X();if(!t)throw new Error("hass object not available");await t.callService("music_assistant","transfer_queue",{source_player:e},{entity_id:n})}function hi(e){var n,t;if(typeof((n=e==null?void 0:e.attributes)==null?void 0:n.mass_player_type)<"u")return!0;if(typeof((t=e==null?void 0:e.attributes)==null?void 0:t.active_child)<"u"){const i=X().states[e.attributes.active_child];return i?hi(i):!1}return!1}function Om(){const e=X();return e?Object.values(e.states).filter(n=>{var t;return((t=n.entity_id)==null?void 0:t.startsWith("media_player."))&&hi(n)}):[]}const fi={root:w({background:"none",border:"none",cursor:"pointer",padding:"0px",margin:"0px",position:"relative",overflow:"hidden",width:"var(--mmpc-art-width)",height:"var(--mmpc-art-height)","&::after":{content:'""',display:"block",paddingBottom:"100%"}}),contentContainer:w({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"}),image:w({height:"100%",aspectRatio:"1 / 1",objectFit:"cover",borderRadius:"var(--mmpc-art-border-radius, 4px)"}),iconContainer:w({display:"flex",justifyContent:"center",alignItems:"center","--icon-primary-color":de.colors.card,backgroundColor:de.colors.onCard,opacity:.5,borderRadius:"var(--mmpc-art-border-radius, 4px)",height:"100%",aspectRatio:"1 / 1"})},hc=({size:e,borderRadius:n=4,iconSize:t,renderLongPressIndicator:r,...i})=>{const s=Le(),{media_title:o,media_artist:a,entity_picture:c,entity_picture_local:l,icon:u,device_class:d,source:h}=s.attributes,f=l||c,p=s.state,[g,b]=P(!1);return Q(()=>{b(!1)},[f]),O("button",{css:fi.root,style:{"--mmpc-art-border-radius":`${n}px`,"--mmpc-art-width":e?typeof e=="string"?e:`${e}px`:"100%","--mmpc-art-height":e?typeof e=="string"?e:`${e}px`:"unset",...typeof e=="number"?{flexShrink:0}:{}},...i,children:[m("div",{css:fi.contentContainer,children:f&&p!=="off"&&!g?m("img",{css:fi.image,src:X().hassUrl(f),alt:o&&a?`${o} by ${a}`:`Source: ${h}`,onError:()=>b(!0)}):m("div",{css:fi.iconContainer,children:m(gt,{icon:p==="off"||!h?lo({icon:u,deviceClass:d}):Im({source:h}),size:t})})}),r&&r()]})},Im=({source:e})=>{switch(e==null?void 0:e.toLowerCase()){case"spotify":return"mdi:spotify";case"airplay":return"mdi:cast-audio-variant";case"bluetooth":return"mdi:bluetooth";case"net radio":return"mdi:radio";case"server":return"mdi:server";case"usb":return"mdi:usb";case"aux":return"mdi:audio-input-rca";case"hdmi":return"mdi:hdmi-port";case"tv":return"mdi:television";case"tuner":return"mdi:radio-tower";case"optical":return"mdi:audio-input-stereo-minijack";default:return"mdi:music"}},Ve=st(null),fc=({rootElement:e,config:n,children:t})=>{const r=W(()=>({rootElement:e,config:n}),[e,n]);return m(Ve.Provider,{value:r,children:t})},pc={root:w({position:"relative",background:"none",border:"none",display:"flex",flex:0,flexDirection:"row",height:"32px",fontSize:"13px",fontWeight:500,lineHeight:"32px",padding:"0 12px",borderRadius:"16px",color:`var(--mmpc-chip-foreground, ${de.colors.card})`,backgroundColor:`var(--mmpc-chip-background, ${de.colors.onCard})`,"--icon-primary-color":`var(--mmpc-chip-foreground, ${de.colors.card})`,marginRight:"5px",alignItems:"center",gap:"4px",textWrap:"nowrap",cursor:"pointer","&:hover":{opacity:.8},opacity:1,"& ha-icon":{pointerEvents:"none"}}),rootLoading:w({opacity:.8})},on=({loading:e,icon:n,iconPosition:t="left",children:r,...i})=>{const s=()=>{if(e)return m(_r,{size:"x-small"});if(n)return m(gt,{size:"x-small",icon:n})};return O("button",{css:[pc.root,e&&pc.rootLoading],...i,children:[t==="left"&&s(),r,t==="right"&&s()]})},mc=({rootElement:e,children:n})=>{const[t]=P(()=>Ql({key:"mmpc",container:e,speedy:!1}));return m(xm,{value:t,children:n})},Am=()=>[{name:"tap_action",label:"Tap Action",selector:{ui_action:{}}},{name:"hold_action",label:"Hold Action",selector:{ui_action:{}}},{name:"double_tap_action",label:"Double Tap Action",selector:{ui_action:{}}}],Nm=({hass:e,value:n,onChange:t,disabled:r=!1})=>{const i=Z(null),s=W(()=>n?{...n}:{action:"none"},[n]),o=D(a=>{const l=a.detail.value;t(l)},[t]);return Q(()=>{const a=i.current;return a&&a.addEventListener("value-changed",o),()=>{a&&a.removeEventListener("value-changed",o)}},[i.current,o]),m("ha-form",{ref:i,hass:e,data:s,schema:Am(),computeLabel:a=>a.label||a.name,disabled:r})},mt={formGroup:w({marginBottom:"16px"}),label:w({display:"block",marginBottom:"16px",fontWeight:500}),buttonsContainer:w({display:"flex",flexDirection:"column"}),button:w({padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",backgroundColor:"var(--primary-color, #03a9f4)",color:"white",fontWeight:500,"&:hover":{backgroundColor:"var(--primary-color-dark, #007ac1)"},alignSelf:"flex-start"}),deleteButton:w({backgroundColor:"var(--error-color, #ff5252)","&:hover":{backgroundColor:"var(--error-color-dark, #c50b0b)"}}),inputGroup:w({display:"flex",flexDirection:"column",marginBottom:"16px"}),toggleContainer:w({display:"flex",alignItems:"center",marginBottom:"16px"}),toggleLabel:w({marginLeft:"8px",fontWeight:"normal"}),toggle:w({cursor:"pointer"}),errorMessage:w({color:"var(--error-color, #ff5252)",marginTop:"8px",fontSize:"14px"})},Ue=e=>m("div",{css:mt.formGroup,...e}),On=e=>m("label",{css:mt.label,...e}),gc=e=>m("div",{css:mt.buttonsContainer,...e}),vr=e=>m("button",{css:mt.button,...e}),yc=e=>m("button",{css:[mt.button,mt.deleteButton],...e}),pi=e=>m("div",{css:mt.inputGroup,...e}),$t=e=>m("div",{css:mt.toggleContainer,...e}),Ct=e=>m("label",{css:mt.toggleLabel,...e}),Mt=e=>m("input",{type:"checkbox",css:mt.toggle,...e}),co=e=>m("div",{css:mt.errorMessage,...e}),ot=e=>{const{hass:n,value:t,onChange:r,label:i,domains:s,required:o=!1,disabled:a=!1,allowCustomEntity:c=!1,error:l}=e,u=Z(null),d=D(h=>{const p=h.detail.value;r(p)},[r]);return Q(()=>{const h=u.current;return h&&h.addEventListener("value-changed",d),()=>{h&&h.removeEventListener("value-changed",d)}},[u.current,d]),O("div",{children:[m("ha-entity-picker",{ref:u,hass:n,value:t,label:i,includeDomains:s,disabled:a,required:o,"allow-custom-entity":c}),!!l&&m(co,{children:l})]})},Rm={root:w({display:"flex",flexDirection:"column",gap:"8px"})},bc=({hass:e,value:n,onChange:t,label:r,domains:i,disabled:s=!1,allowCustomEntity:o=!1})=>{const a=(n==null?void 0:n.filter(Boolean))||[],c=D((l,u)=>{const d=[...a];!l&&u<a.length?d.splice(u,1):u<a.length?d[u]=l||"":l&&d.push(l),t(d.filter(Boolean))},[a,t]);return O("div",{css:Rm.root,className:"entities-picker",children:[r&&m("label",{children:r}),a.map((l,u)=>m(ot,{hass:e,value:l,onChange:d=>c(d,u),domains:i,disabled:s,required:!1,allowCustomEntity:o},`entity-${u}`)),m(ot,{hass:e,value:"",onChange:l=>c(l,a.length),domains:i,disabled:s,required:!1,allowCustomEntity:o},"entity-new")]})},Pm=({options:e,onSelected:n,selected:t})=>m("select",{value:t,onChange:r=>n(r.target.value),children:e.map(r=>m("option",{value:r.value,children:r.name},r.value))}),mi=({hass:e,value:n={},onChange:t})=>m(Nm,{hass:e,value:n,onChange:t}),Dm={root:w({display:"flex",flexDirection:"column"})},an=({hass:e,value:n,onChange:t,label:r,error:i,required:s=!1,disabled:o=!1,isIconInput:a=!1})=>{const c=D(u=>{t(u.detail.value)},[t]),l=()=>a?m("ha-icon-picker",{label:r||"Icon",hass:e,value:n,disabled:o,required:s,"onvalue-changed":c}):m("ha-textfield",{label:r||"Text",value:n,disabled:o,required:s,onchange:u=>t(u.target.value)});return O("div",{css:Dm.root,children:[l(),!!i&&m(co,{children:i})]})},Tm=({children:e})=>{const[n,t]=P(!1);return Q(()=>{customElements.get("hui-glance-card").getConfigElement().then(()=>{t(!0)})},[]),n?e:null},vc={root:w({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),speakerChip:w({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}})},uo=({config:e,showGrouped:n,layout:t})=>{const r=An(),{entity_id:i,speaker_group:s}=e,[o,a]=P([]),c=(s==null?void 0:s.entity_id)||i,l=r.states[c],u=W(()=>{var h;return(h=s==null?void 0:s.entities)!=null&&h.length?s.entities.filter(f=>f!==c).filter(f=>r.states[f]).map(f=>{var p,g;return{entity_id:f,name:r.states[f].attributes.friendly_name??f,volume:r.states[f].attributes.volume_level||0,muted:r.states[f].attributes.is_volume_muted||!1,isGrouped:((g=(p=l==null?void 0:l.attributes)==null?void 0:p.group_members)==null?void 0:g.includes(f))||!1}}).filter(f=>n?!0:!f.isGrouped).sort((f,p)=>f.entity_id===c?-1:p.entity_id===c?1:f.name.localeCompare(p.name)).sort((f,p)=>f.isGrouped&&!p.isGrouped?-1:!f.isGrouped&&p.isGrouped?1:0):[]},[r.states,s,n]),d=D(async(h,f)=>{if(!o.includes(h)){a(p=>[...p,h]);try{const p=r.states[h];f?await r.callService("media_player","unjoin",{entity_id:h}):(p.state==="off"&&await r.callService("media_player","turn_on",{entity_id:h}),await r.callService("media_player","join",{entity_id:c,group_members:[h]}))}catch(p){console.error(p)}a(p=>p.filter(g=>g!==h))}},[c,o]);return m("div",{css:vc.root,children:u.map(h=>m(on,{css:vc.speakerChip,loading:o.includes(h.entity_id),onClick:()=>d(h.entity_id,h.isGrouped),icon:h.isGrouped?"mdi:close":"mdi:plus",iconPosition:"right",style:{"--mmpc-chip-horizontal-margin":`${(t==null?void 0:t.horizontalMargin)??0}px`},children:h.name},h.entity_id))})},Kt={speakersTable:w({width:"100%",borderCollapse:"collapse",tableLayout:"fixed"}),speakerRow:w({width:"100%",height:"32px"}),nameCell:w({paddingRight:"8px",fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),nameCellMainSpeaker:w({fontWeight:500}),controlsCell:w({padding:"0px 4px"}),buttonCell:w({width:"28px",whiteSpace:"nowrap"}),controlsContainer:w({display:"flex",alignItems:"center",width:"100%"})},_c=({config:{speaker_group:e,entity_id:n},syncMainSpeaker:t})=>{const r=An(),[i,s]=P([]),o=(e==null?void 0:e.entity_id)||n,a=r.states[o],c=W(()=>{var p;if(!((p=e==null?void 0:e.entities)!=null&&p.length)&&!a)return[];const f=[...(e==null?void 0:e.entities)||[]];return a&&!f.includes(o)&&f.push(o),f.filter(g=>r.states[g]).map(g=>{var b,_,v,S;return{entity_id:g,name:r.states[g].attributes.friendly_name??g,volume:r.states[g].attributes.volume_level||0,muted:r.states[g].attributes.is_volume_muted||!1,isGrouped:((_=(b=a==null?void 0:a.attributes)==null?void 0:b.group_members)==null?void 0:_.includes(g))||!1,isMainSpeaker:((S=(v=a==null?void 0:a.attributes)==null?void 0:v.group_members)==null?void 0:S[0])===g||!1}}).sort((g,b)=>g.entity_id===o?-1:b.entity_id===o?1:g.name.localeCompare(b.name))},[r.states,e,o,a]),l=D(async(f,p)=>{if(!i.includes(f)){s(g=>[...g,f]);try{const g=r.states[f];p?await r.callService("media_player","unjoin",{entity_id:f}):(g.state==="off"&&await r.callService("media_player","turn_on",{entity_id:f}),await r.callService("media_player","join",{entity_id:o,group_members:[f]}))}catch(g){console.error(g)}s(g=>g.filter(b=>b!==f))}},[o,i]),u=D((f,p)=>{X().callService("media_player","volume_mute",{entity_id:f,is_volume_muted:!p})},[]),d=D((f,p,g)=>{Mm(f,p,g&&t)},[t]),h=(f,p,g)=>{const{entity_id:b,name:_,volume:v,muted:S,isGrouped:k,isMainSpeaker:x}=f,M=i.includes(b)||x&&!k;return O("tr",{css:Kt.speakerRow,children:[m("td",{css:[Kt.nameCell,x&&Kt.nameCellMainSpeaker],children:_}),m("td",{css:Kt.buttonCell,children:m(G,{size:"x-small",onClick:()=>u(b,S),icon:br(v,S)})}),m("td",{css:Kt.controlsCell,children:m("div",{css:Kt.controlsContainer,children:m(Va,{min:0,max:1,step:.01,value:v,sliderSize:"small",onChange:E=>d(b,E,x)})})}),m("td",{css:Kt.buttonCell,children:m(G,{size:"x-small",onClick:()=>l(b,k),icon:k?"mdi:close":"mdi:plus",disabled:M})})]},b)};return m("div",{children:m("table",{css:Kt.speakersTable,children:m("tbody",{children:c.filter(f=>f.isGrouped).map((f,p,g)=>h(f))})})})};function xc(e,n){const[t,r]=P(e);return Q(()=>{const i=setTimeout(()=>{r(e)},n);return()=>{clearTimeout(i)}},[e,n]),t}function Fm(){const[e,n]=P({width:null,height:null}),t=Z(null);return[D(i=>{if(t.current&&(t.current.disconnect(),t.current=null),(i==null?void 0:i.nodeType)===Node.ELEMENT_NODE){const s=new ResizeObserver(([o])=>{if(o&&o.borderBoxSize){const{inlineSize:a,blockSize:c}=o.borderBoxSize[0];n({width:a,height:c})}});s.observe(i),t.current=s}},[]),e]}const Vm={root:w({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gridGap:"8px",padding:"0px var(--mmpc-search-padding, 0px)"})},gi=({numberOfColumns:e=3,children:n})=>m("div",{css:Vm.root,style:{gridTemplateColumns:`repeat(${e}, minmax(0, 1fr))`},children:n}),Lm={root:w({background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"var(--mmpc-icon-size)",aspectRatio:"1","& > ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-size)",width:"var(--mmpc-icon-size)",height:"var(--mmpc-icon-size)",display:"flex"}})},gt=({icon:e,size:n="medium",className:t})=>m("div",{css:Lm.root,style:{"--mmpc-icon-size":`${ho(n)}px`},className:t,children:m("ha-icon",{icon:e})}),ho=e=>{switch(e){case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}},zm=En`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Bm={spinner:w({animation:`${zm} 1s linear infinite`,"--mdc-icon-size":"var(--mmpc-spinner-size)",width:"var(--mmpc-spinner-size)",display:"flex",pointerEvents:"none"})},_r=e=>m(gt,{icon:"mdi:loading",css:Bm.spinner,...e}),qm=En({"0%":{opacity:1,transform:"translateY(0px)"},"85%":{opacity:1,transform:"translateY(0px)"},"100%":{opacity:0,transform:"translateY(-20px)"}}),xr={root:w({width:"100%","&::before":{content:'""',display:"block",paddingTop:"100%"},borderRadius:"4px","--icon-primary-color":"var(--card-background-color)",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),image:w({position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}),icon:w({position:"absolute","--icon-primary-color":"var(--primary-text-color, #333)",backgroundColor:"var(--card-background-color)",borderRadius:"50%",padding:"2px",width:ho("x-small")+4,height:ho("x-small")+4}),done:w({animation:`${qm} 3s forwards`})},wc=({imageUrl:e,loading:n,done:t,className:r})=>{const[i,s]=P(!1);return Q(()=>{s(!1)},[e]),O("div",{css:xr.root,className:r,children:[e&&!i&&m("img",{src:X().hassUrl(e),css:xr.image,alt:"",onError:()=>s(!0)}),(!!i||!e)&&m(gt,{icon:"mdi:image-broken-variant",size:"small"}),n&&m(_r,{css:xr.icon,size:"x-small"}),!n&&t&&m(gt,{icon:"mdi:check",size:"x-small",css:[xr.icon,xr.done]})]})},yi={root:w({display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",transition:"transform 0.2s",borderRadius:"8px",padding:"8px",background:"rgba(255, 255, 255, 0.05)","@media (prefers-color-scheme: light)":{background:"rgba(0, 0, 0, 0.05)"},"&:hover":{transform:"translateY(-4px)"}}),name:w({fontSize:"14px",fontWeight:500,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%",color:"var(--primary-text-color)"}),artist:w({fontSize:"12px",color:"var(--secondary-text-color)",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",width:"100%"}),mediaImage:w({marginBottom:8})},bi=({imageUrl:e,name:n,artist:t,onClick:r})=>{const[i,s]=P(!1),[o,a]=P(!1),c=D(async()=>{a(!1),s(!0);try{await r(),a(!0)}catch(l){console.error("Error in MediaItem onClick:",l)}s(!1)},[r]);return O("div",{css:yi.root,onClick:c,children:[m(wc,{css:yi.mediaImage,imageUrl:e,loading:i,done:o}),m("div",{css:yi.name,children:n}),m("div",{css:yi.artist,children:t})]})},Sc={root:w({display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",margin:"0 4px",padding:"4px var(--mmpc-search-padding, 0px)"}),title:w({fontSize:"16px",fontWeight:500,color:"var(--primary-text-color)",margin:0})},kc=({children:e,onClick:n})=>O("div",{css:Sc.root,onClick:n,children:[m("h3",{css:Sc.title,children:e}),!!n&&m(gt,{icon:"mdi:chevron-right",size:"small"})]}),wr={root:w({display:"grid",gridTemplateColumns:"50px 1fr auto",alignItems:"center",gap:"12px",padding:"8px 12px",borderRadius:"8px",gridColumn:"1/-1",background:"rgba(255, 255, 255, 0.05)",cursor:"pointer","&:hover":{background:"rgba(255, 255, 255, 0.1)"},"@media (prefers-color-scheme: light)":{background:"rgba(0, 0, 0, 0.05)","&:hover":{background:"rgba(0, 0, 0, 0.01)"}}}),trackInfo:w({display:"flex",flexDirection:"column",overflow:"hidden"}),trackName:w({fontSize:"14px",fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--primary-text-color)"}),trackArtist:w({fontSize:"12px",color:"var(--secondary-text-color)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),mediaImage:w({width:50,height:50})},vi=({imageUrl:e,title:n,artist:t,onClick:r})=>{const[i,s]=P(!1),[o,a]=P(!1),c=D(async()=>{a(!1),s(!0);try{await r(),a(!0)}catch(l){console.error("Error in MediaItem onClick:",l)}s(!1)},[r]);return O("div",{css:wr.root,onClick:c,children:[m(wc,{css:wr.mediaImage,imageUrl:e,loading:i,done:o}),O("div",{css:wr.trackInfo,children:[m("div",{css:wr.trackName,children:n}),!!t&&m("div",{css:wr.trackArtist,children:t})]})]})},Ne={root:w({display:"flex",flexDirection:"column",gap:"12px",overflow:"hidden"}),rootSearchBarBottom:w({overflow:"hidden"}),searchBarContainer:w({display:"flex",flexDirection:"column",gap:12,marginBottom:12}),searchInput:w({padding:"1px var(--mmpc-search-padding, 0px)"}),filterContainer:w({display:"flex",flexDirection:"row",gap:"2px",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:w({"&:first-child":{marginLeft:"var(--mmpc-chip-horizontal-margin, 0px)"},"&:last-child":{marginRight:"var(--mmpc-chip-horizontal-margin, 0px)"}}),verticalChipSeperator:w({height:"28px",alignSelf:"center",borderRight:"1px solid var(--divider-color)",marginRight:"6px"}),mediaEmptyText:w({padding:"0px var(--mmpc-search-padding, 0px)"}),resultsContainerSearchBarBottom:w({overflowY:"auto"})},Um=(e,n,t)=>{const[r,i]=P(null),[s,o]=P(!1),[a,c]=P(null),l=Z(null);Q(()=>{if(e==="")return;const d=e+(n??"all");l.current=d;const h={type:"call_service",domain:"media_player",service:"search_media",service_data:{search_query:e,entity_id:t,media_content_type:n==="all"?void 0:n},return_response:!0},f=X();o(!0),f.connection.sendMessagePromise(h).then(p=>{const g=p;d===l.current&&g.response[t]&&(o(!1),i(g.response[t]),c(null))}).catch(p=>{console.error("Error fetching search results:",p),o(!1),c("Error fetching search results: "+p.message),i(null)})},[e,t,n]);const u=D(async(d,h,f)=>X().callService("media_player","play_media",{entity_id:h,media_content_type:d.media_content_type,media_content_id:d.media_content_id,enqueue:f}),[]);return W(()=>({results:(r==null?void 0:r.result)??[],loading:s,playItem:u,error:a}),[r,s,a])},Km=(e,n="favorites",t=!1)=>{const[r,i]=P([]),[s,o]=P(!1);return Q(()=>{if(!t){i([]);return}const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:e,media_content_type:n},return_response:!0},c=X();o(!0),c.connection.sendMessagePromise(a).then(l=>{const u=l;u.response[e]&&(o(!1),i(u.response[e].children.filter(d=>d.can_play)))}).catch(l=>{console.error("Error fetching search results:",l),o(!1),i([])})},[e,t,n]),W(()=>({mediaBrowserItems:r,isFetching:s}),[r,s])};function In(e,n,t){let r=t.initialDeps??[],i;function s(){var o,a,c,l;let u;t.key&&((o=t.debug)!=null&&o.call(t))&&(u=Date.now());const d=e();if(!(d.length!==r.length||d.some((p,g)=>r[g]!==p)))return i;r=d;let f;if(t.key&&((a=t.debug)!=null&&a.call(t))&&(f=Date.now()),i=n(...d),t.key&&((c=t.debug)!=null&&c.call(t))){const p=Math.round((Date.now()-u)*100)/100,g=Math.round((Date.now()-f)*100)/100,b=g/16,_=(v,S)=>{for(v=String(v);v.length<S;)v=" "+v;return v};console.info(`%c⏱ ${_(g,5)} /${_(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*b,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(l=t==null?void 0:t.onChange)==null||l.call(t,i),i}return s.updateDeps=o=>{r=o},s}function $c(e,n){if(e===void 0)throw new Error("Unexpected undefined");return e}const jm=(e,n)=>Math.abs(e-n)<1.01,Wm=(e,n,t)=>{let r;return function(...i){e.clearTimeout(r),r=e.setTimeout(()=>n.apply(this,i),t)}};var ln={};const Cc=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Hm=e=>e,Gm=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let i=n;i<=t;i++)r.push(i);return r},Jm=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;const i=o=>{const{width:a,height:c}=o;n({width:Math.round(a),height:Math.round(c)})};if(i(Cc(t)),!r.ResizeObserver)return()=>{};const s=new r.ResizeObserver(o=>{const a=()=>{const c=o[0];if(c!=null&&c.borderBoxSize){const l=c.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(Cc(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return s.observe(t,{box:"border-box"}),()=>{s.unobserve(t)}},Mc={passive:!0},Ec=typeof window>"u"?!0:"onscrollend"in window,Ym=(e,n)=>{const t=e.scrollElement;if(!t)return;const r=e.targetWindow;if(!r)return;let i=0;const s=e.options.useScrollendEvent&&Ec?()=>{}:Wm(r,()=>{n(i,!1)},e.options.isScrollingResetDelay),o=u=>()=>{const{horizontal:d,isRtl:h}=e.options;i=d?t.scrollLeft*(h&&-1||1):t.scrollTop,s(),n(i,u)},a=o(!0),c=o(!1);c(),t.addEventListener("scroll",a,Mc);const l=e.options.useScrollendEvent&&Ec;return l&&t.addEventListener("scrollend",c,Mc),()=>{t.removeEventListener("scroll",a),l&&t.removeEventListener("scrollend",c)}},Zm=(e,n,t)=>{if(n!=null&&n.borderBoxSize){const r=n.borderBoxSize[0];if(r)return Math.round(r[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},Xm=(e,{adjustments:n=0,behavior:t},r)=>{var i,s;const o=e+n;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:t})};class Qm{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const r=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(i=>{i.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var i;(i=r())==null||i.disconnect(),t=null},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([r,i])=>{typeof i>"u"&&delete t[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Hm,rangeExtractor:Gm,onChange:()=>{},measureElement:Zm,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,t)},this.maybeNotify=In(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:ln.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const a=t[o];if(i.has(a.lane))continue;const c=s.get(a.lane);if(c==null||a.end>c.end?s.set(a.lane,a):a.end<c.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurementOptions=In(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,r,i,s,o)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o}),{key:!1}),this.getMeasurements=In(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o},a)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const c=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,c);for(let u=c;u<t;u++){const d=s(u),h=this.options.lanes===1?l[u-1]:this.getFurthestMeasurement(l,u),f=h?h.end+this.options.gap:r+i,p=a.get(d),g=typeof p=="number"?p:this.options.estimateSize(u),b=f+g,_=h?h.lane:u%this.options.lanes;l[u]={index:u,start:f,size:g,end:b,key:d,lane:_}}return this.measurementsCache=l,l},{key:ln.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=In(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,r,i,s)=>this.range=t.length>0&&r>0?eg({measurements:t,outerSize:r,scrollOffset:i,lanes:s}):null,{key:ln.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getVirtualIndexes=In(()=>{let t=null,r=null;const i=this.calculateRange();return i&&(t=i.startIndex,r=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,r]},(t,r,i,s,o)=>s===null||o===null?[]:t({startIndex:s,endIndex:o,overscan:r,count:i}),{key:ln.NODE_ENV!=="production"&&"getVirtualIndexes",debug:()=>this.options.debug}),this.indexFromElement=t=>{const r=this.options.indexAttribute,i=t.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(t,r)=>{const i=this.indexFromElement(t),s=this.measurementsCache[i];if(!s)return;const o=s.key,a=this.elementsCache.get(o);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(o,t)),t.isConnected&&this.resizeItem(i,this.options.measureElement(t,r,this))},this.resizeItem=(t,r)=>{const i=this.measurementsCache[t];if(!i)return;const s=this.itemSizeCache.get(i.key)??i.size,o=r-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,o,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&(ln.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",o),this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,r)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((r,i)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(i))});return}this._measureElement(t,void 0)},this.getVirtualItems=In(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,r)=>{const i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],c=r[a];i.push(c)}return i},{key:ln.NODE_ENV!=="production"&&"getVirtualItems",debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const r=this.getMeasurements();if(r.length!==0)return $c(r[Oc(0,r.length-1,i=>$c(r[i]).start,t)])},this.getOffsetForAlignment=(t,r,i=0)=>{const s=this.getSize(),o=this.getScrollOffset();r==="auto"&&(r=t>=o+s?"end":"start"),r==="center"?t+=(i-s)/2:r==="end"&&(t-=s);const a=this.getTotalSize()+this.options.scrollMargin-s;return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,r="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const i=this.measurementsCache[t];if(!i)return;const s=this.getSize(),o=this.getScrollOffset();if(r==="auto")if(i.end>=o+s-this.options.scrollPaddingEnd)r="end";else if(i.start<=o+this.options.scrollPaddingStart)r="start";else return[o,r];const a=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,r,i.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:r="start",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(t,{align:r="auto",behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let s=0;const o=10,a=l=>{if(!this.targetWindow)return;const u=this.getOffsetForIndex(t,l);if(!u){console.warn("Failed to get offset for index:",t);return}const[d,h]=u;this._scrollToOffset(d,{adjustments:void 0,behavior:i}),this.targetWindow.requestAnimationFrame(()=>{const f=this.getScrollOffset(),p=this.getOffsetForIndex(t,h);if(!p){console.warn("Failed to get offset for index:",t);return}jm(p[0],f)||c(h)})},c=l=>{this.targetWindow&&(s++,s<o?(ln.NODE_ENV!=="production"&&this.options.debug&&console.info("Schedule retry",s,o),this.targetWindow.requestAnimationFrame(()=>a(l))):console.warn(`Failed to scroll to index ${t} after ${o} attempts.`))};a(r)},this.scrollBy=(t,{behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var t;const r=this.getMeasurements();let i;if(r.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((t=r[r.length-1])==null?void 0:t.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=r.length-1;for(;o>=0&&s.some(a=>a===null);){const a=r[o];s[a.lane]===null&&(s[a.lane]=a.end),o--}i=Math.max(...s.filter(a=>a!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:r,behavior:i})=>{this.options.scrollToFn(t,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(n)}}const Oc=(e,n,t,r)=>{for(;e<=n;){const i=(e+n)/2|0,s=t(i);if(s<r)e=i+1;else if(s>r)n=i-1;else return i}return e>0?e-1:0};function eg({measurements:e,outerSize:n,scrollOffset:t,lanes:r}){const i=e.length-1,s=c=>e[c].start;if(e.length<=r)return{startIndex:0,endIndex:i};let o=Oc(0,i,s,t),a=o;if(r===1)for(;a<i&&e[a].end<t+n;)a++;else if(r>1){const c=Array(r).fill(0);for(;a<i&&c.some(u=>u<t+n);){const u=e[a];c[u.lane]=u.end,a++}const l=Array(r).fill(t+n);for(;o>=0&&l.some(u=>u>=t);){const u=e[o];l[u.lane]=u.start,o--}o=Math.max(0,o-o%r),a=Math.min(i,a+(r-1-a%r))}return{startIndex:o,endIndex:a}}const Ic=typeof document<"u"?xt:Q;function tg(e){const n=ar(()=>({}),{})[1],t={...e,onChange:(i,s)=>{var o;s?ni(n):n(),(o=e.onChange)==null||o.call(e,i,s)}},[r]=P(()=>new Qm(t));return r.setOptions(t),Ic(()=>r._didMount(),[]),Ic(()=>r._willUpdate()),r}function ng(e){return tg({observeElementRect:Jm,observeElementOffset:Ym,scrollToFn:Xm,...e})}const Ac={container:w({height:"100%",overflow:"auto"}),item:w({padding:"4px 0"})},Nc=({onLayout:e,data:n,renderItem:t,renderHeader:r,renderEmpty:i,estimateSize:s=80,maxHeight:o=300,overscan:a=5,className:c,style:l={}})=>{const u=Z(null),[d,{width:h}]=Fm();Q(()=>{e&&h!==null&&e({width:h??0})},[e,h]);const f=W(()=>(n==null?void 0:n.length)===0?["empty"]:n,[n]),p=ng({count:f.length,getScrollElement:()=>u.current,estimateSize:()=>s,overscan:a});return m("div",{ref:u,style:{...l,maxHeight:o},css:Ac.container,className:c,children:m("div",{ref:d,style:{height:`${p.getTotalSize()}px`,width:"100%",position:"relative"},children:p.getVirtualItems().map(g=>O("div",{"data-index":g.index,css:Ac.item,ref:p.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${g.start}px)`},children:[g.index===0&&r&&r(),f[g.index]==="empty"&&i&&i(),f[g.index]!=="empty"&&t(n[g.index],g.index)]},g.key))})})},rg=({data:e,onItemClick:n,onHeaderClick:t,filterConfig:r,loading:i=!1,hideEmpty:s=!1,error:o=null,...a})=>{const[c,l]=P(4),u=W(()=>{const h=[],f={};return e.forEach(p=>{const g=p.media_content_type;f[g]||(f[g]=[]),f[g].push(p)}),Object.entries(f).forEach(([p,g])=>{var b,_;if(Object.keys(f).length>1&&h.push({type:"header",mediaType:p}),((b=g[0])==null?void 0:b.media_class)==="track"&&((_=g[0])==null?void 0:_.media_content_type)!=="favorite")g.forEach(v=>{h.push({type:"item",item:v})});else for(let v=0;v<g.length;v+=c){const S=g.slice(v,v+c);h.push({type:"itemsRow",items:S})}}),h},[e,c]),d=h=>{switch(h.type){case"header":{const f=r.find(p=>p.media_type===h.mediaType||p.media_type.slice(0,-1)===h.mediaType);return m(kc,{onClick:f?()=>t==null?void 0:t(f.media_type):void 0,children:(f==null?void 0:f.name)??h.mediaType})}case"item":{const{item:f}=h,p=async()=>{await n(f)};return m(gi,{numberOfColumns:c,children:f.media_class==="track"&&f.media_content_type!=="favorite"?m(vi,{imageUrl:f.thumbnail,title:f.title,onClick:p},f.media_content_id):m(bi,{imageUrl:f.thumbnail,name:f.title,onClick:p},f.media_content_id)})}case"itemsRow":return m(gi,{numberOfColumns:c,children:h.items.map(f=>{const p=async()=>{await n(f)};return f.media_class==="track"&&f.media_content_type!=="favorite"?m(vi,{imageUrl:f.thumbnail,title:f.title,onClick:p},f.media_content_id):m(bi,{imageUrl:f.thumbnail,name:f.title,onClick:p},f.media_content_id)})});default:return null}};return i?m(_r,{}):m(Nc,{onLayout:({width:h})=>{h<390?l(3):l(4)},data:u,renderItem:d,renderEmpty:()=>m(xe,{children:o?m("p",{css:Ne.mediaEmptyText,children:o}):s?null:m("p",{css:Ne.mediaEmptyText,children:"No items found."})}),...a})},ig=[{media_type:"artists",name:"Artists",icon:"mdi:account-music"},{media_type:"albums",name:"Albums",icon:"mdi:album"},{media_type:"tracks",name:"Tracks",icon:"mdi:music-note"},{media_type:"playlists",name:"Playlists",icon:"mdi:playlist-music"}],Rc=({entityId:e,showFavorites:n,horizontalPadding:t,searchBarPosition:r="top",maxHeight:i=300,filterConfig:s=ig})=>{const[o,a]=P(""),[c,l]=P("replace"),u=xc(o,600),[d,h]=P("all"),f=D(()=>{const x=["play","replace","next","add"],M=(x.indexOf(c)+1)%x.length;l(x[M])},[c]),{results:p,loading:g,error:b,playItem:_}=Um(u,d,e),{mediaBrowserItems:v}=Km(e,d==="all"?"favorites":d,(d==="all"&&n||d!=="all")&&o===""),S=()=>O("div",{css:Ne.searchBarContainer,children:[m(ru,{placeholder:"Search..",onChange:a,value:o,loading:g,css:Ne.searchInput}),O("div",{css:Ne.filterContainer,children:[m(on,{css:Ne.chip,style:{"--mmpc-chip-horizontal-margin":`${t}px`},icon:sg(c),onClick:f,children:og(c)}),m("div",{css:Ne.verticalChipSeperator}),k()]})]}),k=()=>[{media_type:"all",name:"All",icon:"mdi:all-inclusive"},...s].map(x=>m(on,{css:Ne.chip,style:{"--mmpc-chip-horizontal-margin":`${t}px`,opacity:d===x.media_type?1:.6,fontWeight:d===x.media_type?"bold":"normal"},onClick:()=>h(x.media_type),icon:x.icon,children:x.name},x.media_type));return O("div",{css:Ne.root,style:{"--mmpc-search-padding":`${t}px`},children:[m(rg,{renderHeader:r==="top"?S:void 0,data:o===""&&v.length>0?v:p,error:b,hideEmpty:o===""&&d==="all"&&!n,onItemClick:x=>_(x,e,c),style:{"--mmpc-search-padding":`${t}px`},maxHeight:i,filterConfig:s,onHeaderClick:h}),r==="bottom"&&S()]})},sg=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},og=e=>{switch(e){case"play":return"Play now";case"replace":return"Replace queue";case"next":return"Add next";case"add":return"Add to queue";default:return"Play"}},Pc=st({}),ag=({hass:e,children:n})=>m(Pc.Provider,{value:{hass:e},children:n}),An=()=>le(Pc).hass,fo={root:w({position:"relative",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"background-color 0.2s",padding:4,minWidth:"var(--mmpc-icon-button-size)",aspectRatio:"1",color:de.colors.onCard,touchAction:"manipulation","-webkit-tap-highlight-color":"transparent","&:hover":{backgroundColor:"var(--secondary-background-color, rgba(0, 0, 0, 0.05))"},"&:active":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))"},"@media (hover: none)":{"&:hover":{backgroundColor:"transparent"},"&:active":{backgroundColor:"var(--divider-color, rgba(0, 0, 0, 0.1))"}},"> ha-icon":{"--mdc-icon-size":"var(--mmpc-icon-button-size)",width:"var(--mmpc-icon-button-size)",display:"flex",pointerEvents:"none"}}),rootDisabled:w({color:"var(--disabled-text-color, #999)"}),rootXxsmall:w({padding:0})},G=pt(({icon:e,size:n="medium",disabled:t=!1,loading:r=!1,className:i,renderLongPressIndicator:s,...o},a)=>O("button",{disabled:t,css:[fo.root,t&&fo.rootDisabled,n==="xx-small"&&fo.rootXxsmall],style:{"--mmpc-icon-button-size":`${lg(n)}px`},className:i,...o,ref:a,children:[r?m(_r,{size:n}):m("ha-icon",{icon:e}),s&&s()]})),lg=e=>{switch(e){case"xx-small":return 12;case"x-small":return 18;case"small":return 24;case"medium":return 32;case"large":return 48;case"x-large":return 80;case"xx-large":return 120}},Dc={};function cn(e,n){const t=Z(Dc);return t.current===Dc&&(t.current=e(n)),t}var cg={};const po=ur[`useInsertionEffect${Math.random().toFixed(1)}`.slice(0,-3)],ug=po&&po!==xt?po:e=>e();function Re(e){const n=cn(dg).current;return n.next=e,ug(n.effect),n.trampoline}function dg(){const e={next:void 0,callback:hg,trampoline:(...n)=>{var t;return(t=e.callback)==null?void 0:t.call(e,...n)},effect:()=>{e.callback=e.next}};return e}function hg(){if(cg.NODE_ENV!=="production")throw new Error("Base UI: Cannot call an event handler while rendering.")}const Et=()=>{};let Tc=function(e){return e.disabled="data-disabled",e.valid="data-valid",e.invalid="data-invalid",e.touched="data-touched",e.dirty="data-dirty",e.filled="data-filled",e.focused="data-focused",e}({});const mo={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:null,valueMissing:!1},fg={valid(e){return e===null?null:e?{[Tc.valid]:""}:{[Tc.invalid]:""}}};var pg={};const Fc=st({invalid:void 0,controlId:void 0,setControlId:Et,labelId:void 0,setLabelId:Et,messageIds:[],setMessageIds:Et,name:void 0,validityData:{state:mo,errors:[],error:"",value:"",initialValue:null},setValidityData:Et,disabled:void 0,touched:!1,setTouched:Et,dirty:!1,setDirty:Et,filled:!1,setFilled:Et,focused:!1,setFocused:Et,validate:()=>null,validationMode:"onBlur",validationDebounceTime:0,state:{disabled:!1,valid:null,touched:!1,dirty:!1,filled:!1,focused:!1},markedDirtyRef:{current:!1}});pg.NODE_ENV!=="production"&&(Fc.displayName="FieldRootContext");function Nn(e=!0){const n=le(Fc);if(n.setControlId===Et&&!e)throw new Error("Base UI: FieldRootContext is missing. Field parts must be placed within <Field.Root>.");return n}var mg={};const Vc=st({formRef:{current:{fields:new Map}},errors:{},clearErrors:Et});mg.NODE_ENV!=="production"&&(Vc.displayName="FormContext");function go(){return le(Vc)}function _i(e,n,t,r){const i=cn(Lc).current;return yg(i,e,n,t,r)&&zc(i,[e,n,t,r]),i.callback}function gg(e){const n=cn(Lc).current;return bg(n,e)&&zc(n,e),n.callback}function Lc(){return{callback:null,cleanup:null,refs:[]}}function yg(e,n,t,r,i){return e.refs[0]!==n||e.refs[1]!==t||e.refs[2]!==r||e.refs[3]!==i}function bg(e,n){return e.refs.length!==n.length||e.refs.some((t,r)=>t!==n[r])}function zc(e,n){if(e.refs=n,n.every(t=>t==null)){e.callback=null;return}e.callback=t=>{if(e.cleanup&&(e.cleanup(),e.cleanup=null),t!=null){const r=Array(n.length).fill(null);for(let i=0;i<n.length;i+=1){const s=n[i];if(s!=null)switch(typeof s){case"function":{const o=s(t);typeof o=="function"&&(r[i]=o);break}case"object":{s.current=t;break}}}e.cleanup=()=>{for(let i=0;i<n.length;i+=1){const s=n[i];if(s!=null)switch(typeof s){case"function":{const o=r[i];typeof o=="function"?o():s(null);break}case"object":{s.current=null;break}}}}}}}const vg=parseInt(Pl,10);function Bc(e){return vg>=e}function qc(e,n){if(e&&!n)return e;if(!e&&n)return n;if(e||n)return{...e,...n}}function Uc(e,n){const t={};for(const r in e){const i=e[r];if(n!=null&&n.hasOwnProperty(r)){const s=n[r](i);s!=null&&Object.assign(t,s);continue}i===!0?t[`data-${r.toLowerCase()}`]="":i&&(t[`data-${r.toLowerCase()}`]=i.toString())}return t}function Kc(e,n){return typeof e=="function"?e(n):e}const Sr={};function Rn(e,n,t,r,i){let s={...yo(e,Sr)};return n&&(s=xi(s,n)),t&&(s=xi(s,t)),r&&(s=xi(s,r)),s}function _g(e){if(e.length===0)return Sr;if(e.length===1)return yo(e[0],Sr);let n={...yo(e[0],Sr)};for(let t=1;t<e.length;t+=1)n=xi(n,e[t]);return n}function xi(e,n){return jc(n)?n(e):xg(e,n)}function xg(e,n){if(!n)return e;for(const t in n){const r=n[t];switch(t){case"style":{e[t]=qc(e.style,r);break}case"className":{e[t]=Wc(e.className,r);break}default:wg(t,r)?e[t]=Sg(e[t],r):e[t]=r}}return e}function wg(e,n){const t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2);return t===111&&r===110&&i>=65&&i<=90&&(typeof n=="function"||typeof n>"u")}function jc(e){return typeof e=="function"}function yo(e,n){return jc(e)?e(n):e??Sr}function Sg(e,n){return n?e?t=>{if($g(t)){const i=t;kg(i);const s=n(i);return i.baseUIHandlerPrevented||e==null||e(i),s}const r=n(t);return e==null||e(t),r}:n:e}function kg(e){return e.preventBaseUIHandler=()=>{e.baseUIHandlerPrevented=!0},e}function Wc(e,n){return n?e?n+" "+e:n:e}function $g(e){return e!=null&&typeof e=="object"&&"nativeEvent"in e}const Pn={};function kr(e,n,t={}){const r=n.render,i=Cg(n,t);if(t.enabled===!1)return null;const s=t.state??Pn;return Mg(e,r,i,s)}function Cg(e,n={}){const{className:t,render:r}=e,{state:i=Pn,ref:s,props:o,disableStyleHooks:a,customStyleHookMapping:c,enabled:l=!0}=n,u=l?Kc(t,i):void 0;let d;a!==!0&&(d=W(()=>l?Uc(i,c):Pn,[i,c,l]));const h=l?qc(d,Array.isArray(o)?_g(o):o)??Pn:Pn;return typeof document<"u"&&(l?Array.isArray(s)?h.ref=gg([h.ref,Hc(r),...s]):h.ref=_i(h.ref,Hc(r),s):_i(null,null)),l?(u!==void 0&&(h.className=Wc(h.className,u)),h):Pn}function Mg(e,n,t,r){if(n){if(typeof n=="function")return n(t,r);const i=Rn(t,n.props);return i.ref=t.ref,ti(n,i)}if(e&&typeof e=="string")return Eg(e,t);throw new Error("Base UI: Render element or function are not defined.")}function Eg(e,n){return e==="button"?Ie("button",{type:"button",...n}):e==="img"?Ie("img",{alt:"",...n}):Be(e,n)}function Hc(e){return e&&typeof e!="function"?Bc(19)?e.props.ref:e.ref:null}const nt=typeof document<"u"?xt:()=>{};function Gc(e){var t;let n=e.activeElement;for(;((t=n==null?void 0:n.shadowRoot)==null?void 0:t.activeElement)!=null;)n=n.shadowRoot.activeElement;return n}const Og={...ur};let Jc=0;function Ig(e,n="mui"){const[t,r]=P(e),i=e||t;return Q(()=>{t==null&&(Jc+=1,r(`${n}-${Jc}`))},[t,n]),i}const Yc=Og.useId;function Ag(e,n){if(Yc!==void 0){const t=Yc();return e??`${n}-${t}`}return Ig(e,n)}function bo(e){return Ag(e,"base-ui")}var Ng={};function Zc({controlled:e,default:n,name:t,state:r="value"}){const{current:i}=Z(e!==void 0),[s,o]=P(n),a=i?e:s;if(Ng.NODE_ENV!=="production"){Q(()=>{i!==(e!==void 0)&&console.error([`Base UI: A component is changing the ${i?"":"un"}controlled ${r} state of ${t} to be ${i?"un":""}controlled.`,"Elements should not switch from uncontrolled to controlled (or vice versa).",`Decide between using a controlled or uncontrolled ${t} element for the lifetime of the component.`,"The nature of the state is determined during the first render. It's considered controlled if the value is not `undefined`.","More info: https://fb.me/react-controlled-components"].join(`
`))},[r,t,e]);const{current:l}=Z(n);Q(()=>{!i&&!Object.is(l,n)&&console.error([`Base UI: A component is changing the default ${r} state of an uncontrolled ${t} after being initialized. To suppress this warning opt to use a controlled ${t}.`].join(`
`))},[JSON.stringify(n)])}const c=D(l=>{i||o(l)},[]);return[a,c]}function Xc(e){const n=cn(Rg,e).current;return n.next=e,nt(n.effect),n}function Rg(e){const n={current:e,next:e,effect:()=>{n.current=n.next}};return n}function vo(e,n){return{...e,state:{...e.state,valid:!n&&e.state.valid}}}function Qc(e){const{formRef:n}=go(),{invalid:t,markedDirtyRef:r,validityData:i,setValidityData:s}=Nn(),{enabled:o=!0,value:a,id:c,name:l,controlRef:u,commitValidation:d}=e,h=Xc(e.getValue);nt(()=>{var p;if(!o)return;let f=a;f===void 0&&(f=(p=h.current)==null?void 0:p.call(h)),i.initialValue===null&&f!==i.initialValue&&s(g=>({...g,initialValue:f}))},[o,s,a,i.initialValue,h]),nt(()=>{o&&c&&n.current.fields.set(c,{controlRef:u,validityData:vo(i,t),validate(){var p;let f=a;f===void 0&&(f=(p=h.current)==null?void 0:p.call(h)),r.current=!0,ni(()=>d(f))},getValueRef:h,name:l})},[d,u,o,n,h,c,t,r,l,i,a]),nt(()=>{const f=n.current.fields;return()=>{c&&f.delete(c)}},[n,c])}const Pg=[];function Dg(e){Q(e,Pg)}const $r=0;class _o{constructor(){y(this,"currentId",$r);y(this,"clear",()=>{this.currentId!==$r&&(clearTimeout(this.currentId),this.currentId=$r)});y(this,"disposeEffect",()=>this.clear)}static create(){return new _o}start(n,t){this.clear(),this.currentId=setTimeout(()=>{this.currentId=$r,t()},n)}isStarted(){return this.currentId!==$r}}function Tg(){const e=cn(_o.create).current;return Dg(e.disposeEffect),e}const wi=Object.keys(mo);function Fg(e){if(!e||e.valid||!e.valueMissing)return!1;let n=!1;for(const t of wi)t!=="valid"&&(t==="valueMissing"&&(n=e[t]),e[t]&&(n=!1));return n}function eu(){const{setValidityData:e,validate:n,messageIds:t,validityData:r,validationMode:i,validationDebounceTime:s,invalid:o,markedDirtyRef:a,controlId:c,state:l,name:u}=Nn(),{formRef:d,clearErrors:h}=go(),f=Tg(),p=Z(null),g=Re(async(v,S=!1)=>{const k=p.current;if(!k)return;if(S){if(l.valid!==!1)return;const R=k.validity;if(!R.valueMissing){const z={value:v,state:{...mo,valid:!0},error:"",errors:[],initialValue:r.initialValue};if(k.setCustomValidity(""),c){const U=d.current.fields.get(c);U&&d.current.fields.set(c,{...U,...vo(z,!1)})}e(z);return}const F=wi.reduce((z,U)=>(z[U]=R[U],z),{});if(!F.valid&&!Fg(F))return}function x(R){const F=wi.reduce((U,Y)=>(U[Y]=R.validity[Y],U),{});let z=!1;for(const U of wi)if(U!=="valid"){if(U==="valueMissing"&&F[U])z=!0;else if(F[U])return F}return z&&!a.current&&(F.valid=!0,F.valueMissing=!1),F}f.clear();let $=null,M=[];const E=x(k);let C;if(k.validationMessage)C=k.validationMessage,M=[k.validationMessage];else{const R=Array.from(d.current.fields.values()).reduce((z,U)=>{var Y,Te;return U.name&&U.getValueRef&&(z[U.name]=(Te=(Y=U.getValueRef).current)==null?void 0:Te.call(Y)),z},{}),F=n(v,R);typeof F=="object"&&F!==null&&"then"in F?$=await F:$=F,$!==null&&(E.valid=!1,E.customError=!0,Array.isArray($)?(M=$,k.setCustomValidity($.join(`
`))):$&&(M=[$],k.setCustomValidity($)))}const N={value:v,state:E,error:C??(Array.isArray($)?$[0]:$??""),errors:M,initialValue:r.initialValue};if(c){const R=d.current.fields.get(c);R&&d.current.fields.set(c,{...R,...vo(N,o)})}e(N)}),b=D((v={})=>Rn({...t.length&&{"aria-describedby":t.join(" ")},...l.valid===!1&&{"aria-invalid":!0}},v),[t,l.valid]),_=D((v={})=>Rn({onChange(S){if(S.nativeEvent.defaultPrevented)return;if(h(u),i!=="onChange"){g(S.currentTarget.value,!0);return}if(o)return;const k=S.currentTarget;if(k.value===""){g(k.value);return}f.clear(),s?f.start(s,()=>{g(k.value)}):g(k.value)}},b(v)),[b,h,u,f,g,o,i,s]);return W(()=>({getValidationProps:b,getInputValidationProps:_,inputRef:p,commitValidation:g}),[b,_,g])}var Vg={};const tu=pt(function(n,t){const{render:r,className:i,id:s,name:o,value:a,disabled:c=!1,onValueChange:l,defaultValue:u,...d}=n,{state:h,name:f,disabled:p}=Nn(),g=p||c,b=f??o,_=W(()=>({...h,disabled:g}),[h,g]),{setControlId:v,labelId:S,setTouched:k,setDirty:x,validityData:$,setFocused:M,setFilled:E,validationMode:C}=Nn(),{getValidationProps:N,getInputValidationProps:R,commitValidation:F,inputRef:z}=eu(),U=bo(s);nt(()=>(v(U),()=>{v(void 0)}),[U,v]),nt(()=>{var me;const K=a!=null;(me=z.current)!=null&&me.value||K&&a!==""?E(!0):K&&a===""&&E(!1)},[z,E,a]);const[Y,Te]=Zc({controlled:a,default:u,name:"FieldControl",state:"value"}),pe=Re((K,me)=>{Te(K),l==null||l(K,me)});return Qc({id:U,name:b,commitValidation:F,value:Y,getValue:()=>{var K;return(K=z.current)==null?void 0:K.value},controlRef:z}),kr("input",n,{ref:t,state:_,props:[{id:U,disabled:g,name:b,ref:z,"aria-labelledby":S,value:Y,onChange(K){Y!=null&&pe(K.currentTarget.value,K.nativeEvent),x(K.currentTarget.value!==$.initialValue),E(K.currentTarget.value!=="")},onFocus(){M(!0)},onBlur(K){k(!0),M(!1),C==="onBlur"&&F(K.currentTarget.value)},onKeyDown(K){K.currentTarget.tagName==="INPUT"&&K.key==="Enter"&&(k(!0),F(K.currentTarget.value))}},N(),R(),d],customStyleHookMapping:fg})});Vg.NODE_ENV!=="production"&&(tu.displayName="FieldControl");var Lg={};const nu=pt(function(n,t){return Ie(tu,{ref:t,...n})});Lg.NODE_ENV!=="production"&&(nu.displayName="Input");const zg=En({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),Si={root:w({display:"flex",position:"relative"}),label:w({display:"block",marginBottom:"8px",color:de.colors.onCard,fontSize:"14px",fontWeight:500}),input:w({"--input-text-color":"var(--primary-text-color)","--input-bg-color":"var(--secondary-background-color)","--input-border-color":"var(--divider-color)","--input-focus-border-color":"var(--secondary-text-color)","--input-disabled-bg-color":"var(--disabled-color)","--input-disabled-text-color":"var(--disabled-text-color)",width:"100%",padding:"8px",color:"var(--input-text-color)",backgroundColor:"var(--input-bg-color)",border:"none",boxShadow:"0 0 1px 1px var(--input-border-color)",borderRadius:"6px",fontSize:"14px","&:focus":{outline:"none",boxShadow:"0 0 1px 1px var(--input-focus-border-color)"},"&:disabled":{backgroundColor:"var(--input-disabled-bg-color)",color:"var(--input-disabled-text-color)",cursor:"not-allowed"}}),icon:w({position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)","& ha-icon":{pointerEvents:"none",animation:`${zg} 1s linear infinite`}})},ru=({value:e="",placeholder:n,onChange:t,disabled:r,type:i="text",label:s,name:o,loading:a=!1,className:c})=>{const l=u=>{t==null||t(u.target.value)};return O("div",{css:Si.root,className:c,children:[s&&m("label",{css:Si.label,children:s}),m(nu,{css:Si.input,value:e,placeholder:n,onChange:l,disabled:r,type:i,name:o}),a&&m(gt,{size:"x-small",icon:"mdi:loading",css:Si.icon})]})},Bg=En`
    from { opacity: 0; }
    to { opacity: 1; }
`,qg={popoverRoot:w({position:"fixed",zIndex:100,opacity:1,animation:`${Bg} 0.3s ease`,maxHeight:"100vh",overflowY:"auto"})},ki=8,iu=({renderTrigger:e,side:n="bottom",align:t="start",openOnHover:r,children:i})=>{const[s,o]=P(),[a,c]=P(),l=s??n,u=a??t,[d,h]=P(!1),f=Z(null),p=Z(null),[g,b]=P(null),[_,v]=P(null);Q(()=>{if(!d)return;function E(C){C.key==="Escape"&&h(!1)}return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[d]),Q(()=>{if(!d)return;function E(C){const N=C.composedPath?C.composedPath():[],R=C.target,F=p.current,z=f.current,U=F&&(N.includes(F)||F.contains(R)),Y=z&&(N.includes(z)||z.contains(R));!U&&!Y&&(h(!1),c(void 0),o(void 0))}return window.addEventListener("click",E),()=>window.removeEventListener("click",E)},[d]);const S=()=>{var E;h(!0),b(((E=f.current)==null?void 0:E.getBoundingClientRect())||null),setTimeout(()=>{var C;v(((C=p.current)==null?void 0:C.getBoundingClientRect())||null)},0)},k=D(()=>{d?(h(!1),c(void 0),o(void 0)):S()},[d]),x=D((E,C,N)=>{switch(E){case"top":return{top:C.top-ki-N.height};case"bottom":return{top:C.top+C.height+ki};case"left":return{left:Math.max(0,C.left-N.width-ki)};case"right":return{left:Math.max(0,C.left+C.width+ki)}}},[]),$=D((E,C,N,R)=>{switch(E){case"start":return C==="right"||C==="left"?{top:Math.max(0,N.top)}:{left:N.left};case"center":return C==="right"||C==="left"?{top:Math.max(0,N.top+N.height/2-R.height/2)}:{left:N.left-R.width/2+N.width/2};case"end":return C==="right"||C==="left"?{top:Math.max(0,N.top-R.height+N.height)}:{left:N.left-R.width+N.width}}},[]),M=W(()=>{if(!g||!_)return{};const E=x(l,g,_),C=$(u,l,g,_);return{...E,...C}},[g,_,l,u]);return Q(()=>{const E=p.current;if(!E||!d)return;const C=new window.IntersectionObserver(N=>{N.forEach(R=>{if(R.intersectionRatio<1){if(R.boundingClientRect.height!==R.intersectionRect.height){const F=R.boundingClientRect.top!==R.intersectionRect.top,z=R.intersectionRect.bottom!==R.boundingClientRect.bottom;z&&F||(z&&(n==="bottom"&&o("top"),(n==="right"||n==="left")&&c("end")),F&&(n==="top"&&o("bottom"),(n==="right"||n==="left")&&c("start")))}if(R.boundingClientRect.width!==R.intersectionRect.width){const F=R.boundingClientRect.right!==R.intersectionRect.right,z=R.boundingClientRect.left!==R.intersectionRect.left;z&&F||(F&&((n==="top"||n==="bottom")&&c("end"),n==="right"&&o("left")),z&&((n==="top"||n==="bottom")&&c("start"),n==="left"&&o("right")))}}})},{root:null,threshold:0});return C.observe(E),()=>{C.disconnect()}},[p.current,d,n,t]),O(xe,{children:[e({onClick:k,onMouseEnter:r&&!matchMedia("(hover: none)").matches?S:void 0,ref:f}),d&&m("div",{css:qg.popoverRoot,role:"menu",style:M,ref:p,children:i})]})},xo={menuRoot:w({background:de.colors.card,color:de.colors.onCard,borderRadius:12,minWidth:180,boxShadow:"0 2px 12px rgba(0,0,0,0.12)",padding:4,gap:4,display:"flex",flexDirection:"column",border:`1px solid ${de.colors.onCardDivider}`}),item:w({display:"flex",alignItems:"center",gap:10,padding:"8px 14px",borderRadius:8,fontSize:15,cursor:"pointer",color:"inherit",transition:"background 0.15s",position:"relative",border:"none","&:hover, &[data-highlighted]":{background:de.colors.onCardDivider},"&[data-disabled]":{color:de.colors.onCardMuted,cursor:"not-allowed"}})},Ug=({menuItems:e,...n})=>{const t=(i,s,o,a)=>O("button",{css:xo.item,onClick:i.onClick,role:"menuitem",...s,children:[i.icon&&m(gt,{icon:i.icon,size:"x-small"}),m("span",{children:i.label}),o&&m(gt,{icon:"mdi:chevron-down",size:"x-small"})]},i.label+a),r=(i,s=0)=>i.map((o,a)=>{const c=!!(o.children&&o.children.length>0);return c?m(iu,{side:"right",align:"start",openOnHover:!0,renderTrigger:l=>t(o,l,c,a),children:m("div",{css:xo.menuRoot,role:"menu",children:r(o.children,s+1)})}):t(o,{},c,a)});return m(iu,{...n,children:m("div",{css:xo.menuRoot,role:"menu",children:r(e)})})};function Kg(e){if(!e)return{title:"Unavailable",subtitle:"unknown unavailable"};const{attributes:{media_title:n,media_artist:t,media_album_name:r,media_series_title:i,media_season:s,media_episode:o,source:a,friendly_name:c}={},state:l,entity_id:u}=e;if(l==="off")return{title:c??u,subtitle:void 0};if(l==="unavailable")return{title:"Unavailable",subtitle:`${u} unavailable`};let d=n??"";(!d||d==="")&&(a&&typeof a=="string"&&!a.startsWith("media_player.")?d=a:d=c??u);let h;if(i){let f="";(s||o)&&(f=`S${s??""}${o?`E${o}`:""}`),h=`${i}${f?` - ${f}`:""}`}else(r||t)&&(h=`${r&&r!==d?`${r} - `:""}${t??""}`);return{title:d,subtitle:h}}const su=st({player:{}}),jg=({hass:e,children:n,entityId:t})=>{const r=W(()=>{const i=e.states[t];if(!i)return{player:{entity_id:t,state:"unavailable",attributes:{},title:"Unavailable",subtitle:`${t} unavailable`}};const{title:s,subtitle:o}=Kg(i);return{player:{...i,title:s,subtitle:o}}},[e.states,t]);return m(su.Provider,{value:r,children:n})},Le=()=>{const e=le(su);if(!e)throw new Error("useHass must be used within a HassContextProvider");return e.player},ou=({ma_entity_id:e,ma_favorite_button_entity_id:n,...t})=>{const r=Le(),i=W(()=>hi(r),[r]),s=D(()=>{n&&X().callService("button","press",{entity_id:n})},[n]),o=D(c=>{e&&Em(e,c)},[e]),a=W(()=>{if(!e||!i)return[];const c=Om().filter(u=>u.entity_id!==e&&hi(u)&&u.state!=="unavailable"),l=[];return n&&l.push({label:"Mark as Favorite",icon:"mdi:heart-plus",onClick:s}),c.length>0&&l.push({label:"Transfer Queue",icon:"mdi:transfer",children:c.map(u=>({label:u.attributes.friendly_name||u.entity_id,onClick:()=>o(u.entity_id)}))}),l},[n,s,o]);return a.length===0?null:m(Ug,{menuItems:a,...t})},Wg=(e,n)=>{const[t,r]=P(null),[i,s]=P(null),[o,a]=P(!1),c=Z(null);Q(()=>{X().callApi("GET","config/config_entries/entry").then(d=>{const f=d.filter(p=>p.domain==="music_assistant").find(p=>p.state==="loaded");f&&r(f.entry_id)})},[]),Q(()=>{if(e===""||!t)return;const u=e+(n??"all");c.current=u;const d={type:"call_service",domain:"music_assistant",service:"search",service_data:{name:e,config_entry_id:t,media_type:n==="all"?void 0:n,limit:n==="all"?8:100},return_response:!0},h=X();a(!0),h.connection.sendMessagePromise(d).then(f=>{if(u!==c.current)return;const p=f;p.response&&(a(!1),s(p.response))})},[e,t,n]);const l=D(async(u,d,h)=>X().callService("music_assistant","play_media",{entity_id:d,media_type:u.media_type,media_id:u.uri,enqueue:h}),[]);return W(()=>({results:i,loading:o,playItem:l}),[i,o])},Hg=[{type:"all",label:"All",icon:"mdi:all-inclusive"},{type:"artist",label:"Artists",icon:"mdi:account-music"},{type:"album",label:"Albums",icon:"mdi:album"},{type:"track",label:"Tracks",icon:"mdi:music-note"},{type:"playlist",label:"Playlists",icon:"mdi:playlist-music"},{type:"radio",label:"Radio",icon:"mdi:radio"},{type:"audiobook",label:"Audiobooks",icon:"mdi:book"},{type:"podcast",label:"Podcasts",icon:"mdi:podcast"}],au={artists:"artist",albums:"album",tracks:"track",playlists:"playlist",radio:"radio",audiobooks:"audiobook",podcasts:"podcast"},Gg={artist:"Artists",album:"Albums",track:"Tracks",playlist:"Playlists",radio:"Radio",audiobook:"Audiobooks",podcast:"Podcasts"},Jg=(e,n)=>{const[t,r]=P(null),[i,s]=P(),[o,a]=P(!1);return Q(()=>{X().callApi("GET","config/config_entries/entry").then(l=>{const d=l.filter(h=>h.domain==="music_assistant").find(h=>h.state==="loaded");d&&r(d.entry_id)})},[]),Q(()=>{if(!t||!n){s(null);return}a(!0);const c={artists:[],albums:[],tracks:[],playlists:[],radio:[],podcasts:[],audiobooks:[]},l=async u=>{const d={type:"call_service",domain:"music_assistant",service:"get_library",service_data:{config_entry_id:t,media_type:u,favorite:!0,limit:e==="all"?8:20},return_response:!0},h=X();try{const p=await h.connection.sendMessagePromise(d);if(!p.response)return;c[Yg[u]]=p.response.items??[]}catch(f){return console.error("Error fetching favorites:",u,f),Promise.reject(f)}};e==="all"?Promise.all(Object.values(au).map(u=>l(u))).then(()=>{a(!1),s(c)}):l(e).then(()=>{a(!1),s(c)})},[t,e]),W(()=>({favorites:i,loading:o}),[i,o])},Yg={artist:"artists",album:"albums",track:"tracks",playlist:"playlists",radio:"radio",audiobook:"audiobooks",podcast:"podcasts"},Zg=({onItemClick:e,onHeaderClick:n,loading:t=!1,error:r=null,results:i,...s})=>{const[o,a]=P(4),c=W(()=>{const u=[];if(!i)return u;const d=Object.entries(i).map(([h,f])=>({mediaType:au[h],items:f})).filter(h=>h.items.length>0);return d.forEach(({mediaType:h,items:f})=>{if(f.length!==0)if(d.length>1&&u.push({type:"header",mediaType:h}),f[0].media_type==="track")f.forEach(p=>{u.push({type:"item",item:p})});else for(let p=0;p<f.length;p+=o){const g=f.slice(p,p+o);u.push({type:"itemsRow",items:g})}}),u},[i,o]),l=u=>{var d;switch(u.type){case"header":return m(kc,{onClick:()=>n==null?void 0:n(u.mediaType),children:Gg[u.mediaType]});case"item":{const{item:h}=u,f=async()=>{await e(h)};return m(gi,{numberOfColumns:o,children:h.media_type==="track"?m(vi,{imageUrl:h.image??((d=h.album)==null?void 0:d.image),title:h.name,artist:h.artists.map(p=>p.name).join(", "),onClick:f},h.uri):m(bi,{imageUrl:h.image,name:h.name,artist:"artists"in h?h.artists.map(p=>p.name).join(", "):void 0,onClick:f},h.uri)})}case"itemsRow":return m(gi,{numberOfColumns:o,children:u.items.map(h=>{var p;const f=async()=>{await e(h)};return h.media_type==="track"?m(vi,{imageUrl:h.image??((p=h.album)==null?void 0:p.image),title:h.name,artist:h.artists.map(g=>g.name).join(", "),onClick:f},h.uri):m(bi,{imageUrl:h.image,name:h.name,artist:"artists"in h?h.artists.map(g=>g.name).join(", "):void 0,onClick:f},h.uri)})});default:return null}};return t?m(_r,{}):r?m("p",{css:Ne.mediaEmptyText,children:r}):m(Nc,{onLayout:({width:u})=>{u<390?a(3):a(4)},data:c,renderItem:l,renderEmpty:()=>m("p",{css:Ne.mediaEmptyText,children:"No items found."}),...s})},lu=({maEntityId:e,horizontalPadding:n,searchBarPosition:t="top",maxHeight:r=300})=>{const[i,s]=P(""),[o,a]=P("play"),c=xc(i,600),[l,u]=P("all"),d=D(()=>{const v=["play","replace","next","replace_next","add"],k=(v.indexOf(o)+1)%v.length;a(v[k])},[o]),{results:h,loading:f,playItem:p}=Wg(c,l),{favorites:g}=Jg(l,i===""),b=()=>O("div",{css:Ne.searchBarContainer,children:[m(ru,{placeholder:"Search..",onChange:s,value:i,loading:f,css:Ne.searchInput}),O("div",{css:Ne.filterContainer,children:[m(on,{css:Ne.chip,style:{"--mmpc-chip-horizontal-margin":`${n}px`},icon:Xg(o),onClick:d,children:Qg(o)}),m("div",{css:Ne.verticalChipSeperator}),_()]})]}),_=()=>Hg.map(v=>m(on,{css:Ne.chip,style:{"--mmpc-chip-horizontal-margin":`${n}px`,opacity:l===v.type?1:.6,fontWeight:l===v.type?"bold":"normal"},onClick:()=>u(v.type),icon:v.icon,children:v.label},v.type));return O("div",{css:Ne.root,style:{"--mmpc-search-padding":`${n}px`},children:[m(Zg,{renderHeader:t==="top"?b:void 0,results:i!==""&&h?h:g||void 0,onItemClick:v=>p(v,e,o),style:{"--mmpc-search-padding":`${n}px`},maxHeight:r,onHeaderClick:u}),t==="bottom"&&b()]})},Xg=e=>{switch(e){case"play":return"mdi:play-circle";case"replace":return"mdi:playlist-remove";case"next":return"mdi:playlist-play";case"replace_next":return"mdi:playlist-edit";case"add":return"mdi:playlist-plus";default:return"mdi:play-circle"}},Qg=e=>{switch(e){case"play":return"Play now";case"replace":return"Replace queue";case"next":return"Add next";case"replace_next":return"Replace next";case"add":return"Add to queue";default:return"Play"}},ey={root:w({display:"contents","--mmpc-chip-background":"var(--card-background-color)","--mmpc-chip-foreground":"var(--primary-text-color)"})},ty=()=>{const{config:e}=le(Ve);return m("div",{css:ey.root,children:m(uo,{config:{entity_id:e.entity_id,speaker_group:{entities:e.entities}},showGrouped:!0})})};function Dn({actionConfig:e,rootElement:n,overrideCallback:t}){const r=W(()=>({onTap:e!=null&&e.tap_action?()=>ao(n,e,"tap",X()):void 0,onLongPress:e!=null&&e.hold_action?()=>ao(n,e,"hold",X()):void 0,onDoubleTap:e!=null&&e.double_tap_action?()=>ao(n,e,"double_tap",X()):void 0,...t??{}}),[e,t]),i=Cy(r);return W(()=>i,[i])}class ny{constructor(n,t){this.pixels=n,this.opts=t;const{sigBits:r}=t,i=(k,x,$)=>(k<<2*r)+(x<<r)+$;this.getColorIndex=i;const s=8-r,o=1<<3*r,a=new Uint32Array(o);let c,l,u,d,h,f,p,g,b,_;c=u=h=0,l=d=f=Number.MAX_VALUE;const v=n.length/4;let S=0;for(;S<v;){const k=S*4;if(S++,p=n[k+0],g=n[k+1],b=n[k+2],_=n[k+3],_===0)continue;p=p>>s,g=g>>s,b=b>>s;const x=i(p,g,b);a[x]===void 0&&(a[x]=0),a[x]+=1,p>c&&(c=p),p<l&&(l=p),g>u&&(u=g),g<d&&(d=g),b>h&&(h=b),b<f&&(f=b)}this._colorCount=a.reduce((k,x)=>x>0?k+1:k,0),this.hist=a,this.rmax=c,this.rmin=l,this.gmax=u,this.gmin=d,this.bmax=h,this.bmin=f}get colorCount(){return this._colorCount}}class ry{scaleDown(n){const t=this.getWidth(),r=this.getHeight();let i=1;if(n.maxDimension>0){const s=Math.max(t,r);s>n.maxDimension&&(i=n.maxDimension/s)}else i=1/n.quality;i<1&&this.resize(t*i,r*i,i)}}function iy(e,n){var t;if(n.length>0){const r=e.data,i=r.length/4;let s,o,a,c,l;for(let u=0;u<i;u++){s=u*4,o=r[s+0],a=r[s+1],c=r[s+2],l=r[s+3];for(let d=0;d<n.length;d++)if(!((t=n[d])!=null&&t.call(n,o,a,c,l))){r[s+3]=0;break}}}return e}function sy(e){const n=new URL(e,location.href);return n.protocol===location.protocol&&n.host===location.host&&n.port===location.port}function oy(e,n){const t=new URL(e),r=new URL(n);return t.protocol===r.protocol&&t.hostname===r.hostname&&t.port===r.port}class ay extends ry{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const n=this.image;if(!n)throw new Error("Image is not initialized");const t=this._canvas=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new ReferenceError("Failed to create canvas context");this._context=r,t.className="@vibrant/canvas",t.style.display="none",this._width=t.width=n.width,this._height=t.height=n.height,r.drawImage(n,0,0),document.body.appendChild(t)}load(n){let t,r;if(typeof n=="string")t=document.createElement("img"),r=n,!sy(r)&&!oy(window.location.href,r)&&(t.crossOrigin="anonymous"),t.src=r;else if(n instanceof HTMLImageElement)t=n,r=n.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=t,new Promise((i,s)=>{const o=()=>{this._initCanvas(),i(this)};t.complete?o():(t.onload=o,t.onerror=a=>s(new Error(`Fail to load image: ${r}`)))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(n){this._getContext().putImageData(n,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(n,t,r){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=n,this._height=this._getCanvas().height=t,this._getContext().scale(r,r),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function Cr(e,...n){return n.forEach(t=>{if(t){for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];Array.isArray(i)?e[r]=i.slice(0):typeof i=="object"?(e[r]||(e[r]={}),Cr(e[r],i)):e[r]=i}}}),e}function ly(e,n){const{colorCount:t,quantizer:r,generators:i,filters:s}=e,o={colorCount:t},a=typeof r=="string"?{name:r,options:{}}:r;return a.options=Cr({},o,a.options),Cr({},{quantizer:a,generators:i,filters:s},n)}class cy{constructor(n,t={}){this._src=n,this._opts=Cr({},jt.DefaultOpts,t)}maxColorCount(n){return this._opts.colorCount=n,this}maxDimension(n){return this._opts.maxDimension=n,this}addFilter(n){return this._opts.filters?this._opts.filters.push(n):this._opts.filters=[n],this}removeFilter(n){if(this._opts.filters){const t=this._opts.filters.indexOf(n);t>0&&this._opts.filters.splice(t)}return this}clearFilters(){return this._opts.filters=[],this}quality(n){return this._opts.quality=n,this}useImageClass(n){return this._opts.ImageClass=n,this}useGenerator(n,t){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(t?{name:n,options:t}:n),this}useQuantizer(n,t){return this._opts.quantizer=t?{name:n,options:t}:n,this}build(){return new jt(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class wo{constructor(n){this.pipeline=n,this._map={}}names(){return Object.keys(this._map)}has(n){return!!this._map[n]}get(n){return this._map[n]}register(n,t){return this._map[n]=t,this.pipeline}}class uy{constructor(){this.filter=new wo(this),this.quantizer=new wo(this),this.generator=new wo(this)}_buildProcessTasks({filters:n,quantizer:t,generators:r}){return r.length===1&&r[0]==="*"&&(r=this.generator.names()),{filters:n.map(s=>i(this.filter,s)),quantizer:i(this.quantizer,t),generators:r.map(s=>i(this.generator,s))};function i(s,o){let a,c;return typeof o=="string"?a=o:(a=o.name,c=o.options),{name:a,fn:s.get(a),options:c}}}async process(n,t){const{filters:r,quantizer:i,generators:s}=this._buildProcessTasks(t),o=await this._filterColors(r,n),a=await this._generateColors(i,o),c=await this._generatePalettes(s,a);return{colors:a,palettes:c}}_filterColors(n,t){return Promise.resolve(iy(t,n.map(({fn:r})=>r)))}_generateColors(n,t){return Promise.resolve(n.fn(t.data,n.options))}async _generatePalettes(n,t){const r=await Promise.all(n.map(({fn:i,options:s})=>Promise.resolve(i(t,s))));return Promise.resolve(r.reduce((i,s,o)=>(i[n[o].name]=s,i),{}))}}function dy(e,n,t){return"#"+((1<<24)+(e<<16)+(n<<8)+t).toString(16).slice(1,7)}function hy(e,n,t){e/=255,n/=255,t/=255;const r=Math.max(e,n,t),i=Math.min(e,n,t);let s=0,o=0;const a=(r+i)/2;if(r!==i){const c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case e:s=(n-t)/c+(n<t?6:0);break;case n:s=(t-e)/c+2;break;case t:s=(e-n)/c+4;break}s/=6}return[s,o,a]}function Pt(e,n,t){let r,i,s;function o(a,c,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?a+(c-a)*6*l:l<1/2?c:l<2/3?a+(c-a)*(2/3-l)*6:a}if(n===0)r=i=s=t;else{const a=t<.5?t*(1+n):t+n-t*n,c=2*t-a;r=o(c,a,e+1/3),i=o(c,a,e),s=o(c,a,e-1/3)}return[r*255,i*255,s*255]}class at{static applyFilters(n,t){return t.length>0?n.filter(({r,g:i,b:s})=>{var o;for(let a=0;a<t.length;a++)if(!((o=t[a])!=null&&o.call(t,r,i,s,255)))return!1;return!0}):n}static clone(n){return new at(n._rgb,n._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[n,t,r]=this._rgb;this._hsl=hy(n,t,r)}return this._hsl}get hex(){if(!this._hex){const[n,t,r]=this._rgb;this._hex=dy(n,t,r)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const n=this._rgb;this._yiq=(n[0]*299+n[1]*587+n[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(n,t){this._rgb=n,this._population=t}}const cu=class Ba{constructor(n,t){this._src=n,this.opts=Cr({},Ba.DefaultOpts,t)}static use(n){this._pipeline=n}static from(n){return new cy(n)}get result(){return this._result}_process(n,t){n.scaleDown(this.opts);const r=ly(this.opts,t);return Ba._pipeline.process(n.getImageData(),r)}async getPalette(){const n=new this.opts.ImageClass;try{const t=await n.load(this._src),r=await this._process(t,{generators:["default"]});this._result=r;const i=r.palettes.default;if(!i)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return n.remove(),i}catch(t){return n.remove(),Promise.reject(t)}}async getPalettes(){const n=new this.opts.ImageClass;try{const t=await n.load(this._src),r=await this._process(t,{generators:["*"]});this._result=r;const i=r.palettes;return n.remove(),i}catch(t){return n.remove(),Promise.reject(t)}}};cu.DefaultOpts={colorCount:64,quality:5,filters:[]};let jt=cu;jt.DefaultOpts.quantizer="mmcq",jt.DefaultOpts.generators=["default"],jt.DefaultOpts.filters=["default"],jt.DefaultOpts.ImageClass=ay;const So=5,ko=8-So;class $i{constructor(n,t,r,i,s,o,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:n,r2:t,g1:r,g2:i,b1:s,b2:o}}static build(n){const t=new ny(n,{sigBits:So}),{rmin:r,rmax:i,gmin:s,gmax:o,bmin:a,bmax:c}=t;return new $i(r,i,s,o,a,c,t)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:n,r2:t,g1:r,g2:i,b1:s,b2:o}=this.dimension;this._volume=(t-n+1)*(i-r+1)*(o-s+1)}return this._volume}count(){if(this._count<0){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension;let l=0;for(let u=r;u<=i;u++)for(let d=s;d<=o;d++)for(let h=a;h<=c;h++){const f=t(u,d,h);n[f]&&(l+=n[f])}this._count=l}return this._count}clone(){const{histogram:n}=this,{r1:t,r2:r,g1:i,g2:s,b1:o,b2:a}=this.dimension;return new $i(t,r,i,s,o,a,n)}avg(){if(!this._avg){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension;let l=0;const u=1<<8-So;let d,h,f;d=h=f=0;for(let p=r;p<=i;p++)for(let g=s;g<=o;g++)for(let b=a;b<=c;b++){const _=t(p,g,b),v=n[_];v&&(l+=v,d+=v*(p+.5)*u,h+=v*(g+.5)*u,f+=v*(b+.5)*u)}l?this._avg=[~~(d/l),~~(h/l),~~(f/l)]:this._avg=[~~(u*(r+i+1)/2),~~(u*(s+o+1)/2),~~(u*(a+c+1)/2)]}return this._avg}contains(n){let[t,r,i]=n;const{r1:s,r2:o,g1:a,g2:c,b1:l,b2:u}=this.dimension;return t>>=ko,r>>=ko,i>>=ko,t>=s&&t<=o&&r>=a&&r<=c&&i>=l&&i<=u}split(){const{hist:n,getColorIndex:t}=this.histogram,{r1:r,r2:i,g1:s,g2:o,b1:a,b2:c}=this.dimension,l=this.count();if(!l)return[];if(l===1)return[this.clone()];const u=i-r+1,d=o-s+1,h=c-a+1,f=Math.max(u,d,h);let p=null,g,b;g=b=0;let _=null;if(f===u){_="r",p=new Uint32Array(i+1);for(let $=r;$<=i;$++){g=0;for(let M=s;M<=o;M++)for(let E=a;E<=c;E++){const C=t($,M,E);n[C]&&(g+=n[C])}b+=g,p[$]=b}}else if(f===d){_="g",p=new Uint32Array(o+1);for(let $=s;$<=o;$++){g=0;for(let M=r;M<=i;M++)for(let E=a;E<=c;E++){const C=t(M,$,E);n[C]&&(g+=n[C])}b+=g,p[$]=b}}else{_="b",p=new Uint32Array(c+1);for(let $=a;$<=c;$++){g=0;for(let M=r;M<=i;M++)for(let E=s;E<=o;E++){const C=t(M,E,$);n[C]&&(g+=n[C])}b+=g,p[$]=b}}let v=-1;const S=new Uint32Array(p.length);for(let $=0;$<p.length;$++){const M=p[$];M&&(v<0&&M>b/2&&(v=$),S[$]=b-M)}const k=this;function x($){const M=$+"1",E=$+"2",C=k.dimension[M];let N=k.dimension[E];const R=k.clone(),F=k.clone(),z=v-C,U=N-v;for(z<=U?(N=Math.min(N-1,~~(v+U/2)),N=Math.max(0,N)):(N=Math.max(C,~~(v-1-z/2)),N=Math.min(k.dimension[E],N));!p[N];)N++;let Y=S[N];for(;!Y&&p[N-1];)Y=S[--N];return R.dimension[E]=N,F.dimension[M]=N+1,[R,F]}return x(_)}}class uu{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(n){this._comparator=n,this.contents=[],this._sorted=!1}push(n){this.contents.push(n),this._sorted=!1}peek(n){return this._sort(),n=typeof n=="number"?n:this.contents.length-1,this.contents[n]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(n){return this._sort(),this.contents.map(n)}}const fy=.75;function du(e,n){let t=e.size();for(;e.size()<n;){const r=e.pop();if(r&&r.count()>0){const[i,s]=r.split();if(!i||(e.push(i),s&&s.count()>0&&e.push(s),e.size()===t))break;t=e.size()}else break}}const py=(e,n)=>{if(e.length===0||n.colorCount<2||n.colorCount>256)throw new Error("Wrong MMCQ parameters");const t=$i.build(e);t.histogram.colorCount;const r=new uu((s,o)=>s.count()-o.count());r.push(t),du(r,fy*n.colorCount);const i=new uu((s,o)=>s.count()*s.volume()-o.count()*o.volume());return i.contents=r.contents,du(i,n.colorCount-i.size()),my(i)};function my(e){const n=[];for(;e.size();){const t=e.pop(),r=t.avg();n.push(new at(r,t.count()))}return n}const gy={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function yy(e){let n=0;return e.forEach(t=>{n=Math.max(n,t.population)}),n}function by(e,n){return e.Vibrant===n||e.DarkVibrant===n||e.LightVibrant===n||e.Muted===n||e.DarkMuted===n||e.LightMuted===n}function vy(e,n,t,r,i,s,o){function a(...l){let u=0,d=0;for(let h=0;h<l.length;h+=2){const f=l[h],p=l[h+1];!f||!p||(u+=f*p,d+=p)}return u/d}function c(l,u){return 1-Math.abs(l-u)}return a(c(e,n),o.weightSaturation,c(t,r),o.weightLuma,i/s,o.weightPopulation)}function Tn(e,n,t,r,i,s,o,a,c,l){let u=null,d=0;return n.forEach(h=>{const[,f,p]=h.hsl;if(f>=a&&f<=c&&p>=i&&p<=s&&!by(e,h)){const g=vy(f,o,p,r,h.population,t,l);(u===null||g>d)&&(u=h,d=g)}}),u}function _y(e,n,t){const r={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return r.Vibrant=Tn(r,e,n,t.targetNormalLuma,t.minNormalLuma,t.maxNormalLuma,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.LightVibrant=Tn(r,e,n,t.targetLightLuma,t.minLightLuma,1,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.DarkVibrant=Tn(r,e,n,t.targetDarkLuma,0,t.maxDarkLuma,t.targetVibrantSaturation,t.minVibrantSaturation,1,t),r.Muted=Tn(r,e,n,t.targetNormalLuma,t.minNormalLuma,t.maxNormalLuma,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r.LightMuted=Tn(r,e,n,t.targetLightLuma,t.minLightLuma,1,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r.DarkMuted=Tn(r,e,n,t.targetDarkLuma,0,t.maxDarkLuma,t.targetMutesSaturation,0,t.maxMutesSaturation,t),r}function xy(e,n,t){if(!e.Vibrant&&!e.DarkVibrant&&!e.LightVibrant){if(!e.DarkVibrant&&e.DarkMuted){let[r,i,s]=e.DarkMuted.hsl;s=t.targetDarkLuma,e.DarkVibrant=new at(Pt(r,i,s),0)}if(!e.LightVibrant&&e.LightMuted){let[r,i,s]=e.LightMuted.hsl;s=t.targetDarkLuma,e.DarkVibrant=new at(Pt(r,i,s),0)}}if(!e.Vibrant&&e.DarkVibrant){let[r,i,s]=e.DarkVibrant.hsl;s=t.targetNormalLuma,e.Vibrant=new at(Pt(r,i,s),0)}else if(!e.Vibrant&&e.LightVibrant){let[r,i,s]=e.LightVibrant.hsl;s=t.targetNormalLuma,e.Vibrant=new at(Pt(r,i,s),0)}if(!e.DarkVibrant&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetDarkLuma,e.DarkVibrant=new at(Pt(r,i,s),0)}if(!e.LightVibrant&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetLightLuma,e.LightVibrant=new at(Pt(r,i,s),0)}if(!e.Muted&&e.Vibrant){let[r,i,s]=e.Vibrant.hsl;s=t.targetMutesSaturation,e.Muted=new at(Pt(r,i,s),0)}if(!e.DarkMuted&&e.DarkVibrant){let[r,i,s]=e.DarkVibrant.hsl;s=t.targetMutesSaturation,e.DarkMuted=new at(Pt(r,i,s),0)}if(!e.LightMuted&&e.LightVibrant){let[r,i,s]=e.LightVibrant.hsl;s=t.targetMutesSaturation,e.LightMuted=new at(Pt(r,i,s),0)}}const wy=(e,n)=>{n=Object.assign({},gy,n);const t=yy(e),r=_y(e,t,n);return xy(r,t,n),r},Sy=new uy().filter.register("default",(e,n,t,r)=>r>=125&&!(e>250&&n>250&&t>250)).quantizer.register("mmcq",py).generator.register("default",wy);jt.use(Sy);const $o=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;function hu(){const{attributes:{entity_picture:e,entity_picture_local:n}}=Le(),t=n||e,[r,i]=P(null),[s,o]=P($o()),a=D(()=>{t&&jt.from(t).getPalette().then(i).catch(u=>{console.error("Error getting color with Vibrant:",u)})},[t]);Q(()=>{i(null),t&&a()},[t]),Q(()=>{const u=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>o($o());if(o($o()),u.addEventListener)return u.addEventListener("change",d),()=>u.removeEventListener("change",d)},[]);const c=W(()=>{if(s||!r)return null;const u=r.Vibrant??r.Muted;if(!u)return null;const d={...Ci(u.hsl),l:50},h=Wt(d),f={...d,s:4.35,l:95.49},p={...Wt(f),l:15.29},g={...f,l:f.l*.98},b=Wt(g),_={...f,l:f.l*1.1},v=Wt(_);return{artVars:{"--art-color":`${J(Ci(u.hsl))}`,"--art-on-art-color":`${u.titleTextColor}`,"--art-primary-color":`${J(d)}`,"--art-on-primary-color":`${J(h)}`,"--art-surface-color":`${J(f)}`,"--art-on-surface-color":`${J(p)}`,"--art-surface-higher-color":`${J(g)}`,"--art-on-surface-higher-color":`${J(b)}`,"--art-surface-lower-color":`${J(_)}`,"--art-on-surface-lower-color":`${J(v)}`},haVars:{"--primary-color":`${J(d)}`,"--ha-card-background":`${J(f)}`,"--card-background-color":`${J(g)}`,"--primary-text-color":`${J(p)}`,"--secondary-text-color":`${J({...p,l:p.l*1.1})}`,"--icon-primary-color":`${J(p)}`,"--divider-color":`${J({...f,l:88})}`,"--clear-background-color":`${J({...f,l:100})}`,"--secondary-background-color":`${J({...p,l:95})}`}}},[r,s]),l=W(()=>{if(!s||!r)return null;const u=r.Vibrant??r.Muted;if(!u)return null;const d={...Ci(u.hsl),l:50},h=Wt(d),f={...d,s:2.91,l:20.2},p={...Wt(f),l:86.47},g={...f,l:f.l*1.02},b=Wt(g),_={...f,l:f.l*.98},v=Wt(_);return{artVars:{"--art-color":`${J(Ci(u.hsl))}`,"--art-on-art-color":`${u.titleTextColor}`,"--art-primary-color":`${J(d)}`,"--art-on-primary-color":`${J(h)}`,"--art-surface-color":`${J(f)}`,"--art-on-surface-color":`${J(p)}`,"--art-surface-higher-color":`${J(g)}`,"--art-on-surface-higher-color":`${J(b)}`,"--art-surface-lower-color":`${J(_)}`,"--art-on-surface-lower-color":`${J(v)}`},haVars:{"--primary-color":`${J(d)}`,"--ha-card-background":`${J(f)}`,"--card-background-color":`${J(g)}`,"--primary-text-color":`${J(p)}`,"--secondary-text-color":`${J({...p,l:p.l*.9})}`,"--icon-primary-color":`${J(p)}`,"--divider-color":`${J({...f,l:25})}`,"--clear-background-color":`${J({...f,l:0})}`,"--secondary-background-color":`${J({...p,l:19})}`}}},[r,s]);return W(()=>({artVars:s?l==null?void 0:l.artVars:c==null?void 0:c.artVars,haVars:s?l==null?void 0:l.haVars:c==null?void 0:c.haVars}),[l,c])}const Ci=e=>{const n=Math.round(e[0]*360),t=Math.round(e[1]*100),r=Math.round(e[2]*100);return{h:n,s:t,l:r}},Wt=({h:e,s:n,l:t})=>({h:(e+180)%360,s:n,l:t}),J=({h:e,s:n,l:t,a:r})=>`hsla(${e}deg, ${n}%, ${t}%, ${r||1})`,ky="ontouchstart"in window,$y={longPressIndicator:w({position:"fixed",width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"var(--primary-color, rgba(7, 114, 244))",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:9,animation:"pulse 1s infinite",transform:"translate(-50%, -50%)","@keyframes pulse":{"0%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6},"50%":{transform:"translate(-50%, -50%) scale(1)",opacity:.8},"100%":{transform:"translate(-50%, -50%) scale(0.95)",opacity:.6}}})};function Cy({onTap:e,onLongPress:n,onDoubleTap:t}){const r=Z(null),i=Z(0),s=Z(null),o=Z(null),[a,c]=P(!1),[l,u]=P(!1),[d,h]=P({x:0,y:0}),f=D(()=>{s.current&&clearTimeout(s.current),o.current&&clearTimeout(o.current),u(!1),r.current=null,i.current=0},[]),p=()=>l?m("div",{css:$y.longPressIndicator,style:{left:`${d.x}px`,top:`${d.y}px`}}):null,g=D(()=>{const E=Date.now();return!!(r.current&&E-r.current>=500)},[]),b=D((E,C)=>{h({x:E,y:C})},[]),_=D((E,C)=>{r.current=Date.now(),b(E,C),o.current=setTimeout(()=>{u(!0)},500)},[b]),v=D((E,C)=>{l&&b(E,C)},[l,b]),S=D(()=>{s.current&&clearTimeout(s.current),o.current&&(clearTimeout(o.current),u(!1)),i.current+=1,s.current=setTimeout(async()=>{c(!0);try{i.current>1?await(t==null?void 0:t()):g()?await(n==null?void 0:n()):await(e==null?void 0:e())}catch(E){console.error("Error in button callback:",E)}c(!1),r.current=null,i.current=0},250)},[g,t,n,e]),k=D(E=>{_(E.clientX,E.clientY)},[_]),x=D(E=>{v(E.clientX,E.clientY)},[v]),$=D(E=>{if(E.touches.length>0){const C=E.touches[0];_(C.clientX,C.clientY)}},[_]),M=D(E=>{if(E.touches.length>0){const C=E.touches[0];v(C.clientX,C.clientY)}},[v]);return W(()=>({...ky?{onTouchStart:$,onTouchMove:M,onTouchEnd:S,onTouchCancel:f,loading:a}:{onMouseDown:k,onMouseMove:x,onMouseUp:S,onMouseOut:f,loading:a},renderLongPressIndicator:p}),[k,x,S,f,$,M,p])}function My(e,n){const{shuffle:t,repeat:r,source:i,supported_features:s}=n,o=e==="off",a=!o&&s!==void 0&&(s|16)===s,c=!o&&s!==void 0&&(s|32)===s,l=!o&&t!==void 0&&!["optical","aux"].includes((i==null?void 0:i.toLowerCase())||"")&&s!==void 0&&(s&32768)===32768,u=!o&&r!==void 0&&!["optical","aux"].includes((i==null?void 0:i.toLowerCase())||"")&&s!==void 0&&(s&262144)===262144,d=!o&&s!==void 0&&((s&4096)===4096||(s&16384)===16384);return{supportPreviousTrack:a,supportNextTrack:c,supportsShuffle:l,supportsRepeat:u,supportsTogglePlayPause:d}}function Co(){const{attributes:e,state:n}=Le(),t=My(n,e);return W(()=>t,[t.supportPreviousTrack,t.supportNextTrack,t.supportsShuffle,t.supportsRepeat,t.supportsTogglePlayPause])}const fu={root:w({display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:"2px",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"}}),chip:w({"&:first-child":{marginLeft:"16px"},"&:last-child":{marginRight:"16px"}})},Ey=()=>{const{config:e}=le(Ve),{custom_buttons:n}=e;return m("div",{css:fu.root,children:n==null?void 0:n.map((t,r)=>m(Oy,{button:t},r))})},Oy=({button:e})=>{const{rootElement:n,config:t}=le(Ve),{icon:r,name:i,...s}=e,o=Dn({rootElement:n,actionConfig:{...s,entity:t.entity_id}});return O(on,{css:fu.chip,icon:r,...o,children:[!!i&&m("span",{children:i}),o.renderLongPressIndicator()]})},Iy={root:w({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around",width:"100%",paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)"})},Ay=()=>{const{config:e}=le(Ve),{attributes:{shuffle:n,repeat:t},state:r}=Le(),i=r==="playing",{supportPreviousTrack:s,supportNextTrack:o,supportsShuffle:a,supportsRepeat:c,supportsTogglePlayPause:l}=Co(),u=D(()=>{X().callService("media_player","media_play_pause",{entity_id:e.entity_id})},[]),d=D(()=>{X().callService("media_player","media_next_track",{entity_id:e.entity_id})},[]),h=D(()=>{X().callService("media_player","media_previous_track",{entity_id:e.entity_id})},[]),f=D(()=>{X().callService("media_player","shuffle_set",{entity_id:e.entity_id,shuffle:!n})},[n]),p=D(()=>{const g=t==="off"?"one":t==="one"?"all":"off";X().callService("media_player","repeat_set",{entity_id:e.entity_id,repeat:g})},[t]);return O("div",{css:Iy.root,children:[a&&m(G,{size:"small",onClick:f,icon:n?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),s&&m(G,{size:"large",onClick:h,icon:"mdi:skip-previous"}),l&&m(G,{size:"x-large",onClick:u,icon:i?"mdi:pause-circle":"mdi:play-circle"}),o&&m(G,{size:"large",onClick:d,icon:"mdi:skip-next"}),c&&m(G,{size:"small",onClick:p,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},pu={root:w({display:"flex",alignItems:"center",flex:1,maxHeight:"36px",marginTop:"auto",gap:"8px"}),buttonMuted:w({opacity:.8})},Ny=()=>{var a,c;const e=Le(),n=e.entity_id,t=((a=e.attributes)==null?void 0:a.volume_level)??0,r=((c=e.attributes)==null?void 0:c.is_volume_muted)??!1,i=D(l=>{X().callService("media_player","volume_set",{entity_id:n,volume_level:l})},[]),s=D(()=>{X().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!r})},[r]),o=W(()=>br(t,r),[t,r]);return O("div",{css:pu.root,children:[m(G,{css:r?pu.buttonMuted:{},size:"small",onClick:s,icon:o}),m(Va,{min:0,max:1,step:.01,value:t,sliderSize:"large",onChange:i})]})},Ry=({onClick:e})=>{var s,o;const n=Le(),t=((s=n.attributes)==null?void 0:s.volume_level)??0,r=((o=n.attributes)==null?void 0:o.is_volume_muted)??!1,i=br(t,r);return m(G,{size:"small",onClick:e,icon:i})},Mi={root:w({display:"flex",flexDirection:"column",gap:"18px"}),speakerList:w({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),syncContainer:w({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",opacity:.8,position:"absolute",right:"56px",top:"12px"}),syncText:w({fontSize:"12px"})},Py=()=>{var c,l;const e=An(),{config:n}=le(Ve),{entity_id:t,speaker_group:r}=n,[i,s]=P(!0),o=(r==null?void 0:r.entity_id)||t,a=e.states[o];return O("div",{css:Mi.root,children:[((l=(c=a==null?void 0:a.attributes)==null?void 0:c.group_members)==null?void 0:l.length)>1&&O("div",{children:[O("div",{css:Mi.syncContainer,children:[m("span",{css:Mi.syncText,onClick:()=>s(!i),children:"Link Volume"}),m(G,{icon:i?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>s(!i)})]}),m("div",{css:Mi.speakerList,children:m(_c,{config:{entity_id:t,speaker_group:r},syncMainSpeaker:i})})]}),m(uo,{config:{entity_id:t,speaker_group:r},showGrouped:!1,layout:{horizontalMargin:16}})]})},Dy=En`
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`,Ei={root:w({backgroundColor:"var(--mmpc-surface-higher)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderRadius:"12px",padding:"12px",width:"100%",position:"relative",boxSizing:"border-box",boxShadow:"0 15px 100px var(--clear-background-color)"}),modalRoot:w({position:"absolute",bottom:"calc(100% + 12px)",left:0,width:"100%",backgroundColor:"var(--mmpc-surface-higher)",borderRadius:"12px",boxSizing:"border-box",animation:`${Dy} 0.3s ease forwards`,boxShadow:"0 0px 80px var(--clear-background-color)"}),modalHeader:w({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",color:"var(--primary-text-color, #fff)",borderBottom:`0.5px solid ${de.colors.onCardDivider}`,"> h4":{margin:0}}),modalContent:w({display:"flex",flexDirection:"column",gap:"12px",maxHeight:"400px",overflowY:"auto",padding:"var(--mmpc-modal-padding, 16px)"})},Ty=()=>{const{config:e}=le(Ve),{entity_id:n,custom_buttons:t,speaker_group:r,ma_entity_id:i,search:s,ma_favorite_button_entity_id:o,options:{always_show_power_button:a}={}}=e,{state:c}=Le(),l=c!=="off"&&c!=="unavailable",d=i&&i.length>0||(s==null?void 0:s.enabled),[h,f]=P(),p=D(b=>{f(h===b?void 0:b)},[h]),g=D(()=>{X().callService("media_player","toggle",{entity_id:n})},[n]);return O("div",{css:Ei.root,children:[m(Oi,{title:"Volume",isOpen:h==="volume",onClose:()=>f(void 0),children:m(Ny,{})}),m(Oi,{title:"Speaker Grouping",isOpen:h==="speaker-grouping",onClose:()=>f(void 0),padding:"16px 0px 16px 0px",children:m(Py,{})}),m(Oi,{title:"Search",isOpen:h==="search",onClose:()=>f(void 0),padding:"16px 0px 16px 0px",children:i?m(lu,{maEntityId:i,horizontalPadding:16,searchBarPosition:"bottom"}):m(Rc,{entityId:(s==null?void 0:s.entity_id)??e.entity_id,showFavorites:(s==null?void 0:s.show_favorites)??!1,horizontalPadding:16,filterConfig:s==null?void 0:s.media_types,searchBarPosition:"bottom"})}),!!r&&m(G,{size:"small",icon:"mdi:speaker-multiple",onClick:()=>p("speaker-grouping")}),t&&t.length===1?m(Fy,{button:t[0]}):t&&t.length>1?O(xe,{children:[m(G,{size:"small",icon:"mdi:dots-horizontal",onClick:()=>p("custom-buttons")}),m(Oi,{title:"Shortcuts",isOpen:h==="custom-buttons",onClose:()=>f(void 0),padding:"16px 0px 16px 0px",children:m(Ey,{})})]}):null,i&&m(ou,{ma_entity_id:i??void 0,ma_favorite_button_entity_id:o??void 0,side:"top",align:"start",renderTrigger:b=>m(G,{icon:"mdi:bookshelf",size:"small",...b})}),d&&m(G,{size:"small",icon:"mdi:magnify",onClick:()=>f("search")}),(!l||a)&&m(G,{size:"x-small",onClick:g,icon:"mdi:power"}),m(Ry,{onClick:()=>p("volume")})]})},Oi=({children:e,title:n,isOpen:t,padding:r,onClose:i})=>t?O("div",{css:Ei.modalRoot,children:[O("div",{css:Ei.modalHeader,children:[m("h4",{children:n}),m(G,{type:"button",size:"small",icon:"mdi:close",onClick:i})]}),m("div",{css:Ei.modalContent,style:{"--mmpc-modal-padding":r??"16px"},children:e})]}):null,Fy=({button:e})=>{const{rootElement:n,config:t}=le(Ve),{icon:r,name:i,...s}=e,o=Dn({rootElement:n,actionConfig:{...s,entity:t.entity_id}});return m(G,{icon:e.icon??"mdi:dots-vertical",size:"small",...o})},Mo={root:w({display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",textAlign:"center",color:de.colors.onDialog,paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)","> h2, > h3":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"}}),titleH2:w({margin:0}),titleH3:w({margin:0,fontWeight:"normal",color:de.colors.onDialogMuted})},Vy=()=>{const{title:e,subtitle:n}=Le();return O("div",{css:Mo.root,children:[!!e&&m("h2",{css:Mo.titleH2,children:e}),!!n&&m("h3",{css:Mo.titleH3,children:n})]})},mu={root:w({paddingLeft:"var(--mmpc-extra-horizontal-padding, 0px)",paddingRight:"var(--mmpc-extra-horizontal-padding, 0px)"}),timeWrap:w({display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:"4px",color:de.colors.onDialogMuted,height:"20px",marginBottom:"-20px"})},Ly=()=>{const e=Le(),[n,t]=P(0),r=e.state==="playing";Q(()=>{if(!r)return;const s=setInterval(()=>{t(o=>o+1)},1e3);return()=>clearInterval(s)},[r]);const i=W(()=>{var f,p,g;const s=((f=e.attributes)==null?void 0:f.media_position)??null,o=((p=e.attributes)==null?void 0:p.media_position_updated_at)??null,a=((g=e.attributes)==null?void 0:g.media_duration)??null;if(s===null||s<0||a===null||o===null)return null;const c=new Date,l=new Date(o),d=(c.getTime()-l.getTime())/1e3+s,h=b=>{const _=Math.floor(b/60).toString().padStart(2,"0"),v=Math.round(b-Number(_)*60).toString().padStart(2,"0");return`${_}:${v}`};return{currentPosition:d,mediaDuration:a,prettyNow:h(d),prettyEnd:h(a)}},[e,n]);return i?O("div",{css:mu.root,children:[m(Yw,{value:i.currentPosition,min:0,max:i.mediaDuration}),O("div",{css:mu.timeWrap,children:[m("span",{children:i.prettyNow}),m("span",{children:i.prettyEnd})]})]}):null},Ht={root:w({display:"flex",justifyContent:"center",alignItems:"center","--mmpc-extra-horizontal-padding":"0px",boxSizing:"border-box","*":{boxSizing:"border-box"},"--mmpc-surface-higher":de.colors.card}),rootPanelMode:w({width:"100%",height:"100%",background:"linear-gradient(var(--app-header-background-color), rgba(255, 255, 255, 0))",maxHeight:"calc(100vh - var(--header-height, 16px))"}),rootPopupMode:w({"--mmpc-extra-horizontal-padding":"12px"}),wrap:w({display:"flex",flex:1,flexDirection:"column",gap:"16px",justifyContent:"space-around",alignItems:"center",paddingTop:"16px",paddingBottom:"16px",height:"100%"}),wrapPanelMode:w({width:"90%",maxWidth:"400px",padding:"16px"}),wrapPopupMode:w({maxWidth:"100%",padding:"16px",paddingBottom:"max(calc(env(safe-area-inset-bottom) + 8px), 16px)"}),wrapCardMode:w({width:"100%",padding:"16px"}),controlsWrapper:w({display:"flex",flexDirection:"column",maxHeight:"300px",minHeight:"280px",width:"100%",height:"100%",justifyContent:"space-between"})},gu=({className:e})=>{const{config:n,rootElement:t}=le(Ve),{mode:r,use_art_colors:i,action:s}=n,{artVars:o,haVars:a}=hu(),l=Dn({rootElement:t,actionConfig:{...s??{tap_action:{action:"more-info"}},entity:n.entity_id}}),u=()=>m("div",{className:e,css:[Ht.root,r==="panel"&&Ht.rootPanelMode,r==="popup"&&Ht.rootPopupMode],style:{...o??{},...a&&i?a:{}},children:O("div",{css:[Ht.wrap,r==="panel"&&Ht.wrapPanelMode,r==="card"&&Ht.wrapCardMode,r==="popup"&&Ht.wrapPopupMode],children:[m(hc,{iconSize:"x-large",borderRadius:8,...l}),O("div",{css:Ht.controlsWrapper,children:[m(Vy,{}),m(Ly,{}),m(Ay,{}),m(Ty,{})]})]})});return r==="card"?m("ha-card",{children:u()}):u()},Mr=e=>Array.isArray(e)?e:[e],zy=(e,n)=>{const t=[[],[]];for(const r of e)n(r)?t[0].push(r):t[1].push(r);return t},yu=Array,un=(e,n)=>e.includes(n),By=(e,n=0)=>[...new Array(e)].map((t,r)=>r+n),he=(e,n,t)=>e===void 0?n===void 0?[]:Array.isArray(n)?n:[n]:(Array.isArray(n)?e.push(...n):e.push(n),e),dn=(e,n)=>n==null?e??[]:e==null?Mr(n):e.concat(n),qy=(...e)=>e.reduce(dn,[]),hn=(e,n,t)=>{if(e===void 0)return Array.isArray(n)?n:[n];const r=(t==null?void 0:t.isEqual)??((i,s)=>i===s);for(const i of Mr(n))e.some(s=>r(s,i))||e.push(i);return e},Uy=(e,n)=>e.reduce((t,r)=>{const i=r[n];return t[i]=he(t[i],r),t},{}),Fn=(e,n,t)=>e.length===n.length&&e.every(t!=null&&t.isEqual?(r,i)=>t.isEqual(r,n[i]):(r,i)=>r===n[i]),fn=(e,n)=>yt(e)===n,yt=e=>{const n=typeof e;return n==="object"?e===null?"null":"object":n==="function"?"object":n},Dt={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},Ky={...Dt,function:"a function"};class jy extends Error{}const Ee=e=>Vn(e,jy),Vn=(e,n=Error)=>{throw new n(e)};class Wy extends Error{constructor(){super(...arguments);y(this,"name","ParseError")}}const I=e=>Vn(e,Wy),bu=e=>` ${e}`,fe=(e,n)=>{const t={},r=Array.isArray(e);let i=!1;for(const[s,o]of Object.entries(e).entries()){const a=r?n(s,o[1]):n(...o,s);i||(i=typeof a[0]=="number");const c=Array.isArray(a[0])||a.length===0?a:[a];for(const[l,u]of c)typeof l=="object"?t[l.group]=he(t[l.group],u):t[l]=u}return i?Object.values(t):t},vu=Object.entries,Ot=(e,n)=>e in n,Eo=(e,n)=>n in e;class Hy{constructor(n){Object.assign(this,n)}}const Gy=class{};class _u extends Gy{}const Jy=(e,n)=>{const t={},r={};let i;for(i in e)i in n?t[i]=e[i]:r[i]=e[i];return[t,r]},Yy=(e,n)=>Jy(e,n)[1],Er=e=>Object.keys(e).length===0,Ii=e=>[...Object.entries(e),...Object.getOwnPropertySymbols(e).map(n=>[n,e[n]])],Zy=(e,n)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)),Xy=e=>{const n=Object.keys(e).sort(),t={};for(let r=0;r<n.length;r++)t[n[r]]=e[n[r]];return t},Tt=bu("represents an uninitialized value"),Qy=e=>Object.values(e).filter(n=>typeof n=="number"?!0:typeof e[n]!="number"),xu={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},wu=globalThis.File??Blob,Su={ArrayBuffer,Blob,File:wu,FormData,Headers,Request,Response,URL},eb={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},Ln={...xu,...Su,...eb,String,Number,Boolean},Oo=e=>{var r;let n=Object.getPrototypeOf(e);for(;n!=null&&n.constructor&&(!Ot(n.constructor.name,Ln)||!(e instanceof Ln[n.constructor.name]));)n=Object.getPrototypeOf(n);const t=(r=n==null?void 0:n.constructor)==null?void 0:r.name;if(!(t===void 0||t==="Object"))return t},Io=e=>typeof e=="object"&&e!==null?Oo(e)??"object":yt(e),Ke=Array.isArray,tb={...{Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},...{ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},...{Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"}},Ao=e=>{const n=Object(e).name??null;return n&&Ot(n,Ln)&&Ln[n]===e?n:null},ku=(e,n)=>{let t=e.prototype;for(;t!==null;){if(t===n.prototype)return!0;t=Object.getPrototypeOf(t)}return!1},nb=e=>$u(e,new Map),$u=(e,n)=>{if(typeof e!="object"||e===null)return e;if(n!=null&&n.has(e))return n.get(e);const t=Ao(e.constructor);if(t==="Date")return new Date(e.getTime());if(t&&t!=="Array")return e;const r=Array.isArray(e)?e.slice():Object.create(Object.getPrototypeOf(e)),i=Object.getOwnPropertyDescriptors(e);if(n){n.set(e,r);for(const s in i){const o=i[s];"get"in o||"set"in o||(o.value=$u(o.value,n))}}return Object.defineProperties(r,i),r},rb=e=>{let n=Tt;return()=>n===Tt?n=e():n},Ai=e=>typeof e=="function"&&e.length===0,ib=class extends Function{constructor(...e){const n=e.slice(0,-1),t=e.at(-1);try{super(...n,t)}catch(r){return Ee(`Encountered an unexpected error while compiling your definition:
                Message: ${r} 
                Source: (${e.slice(0,-1)}) => {
                    ${e.at(-1)}
                }`)}}};class zn{constructor(n,...[t]){return Object.assign(Object.setPrototypeOf(n.bind((t==null?void 0:t.bind)??this),this.constructor.prototype),t==null?void 0:t.attach)}}const sb=rb(()=>{try{return new Function("return false")()}catch{return!0}});class It{constructor(){}}const ob=()=>{var e,n,t;try{return(((t=(((n=(e=new Error().stack)==null?void 0:e.split(`
`)[2])==null?void 0:n.trim())||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/))==null?void 0:t[1])||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},ab=((Hf=globalThis.process)==null?void 0:Hf.env)??{},lb={fileName:ob,env:ab},cb=e=>e[0].toUpperCase()+e.slice(1),Cu=e=>new RegExp(ub(e),typeof e=="string"?"":e.flags),ub=e=>`^(?:${typeof e=="string"?e:e.source})$`,Gt={negativeLookahead:e=>`(?!${e})`,nonCapturingGroup:e=>`(?:${e})`},No="\\",Ni={" ":1,"\n":1,"	":1},db=/^-0\.?0*$/.source,Mu=/[1-9]\d*/.source,hb=/\.\d+/.source,fb=/\.\d*[1-9]/.source,Eu=e=>Cu(Gt.negativeLookahead(db)+Gt.nonCapturingGroup("-?"+Gt.nonCapturingGroup(Gt.nonCapturingGroup("0|"+Mu)+Gt.nonCapturingGroup(e.decimalPattern)+"?")+(e.allowDecimalOnly?"|"+e.decimalPattern:"")+"?")),Ou=Eu({decimalPattern:fb,allowDecimalOnly:!1}),pb=Ou.test.bind(Ou),Ro=Eu({decimalPattern:hb,allowDecimalOnly:!0});Ro.test.bind(Ro);const mb=/^-?\d*\.?\d*$/,gb=e=>e.length!==0&&mb.test(e),Ri=Cu(Gt.negativeLookahead("^-0$")+"-?"+Gt.nonCapturingGroup(Gt.nonCapturingGroup("0|"+Mu))),yb=Ri.test.bind(Ri),Po=/^-?\d+$/,bb=Po.test.bind(Po),Iu={number:"a number",bigint:"a bigint",integer:"an integer"},Au=(e,n)=>`'${e}' was parsed as ${Iu[n]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,vb=(e,n)=>n==="number"?pb(e):yb(e),_b=(e,n)=>n==="number"?Number(e):Number.parseInt(e),xb=(e,n)=>n==="number"?gb(e):bb(e),wb=(e,n)=>Do(e,"number",n),Sb=(e,n)=>Do(e,"number",{...n,strict:!0}),kb=(e,n)=>Do(e,"integer",n),Do=(e,n,t)=>{const r=_b(e,n);return!Number.isNaN(r)&&xb(e,n)?t!=null&&t.strict?vb(e,n)?r:I(Au(e,n)):r:t!=null&&t.errorOnFail?I((t==null?void 0:t.errorOnFail)===!0?`Failed to parse ${Iu[n]} from '${e}'`:t==null?void 0:t.errorOnFail):void 0},$b=e=>{if(e[e.length-1]!=="n")return;const n=e.slice(0,-1);let t;try{t=BigInt(n)}catch{return}if(Ri.test(n))return t;if(Po.test(n))return I(Au(e,"bigint"))},Or={version:"0.46.0",filename:lb.fileName(),FileConstructor:wu},Nu=new Map,To=Object.create(null),Fo=e=>{const n=Nu.get(e);if(n)return n;let t=Cb(e);return To[t]?t=`${t}${To[t]++}`:To[t]=1,Or[t]=e,Nu.set(e,t),t},Ir=e=>/^[$A-Z_a-z][\w$]*$/.test(e),Cb=e=>{switch(typeof e){case"object":{if(e===null)break;const n=Oo(e)??"object";return n[0].toLowerCase()+n.slice(1)}case"function":return Ir(e.name)?e.name:"fn";case"symbol":return e.description&&Ir(e.description)?e.description:"symbol"}return Ee(`Unexpected attempt to register serializable value of type ${yt(e)}`)},Vo=e=>typeof e=="string"?JSON.stringify(e):typeof e=="bigint"?`${e}n`:`${e}`,Mb=(e,n={})=>Ar(e,{onUndefined:"$ark.undefined",onBigInt:t=>`$ark.bigint-${t}`,...n},[]),ce=(e,n)=>{switch(yt(e)){case"object":const t=e,r=t.constructor.name;return r==="Object"||r==="Array"?(n==null?void 0:n.quoteKeys)===!1?Pi(t,(n==null?void 0:n.indent)??0,""):JSON.stringify(Ar(t,Bn,[]),null,n==null?void 0:n.indent):Pi(t,(n==null?void 0:n.indent)??0,"");case"symbol":return Bn.onSymbol(e);default:return Vo(e)}},Pi=(e,n,t)=>{if(typeof e=="function")return Bn.onFunction(e);if(typeof e!="object"||e===null)return Vo(e);const r=t+" ".repeat(n);if(Array.isArray(e)){if(e.length===0)return"[]";const s=e.map(o=>Pi(o,n,r)).join(`,
`+r);return n?`[
${r}${s}
${t}]`:`[${s}]`}const i=e.constructor.name;if(i==="Object"){const s=Ii(e).map(([o,a])=>{const c=typeof o=="symbol"?Bn.onSymbol(o):Ir(o)?o:JSON.stringify(o),l=Pi(a,n,r);return`${r}${c}: ${l}`});return s.length===0?"{}":n?`{
${s.join(`,
`)}
${t}}`:`{${s.join(", ")}}`}return e instanceof Date?Nr(e):"expression"in e&&typeof e.expression=="string"?e.expression:i},Bn={onCycle:()=>"(cycle)",onSymbol:e=>`Symbol(${Fo(e)})`,onFunction:e=>`Function(${Fo(e)})`},Ar=(e,n,t)=>{var r,i;switch(yt(e)){case"object":{const s=e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();if(typeof s=="function")return Bn.onFunction(s);if(t.includes(s))return"(cycle)";const o=[...t,s];if(Array.isArray(s))return s.map(c=>Ar(c,n,o));if(s instanceof Date)return s.toDateString();const a={};for(const c in s)a[c]=Ar(s[c],n,o);for(const c of Object.getOwnPropertySymbols(s))a[((r=n.onSymbol)==null?void 0:r.call(n,c))??c.toString()]=Ar(s[c],n,o);return a}case"symbol":return Bn.onSymbol(e);case"bigint":return((i=n.onBigInt)==null?void 0:i.call(n,e))??`${e}n`;case"undefined":return n.onUndefined??"undefined";case"string":return e.replaceAll("\\","\\\\");default:return e}},Nr=e=>{const n=e.getFullYear(),t=e.getMonth(),r=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),a=e.getMilliseconds();if(t===0&&r===1&&i===0&&s===0&&o===0&&a===0)return`${n}`;const c=`${Eb[t]} ${r}, ${n}`;if(i===0&&s===0&&o===0&&a===0)return c;let l=e.toLocaleTimeString();const u=l.endsWith(" AM")||l.endsWith(" PM")?l.slice(-3):"";return u&&(l=l.slice(0,-u.length)),a?l+=`.${Ib(a,3)}`:Ob.test(l)&&(l=l.slice(0,-3)),`${l+u}, ${c}`},Eb=["January","February","March","April","May","June","July","August","September","October","November","December"],Ob=/:\d\d:00$/,Ib=(e,n)=>String(e).padStart(n,"0"),Ru=(e,n,...[t])=>{const r=(t==null?void 0:t.stringifySymbol)??ce;let i=e;switch(typeof n){case"string":i=Ir(n)?e===""?n:`${e}.${n}`:`${e}[${JSON.stringify(n)}]`;break;case"number":i=`${e}[${n}]`;break;case"symbol":i=`${e}[${r(n)}]`;break;default:t!=null&&t.stringifyNonKey?i=`${e}[${t.stringifyNonKey(n)}]`:I(`${ce(n)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},Rr=(e,...n)=>e.reduce((t,r)=>Ru(t,r,...n),"");class Pu extends yu{constructor(...t){super();y(this,"cache",{});this.push(...t)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let t=0;t<this.length;t++)this.cache.json.push(typeof this[t]=="symbol"?ce(this[t]):this[t]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=Rr(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let t="";const r=[t];for(const i of this)t=Ru(t,i),r.push(t);return this.cache.stringifyAncestors=r}}class Ab{constructor(n){y(this,"chars");y(this,"i");y(this,"def");this.def=n,this.chars=[...n],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(n){let t="";for(;this.lookahead;){if(n(this,t))if(t[t.length-1]===No)t=t.slice(0,-1);else break;t+=this.shift()}return t}shiftUntilLookahead(n){return typeof n=="string"?this.shiftUntil(t=>t.lookahead===n):this.shiftUntil(t=>t.lookahead in n)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in Ni))}jumpToIndex(n){this.i=n<0?this.length+n:n}jumpForward(n){this.i+=n}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(n,t){return this.chars.slice(n,t).join("")}lookaheadIs(n){return this.lookahead===n}lookaheadIsIn(n){return this.lookahead in n}}let Lo="$ark",Nb=2;for(;Lo in globalThis;)Lo=`$ark${Nb++}`;const Du=Lo;globalThis[Du]=Or;const A=Or,Rb=e=>`${Du}.${e}`,He=e=>Rb(Fo(e));class Tu extends _u{constructor(...t){super();y(this,"argNames");y(this,"body","");y(this,"indentation",0);this.argNames=t;for(const r of t){if(r in this)throw new Error(`Arg name '${r}' would overwrite an existing property on FunctionBody`);this[r]=r}}indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(t,r=!1){return Fu(t,r)}index(t,r=!1){return Vu(`${t}`,r)}line(t){return this.body+=`${" ".repeat(this.indentation)}${t}
`,this}const(t,r){return this.line(`const ${t} = ${r}`),this}let(t,r){return this.line(`let ${t} = ${r}`)}set(t,r){return this.line(`${t} = ${r}`)}if(t,r){return this.block(`if (${t})`,r)}elseIf(t,r){return this.block(`else if (${t})`,r)}else(t){return this.block("else",t)}for(t,r,i=0){return this.block(`for (let i = ${i}; ${t}; i++)`,r)}forIn(t,r){return this.block(`for (const k in ${t})`,r)}block(t,r,i=""){return this.line(`${t} {`),this.indent(),r(this),this.dedent(),this.line(`}${i}`)}return(t=""){return this.line(`return ${t}`)}write(t="anonymous",r=0){return`${t}(${this.argNames.join(", ")}) { ${r?this.body.split(`
`).map(i=>" ".repeat(r)+`${i}`).join(`
`):this.body} }`}compile(){return new ib(...this.argNames,this.body)}}const Pr=e=>fn(e,"object")||typeof e=="symbol"?He(e):Vo(e),Fu=(e,n=!1)=>typeof e=="string"&&Ir(e)?`${n?"?":""}.${e}`:Vu(Pb(e),n),Pb=e=>typeof e=="symbol"?He(e):JSON.stringify(e),Vu=(e,n=!1)=>`${n?"?.":""}[${e}]`;class zo extends Tu{constructor(t){super("data","ctx");y(this,"traversalKind");y(this,"optimistic");this.traversalKind=t.kind,this.optimistic=t.optimistic===!0}invoke(t,r){const i=(r==null?void 0:r.arg)??this.data,s=typeof t=="string"?!0:this.requiresContextFor(t),o=typeof t=="string"?t:t.id;return s?`${this.referenceToId(o,r)}(${i}, ${this.ctx})`:`${this.referenceToId(o,r)}(${i})`}referenceToId(t,r){const i=(r==null?void 0:r.kind)??this.traversalKind,s=`this.${t}${i}`;return r!=null&&r.bind?`${s}.bind(${r==null?void 0:r.bind})`:s}requiresContextFor(t){return this.traversalKind==="Apply"||t.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(t,r,i){const s=this.requiresContextFor(i);return s&&this.line(`${this.ctx}.path.push(${t})`),this.check(i,{arg:r}),s&&this.line(`${this.ctx}.path.pop()`),this}check(t,r){return this.traversalKind==="Allows"?this.if(`!${this.invoke(t,r)}`,()=>this.return(!1)):this.line(this.invoke(t,r))}}const Lu=e=>fe(e,(n,t)=>[n,Ke(t)?[...t]:t]),Ft=bu("arkKind"),B=(e,n)=>(e==null?void 0:e[Ft])===n,Ge=e=>B(e,"root")||B(e,"constraint"),Db=["unit","proto","domain"],Di=["required","optional","index","sequence"],zu=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Bo=[...zu,...Di,"structure","predicate"],Ti=["alias","union","morph","unit","intersection","proto","domain"],Tb=[...Ti,...Bo],Bu=fe(Bo,(e,n)=>[n,1]),Fb=fe([...Di,"undeclared"],(e,n)=>[n,1]),qu=fe(Tb,(e,n)=>[n,e]),Fi=e=>typeof e=="string"&&e in qu,Vi=e=>qu[e],qo=e=>Ti.slice(Vi(e)+1);[...qo("union")],[...qo("morph")];const pn=e=>typeof e=="string"||typeof e=="boolean"||e===null?e:typeof e=="number"?Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e:Pr(e),Li=e=>{let n="{ ";for(const[t,r]of Object.entries(e))n+=`${t}: ${Pr(r)}, `;return n+" }"},we=e=>{var t,r,i,s;const n=e;return n.hasAssociatedError&&((t=n.defaults).expected??(t.expected=o=>"description"in o?o.description:n.defaults.description(o)),(r=n.defaults).actual??(r.actual=o=>ce(o)),(i=n.defaults).problem??(i.problem=o=>`must be ${o.expected}${o.actual?` (was ${o.actual})`:""}`),(s=n.defaults).message??(s.message=o=>{if(o.path.length===0)return o.problem;const a=`${o.propString} ${o.problem}`;return a[0]==="["?`value at ${a}`:a})),n};class Vb extends Error{constructor(t,r){super(ce(r,{quoteKeys:!1,indent:4}));y(this,"name","ToJsonSchemaError");y(this,"code");y(this,"context");this.code=t,this.context=r}hasCode(t){return this.code===t}}const Ae={Error:Vb,throw:(...e)=>{throw new Ae.Error(...e)},throwInternalOperandError:(e,n)=>Ee(`Unexpected JSON Schema input for ${e}: ${ce(n)}`),defaultConfig:{dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:e=>Ae.throw("arrayObject",e),arrayPostfix:e=>Ae.throw("arrayPostfix",e),defaultValue:e=>Ae.throw("defaultValue",e),domain:e=>Ae.throw("domain",e),morph:e=>Ae.throw("morph",e),patternIntersection:e=>Ae.throw("patternIntersection",e),predicate:e=>Ae.throw("predicate",e),proto:e=>Ae.throw("proto",e),symbolKey:e=>Ae.throw("symbolKey",e),unit:e=>Ae.throw("unit",e),date:e=>Ae.throw("date",e)}}};A.config??(A.config={});const Uo=(e,n)=>{if(!n)return e;const t={...e};let r;for(r in n){const i={...e.keywords};if(r==="keywords"){for(const s in n[r]){const o=n.keywords[s];o!==void 0&&(i[s]=typeof o=="string"?{description:o}:o)}t.keywords=i}else r==="toJsonSchema"?t[r]=Uu(e.toJsonSchema,n.toJsonSchema):Fi(r)?t[r]={...e[r],...n[r]}:t[r]=n[r]}return t},Uu=(e,n)=>{if(!e)return n??{};if(!n)return e;const t={...e};let r;for(r in n)r==="fallback"?t.fallback=Lb(e.fallback,n.fallback):t[r]=n[r];return t},Lb=(e,n)=>{e=Ku(e),n=Ku(n);const t={};let r;for(r in Ae.defaultConfig.fallback)t[r]=n[r]??n.default??e[r]??e.default??Ae.defaultConfig.fallback[r];return t},Ku=e=>typeof e=="function"?{default:e}:e??{};class qn extends(Jf=_u,Gf=Ft,Jf){constructor({prefixPath:t,relativePath:r,...i},s){super();y(this,Gf,"error");y(this,"path");y(this,"data");y(this,"nodeConfig");y(this,"input");y(this,"ctx");this.input=i,this.ctx=s,Zy(this,i);const o=s.data;i.code==="union"&&(i.errors=i.errors.flatMap(c=>{const l=c.hasCode("union")?c.errors:[c];return!t&&!r?l:l.map(u=>u.transform(d=>({...d,path:qy(t,d.path,r)})))})),this.nodeConfig=s.config[this.code];const a=[...i.path??s.path];r&&a.push(...r),t&&a.unshift(...t),this.path=new Pu(...a),this.data="data"in i?i.data:o}transform(t){return new qn(t({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(t){return this.code===t}get propString(){return Rr(this.path)}get expected(){var r;if(this.input.expected)return this.input.expected;const t=((r=this.meta)==null?void 0:r.expected)??this.nodeConfig.expected;return typeof t=="function"?t(this.input):t}get actual(){var r;if(this.input.actual)return this.input.actual;const t=((r=this.meta)==null?void 0:r.actual)??this.nodeConfig.actual;return typeof t=="function"?t(this.data):t}get problem(){var r;if(this.input.problem)return this.input.problem;const t=((r=this.meta)==null?void 0:r.problem)??this.nodeConfig.problem;return typeof t=="function"?t(this):t}get message(){var r;if(this.input.message)return this.input.message;const t=((r=this.meta)==null?void 0:r.message)??this.nodeConfig.message;return typeof t=="function"?t(this):t}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class Jt extends(Zf=yu,Yf=Ft,Zf){constructor(t){super();y(this,Yf,"errors");y(this,"ctx");y(this,"byPath",Object.create(null));y(this,"byAncestorPath",Object.create(null));y(this,"count",0);y(this,"mutable",this);this.ctx=t}get flatByPath(){return fe(this.byPath,(t,r)=>[t,r.flat])}get flatProblemsByPath(){return fe(this.byPath,(t,r)=>[t,r.flat.map(i=>i.problem)])}throw(){throw this.toTraversalError()}toTraversalError(){return new zb(this)}add(t){this.includes(t)||this._add(t)}transform(t){const r=new Jt(this.ctx);for(const i of this)r.add(t(i));return r}merge(t){for(const r of t)this.includes(r)||this._add(new qn({...r,path:[...this.ctx.path,...r.path]},this.ctx))}affectsPath(t){return this.length===0?!1:t.stringifyAncestors().some(r=>r in this.byPath)||t.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(t=>t.toJSON())]}toString(){return this.join(`
`)}_add(t){const r=this.byPath[t.propString];if(r){if(r.hasCode("union")&&r.errors.length===0)return;const i=t.hasCode("union")&&t.errors.length===0?t:new qn({code:"intersection",errors:r.hasCode("intersection")?[...r.errors,t]:[r,t]},this.ctx),s=this.indexOf(r);this.mutable[s===-1?this.length:s]=i,this.byPath[t.propString]=i,this.addAncestorPaths(t)}else this.byPath[t.propString]=t,this.addAncestorPaths(t),this.mutable.push(t);this.count++}addAncestorPaths(t){for(const r of t.path.stringifyAncestors())this.byAncestorPath[r]=he(this.byAncestorPath[r],t)}}class zb extends Error{constructor(t){var n=(...G1)=>(super(...G1),y(this,"name","TraversalError"),this);t.length===1?n(t.summary):n(`
`+t.map(r=>`  • ${Bb(r)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:t,enumerable:!1})}}const Bb=e=>e.toString().split(`
`).join(`
  `);class Un{constructor(n,t){y(this,"path",[]);y(this,"errors",new Jt(this));y(this,"root");y(this,"config");y(this,"queuedMorphs",[]);y(this,"branches",[]);y(this,"seen",{});this.root=n,this.config=t}get data(){let n=this.root;for(const t of this.path)n=n==null?void 0:n[t];return n}get propString(){return Rr(this.path)}reject(n){return this.error(n),!1}mustBe(n){return this.error(n),!1}error(n){const t=typeof n=="object"?n.code?n:{...n,code:"predicate"}:{code:"predicate",expected:n};return this.errorFromContext(t)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(n){const t={path:new Pu(...this.path),morphs:n};this.currentBranch?this.currentBranch.queuedMorphs.push(t):this.queuedMorphs.push(t)}finalize(n){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?n?n(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(n){return this.errorFromContext(n)}errorFromContext(n){const t=new qn(n,this);return this.currentBranch?this.currentBranch.error=t:this.errors.add(t),t}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const n=this.queuedMorphs;this.queuedMorphs=[];for(const{path:t,morphs:r}of n)this.errors.affectsPath(t)||this.applyMorphsAtPath(t,r)}}applyMorphsAtPath(n,t){const r=n.at(-1);let i;if(r!==void 0){i=this.root;for(let s=0;s<n.length-1;s++)i=i[n[s]]}this.path=[...n];for(const s of t){const o=Ge(s),a=s(i===void 0?this.root:i[r],this);if(a instanceof qn){this.errors.add(a);break}if(a instanceof Jt){o||this.errors.merge(a);break}i===void 0?this.root=a:i[r]=a,this.applyQueuedMorphs()}}}const Vt=(e,n,t)=>{if(!t)return n();t.path.push(e);const r=n();return t.path.pop(),r};class ju extends zn{constructor(t,r){var s;super((o,a,c=this.onFail)=>a?(this.traverseApply(o,a),a.hasError()?a.errors:a.data):this.rootApply(o,c),{attach:t});y(this,"attachments");y(this,"$");y(this,"onFail");y(this,"includesTransform");y(this,"includesContextualPredicate");y(this,"isCyclic");y(this,"allowsRequiresContext");y(this,"rootApplyStrategy");y(this,"contextFreeMorph");y(this,"rootApply");y(this,"referencesById");y(this,"shallowReferences");y(this,"flatRefs");y(this,"flatMorphs");y(this,"allows");y(this,"compiledMeta",Kb(this.metaJson));y(this,"precedence",Vi(this.kind));y(this,"precompilation");y(this,"assert",(t,r)=>this(t,r,i=>i.throw()));this.attachments=t,this.$=r,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((o,a)=>jb(o,a.shallowReferences),[this]);const i=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let o=0;o<this.children.length;o++){if(this.includesTransform||(this.includesTransform=this.children[o].includesTransform),this.includesContextualPredicate||(this.includesContextualPredicate=this.children[o].includesContextualPredicate),this.isCyclic||(this.isCyclic=this.children[o].isCyclic),!i){const a=this.children[o].flatRefs;for(let c=0;c<a.length;c++){const l=a[c];if(!this.flatRefs.some(u=>Hu(u,l))){this.flatRefs.push(l);for(const u of l.node.branches)(u.hasKind("morph")||u.hasKind("intersection")&&((s=u.structure)==null?void 0:s.structuralMorph)!==void 0)&&this.flatMorphs.push({path:l.path,propString:l.propString,node:u})}}}Object.assign(this.referencesById,this.children[o].referencesById)}this.flatRefs.sort((o,a)=>o.path.length>a.path.length?1:o.path.length<a.path.length?-1:o.propString>a.propString?1:o.propString<a.propString||o.node.expression<a.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(o=>o.length===1||o.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(o=>o.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?o=>this.traverseAllows(o,new Un(o,this.$.resolvedConfig)):o=>this.traverseAllows(o)}get shallowMorphs(){return[]}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(r,i)=>{if(this.allows(r))return r;const s=new Un(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"contextual":return(r,i)=>{const s=new Un(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const t=this.$.resolvedConfig.clone;return(r,i)=>{if(this.allows(r))return this.contextFreeMorph(t&&(typeof r=="object"&&r!==null||typeof r=="function")?t(r):r);const s=new Un(r,this.$.resolvedConfig);return this.traverseApply(r,s),s.finalize(i)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,Ee(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get description(){var t;return this.cacheGetter("description",((t=this.meta)==null?void 0:t.description)??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}traverse(t,r){return this(t,r,null)}get in(){return this.cacheGetter("in",this.getIo("in"))}get out(){return this.cacheGetter("out",this.getIo("out"))}getIo(t){if(!this.includesTransform)return this;const r={};for(const[i,s]of this.innerEntries){const o=this.impl.keys[i];if(o.reduceIo)o.reduceIo(t,r,s);else if(o.child){const a=s;r[i]=Ke(a)?a.map(c=>c[t]):a[t]}else r[i]=s}return this.$.node(this.kind,r)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(t){const r=Ge(t)?t:this.$.parseDefinition(t);return this.innerHash===r.innerHash}ifEquals(t){return this.equals(t)?this:void 0}hasKind(t){return this.kind===t}assertHasKind(t){return this.kind!==t&&Vn(`${this.kind} node was not of asserted kind ${t}`),this}hasKindIn(...t){return t.includes(this.kind)}assertHasKindIn(...t){return un(t,this.kind)||Vn(`${this.kind} node was not one of asserted kinds ${t}`),this}isBasis(){return un(Db,this.kind)}isConstraint(){return un(Bo,this.kind)}isStructural(){return un(Di,this.kind)}isRefinement(){return un(zu,this.kind)}isRoot(){return un(Ti,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(t){return this.hasKind("unit")&&this.allows(t)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(t){const r=Dr.normalize(t);return this._select(r)}_select(t){let r=Dr.applyBoundary[t.boundary??"references"](this);return t.kind&&(r=r.filter(i=>i.kind===t.kind)),t.where&&(r=r.filter(t.where)),Dr.applyMethod[t.method??"filter"](r,this,t)}transform(t,r){return this._transform(t,this._createTransformContext(r))}_createTransformContext(t){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:(t==null?void 0:t.prereduced)??!1},undeclaredKeyHandling:void 0,...t}}_transform(t,r){var d;const i=r.bindScope??this.$;if(r.seen[this.id])return this.$.lazilyResolve(r.seen[this.id]);if(((d=r.shouldTransform)==null?void 0:d.call(r,this,r))===!1)return this;let s;r.seen[this.id]=()=>s,this.hasKind("structure")&&this.undeclared!==r.undeclaredKeyHandling&&(r={...r,undeclaredKeyHandling:this.undeclared});const o=fe(this.inner,(h,f)=>{if(!this.impl.keys[h].child)return[h,f];const p=f;if(!Ke(p)){const b=p._transform(t,r);return b?[h,b]:[]}if(p.length===0)return[h,f];const g=p.flatMap(b=>b._transform(t,r)??[]);return g.length?[h,g]:[]});delete r.seen[this.id];const a=Object.assign(o,{meta:this.meta}),c=r.selected&&!r.selected.includes(this)?a:t(this.kind,a,r);if(c===null)return null;if(Ge(c))return s=c;const l=Object.keys(c);return(l.length===0||l.length===1&&l[0]==="meta")&&!Er(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in c)?r.undeclaredKeyHandling?{...c,value:A.intrinsic.unknown}:null:(this.kind==="morph"&&(c.in??(c.in=A.intrinsic.unknown)),s=i.node(this.kind,c,r.parseOptions))}configureReferences(t,r="references"){const i=Dr.normalize(r),s=typeof t=="string"?(l,u)=>({...u,meta:{...u.meta,description:t}}):typeof t=="function"?(l,u)=>({...u,meta:t(u.meta)}):(l,u)=>({...u,meta:{...u.meta,...t}});if(i.boundary==="self")return this.$.node(this.kind,s(this.kind,{...this.inner,meta:this.meta}));const o=this._select(i),a=o&&Mr(o),c=i.boundary==="child"?(l,u)=>u.root.children.includes(l):i.boundary==="shallow"?l=>l.kind!=="structure":()=>!0;return this.$.finalize(this.transform(s,{shouldTransform:c,selected:a}))}}const Dr={applyBoundary:{self:e=>[e],child:e=>[...e.children],shallow:e=>[...e.shallowReferences],references:e=>[...e.references]},applyMethod:{filter:e=>e,assertFilter:(e,n,t)=>(e.length===0&&Vn(Wu(n,t)),e),find:e=>e[0],assertFind:(e,n,t)=>(e.length===0&&Vn(Wu(n,t)),e[0])},normalize:e=>typeof e=="function"?{boundary:"references",method:"filter",where:e}:typeof e=="string"?Ot(e,Dr.applyBoundary)?{method:"filter",boundary:e}:{boundary:"references",method:"filter",kind:e}:{boundary:"references",method:"filter",...e}},Wu=(e,n)=>`${e} had no references matching ${ce(n)}.`,qb=e=>Rr(e,{stringifyNonKey:n=>n.expression}),Ub=/"(\$ark\.[^"]+)"/g,Kb=e=>JSON.stringify(e).replaceAll(Ub,"$1"),Yt=(e,n)=>({path:e,node:n,propString:qb(e)}),Hu=(e,n)=>e.propString===n.propString&&e.node.equals(n.node),Gu=(e,n)=>hn(e,n,{isEqual:Hu}),jb=(e,n)=>hn(e,n,{isEqual:(t,r)=>t.equals(r)});class V extends Array{static init(n,t,r,i){return new V({kind:n,l:t,r,path:(i==null?void 0:i.path)??[],optional:(i==null?void 0:i.optional)??!1})}add(n,t,r,i){return this.push({kind:n,l:t,r,path:(i==null?void 0:i.path)??[],optional:(i==null?void 0:i.optional)??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:n,l:t,r}=this[0],i=Rr(n);return Yu(`Intersection${i&&` at ${i}`} of ${Ju(t,r)}`)}return`The following intersections result in unsatisfiable types:
• ${this.map(({path:n,l:t,r})=>`${n}: ${Ju(t,r)}`).join(`
• `)}`}throw(){return I(this.describeReasons())}invert(){const n=this.map(t=>({...t,l:t.r,r:t.l}));return n instanceof V?n:new V(...n)}withPrefixKey(n,t){return this.map(r=>({...r,path:[n,...r.path],optional:r.optional||t==="optional"}))}toNeverIfDisjoint(){return A.intrinsic.never}}const Ju=(e,n)=>`${Ko(e)} and ${Ko(n)}`,Ko=e=>Ge(e)?e.expression:Ke(e)?e.map(Ko).join(" | ")||"never":String(e),Yu=e=>`${e} results in an unsatisfiable type`,Kn={},Lt=(e,n,t)=>Pe(e,n,{$:t,invert:!1,pipe:!1}),jo=(e,n,t)=>Pe(e,n,{$:t,invert:!1,pipe:!0}),Pe=(e,n,t)=>{const r=t.pipe?"|>":"&",i=`${e.hash}${r}${n.hash}`;if(Kn[i]!==void 0)return Kn[i];if(!t.pipe){const a=`${n.hash}${r}${e.hash}`;if(Kn[a]!==void 0){const c=Kn[a],l=c instanceof V?c.invert():c;return Kn[i]=l,l}}const s=!t.pipe||!e.includesTransform&&!n.includesTransform;if(s&&e.equals(n))return e;let o=s?Wo(e,n,t):e.hasKindIn(...Ti)?Wb(e,n,t):Wo(e,n,t);return Ge(o)&&(e.equals(o)?o=e:n.equals(o)&&(o=n)),Kn[i]=o,o},Wo=(e,n,t)=>{const r=e.precedence<n.precedence?e.kind:n.kind,i=e.impl.intersections[n.kind]??n.impl.intersections[e.kind];if(i===void 0)return null;if(r===e.kind)return i(e,n,t);{let s=i(n,e,{...t,invert:!t.invert});return s instanceof V&&(s=s.invert()),s}},Wb=(e,n,t)=>e.includesTransform||n.includesTransform?t.invert?Zu(n,e,t):Zu(e,n,t):Wo(e,n,t),Zu=(e,n,t)=>e.distribute(r=>Hb(r,n,t),r=>{const i=r.filter(Ge);if(i.length===0)return V.init("union",e.branches,n.branches);if(i.length<e.branches.length||!e.branches.every((o,a)=>o.in.equals(i[a].in)))return t.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return t.$.parseSchema(s)}),Hb=(e,n,t)=>{if(e.hasKind("morph")){const i=[...e.morphs];if(e.lastMorphIfNode){const s=Pe(e.lastMorphIfNode,n,t);if(s instanceof V)return s;i[i.length-1]=s}else i.push(n);return t.$.node("morph",{morphs:i,in:e.inner.in})}if(n.hasKind("morph")){const i=Pe(e,n.in,t);return i instanceof V?i:t.$.node("morph",{morphs:[n],in:i})}return t.$.node("morph",{morphs:[n],in:e})};class jn extends ju{constructor(t,r){super(t,r);y(this,"impliedSiblings");Object.defineProperty(this,Ft,{value:"constraint",enumerable:!1})}intersect(t){return Lt(this,t,this.$)}}class zi extends jn{constructor(){super(...arguments);y(this,"traverseApply",(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)})}compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`${t.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Li(this.errorContext)}}const Ze=e=>(n,t)=>{if(Ke(n)){if(n.length===0)return;const i=n.map(s=>t.$.node(e,s));return e==="predicate"?i:i.sort((s,o)=>s.hash<o.hash?-1:1)}const r=t.$.node(e,n);return r.hasOpenIntersection()?[r]:r},Bi=e=>{const n=e.r.shift();if(!n){let r=e.l.length===0&&e.kind==="structure"?A.intrinsic.unknown.internal:e.ctx.$.node(e.kind,Object.assign(e.baseInner,Gb(e.l)),{prereduced:!0});for(const i of e.roots){if(r instanceof V)return r;r=Pe(i,r,e.ctx)}return r}let t=!1;for(let r=0;r<e.l.length;r++){const i=Pe(e.l[r],n,e.ctx);if(i!==null){if(i instanceof V)return i;if(t){if(!e.l.includes(i))return Ee(`Unexpectedly encountered multiple distinct intersection results for refinement ${i}`)}else{if(i.isRoot())return e.roots.push(i),e.l.splice(r),Bi(e);e.l[r]=i,t=!0}}}if(t||e.l.push(n),e.kind==="intersection"&&n.impliedSiblings)for(const r of n.impliedSiblings)hn(e.r,r);return Bi(e)},qi=e=>Object.entries(e).flatMap(([t,r])=>t in Bu?r:[]).sort((t,r)=>t.precedence<r.precedence?-1:t.precedence>r.precedence?1:t.kind==="predicate"&&r.kind==="predicate"?0:t.hash<r.hash?-1:1),Gb=e=>{const n={};for(const t of e)if(t.hasOpenIntersection())n[t.kind]=he(n[t.kind],t);else{if(n[t.kind])return Ee(`Unexpected intersection of closed refinements of kind ${t.kind}`);n[t.kind]=t}return n},Jb=(...e)=>I(Yb(...e)),Yb=(e,n,t)=>{const r=t.hasKind("morph")?"a morph":t.isUnknown()?"unknown":t.exclude(n).defaultShortDescription;return`${cb(e)} operand must be ${n.description} (was ${r})`},Zb=(e,n,t)=>new Ui(e,n,t,t,null);class Xu extends zn{}class Ui extends(Qf=zn,Xf=Ft,Qf){constructor(t,r,i,s,o){super((...a)=>{const c=fe(this.names,(l,u)=>{const d=this.arg$.parse(a[l]);return d.extends(this.constraints[l])||I(Xb(u,this.constraints[l].expression,d.expression)),[u,d]});if(this.defIsLazy()){const l=this.bodyDef(c);return this.$.parse(l)}return this.$.parse(r,{args:c})});y(this,Xf,"generic");y(this,"paramDefs");y(this,"bodyDef");y(this,"$");y(this,"arg$");y(this,"baseInstantiation");y(this,"hkt");y(this,"description");this.paramDefs=t,this.bodyDef=r,this.$=i,this.arg$=s,this.hkt=o,this.description=o?new o().description??`a generic type for ${o.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof Xu}cacheGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}get json(){return this.cacheGetter("json",{params:this.params.map(t=>t[1].isUnknown()?t[0]:[t[0],t[1].json]),body:Mb(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(t=>typeof t=="string"?[t,A.intrinsic.unknown]:[t[0],this.$.parse(t[1])]))}get names(){return this.cacheGetter("names",this.params.map(t=>t[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(t=>t[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const Xb=(e,n,t)=>`${e} must be assignable to ${n} (was ${t})`,Qb=we({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:e=>typeof e=="function"?{predicate:e}:e,defaults:{description:e=>`valid according to ${e.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class ev extends jn{constructor(){super(...arguments);y(this,"serializedPredicate",He(this.predicate));y(this,"compiledCondition",`${this.serializedPredicate}(data, ctx)`);y(this,"compiledNegation",`!${this.compiledCondition}`);y(this,"impliedBasis",null);y(this,"expression",this.serializedPredicate);y(this,"traverseAllows",this.predicate);y(this,"errorContext",{code:"predicate",description:this.description,meta:this.meta});y(this,"compiledErrorContext",Li(this.errorContext));y(this,"traverseApply",(t,r)=>{!this.predicate(t,r.external)&&!r.hasError()&&r.errorFromNodeContext(this.errorContext)})}compile(t){if(t.traversalKind==="Allows"){t.return(this.compiledCondition);return}t.if(`${this.compiledNegation} && !ctx.hasError()`,()=>t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(t,r){return r.fallback.predicate({code:"predicate",base:t,predicate:this.predicate})}}const Qu={implementation:Qb,Node:ev},tv=we({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:e=>Number.isInteger(e)?e:I(rv(e))}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>e.rule===1?"an integer":e.rule===2?"even":`a multiple of ${e.rule}`},intersections:{divisor:(e,n,t)=>t.$.node("divisor",{rule:Math.abs(e.rule*n.rule/iv(e.rule,n.rule))})},obviatesBasisDescription:!0});class nv extends zi{constructor(){super(...arguments);y(this,"traverseAllows",t=>t%this.rule===0);y(this,"compiledCondition",`data % ${this.rule} === 0`);y(this,"compiledNegation",`data % ${this.rule} !== 0`);y(this,"impliedBasis",A.intrinsic.number.internal);y(this,"expression",`% ${this.rule}`)}reduceJsonSchema(t){return t.type="integer",this.rule===1||(t.multipleOf=this.rule),t}}const ed={implementation:tv,Node:nv},rv=e=>`divisor must be an integer (was ${e})`,iv=(e,n)=>{let t,r=e,i=n;for(;i!==0;)t=i,i=r%i,r=t;return r};class Wn extends zi{constructor(){super(...arguments);y(this,"boundOperandKind",lv[this.kind]);y(this,"compiledActual",this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()");y(this,"comparator",cv(this.kind,this.exclusive));y(this,"numericLimit",this.rule.valueOf());y(this,"expression",`${this.comparator} ${this.rule}`);y(this,"compiledCondition",`${this.compiledActual} ${this.comparator} ${this.numericLimit}`);y(this,"compiledNegation",`${this.compiledActual} ${sv[this.comparator]} ${this.numericLimit}`);y(this,"stringLimit",this.boundOperandKind==="date"?uv(this.numericLimit):`${this.numericLimit}`);y(this,"limitKind",this.comparator[0]==="<"?"upper":"lower")}isStricterThan(t){return(this.limitKind==="upper"?this.numericLimit<t.numericLimit:this.numericLimit>t.numericLimit)||this.numericLimit===t.numericLimit&&this.exclusive===!0&&!t.exclusive}overlapsRange(t){return!(this.isStricterThan(t)||this.numericLimit===t.numericLimit&&(this.exclusive||t.exclusive))}overlapIsUnit(t){return this.numericLimit===t.numericLimit&&!this.exclusive&&!t.exclusive}}const sv={"<":">=","<=":">",">":"<=",">=":"<"},ov={min:"max",minLength:"maxLength",after:"before"},td={parse:e=>e||void 0},nd=e=>n=>{if(typeof n=="number")return{rule:n};const{exclusive:t,...r}=n;return t?{...r,rule:e==="minLength"?r.rule+1:r.rule-1}:r},rd=e=>n=>{if(typeof n=="number"||typeof n=="string"||n instanceof Date)return{rule:n};const{exclusive:t,...r}=n;if(!t)return r;const i=typeof r.rule=="number"?r.rule:typeof r.rule=="string"?new Date(r.rule).valueOf():r.rule.valueOf();return t?{...r,rule:e==="after"?i+1:i-1}:r},id=e=>typeof e=="string"||typeof e=="number"?new Date(e):e,av=(e,n)=>`${e} bound must be a positive integer (was ${n})`,Ho=e=>n=>((!Number.isInteger(n)||n<0)&&I(av(e,n)),n),lv={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},cv=(e,n)=>`${Ot(e,ov)?">":"<"}${n?"":"="}`,uv=e=>typeof e=="string"?e:new Date(e).toLocaleString(),dv=e=>`Bounded expression ${e} must be exactly one of number, string, Array, or Date`,hv=we({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:id,serialize:e=>e.toISOString()}},normalize:rd("after"),defaults:{description:e=>`${e.collapsibleLimitString} or later`,actual:Nr},intersections:{after:(e,n)=>e.isStricterThan(n)?e:n}});class fv extends Wn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.Date.internal);y(this,"collapsibleLimitString",Nr(this.rule));y(this,"traverseAllows",t=>t>=this.rule)}reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,after:this.rule})}}const sd={implementation:hv,Node:fv},pv=we({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:id,serialize:e=>e.toISOString()}},normalize:rd("before"),defaults:{description:e=>`${e.collapsibleLimitString} or earlier`,actual:Nr},intersections:{before:(e,n)=>e.isStricterThan(n)?e:n,after:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("unit",{unit:e.rule}):null:V.init("range",e,n)}});class mv extends Wn{constructor(){super(...arguments);y(this,"collapsibleLimitString",Nr(this.rule));y(this,"traverseAllows",t=>t<=this.rule);y(this,"impliedBasis",A.intrinsic.Date.internal)}reduceJsonSchema(t,r){return r.fallback.date({code:"date",base:t,before:this.rule})}}const od={implementation:pv,Node:mv},gv=we({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:Ho("exactLength")}},normalize:e=>typeof e=="number"?{rule:e}:e,hasAssociatedError:!0,defaults:{description:e=>`exactly length ${e.rule}`,actual:e=>`${e.length}`},intersections:{exactLength:(e,n,t)=>V.init("unit",t.$.node("unit",{unit:e.rule}),t.$.node("unit",{unit:n.rule}),{path:["length"]}),minLength:(e,n)=>e.rule>=n.rule?e:V.init("range",e,n),maxLength:(e,n)=>e.rule<=n.rule?e:V.init("range",e,n)}});class yv extends zi{constructor(){super(...arguments);y(this,"traverseAllows",t=>t.length===this.rule);y(this,"compiledCondition",`data.length === ${this.rule}`);y(this,"compiledNegation",`data.length !== ${this.rule}`);y(this,"impliedBasis",A.intrinsic.lengthBoundable.internal);y(this,"expression",`== ${this.rule}`)}reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t.maxLength=this.rule,t;case"array":return t.minItems=this.rule,t.maxItems=this.rule,t;default:return Ae.throwInternalOperandError("exactLength",t)}}}const ad={implementation:gv,Node:yv},bv=we({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:td},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"negative":"non-positive":`${e.exclusive?"less than":"at most"} ${e.rule}`},intersections:{max:(e,n)=>e.isStricterThan(n)?e:n,min:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("unit",{unit:e.rule}):null:V.init("range",e,n)},obviatesBasisDescription:!0});class vv extends Wn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.number.internal);y(this,"traverseAllows",this.exclusive?t=>t<this.rule:t=>t<=this.rule)}reduceJsonSchema(t){return this.exclusive?t.exclusiveMaximum=this.rule:t.maximum=this.rule,t}}const ld={implementation:bv,Node:vv},_v=we({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Ho("maxLength")}},reduce:(e,n)=>e.rule===0?n.node("exactLength",e):void 0,normalize:nd("maxLength"),defaults:{description:e=>`at most length ${e.rule}`,actual:e=>`${e.length}`},intersections:{maxLength:(e,n)=>e.isStricterThan(n)?e:n,minLength:(e,n,t)=>e.overlapsRange(n)?e.overlapIsUnit(n)?t.$.node("exactLength",{rule:e.rule}):null:V.init("range",e,n)}});class xv extends Wn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.lengthBoundable.internal);y(this,"traverseAllows",t=>t.length<=this.rule)}reduceJsonSchema(t){switch(t.type){case"string":return t.maxLength=this.rule,t;case"array":return t.maxItems=this.rule,t;default:return Ae.throwInternalOperandError("maxLength",t)}}}const cd={implementation:_v,Node:xv},wv=we({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:td},normalize:e=>typeof e=="number"?{rule:e}:e,defaults:{description:e=>e.rule===0?e.exclusive?"positive":"non-negative":`${e.exclusive?"more than":"at least"} ${e.rule}`},intersections:{min:(e,n)=>e.isStricterThan(n)?e:n},obviatesBasisDescription:!0});class Sv extends Wn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.number.internal);y(this,"traverseAllows",this.exclusive?t=>t>this.rule:t=>t>=this.rule)}reduceJsonSchema(t){return this.exclusive?t.exclusiveMinimum=this.rule:t.minimum=this.rule,t}}const ud={implementation:wv,Node:Sv},kv=we({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Ho("minLength")}},reduce:e=>e.rule===0?A.intrinsic.unknown:void 0,normalize:nd("minLength"),defaults:{description:e=>e.rule===1?"non-empty":`at least length ${e.rule}`,actual:e=>e.length===0?"":`${e.length}`},intersections:{minLength:(e,n)=>e.isStricterThan(n)?e:n}});class $v extends Wn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.lengthBoundable.internal);y(this,"traverseAllows",t=>t.length>=this.rule)}reduceJsonSchema(t){switch(t.type){case"string":return t.minLength=this.rule,t;case"array":return t.minItems=this.rule,t;default:return Ae.throwInternalOperandError("minLength",t)}}}const dd={implementation:kv,Node:$v},Cv={min:ud.implementation,max:ld.implementation,minLength:dd.implementation,maxLength:cd.implementation,exactLength:ad.implementation,after:sd.implementation,before:od.implementation},Mv={min:ud.Node,max:ld.Node,minLength:dd.Node,maxLength:cd.Node,exactLength:ad.Node,after:sd.Node,before:od.Node},Ev=we({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:e=>typeof e=="string"?{rule:e}:e instanceof RegExp?e.flags?{rule:e.source,flags:e.flags}:{rule:e.source}:e,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:e=>`matched by ${e.rule}`},intersections:{pattern:()=>null}});class Ov extends zi{constructor(){super(...arguments);y(this,"instance",new RegExp(this.rule,this.flags));y(this,"expression",`${this.instance}`);y(this,"traverseAllows",this.instance.test.bind(this.instance));y(this,"compiledCondition",`${this.expression}.test(data)`);y(this,"compiledNegation",`!${this.compiledCondition}`);y(this,"impliedBasis",A.intrinsic.string.internal)}reduceJsonSchema(t,r){return t.pattern?r.fallback.patternIntersection({code:"patternIntersection",base:t,pattern:this.rule}):(t.pattern=this.rule,t)}}const hd={implementation:Ev,Node:Ov},Ki=(e,n)=>{const t=Iv(e);return n&&!n.includes(t)?I(`Root of kind ${t} should be one of ${n}`):t},Iv=e=>{if(B(e,"root"))return e.kind;if(typeof e=="string")return e[0]==="$"?"alias":e in Dt?"domain":"proto";if(typeof e=="function")return"proto";if(typeof e!="object"||e===null)return I(fd(e));if("morphs"in e)return"morph";if("branches"in e||Ke(e))return"union";if("unit"in e)return"unit";if("reference"in e)return"alias";const n=Object.keys(e);return n.length===0||n.some(t=>t in Bu)?"intersection":"proto"in e?"proto":"domain"in e?"domain":I(fd(e))},fd=e=>`${ce(e)} is not a valid type schema`,ji={},Av=e=>Ke(e)?e.map(n=>n.collapsibleJson):e.collapsibleJson,lt={};A.nodesByRegisteredId=lt;const pd=e=>(ji[e]??(ji[e]=0),`${e}${++ji[e]}`),md=e=>{var l;const n=Ji[e.kind],t=((l=n.applyConfig)==null?void 0:l.call(n,e.def,e.$.resolvedConfig))??e.def,r={},{meta:i,...s}=t,o=i===void 0?{}:typeof i=="string"?{description:i}:i,a=vu(s).sort(([u],[d])=>Fi(u)?Fi(d)?Vi(u)-Vi(d):1:Fi(d)||u<d?-1:1).filter(([u,d])=>{if(u.startsWith("meta.")){const h=u.slice(5);return o[h]=d,!1}return!0});for(const u of a){const d=u[0],h=n.keys[d];if(!h)return I(`Key ${d} is not valid on ${e.kind} schema`);const f=h.parse?h.parse(u[1],e):u[1];f!==Tt&&(f!==void 0||h.preserveUndefined)&&(r[d]=f)}if(n.reduce&&!e.prereduced){const u=n.reduce(r,e.$);if(u)return u instanceof V?u.throw():Rv(u,o)}return Go({id:e.id,kind:e.kind,inner:r,meta:o,$:e.$})},Go=({id:e,kind:n,inner:t,meta:r,$:i,ignoreCache:s})=>{const o=Ji[n],a=vu(t),c=[];let l={};for(const[_,v]of a){const S=o.keys[_],k=S.serialize??(S.child?Av:pn);if(l[_]=k(v),S.child===!0){const x=v;Ke(x)?c.push(...x):c.push(x)}else typeof S.child=="function"&&c.push(...S.child(v))}o.finalizeInnerJson&&(l=o.finalizeInnerJson(l));let u={...l},d={};Er(r)||(d=fe(r,(_,v)=>[_,_==="examples"?v:pn(v)]),u.meta=Wi(d,"description",!0)),l=Wi(l,o.collapsibleKey,!1);const h=JSON.stringify({kind:n,...l});u=Wi(u,o.collapsibleKey,!1);const f=Wi(u,o.collapsibleKey,!0),p=JSON.stringify({kind:n,...u});if(i.nodesByHash[p]&&!s)return i.nodesByHash[p];const g={id:e,kind:n,impl:o,inner:t,innerEntries:a,innerJson:l,innerHash:h,meta:r,metaJson:d,json:u,hash:p,collapsibleJson:f,children:c};if(n!=="intersection")for(const _ in t)_!=="in"&&_!=="out"&&(g[_]=t[_]);const b=new F_[n](g,i);return i.nodesByHash[p]=b},Nv=(e,n)=>e.id===n?e:(Ge(lt[n])&&Ee(`Unexpected attempt to overwrite node id ${n}`),Go({id:n,kind:e.kind,inner:e.inner,meta:e.meta,$:e.$,ignoreCache:!0})),Rv=(e,n,t)=>Go({id:pd(n.alias??e.kind),kind:e.kind,inner:e.inner,meta:n,$:e.$}),Wi=(e,n,t)=>{const r=Object.keys(e);if(r.length===1&&r[0]===n){const i=e[n];if(t||fn(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return e},Jo=(e,n,t)=>{if(e.key!==n.key)return null;const r=e.key;let i=Pe(e.value,n.value,t);const s=e.required||n.required?"required":"optional";if(i instanceof V)if(s==="optional")i=A.intrinsic.never.internal;else return i.withPrefixKey(e.key,e.required&&n.required?"required":"optional");if(s==="required")return t.$.node("required",{key:r,value:i});const o=e.hasDefault()?n.hasDefault()?e.default===n.default?e.default:I(yd(e.default,n.default)):e.default:n.hasDefault()?n.default:Tt;return t.$.node("optional",{key:r,value:i,default:o})};class gd extends jn{constructor(){super(...arguments);y(this,"required",this.kind==="required");y(this,"optional",this.kind==="optional");y(this,"impliedBasis",A.intrinsic.object.internal);y(this,"serializedKey",Pr(this.key));y(this,"compiledKey",typeof this.key=="string"?this.key:this.serializedKey);y(this,"flatRefs",he(this.value.flatRefs.map(t=>Yt([this.key,...t.path],t.node)),Yt([this.key],this.value)));y(this,"traverseAllows",(t,r)=>this.key in t?Vt(this.key,()=>this.value.traverseAllows(t[this.key],r),r):this.optional);y(this,"traverseApply",(t,r)=>{this.key in t?Vt(this.key,()=>this.value.traverseApply(t[this.key],r),r):this.hasKind("required")&&r.errorFromNodeContext(this.errorContext)})}_transform(t,r){r.path.push(this.key);const i=super._transform(t,r);return r.path.pop(),i}hasDefault(){return"default"in this.inner}compile(t){t.if(`${this.serializedKey} in data`,()=>t.traverseKey(this.serializedKey,`data${t.prop(this.key)}`,this.value)),this.hasKind("required")&&t.else(()=>t.traversalKind==="Apply"?t.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):t.return(!1)),t.traversalKind==="Allows"&&t.return(!0)}}const yd=(e,n)=>`Invalid intersection of default values ${ce(e)} & ${ce(n)}`,Pv=we({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)},default:{preserveUndefined:!0}},normalize:e=>e,reduce:(e,n)=>{if(n.resolvedConfig.exactOptionalPropertyTypes===!1&&!e.value.allows(void 0))return n.node("optional",{...e,value:e.value.or(j.undefined)},{prereduced:!0})},defaults:{description:e=>`${e.compiledKey}?: ${e.value.description}`},intersections:{optional:Jo}});class Dv extends gd{constructor(...t){super(...t);y(this,"expression",this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${ce(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`);y(this,"defaultValueMorph",Tv(this));y(this,"defaultValueMorphRef",this.defaultValueMorph&&He(this.defaultValueMorph));"default"in this.inner&&Xo(this.value,this.inner.default,this.key)}get outProp(){if(!this.hasDefault())return this;const{default:t,...r}=this.inner;return this.cacheGetter("outProp",this.$.node("required",r,{prereduced:!0}))}}const Yo={implementation:Pv,Node:Dv},Zo={},Tv=e=>{if(!e.hasDefault())return;const n=`{${e.compiledKey}: ${e.value.id} = ${pn(e.default)}}`;return Zo[n]??(Zo[n]=bd(e.key,e.value,e.default))},bd=(e,n,t)=>{if(typeof t=="function")return n.includesTransform?(i,s)=>(Vt(e,()=>n(i[e]=t(),s),s),i):i=>(i[e]=t(),i);const r=n.includesTransform?n.assert(t):t;return fn(r,"object")?(i,s)=>(Vt(e,()=>n(i[e]=t,s),s),i):i=>(i[e]=r,i)},Xo=(e,n,t)=>{const r=Ai(n);fn(n,"object")&&!r&&I(Fv(t));const i=e.in(r?n():n);if(i instanceof Jt){t===null&&I(`Default ${i.summary}`);const s=i.transform(o=>o.transform(a=>({...a,prefixPath:[t]})));I(`Default for ${s.summary}`)}return n},Fv=e=>`Non-primitive default ${e===null?"":typeof e=="number"?`for value at [${e}] `:`for ${Pr(e)} `}must be specified as a function like () => ({my: 'object'})`;class Tr extends ju{constructor(t,r){super(t,r);y(this,"branches",this.hasKind("union")?this.inner.branches:[this]);y(this,"_keyof");y(this,"pipe",Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)}));Object.defineProperty(this,Ft,{value:"root",enumerable:!1})}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:t=>{const r=this(t);return r instanceof Jt?r:{value:r}}}}as(){return this}brand(t){return t===""?I(Vv):this}readonly(){return this}distribute(t,r){const i=this.branches.map(t);return(r==null?void 0:r(i))??i}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(t={}){const r=Uu(this.$.resolvedConfig.toJsonSchema,t);r.useRefs||(r.useRefs=this.isCyclic);const i=typeof r.dialect=="string"?{$schema:r.dialect}:{};return Object.assign(i,this.toJsonSchemaRecurse(r)),r.useRefs&&(i.$defs=fe(this.references,(s,o)=>o.isRoot()&&!o.alwaysExpandJsonSchema?[o.id,o.toResolvedJsonSchema(r)]:[])),i}toJsonSchemaRecurse(t){return t.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(t)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(t){const r=this.innerToJsonSchema(t);return Object.assign(r,this.metaJson)}intersect(t){const r=this.$.parseDefinition(t),i=this.rawIntersect(r);return i instanceof V?i:this.$.finalize(i)}rawIntersect(t){return Lt(this,t,this.$)}toNeverIfDisjoint(){return this}and(t){const r=this.intersect(t);return r instanceof V?r.throw():r}rawAnd(t){const r=this.rawIntersect(t);return r instanceof V?r.throw():r}or(t){const r=this.$.parseDefinition(t);return this.$.finalize(this.rawOr(r))}rawOr(t){const r=[...this.branches,...t.branches];return this.$.node("union",r)}map(t){return this.$.schema(this.applyStructuralOperation("map",[t]))}pick(...t){return this.$.schema(this.applyStructuralOperation("pick",t))}omit(...t){return this.$.schema(this.applyStructuralOperation("omit",t))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}keyof(){if(this._keyof)return this._keyof;const t=this.applyStructuralOperation("keyof",[]).reduce((r,i)=>r.intersect(i).toNeverIfDisjoint(),A.intrinsic.unknown.internal);return t.branches.length===0&&I(Yu(`keyof ${this.expression}`)),this._keyof=this.$.finalize(t)}get props(){return this.branches.length!==1?I(Lv(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(t){const r=this.$.parseDefinition(t);return this.$.schema(r.distribute(i=>this.applyStructuralOperation("merge",[vd(i)??I(_d("merge",i.expression))])))}applyStructuralOperation(t,r){return this.distribute(i=>{if(i.equals(A.intrinsic.object)&&t!=="merge")return i;const s=vd(i);if(s||I(_d(t,i.expression)),t==="keyof")return s.keyof();if(t==="get")return s.get(...r);if(t==="props")return s.props;const o=t==="required"?"require":t==="partial"?"optionalize":t;return this.$.node("intersection",{...i.inner,structure:s[o](...r)})})}get(...t){return t[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",t))}extract(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(i=>i.extends(r)))}exclude(t){const r=this.$.parseDefinition(t);return this.$.schema(this.branches.filter(i=>!i.extends(r)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(t){return!(this.intersect(t)instanceof V)}extends(t){const r=this.intersect(t);return!(r instanceof V)&&this.equals(r)}ifExtends(t){return this.extends(t)?this:void 0}subsumes(t){return this.$.parseDefinition(t).extends(this)}configure(t,r="shallow"){return this.configureReferences(t,r)}describe(t,r="shallow"){return this.configure({description:t},r)}optional(){return[this,"?"]}default(t){return Xo(this,t,null),[this,"=",t]}from(t){return this.assert(t)}_pipe(...t){const r=t.reduce((i,s)=>i.rawPipeOnce(s),this);return this.$.finalize(r)}tryPipe(...t){const r=t.reduce((i,s)=>i.rawPipeOnce(B(s,"root")?s:(o,a)=>{try{return s(o,a)}catch(c){return a.error({code:"predicate",predicate:s,actual:`aborted due to error:
    ${c}
`})}}),this);return this.$.finalize(r)}to(t){return this.$.finalize(this.toNode(this.$.parseDefinition(t)))}toNode(t){const r=jo(this,t,this.$);return r instanceof V?r.throw():r}rawPipeOnce(t){return B(t,"root")?this.toNode(t):this.distribute(r=>r.hasKind("morph")?this.$.node("morph",{in:r.inner.in,morphs:[...r.morphs,t]}):this.$.node("morph",{in:r,morphs:[t]}),this.$.parseSchema)}narrow(t){return this.constrainOut("predicate",t)}constrain(t,r){return this._constrain("root",t,r)}constrainIn(t,r){return this._constrain("in",t,r)}constrainOut(t,r){return this._constrain("out",t,r)}_constrain(t,r,i){const s=this.$.node(r,i);if(s.isRoot())return s.isUnknown()?this:Ee(`Unexpected constraint node ${s}`);const o=t==="root"?this:this[t];if(o.hasKind("morph")||s.impliedBasis&&!o.extends(s.impliedBasis))return Jb(r,s.impliedBasis,this);const a=this.$.node("intersection",{[s.kind]:s}),c=t==="out"?jo(this,a,this.$):Lt(this,a,this.$);return c instanceof V&&c.throw(),this.$.finalize(c)}onUndeclaredKey(t){const r=typeof t=="string"?t:t.rule,i=typeof t=="string"?!1:t.deep;return this.$.finalize(this.transform((s,o)=>s==="structure"?r==="ignore"?Yy(o,{undeclared:1}):{...o,undeclared:r}:o,i?void 0:{shouldTransform:s=>!un(Di,s.kind)}))}hasEqualMorphs(t){return!this.includesTransform&&!t.includesTransform?!0:!(!Fn(this.shallowMorphs,t.shallowMorphs)||!Fn(this.flatMorphs,t.flatMorphs,{isEqual:(r,i)=>{var s,o;return r.propString===i.propString&&(r.node.hasKind("morph")&&i.node.hasKind("morph")?r.node.hasEqualMorphs(i.node):r.node.hasKind("intersection")&&i.node.hasKind("intersection")?((s=r.node.structure)==null?void 0:s.structuralMorphRef)===((o=i.node.structure)==null?void 0:o.structuralMorphRef):!1)}}))}onDeepUndeclaredKey(t){return this.onUndeclaredKey({rule:t,deep:!0})}filter(t){return this.constrainIn("predicate",t)}divisibleBy(t){return this.constrain("divisor",t)}matching(t){return this.constrain("pattern",t)}atLeast(t){return this.constrain("min",t)}atMost(t){return this.constrain("max",t)}moreThan(t){return this.constrain("min",Hn(t))}lessThan(t){return this.constrain("max",Hn(t))}atLeastLength(t){return this.constrain("minLength",t)}atMostLength(t){return this.constrain("maxLength",t)}moreThanLength(t){return this.constrain("minLength",Hn(t))}lessThanLength(t){return this.constrain("maxLength",Hn(t))}exactlyLength(t){return this.constrain("exactLength",t)}atOrAfter(t){return this.constrain("after",t)}atOrBefore(t){return this.constrain("before",t)}laterThan(t){return this.constrain("after",Hn(t))}earlierThan(t){return this.constrain("before",Hn(t))}}const Vv="Expected a non-empty brand name after #",Hn=e=>typeof e=="object"&&!(e instanceof Date)?{...e,exclusive:!0}:{rule:e,exclusive:!0},Hi=(e,n)=>B(n,"root")?B(e,"root")?e.extends(n):n.allows(e):B(e,"root")?e.hasUnit(n):n===e,vd=e=>{var n;return e.hasKind("morph")?null:e.hasKind("intersection")?e.inner.structure??(((n=e.basis)==null?void 0:n.domain)==="object"?e.$.bindReference(A.intrinsic.emptyStructure):null):e.isBasis()&&e.domain==="object"?e.$.bindReference(A.intrinsic.emptyStructure):null},Lv=e=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${e}`,_d=(e,n)=>`${e} operand must be an object (was ${n})`,Fr=(e,n)=>fe(qo(e),(t,r)=>[r,n]),zv=e=>typeof e=="string"?{reference:e}:e,xd=e=>e instanceof V?A.intrinsic.never.internal:e,Bv=we({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:e=>e.startsWith("$")?e:`$ark.${e}`},resolve:{}},normalize:zv,defaults:{description:e=>e.reference},intersections:{alias:(e,n,t)=>t.$.lazilyResolve(()=>xd(Pe(e.resolution,n.resolution,t)),`${e.reference}${t.pipe?"=>":"&"}${n.reference}`),...Fr("alias",(e,n,t)=>n.isUnknown()?e:n.isNever()?n:n.isBasis()&&!n.overlaps(A.intrinsic.object)?V.init("assignability",A.intrinsic.object,n):t.$.lazilyResolve(()=>xd(Pe(e.resolution,n,t)),`${e.reference}${t.pipe?"=>":"&"}${n.id}`))}});class qv extends Tr{constructor(){super(...arguments);y(this,"expression",this.reference);y(this,"structure");y(this,"traverseAllows",(t,r)=>{const i=r.seen[this.reference];return i!=null&&i.includes(t)?!0:(r.seen[this.reference]=he(i,t),this.resolution.traverseAllows(t,r))});y(this,"traverseApply",(t,r)=>{const i=r.seen[this.reference];i!=null&&i.includes(t)||(r.seen[this.reference]=he(i,t),this.resolution.traverseApply(t,r))})}get resolution(){const t=this._resolve();return lt[this.id]=t}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const t=this.reference;let r=lt[t];const i=[];for(;B(r,"context");){if(i.includes(r.id))return I(Uv(r.id,i));i.push(r.id),r=lt[r.id]}return B(r,"root")?r:Ee(`Unexpected resolution for reference ${this.reference}
Seen: [${i.join("->")}] 
Resolution: ${ce(r)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const t=this.reference.slice(1),r=this.$.resolutions[t];return typeof r=="string"?r:B(r,"root")?r.id:Ee(`Unexpected resolution for reference ${this.reference}: ${ce(r)}`)}get defaultShortDescription(){return Dt.object}innerToJsonSchema(t){return this.resolution.toJsonSchemaRecurse(t)}compile(t){const r=this.resolutionId;t.if(`ctx.seen.${r} && ctx.seen.${r}.includes(data)`,()=>t.return(!0)),t.if(`!ctx.seen.${r}`,()=>t.line(`ctx.seen.${r} = []`)),t.line(`ctx.seen.${r}.push(data)`),t.return(t.invoke(r))}}const Uv=(e,n)=>`Alias '${e}' has a shallow resolution cycle: ${[...n,e].join("->")}`,Qo={implementation:Bv,Node:qv};class ea extends Tr{constructor(){super(...arguments);y(this,"traverseApply",(t,r)=>{this.traverseAllows(t,r)||r.errorFromNodeContext(this.errorContext)})}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Li(this.errorContext)}compile(t){t.traversalKind==="Allows"?t.return(this.compiledCondition):t.if(this.compiledNegation,()=>t.line(`${t.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}}const Kv=we({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:e=>typeof e=="string"?{domain:e}:Eo(e,"numberAllowsNaN")&&e.domain!=="number"?I(ta.writeBadAllowNanMessage(e.domain)):e,applyConfig:(e,n)=>e.numberAllowsNaN===void 0&&e.domain==="number"&&n.numberAllowsNaN?{...e,numberAllowsNaN:!0}:e,defaults:{description:e=>Dt[e.domain],actual:e=>Number.isNaN(e)?"NaN":Dt[yt(e)]},intersections:{domain:(e,n)=>e.domain==="number"&&n.domain==="number"?e.numberAllowsNaN?n:e:V.init("domain",e,n)}});class jv extends ea{constructor(){super(...arguments);y(this,"requiresNaNCheck",this.domain==="number"&&!this.numberAllowsNaN);y(this,"traverseAllows",this.requiresNaNCheck?t=>typeof t=="number"&&!Number.isNaN(t):t=>yt(t)===this.domain);y(this,"compiledCondition",this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`);y(this,"compiledNegation",this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`);y(this,"expression",this.numberAllowsNaN?"number | NaN":this.domain)}get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Dt[this.domain]}innerToJsonSchema(t){return this.domain==="bigint"||this.domain==="symbol"?t.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const ta={implementation:Kv,Node:jv,writeBadAllowNanMessage:e=>`numberAllowsNaN may only be specified with domain "number" (was ${e})`},Wv=we({kind:"intersection",hasAssociatedError:!0,normalize:e=>{if(Ge(e))return e;const{structure:n,...t}=e,r=!!n,i=n??{},s=fe(t,(o,a)=>Ot(o,Fb)?(r&&I(`Flattened structure key ${o} cannot be specified alongside a root 'structure' key.`),i[o]=a,[]):[o,a]);return(B(i,"constraint")||!Er(i))&&(s.structure=i),s},finalizeInnerJson:({structure:e,...n})=>fn(e,"object")?{...e,...n}:n,keys:{domain:{child:!0,parse:(e,n)=>n.$.node("domain",e)},proto:{child:!0,parse:(e,n)=>n.$.node("proto",e)},structure:{child:!0,parse:(e,n)=>n.$.node("structure",e),serialize:e=>{var o;if(!((o=e.sequence)!=null&&o.minLength))return e.collapsibleJson;const{sequence:n,...t}=e.collapsibleJson,{minVariadicLength:r,...i}=n,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...t,sequence:s}}},divisor:{child:!0,parse:Ze("divisor")},max:{child:!0,parse:Ze("max")},min:{child:!0,parse:Ze("min")},maxLength:{child:!0,parse:Ze("maxLength")},minLength:{child:!0,parse:Ze("minLength")},exactLength:{child:!0,parse:Ze("exactLength")},before:{child:!0,parse:Ze("before")},after:{child:!0,parse:Ze("after")},pattern:{child:!0,parse:Ze("pattern")},predicate:{child:!0,parse:Ze("predicate")}},reduce:(e,n)=>Sd({},e,{$:n,invert:!1,pipe:!1}),defaults:{description:e=>{if(e.children.length===0)return"unknown";if(e.structure)return e.structure.description;const n=[];if(e.basis&&!e.refinements.some(t=>t.impl.obviatesBasisDescription)&&n.push(e.basis.description),e.refinements.length){const t=e.refinements.toSorted((r,i)=>r.kind==="min"&&i.kind==="max"?-1:0).map(r=>r.description);n.push(...t)}return e.inner.predicate&&n.push(...e.inner.predicate.map(t=>t.description)),n.join(" and ")},expected:e=>`  ◦ ${e.errors.map(n=>n.expected).join(`
  ◦ `)}`,problem:e=>`(${e.actual}) must be...
${e.expected}`},intersections:{intersection:(e,n,t)=>Sd(e.inner,n.inner,t),...Fr("intersection",(e,n,t)=>{var c;if(e.children.length===0)return n;const{domain:r,proto:i,...s}=e.inner,o=i??r,a=o?Pe(o,n,t):n;return a instanceof V?a:(c=e==null?void 0:e.basis)!=null&&c.equals(a)?e:e.$.node("intersection",{...s,[a.kind]:a},{prereduced:!0})})}});class Hv extends Tr{constructor(){super(...arguments);y(this,"basis",this.inner.domain??this.inner.proto??null);y(this,"refinements",this.children.filter(t=>t.isRefinement()));y(this,"structure",this.inner.structure);y(this,"expression",Gv(this));y(this,"traverseAllows",(t,r)=>this.children.every(i=>i.traverseAllows(t,r)));y(this,"traverseApply",(t,r)=>{const i=r.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(t,r),r.currentErrorCount>i))){if(this.refinements.length){for(let s=0;s<this.refinements.length-1;s++)if(this.refinements[s].traverseApply(t,r),r.failFast&&r.currentErrorCount>i)return;if(this.refinements.at(-1).traverseApply(t,r),r.currentErrorCount>i)return}if(!(this.structure&&(this.structure.traverseApply(t,r),r.currentErrorCount>i))&&this.inner.predicate){for(let s=0;s<this.inner.predicate.length-1;s++)if(this.inner.predicate[s].traverseApply(t,r),r.failFast&&r.currentErrorCount>i)return;this.inner.predicate.at(-1).traverseApply(t,r)}}})}get shallowMorphs(){var t;return(t=this.inner.structure)!=null&&t.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){var t;return((t=this.basis)==null?void 0:t.defaultShortDescription)??"present"}innerToJsonSchema(t){return this.children.reduce((r,i)=>i.isBasis()?i.toJsonSchemaRecurse(t):i.reduceJsonSchema(r,t),{})}compile(t){if(t.traversalKind==="Allows"){for(const r of this.children)t.check(r);t.return(!0);return}if(t.initializeErrorCount(),this.basis&&(t.check(this.basis),this.children.length>1&&t.returnIfFail()),this.refinements.length){for(let r=0;r<this.refinements.length-1;r++)t.check(this.refinements[r]),t.returnIfFailFast();t.check(this.refinements.at(-1)),(this.structure||this.inner.predicate)&&t.returnIfFail()}if(this.structure&&(t.check(this.structure),this.inner.predicate&&t.returnIfFail()),this.inner.predicate){for(let r=0;r<this.inner.predicate.length-1;r++)t.check(this.inner.predicate[r]),t.returnIfFail();t.check(this.inner.predicate.at(-1))}}}const wd={implementation:Wv,Node:Hv},Gv=e=>{var t;let n=((t=e.structure)==null?void 0:t.expression)||`${e.basis&&!e.refinements.some(r=>r.impl.obviatesBasisExpression)?e.basis.nestableExpression+" ":""}${e.refinements.map(r=>r.expression).join(" & ")}`||"unknown";return n==="Array == 0"&&(n="[]"),n},Sd=(e,n,t)=>{const r={},i=e.proto??e.domain,s=n.proto??n.domain,o=i?s?Pe(i,s,t):i:s;return o instanceof V?o:(o&&(r[o.kind]=o),Bi({kind:"intersection",baseInner:r,l:qi(e),r:qi(n),roots:[],ctx:t}))},Jv=we({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(e,n)=>n.$.parseSchema(e)},morphs:{parse:Mr,serialize:e=>e.map(n=>B(n,"root")?n.json:He(n))},declaredIn:{child:!1,serialize:e=>e.json},declaredOut:{child:!1,serialize:e=>e.json}},normalize:e=>e,defaults:{description:e=>{var n;return`a morph from ${e.in.description} to ${((n=e.out)==null?void 0:n.description)??"unknown"}`}},intersections:{morph:(e,n,t)=>{if(!e.hasEqualMorphs(n))return I(Zv(e.expression,n.expression));const r=Pe(e.in,n.in,t);if(r instanceof V)return r;const i={morphs:e.morphs};if(e.declaredIn||n.declaredIn){const s=Pe(e.in,n.in,t);if(s instanceof V)return s.throw();i.declaredIn=s}if(e.declaredOut||n.declaredOut){const s=Pe(e.out,n.out,t);if(s instanceof V)return s.throw();i.declaredOut=s}return r.distribute(s=>t.$.node("morph",{...i,in:s}),t.$.parseSchema)},...Fr("morph",(e,n,t)=>{const r=e.inner.in?Pe(e.inner.in,n,t):n;return r instanceof V?r:r.equals(e.inner.in)?e:t.$.node("morph",{...e.inner,in:r})})}});class Yv extends Tr{constructor(){super(...arguments);y(this,"serializedMorphs",this.morphs.map(He));y(this,"compiledMorphs",`[${this.serializedMorphs}]`);y(this,"lastMorph",this.inner.morphs.at(-1));y(this,"lastMorphIfNode",B(this.lastMorph,"root")?this.lastMorph:void 0);y(this,"introspectableIn",this.inner.in);y(this,"introspectableOut",this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.out:void 0);y(this,"expression",`(In: ${this.in.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.out.expression}>`);y(this,"traverseAllows",(t,r)=>!this.introspectableIn||this.introspectableIn.traverseAllows(t,r));y(this,"traverseApply",(t,r)=>{this.introspectableIn&&this.introspectableIn.traverseApply(t,r),r.queueMorphs(this.morphs)})}get shallowMorphs(){var t;return Array.isArray((t=this.inner.in)==null?void 0:t.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get in(){var t;return this.declaredIn??((t=this.inner.in)==null?void 0:t.in)??A.intrinsic.unknown.internal}get out(){return this.declaredOut??this.introspectableOut??A.intrinsic.unknown.internal}declareIn(t){return this.$.node("morph",{...this.inner,declaredIn:t})}declareOut(t){return this.$.node("morph",{...this.inner,declaredOut:t})}get defaultShortDescription(){return this.in.meta.description??this.in.defaultShortDescription}innerToJsonSchema(t){var r;return t.fallback.morph({code:"morph",base:this.in.toJsonSchemaRecurse(t),out:((r=this.introspectableOut)==null?void 0:r.toJsonSchemaRecurse(t))??null})}compile(t){if(t.traversalKind==="Allows"){if(!this.introspectableIn)return;t.return(t.invoke(this.introspectableIn));return}this.introspectableIn&&t.line(t.invoke(this.introspectableIn)),t.line(`ctx.queueMorphs(${this.compiledMorphs})`)}hasEqualMorphs(t){return Fn(this.morphs,t.morphs,{isEqual:(r,i)=>r===i||B(r,"root")&&B(i,"root")&&r.equals(i)})}}const kd={implementation:Jv,Node:Yv},Zv=(e,n)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${e}
Right: ${n}`,Xv=we({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:e=>Ao(e)??pn(e)},dateAllowsInvalid:{}},normalize:e=>{const n=typeof e=="string"?{proto:Ln[e]}:typeof e=="function"?Ge(e)?e:{proto:e}:typeof e.proto=="string"?{...e,proto:Ln[e.proto]}:e;return typeof n.proto!="function"&&I(Gi.writeInvalidSchemaMessage(n.proto)),Eo(n,"dateAllowsInvalid")&&n.proto!==Date&&I(Gi.writeBadInvalidDateMessage(n.proto)),n},applyConfig:(e,n)=>e.dateAllowsInvalid===void 0&&e.proto===Date&&n.dateAllowsInvalid?{...e,dateAllowsInvalid:!0}:e,defaults:{description:e=>e.builtinName?tb[e.builtinName]:`an instance of ${e.proto.name}`,actual:e=>e instanceof Date&&e.toString()==="Invalid Date"?"an invalid Date":Io(e)},intersections:{proto:(e,n)=>e.proto===Date&&n.proto===Date?e.dateAllowsInvalid?n:e:ku(e.proto,n.proto)?e:ku(n.proto,e.proto)?n:V.init("proto",e,n),domain:(e,n)=>n.domain==="object"?e:V.init("domain",A.intrinsic.object.internal,n)}});class Qv extends ea{constructor(){super(...arguments);y(this,"builtinName",Ao(this.proto));y(this,"serializedConstructor",this.json.proto);y(this,"requiresInvalidDateCheck",this.proto===Date&&!this.dateAllowsInvalid);y(this,"traverseAllows",this.requiresInvalidDateCheck?t=>t instanceof Date&&t.toString()!=="Invalid Date":t=>t instanceof this.proto);y(this,"compiledCondition",`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`);y(this,"compiledNegation",`!(${this.compiledCondition})`);y(this,"expression",this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name);y(this,"domain","object")}innerToJsonSchema(t){var r,i;switch(this.builtinName){case"Array":return{type:"array"};case"Date":return((i=(r=t.fallback).date)==null?void 0:i.call(r,{code:"date",base:{}}))??t.fallback.proto({code:"proto",base:{},proto:this.proto});default:return t.fallback.proto({code:"proto",base:{},proto:this.proto})}}get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}get defaultShortDescription(){return this.description}}const Gi={implementation:Xv,Node:Qv,writeBadInvalidDateMessage:e=>`dateAllowsInvalid may only be specified with constructor Date (was ${e.name})`,writeInvalidSchemaMessage:e=>`instanceOf operand must be a function (was ${yt(e)})`},e_=we({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(e,n)=>{const t=[];for(const r of e){const i=B(r,"root")?r.branches:n.$.parseSchema(r).branches;for(const s of i)if(s.hasKind("morph")){const o=t.findIndex(a=>a.hasKind("morph")&&a.hasEqualMorphs(s));if(o===-1)t.push(s);else{const a=t[o];t[o]=n.$.node("morph",{...a.inner,in:a.in.rawOr(s.in)})}}else t.push(s)}return n.def.ordered||t.sort((r,i)=>r.hash<i.hash?-1:1),t}}},normalize:e=>Ke(e)?{branches:e}:e,reduce:(e,n)=>{const t=d_(e);if(t.length===1)return t[0];if(t.length!==e.branches.length)return n.node("union",{...e,branches:t},{prereduced:!0})},defaults:{description:e=>e.distribute(n=>n.description,Gn),expected:e=>{const n=Uy(e.errors,"propString"),t=Object.entries(n).map(([r,i])=>{const s=[];for(const c of i)hn(s,c.expected);const o=Gn(s),a=i.every(c=>c.actual===i[0].actual)?i[0].actual:ce(i[0].data);return`${r&&`${r} `}must be ${o}${a&&` (was ${a})`}`});return Gn(t)},problem:e=>e.expected,message:e=>e.problem},intersections:{union:(e,n,t)=>{if(e.isNever!==n.isNever)return V.init("presence",e,n);let r;return e.ordered?(n.ordered&&I(f_(e.expression,n.expression)),r=na(n.branches,e.branches,t),r instanceof V&&r.invert()):r=na(e.branches,n.branches,t),r instanceof V?r:t.$.parseSchema(e.ordered||n.ordered?{branches:r,ordered:!0}:{branches:r})},...Fr("union",(e,n,t)=>{const r=na(e.branches,[n],t);return r instanceof V?r:r.length===1?r[0]:t.$.parseSchema(e.ordered?{branches:r,ordered:!0}:{branches:r})})}});class t_ extends Tr{constructor(){super(...arguments);y(this,"isBoolean",this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0));y(this,"unitBranches",this.branches.filter(t=>t.in.hasKind("unit")));y(this,"discriminant",this.discriminate());y(this,"discriminantJson",this.discriminant?l_(this.discriminant):null);y(this,"expression",this.distribute(t=>t.nestableExpression,u_));y(this,"traverseAllows",(t,r)=>this.branches.some(i=>i.traverseAllows(t,r)));y(this,"traverseApply",(t,r)=>{const i=[];for(let s=0;s<this.branches.length;s++){if(r.pushBranch(),this.branches[s].traverseApply(t,r),!r.hasError())return this.branches[s].includesTransform?r.queuedMorphs.push(...r.popBranch().queuedMorphs):r.popBranch();i.push(r.popBranch().error)}r.errorFromNodeContext({code:"union",errors:i,meta:this.meta})});y(this,"traverseOptimistic",t=>{for(let r=0;r<this.branches.length;r++){const i=this.branches[r];if(i.traverseAllows(t))return i.contextFreeMorph?i.contextFreeMorph(t):t}return Tt})}get branchGroups(){const t=[];let r=-1;for(const i of this.branches){if(i.hasKind("unit")&&i.domain==="boolean"){r===-1?(r=t.length,t.push(i)):t[r]=A.intrinsic.boolean;continue}t.push(i)}return t}createBranchedOptimisticRootApply(){return(t,r)=>{const i=this.traverseOptimistic(t);if(i!==Tt)return i;const s=new Un(t,this.$.resolvedConfig);return this.traverseApply(t,s),s.finalize(r)}}get shallowMorphs(){return this.branches.reduce((t,r)=>hn(t,r.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(t=>t.defaultShortDescription,Gn)}innerToJsonSchema(t){if(this.branchGroups.length===1&&this.branchGroups[0].equals(A.intrinsic.boolean))return{type:"boolean"};const r=this.branchGroups.map(i=>i.toJsonSchemaRecurse(t));return r.every(i=>Object.keys(i).length===1&&Eo(i,"const"))?{enum:r.map(i=>i.const)}:{anyOf:r}}compile(t){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(t);let r=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(r=`typeof ${r} === "object" ? ${r} === null ? "null" : "object" : typeof ${r} === "function" ? "object" : typeof ${r}`);const i=this.discriminant.cases,s=Object.keys(i),{optimistic:o}=t;if(t.optimistic=!1,t.block(`switch(${r})`,()=>{for(const d in i){const h=i[d],f=d==="default"?d:`case ${d}`;t.line(`${f}: return ${h===!0?o?t.data:h:o?`${t.invoke(h)} ? ${h.contextFreeMorph?`${He(h.contextFreeMorph)}(${t.data})`:t.data} : "${Tt}"`:t.invoke(h)}`)}return t}),t.traversalKind==="Allows"){t.return(o?`"${Tt}"`:!1);return}const a=Gn(this.discriminant.kind==="domain"?s.map(d=>{const h=d.slice(1,-1);return h==="function"?Dt.object:Dt[h]}):s),c=this.discriminant.path.map(d=>typeof d=="symbol"?He(d):JSON.stringify(d)),l=JSON.stringify(a),u=this.discriminant.kind==="domain"?`${o_}[${r}]`:`${a_}(${r})`;t.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${l},
	actual: ${u},
	relativePath: [${c}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(t){if(t.traversalKind==="Apply"){t.const("errors","[]");for(const r of this.branches)t.line("ctx.pushBranch()").line(t.invoke(r)).if("!ctx.hasError()",()=>t.return(r.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");t.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:r}=t;t.optimistic=!1;for(const i of this.branches)t.if(`${t.invoke(i)}`,()=>t.return(r?i.contextFreeMorph?`${He(i.contextFreeMorph)}(${t.data})`:t.data:!0));t.return(r?`"${Tt}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){var o,a;if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const c=fe(this.unitBranches,(l,u)=>[`${u.in.serializedValue}`,u.hasKind("morph")?u:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:c}}const t=[];for(let c=0;c<this.branches.length-1;c++){const l=this.branches[c];for(let u=c+1;u<this.branches.length;u++){const d=this.branches[u],h=Lt(l.in,d.in,l.$);if(h instanceof V)for(const f of h){if(!f.kind||f.optional)continue;let p,g;if(f.kind==="domain"){const _=f.l,v=f.r;p=`"${typeof _=="string"?_:_.domain}"`,g=`"${typeof v=="string"?v:v.domain}"`}else if(f.kind==="unit")p=f.l.serializedValue,g=f.r.serializedValue;else continue;const b=t.find(_=>Fn(_.path,f.path)&&_.kind===f.kind);b?(b.cases[p]?b.cases[p].branchIndices=hn(b.cases[p].branchIndices,c):(o=b.cases)[p]??(o[p]={branchIndices:[c],condition:f.l}),b.cases[g]?b.cases[g].branchIndices=hn(b.cases[g].branchIndices,u):(a=b.cases)[g]??(a[g]={branchIndices:[u],condition:f.r})):t.push({kind:f.kind,cases:{[p]:{branchIndices:[c],condition:f.l},[g]:{branchIndices:[u],condition:f.r}},path:f.path})}}}const r=this.ordered?i_(t,this.branches):t;if(!r.length)return null;const i=n_(r,this),s={};for(const c in i.best.cases){const l=r_(i,c);if(l===null){s[c]=!0;continue}if(l.length===this.branches.length)return null;this.ordered&&l.sort((h,f)=>h.originalIndex-f.originalIndex);const u=l.map(h=>h.branch),d=u.length===1?u[0]:this.$.node("union",this.ordered?{branches:u,ordered:!0}:u);Object.assign(this.referencesById,d.referencesById),s[c]=d}if(i.defaultEntries.length){const c=i.defaultEntries.map(l=>l.branch);s.default=this.$.node("union",this.ordered?{branches:c,ordered:!0}:c,{prereduced:!0}),Object.assign(this.referencesById,s.default.referencesById)}return Object.assign(i.location,{cases:s})}}const n_=(e,n)=>{const t=e.sort((s,o)=>Object.keys(o.cases).length-Object.keys(s.cases).length)[0],r={kind:t.kind,path:t.path,optionallyChainedPropString:$d(t.path)},i=n.branches.map((s,o)=>({originalIndex:o,branch:s}));return{best:t,location:r,defaultEntries:i,node:n}},r_=(e,n)=>{const t=e.best.cases[n],r=s_(t.condition,e.location.path,e.node.$);let i=[];const s=[];for(let o=0;o<e.defaultEntries.length;o++){const a=e.defaultEntries[o];if(t.branchIndices.includes(a.originalIndex)){const c=Md(e.node.branches[a.originalIndex],e.location);c===null?i=null:i==null||i.push({originalIndex:a.originalIndex,branch:c})}else if(a.branch.hasKind("alias")&&r.hasKind("domain")&&r.domain==="object")i==null||i.push(a);else{if(a.branch.in.overlaps(r)){const c=Md(a.branch,e.location);i==null||i.push({originalIndex:a.originalIndex,branch:c})}s.push(a)}}return e.defaultEntries=s,i},i_=(e,n)=>e.filter(r=>{const i=Object.values(r.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const c=i[a];for(const l of o)for(const u of c)if(l>u&&n[l].overlaps(n[u]))return!1}}return!0}),s_=(e,n,t)=>{let r=e==="undefined"?t.node("unit",{unit:void 0}):e==="null"?t.node("unit",{unit:null}):e==="boolean"?t.units([!0,!1]):e;for(let i=n.length-1;i>=0;i--){const s=n[i];r=t.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...By(s).map(o=>({})),r]}:{domain:"object",required:[{key:s,value:r}]})}return r},$d=e=>e.reduce((n,t)=>n+Fu(t,!0),"data"),o_=He(Ky),a_=He(ce),Cd={implementation:e_,Node:t_},l_=e=>({kind:e.kind,path:e.path.map(n=>typeof n=="string"?n:Pr(n)),cases:fe(e.cases,(n,t)=>[n,t===!0?t:t.hasKind("union")&&t.discriminantJson?t.discriminantJson:t.json])}),c_={delimiter:" | ",finalDelimiter:" | "},u_=e=>Gn(e,c_),Gn=(e,n)=>{const t=(n==null?void 0:n.delimiter)??", ",r=(n==null?void 0:n.finalDelimiter)??" or ";if(e.length===0)return"never";if(e.length===1)return e[0];if(e.length===2&&e[0]==="false"&&e[1]==="true"||e[0]==="true"&&e[1]==="false")return"boolean";const i={},s=e.filter(a=>i[a]?!1:i[a]=!0),o=s.pop();return`${s.join(t)}${s.length?r:""}${o}`},na=(e,n,t)=>{const r=n.map(()=>[]);for(let s=0;s<e.length;s++){let o={};for(let a=0;a<n.length;a++){if(r[a]===null)continue;if(e[s].equals(n[a])){r[a]=null,o={};break}const c=Pe(e[s],n[a],t);if(!(c instanceof V)){if(c.equals(e[s])){r[a].push(e[s]),o={};break}c.equals(n[a])?r[a]=null:o[a]=c}}for(const a in o)r[a][s]=o[a]}const i=r.flatMap((s,o)=>(s==null?void 0:s.flatMap(a=>a.branches))??n[o]);return i.length===0?V.init("union",e,n):i},d_=({branches:e,ordered:n})=>{if(e.length<2)return e;const t=e.map(()=>!0);for(let r=0;r<e.length;r++)for(let i=r+1;i<e.length&&t[r]&&t[i];i++){if(e[r].equals(e[i])){t[i]=!1;continue}const s=Lt(e[r].in,e[i].in,e[0].$);s instanceof V||(n||h_(e[r],e[i]),s.equals(e[r].in)?t[r]=!!n:s.equals(e[i].in)&&(t[i]=!1))}return e.filter((r,i)=>t[i])},h_=(e,n)=>{!e.includesTransform&&!n.includesTransform||(Fn(e.shallowMorphs,n.shallowMorphs)||I(Ed(e.expression,n.expression)),Fn(e.flatMorphs,n.flatMorphs,{isEqual:(t,r)=>{var i,s;return t.propString===r.propString&&(t.node.hasKind("morph")&&r.node.hasKind("morph")?t.node.hasEqualMorphs(r.node):t.node.hasKind("intersection")&&r.node.hasKind("intersection")?((i=t.node.structure)==null?void 0:i.structuralMorphRef)===((s=r.node.structure)==null?void 0:s.structuralMorphRef):!1)}})||I(Ed(e.expression,n.expression)))},Md=(e,n)=>e.transform((t,r)=>t==="domain"||t==="unit"?null:r,{shouldTransform:(t,r)=>{const i=$d(r.path);return n.optionallyChainedPropString.startsWith(i)?t.hasKind("domain")&&t.domain==="object"||(t.hasKind("domain")||n.kind==="unit")&&i===n.optionallyChainedPropString?!0:t.children.length!==0&&t.kind!=="index":!1}}),Ed=(e,n)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${e}
Right: ${n}`,f_=(e,n)=>`The intersection of two ordered unions is indeterminate:
Left: ${e}
Right: ${n}`,p_=we({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:e=>e instanceof Date?e.toISOString():pn(e)}},normalize:e=>e,defaults:{description:e=>ce(e.unit),problem:({expected:e,actual:n})=>`${e===n?`must be reference equal to ${e} (serialized to the same value)`:`must be ${e} (was ${n})`}`},intersections:{unit:(e,n)=>V.init("unit",e,n),...Fr("unit",(e,n)=>{if(n.allows(e.unit))return e;const t=n.hasKind("intersection")?n.basis:n;if(t){const r=t.hasKind("domain")?t:A.intrinsic.object;if(e.domain!==r.domain){const i=e.domain==="undefined"||e.domain==="null"||e.domain==="boolean"?e.domain:A.intrinsic[e.domain];return V.init("domain",i,r)}}return V.init("assignability",e,n.hasKind("intersection")?n.children.find(r=>!r.allows(e.unit)):n)})}});class m_ extends ea{constructor(){super(...arguments);y(this,"compiledValue",this.json.unit);y(this,"serializedValue",typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`);y(this,"compiledCondition",Id(this.unit,this.serializedValue));y(this,"compiledNegation",Id(this.unit,this.serializedValue,"negated"));y(this,"expression",ce(this.unit));y(this,"domain",yt(this.unit));y(this,"traverseAllows",this.unit instanceof Date?t=>t instanceof Date&&t.toISOString()===this.compiledValue:Number.isNaN(this.unit)?t=>Number.isNaN(t):t=>t===this.unit)}get defaultShortDescription(){return this.domain==="object"?Dt.object:this.description}innerToJsonSchema(t){return this.unit===null?{type:"null"}:A.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:t.fallback.unit({code:"unit",base:{},unit:this.unit})}}const Od={implementation:p_,Node:m_},Id=(e,n,t)=>{if(e instanceof Date){const r=`data instanceof Date && data.toISOString() === ${n}`;return t?`!(${r})`:r}return Number.isNaN(e)?`${t?"!":""}Number.isNaN(data)`:`data ${t?"!":"="}== ${n}`},g_=we({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(e,n)=>{const t=n.$.parseSchema(e);if(!t.extends(A.intrinsic.key))return I(v_(t.expression));const r=t.branches.filter(i=>i.hasKind("unit"));return r.length?I(b_(r.map(i=>ce(i.unit)))):t}},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`[${e.signature.expression}]: ${e.value.description}`},intersections:{index:(e,n,t)=>{if(e.signature.equals(n.signature)){const r=Pe(e.value,n.value,t),i=r instanceof V?A.intrinsic.never.internal:r;return t.$.node("index",{signature:e.signature,value:i})}return e.signature.extends(n.signature)&&e.value.subsumes(n.value)?n:n.signature.extends(e.signature)&&n.value.subsumes(e.value)?e:null}}});class y_ extends jn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.object.internal);y(this,"expression",`[${this.signature.expression}]: ${this.value.expression}`);y(this,"flatRefs",he(this.value.flatRefs.map(t=>Yt([this.signature,...t.path],t.node)),Yt([this.signature],this.value)));y(this,"traverseAllows",(t,r)=>Ii(t).every(i=>this.signature.traverseAllows(i[0],r)?Vt(i[0],()=>this.value.traverseAllows(i[1],r),r):!0));y(this,"traverseApply",(t,r)=>{for(const i of Ii(t))this.signature.traverseAllows(i[0],r)&&Vt(i[0],()=>this.value.traverseApply(i[1],r),r)})}_transform(t,r){r.path.push(this.signature);const i=super._transform(t,r);return r.path.pop(),i}compile(){}}const Ad={implementation:g_,Node:y_},b_=e=>`Index keys ${e.join(", ")} should be specified as named props.`,v_=e=>`Indexed key definition '${e}' must be a string or symbol`,__=we({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(e,n)=>n.$.parseSchema(e)}},normalize:e=>e,defaults:{description:e=>`${e.compiledKey}: ${e.value.description}`,expected:e=>e.missingValueDescription,actual:()=>"missing"},intersections:{required:Jo,optional:Jo}});class x_ extends gd{constructor(){super(...arguments);y(this,"expression",`${this.compiledKey}: ${this.value.expression}`);y(this,"errorContext",Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta}));y(this,"compiledErrorContext",Li(this.errorContext))}}const Nd={implementation:__,Node:x_},w_=we({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}},optionals:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}},defaultables:{child:e=>e.map(n=>n[0]),parse:(e,n)=>{if(e.length!==0)return e.map(t=>{const r=n.$.parseSchema(t[0]);return Xo(r,t[1],null),[r,t[1]]})},serialize:e=>e.map(n=>[n[0].collapsibleJson,pn(n[1])])},variadic:{child:!0,parse:(e,n)=>n.$.parseSchema(e,n)},minVariadicLength:{parse:e=>e===0?void 0:e},postfix:{child:!0,parse:(e,n)=>{if(e.length!==0)return e.map(t=>n.$.parseSchema(t))}}},normalize:e=>{var n,t,r;if(typeof e=="string")return{variadic:e};if("variadic"in e||"prefix"in e||"defaultables"in e||"optionals"in e||"postfix"in e||"minVariadicLength"in e){if((n=e.postfix)!=null&&n.length){if(!e.variadic)return I(C_);if((t=e.optionals)!=null&&t.length||(r=e.defaultables)!=null&&r.length)return I(Dd)}return e.minVariadicLength&&!e.variadic?I("minVariadicLength may not be specified without a variadic element"):e}return{variadic:e}},reduce:(e,n)=>{var a,c,l,u,d,h,f;let t=e.minVariadicLength??0;const r=((a=e.prefix)==null?void 0:a.slice())??[],i=((c=e.defaultables)==null?void 0:c.slice())??[],s=((l=e.optionals)==null?void 0:l.slice())??[],o=((u=e.postfix)==null?void 0:u.slice())??[];if(e.variadic){for(;(d=s.at(-1))!=null&&d.equals(e.variadic);)s.pop();if(s.length===0&&i.length===0)for(;(h=r.at(-1))!=null&&h.equals(e.variadic);)r.pop(),t++;for(;(f=o[0])!=null&&f.equals(e.variadic);)o.shift(),t++}else s.length===0&&i.length===0&&r.push(...o.splice(0));if(t!==e.minVariadicLength||e.prefix&&e.prefix.length!==r.length)return n.node("sequence",{...e,prefix:r,defaultables:i,optionals:s,postfix:o,minVariadicLength:t},{prereduced:!0})},defaults:{description:e=>e.isVariadicOnly?`${e.variadic.nestableExpression}[]`:`[${e.tuple.map(t=>t.kind==="defaultables"?`${t.node.nestableExpression} = ${ce(t.default)}`:t.kind==="optionals"?`${t.node.nestableExpression}?`:t.kind==="variadic"?`...${t.node.nestableExpression}[]`:t.node.expression).join(", ")}]`},intersections:{sequence:(e,n,t)=>{const r=Vr({l:e.tuple,r:n.tuple,disjoint:new V,result:[],fixedVariants:[],ctx:t}),i=r.disjoint.length===0?[r,...r.fixedVariants]:r.fixedVariants;return i.length===0?r.disjoint:i.length===1?t.$.node("sequence",Pd(i[0].result)):t.$.node("union",i.map(s=>({proto:Array,sequence:Pd(s.result)})))}}});class S_ extends jn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.Array.internal);y(this,"tuple",$_(this.inner));y(this,"prefixLength",((ep=this.prefix)==null?void 0:ep.length)??0);y(this,"defaultablesLength",((tp=this.defaultables)==null?void 0:tp.length)??0);y(this,"optionalsLength",((np=this.optionals)==null?void 0:np.length)??0);y(this,"postfixLength",((rp=this.postfix)==null?void 0:rp.length)??0);y(this,"defaultablesAndOptionals",[]);y(this,"prevariadic",this.tuple.filter(t=>t.kind==="defaultables"||t.kind==="optionals"?(this.defaultablesAndOptionals.push(t.node),!0):t.kind==="prefix"));y(this,"variadicOrPostfix",dn(this.variadic&&[this.variadic],this.postfix));y(this,"flatRefs",this.addFlatRefs());y(this,"isVariadicOnly",this.prevariadic.length+this.postfixLength===0);y(this,"minVariadicLength",this.inner.minVariadicLength??0);y(this,"minLength",this.prefixLength+this.minVariadicLength+this.postfixLength);y(this,"minLengthNode",this.minLength===0?null:this.$.node("minLength",this.minLength));y(this,"maxLength",this.variadic?null:this.tuple.length);y(this,"maxLengthNode",this.maxLength===null?null:this.$.node("maxLength",this.maxLength));y(this,"impliedSiblings",this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[]);y(this,"defaultValueMorphs",k_(this));y(this,"defaultValueMorphsReference",this.defaultValueMorphs.length?He(this.defaultValueMorphs):void 0);y(this,"traverseAllows",(t,r)=>{for(let i=0;i<t.length;i++)if(!this.elementAtIndex(t,i).node.traverseAllows(t[i],r))return!1;return!0});y(this,"traverseApply",(t,r)=>{let i=0;for(;i<t.length;i++)Vt(i,()=>this.elementAtIndex(t,i).node.traverseApply(t[i],r),r)});y(this,"expression",this.description)}addFlatRefs(){return Gu(this.flatRefs,this.prevariadic.flatMap((t,r)=>he(t.node.flatRefs.map(i=>Yt([`${r}`,...i.path],i.node)),Yt([`${r}`],t.node)))),Gu(this.flatRefs,this.variadicOrPostfix.flatMap(t=>he(t.flatRefs.map(r=>Yt([A.intrinsic.nonNegativeIntegerString.internal,...r.path],r.node)),Yt([A.intrinsic.nonNegativeIntegerString.internal],t)))),this.flatRefs}elementAtIndex(t,r){if(r<this.prevariadic.length)return this.tuple[r];const i=t.length-this.postfixLength;return r>=i?{kind:"postfix",node:this.postfix[r-i]}:{kind:"variadic",node:this.variadic??Ee(`Unexpected attempt to access index ${r} on ${this}`)}}get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(t){if(this.prefix)for(const[r,i]of this.prefix.entries())t.traverseKey(`${r}`,`data[${r}]`,i);for(const[r,i]of this.defaultablesAndOptionals.entries()){const s=`${r+this.prefixLength}`;t.if(`${s} >= ${t.data}.length`,()=>t.traversalKind==="Allows"?t.return(!0):t.return()),t.traverseKey(s,`data[${s}]`,i)}if(this.variadic&&(this.postfix&&t.const("firstPostfixIndex",`${t.data}.length${this.postfix?`- ${this.postfix.length}`:""}`),t.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>t.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[r,i]of this.postfix.entries()){const s=`firstPostfixIndex + ${r}`;t.traverseKey(s,`data[${s}]`,i)}t.traversalKind==="Allows"&&t.return(!0)}_transform(t,r){r.path.push(A.intrinsic.nonNegativeIntegerString.internal);const i=super._transform(t,r);return r.path.pop(),i}reduceJsonSchema(t,r){if(this.prevariadic.length&&(t.prefixItems=this.prevariadic.map(i=>{const s=i.node.toJsonSchemaRecurse(r);if(i.kind==="defaultables"){const o=typeof i.default=="function"?i.default():i.default;s.default=A.intrinsic.jsonData.allows(o)?o:r.fallback.defaultValue({code:"defaultValue",base:s,value:o})}return s})),this.minLength&&(t.minItems=this.minLength),this.variadic){const i=Object.assign(t,{items:this.variadic.toJsonSchemaRecurse(r)});if(this.maxLength&&(i.maxItems=this.maxLength),this.postfix){const s=this.postfix.map(o=>o.toJsonSchemaRecurse(r));t=r.fallback.arrayPostfix({code:"arrayPostfix",base:i,elements:s})}}else t.items=!1,delete t.maxItems;return t}}const ra={},k_=e=>{if(!e.defaultables)return[];const n=[];let t="[";const r=e.prefixLength+e.defaultablesLength-1;for(let i=e.prefixLength;i<=r;i++){const[s,o]=e.defaultables[i-e.prefixLength];n.push(bd(i,s,o)),t+=`${i}: ${s.id} = ${pn(o)}, `}return t+="]",ra[t]??(ra[t]=n)},Rd={implementation:w_,Node:S_},$_=e=>{const n=[];if(e.prefix)for(const t of e.prefix)n.push({kind:"prefix",node:t});if(e.defaultables)for(const[t,r]of e.defaultables)n.push({kind:"defaultables",node:t,default:r});if(e.optionals)for(const t of e.optionals)n.push({kind:"optionals",node:t});if(e.variadic&&n.push({kind:"variadic",node:e.variadic}),e.postfix)for(const t of e.postfix)n.push({kind:"postfix",node:t});return n},Pd=e=>e.reduce((n,t)=>(t.kind==="variadic"?n.variadic=t.node:t.kind==="defaultables"?n.defaultables=he(n.defaultables,[[t.node,t.default]]):n[t.kind]=he(n[t.kind],t.node),n),{}),Dd="A postfix required element cannot follow an optional or defaultable element",C_="A postfix element requires a variadic element",Vr=e=>{var d,h;const[n,...t]=e.l,[r,...i]=e.r;if(!n||!r)return e;const s=((d=t.at(-1))==null?void 0:d.kind)==="postfix",o=((h=i.at(-1))==null?void 0:h.kind)==="postfix",a=n.kind==="prefix"||r.kind==="prefix"?"prefix":n.kind==="postfix"||r.kind==="postfix"?"postfix":n.kind==="variadic"&&r.kind==="variadic"?"variadic":s||o?"prefix":n.kind==="defaultables"||r.kind==="defaultables"?"defaultables":"optionals";if(n.kind==="prefix"&&r.kind==="variadic"&&o){const f=Vr({...e,fixedVariants:[],r:i.map(p=>({...p,kind:"prefix"}))});f.disjoint.length===0&&e.fixedVariants.push(f)}else if(r.kind==="prefix"&&n.kind==="variadic"&&s){const f=Vr({...e,fixedVariants:[],l:t.map(p=>({...p,kind:"prefix"}))});f.disjoint.length===0&&e.fixedVariants.push(f)}const c=Pe(n.node,r.node,e.ctx);if(c instanceof V)if(a==="prefix"||a==="postfix")e.disjoint.push(...c.withPrefixKey(a==="prefix"?e.result.length:`-${t.length+1}`,"required")),e.result=[...e.result,{kind:a,node:A.intrinsic.never.internal}];else return a==="optionals"||a==="defaultables"?e:Vr({...e,fixedVariants:[],l:t.map(f=>({...f,kind:"prefix"})),r:t.map(f=>({...f,kind:"prefix"}))});else a==="defaultables"?(n.kind==="defaultables"&&r.kind==="defaultables"&&n.default!==r.default&&I(yd(n.default,r.default)),e.result=[...e.result,{kind:a,node:c,default:n.kind==="defaultables"?n.default:r.kind==="defaultables"?r.default:Ee(`Unexpected defaultable intersection from ${n.kind} and ${r.kind} elements.`)}]):e.result=[...e.result,{kind:a,node:c}];const l=e.l.length,u=e.r.length;return(n.kind!=="variadic"||l>=u&&(r.kind==="variadic"||u===1))&&(e.l=t),(r.kind!=="variadic"||u>=l&&(n.kind==="variadic"||l===1))&&(e.r=i),Vr(e)},Td=e=>n=>{var t,r;if(n.props.length||n.index){const i=((t=n.index)==null?void 0:t.map(o=>o[e]))??[];for(const o of n.props)i.push(o[e]);n.undeclared&&i.push(`+ (undeclared): ${n.undeclared}`);const s=`{ ${i.join(", ")} }`;return n.sequence?`${s} & ${n.sequence.description}`:s}return((r=n.sequence)==null?void 0:r.description)??"{}"},M_=Td("description"),E_=Td("expression"),Fd=(e,n,t)=>{const r=e.required?"required":"optional";if(!n.signature.allows(e.key))return null;const i=Lt(e.value,n.value,t);return i instanceof V?r==="optional"?t.node("optional",{key:e.key,value:A.intrinsic.never.internal}):i.withPrefixKey(e.key,e.kind):null},O_=we({kind:"structure",hasAssociatedError:!1,normalize:e=>e,applyConfig:(e,n)=>!e.undeclared&&n.onUndeclaredKey!=="ignore"?{...e,undeclared:n.onUndeclaredKey}:e,keys:{required:{child:!0,parse:Ze("required"),reduceIo:(e,n,t)=>{n.required=he(n.required,t.map(r=>r[e]))}},optional:{child:!0,parse:Ze("optional"),reduceIo:(e,n,t)=>{if(e==="in"){n.optional=t.map(r=>r.in);return}for(const r of t)n[r.outProp.kind]=he(n[r.outProp.kind],r.outProp.out)}},index:{child:!0,parse:Ze("index")},sequence:{child:!0,parse:Ze("sequence")},undeclared:{parse:e=>e==="ignore"?void 0:e,reduceIo:(e,n,t)=>{t==="delete"&&(e==="in"?delete n.undeclared:n.undeclared="reject")}}},defaults:{description:M_},intersections:{structure:(e,n,t)=>{const r={...e.inner},i={...n.inner},s=new V;if(e.undeclared){const c=e.keyof();for(const l of n.requiredKeys)c.allows(l)||s.add("presence",A.intrinsic.never.internal,n.propsByKey[l].value,{path:[l]});i.optional&&(i.optional=i.optional.filter(l=>c.allows(l.key))),i.index&&(i.index=i.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Lt(c,l.signature,t.$);if(u instanceof V)return[];const d=sa(u,l.value,t.$);return d.required&&(i.required=dn(i.required,d.required)),d.optional&&(i.optional=dn(i.optional,d.optional)),d.index??[]}))}if(n.undeclared){const c=n.keyof();for(const l of e.requiredKeys)c.allows(l)||s.add("presence",e.propsByKey[l].value,A.intrinsic.never.internal,{path:[l]});r.optional&&(r.optional=r.optional.filter(l=>c.allows(l.key))),r.index&&(r.index=r.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Lt(c,l.signature,t.$);if(u instanceof V)return[];const d=sa(u,l.value,t.$);return d.required&&(r.required=dn(r.required,d.required)),d.optional&&(r.optional=dn(r.optional,d.optional)),d.index??[]}))}const o={};(e.undeclared||n.undeclared)&&(o.undeclared=e.undeclared==="reject"||n.undeclared==="reject"?"reject":"delete");const a=Bi({kind:"structure",baseInner:o,l:qi(r),r:qi(i),roots:[],ctx:t});return a instanceof V&&s.push(...a),s.length?s:a}},reduce:(e,n)=>{if(e.index){if(!(e.required||e.optional))return;let t=!1;const r=e.required??[],i=e.optional??[],s=[...i];for(const o of e.index){for(const a of r){const c=Fd(a,o,n);if(c instanceof V)return c}for(const[a,c]of i.entries()){const l=Fd(c,o,n);if(l instanceof V)return l;l!==null&&(s[a]=l,t=!0)}}if(t)return n.node("structure",{...e,optional:s},{prereduced:!0})}}});class I_ extends jn{constructor(){super(...arguments);y(this,"impliedBasis",A.intrinsic.object.internal);y(this,"impliedSiblings",this.children.flatMap(t=>t.impliedSiblings??[]));y(this,"props",dn(this.required,this.optional));y(this,"propsByKey",fe(this.props,(t,r)=>[r.key,r]));y(this,"propsByKeyReference",He(this.propsByKey));y(this,"expression",E_(this));y(this,"requiredKeys",((ip=this.required)==null?void 0:ip.map(t=>t.key))??[]);y(this,"optionalKeys",((sp=this.optional)==null?void 0:sp.map(t=>t.key))??[]);y(this,"literalKeys",[...this.requiredKeys,...this.optionalKeys]);y(this,"_keyof");y(this,"traverseAllows",(t,r)=>this._traverse("Allows",t,r));y(this,"traverseApply",(t,r)=>this._traverse("Apply",t,r));y(this,"_traverse",(t,r,i)=>{const s=(i==null?void 0:i.currentErrorCount)??0;for(let o=0;o<this.props.length;o++)if(t==="Allows"){if(!this.props[o].traverseAllows(r,i))return!1}else if(this.props[o].traverseApply(r,i),i.failFast&&i.currentErrorCount>s)return!1;if(this.sequence){if(t==="Allows"){if(!this.sequence.traverseAllows(r,i))return!1}else if(this.sequence.traverseApply(r,i),i.failFast&&i.currentErrorCount>s)return!1}if(this.index||this.undeclared==="reject"){const o=Object.keys(r);o.push(...Object.getOwnPropertySymbols(r));for(let a=0;a<o.length;a++){const c=o[a];if(this.index){for(const l of this.index)if(l.signature.traverseAllows(c,i)){if(t==="Allows"){if(!Vt(c,()=>l.value.traverseAllows(r[c],i),i))return!1}else if(Vt(c,()=>l.value.traverseApply(r[c],i),i),i.failFast&&i.currentErrorCount>s)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(c)&&(t==="Allows"||(i.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[c],meta:this.meta}),i.failFast)))return!1}}return this.structuralMorph&&i&&!i.hasError()&&i.queueMorphs([this.structuralMorph]),!0});y(this,"declaresKey",t=>{var r;return t in this.propsByKey||((r=this.index)==null?void 0:r.some(i=>i.signature.allows(t)))||this.sequence!==void 0&&A.intrinsic.nonNegativeIntegerString.allows(t)});y(this,"structuralMorphRef",this.structuralMorph&&He(this.structuralMorph))}keyof(){if(this._keyof)return this._keyof;let t=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:r}of this.index)t=t.concat(r.branches);return this._keyof=this.$.node("union",t)}map(t){return this.$.node("structure",this.props.flatMap(t).reduce((r,i)=>{const s=this.propsByKey[i.key];if(Ge(i))return i.kind!=="required"&&i.kind!=="optional"?I(`Map result must have kind "required" or "optional" (was ${i.kind})`):(r[i.kind]=he(r[i.kind],i),r);const o=i.kind??(s==null?void 0:s.kind)??"required",a=fe(i,(c,l)=>c in Yo.implementation.keys?[c,l]:[]);return r[o]=he(r[o],this.$.node(o,a)),r},{}))}assertHasKeys(t){const r=t.filter(i=>!Hi(i,this.keyof()));if(r.length)return I(Ld(this.expression,r))}get(t,...r){var c;let i,s=!1;const o=P_(t);if((typeof o=="string"||typeof o=="symbol")&&this.propsByKey[o]&&(i=this.propsByKey[o].value,s=this.propsByKey[o].required),this.index)for(const l of this.index)Hi(o,l.signature)&&(i=(i==null?void 0:i.and(l.value))??l.value);if(this.sequence&&Hi(o,A.intrinsic.nonNegativeIntegerString))if(B(o,"root"))this.sequence.variadic&&(i=(i==null?void 0:i.and(this.sequence.element))??this.sequence.element);else{const l=Number.parseInt(o);if(l<this.sequence.prevariadic.length){const u=this.sequence.prevariadic[l].node;i=(i==null?void 0:i.and(u))??u,s||(s=l<this.sequence.prefixLength)}else if(this.sequence.variadic){const u=this.$.node("union",this.sequence.variadicOrPostfix);i=(i==null?void 0:i.and(u))??u}}if(!i)return(c=this.sequence)!=null&&c.variadic&&B(o,"root")&&o.extends(A.intrinsic.number)?I(D_(o.expression,this.sequence.expression)):I(Ld(this.expression,[o]));const a=i.get(...r);return s?a:a.or(A.intrinsic.undefined)}pick(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("pick",t))}omit(...t){return this.assertHasKeys(t),this.$.node("structure",this.filterKeys("omit",t))}optionalize(){const{required:t,...r}=this.inner;return this.$.node("structure",{...r,optional:this.props.map(i=>i.hasKind("required")?this.$.node("optional",i.inner):i)})}require(){const{optional:t,...r}=this.inner;return this.$.node("structure",{...r,required:this.props.map(i=>i.hasKind("optional")?{key:i.key,value:i.value}:i)})}merge(t){const r=this.filterKeys("omit",[t.keyof()]);return t.required&&(r.required=he(r.required,t.required)),t.optional&&(r.optional=he(r.optional,t.optional)),t.index&&(r.index=he(r.index,t.index)),t.sequence&&(r.sequence=t.sequence),t.undeclared?r.undeclared=t.undeclared:delete r.undeclared,this.$.node("structure",r)}filterKeys(t,r){const i=Lu(this.inner),s=o=>{const a=r.some(c=>Hi(o,c));return t==="pick"?a:!a};return i.required&&(i.required=i.required.filter(o=>s(o.key))),i.optional&&(i.optional=i.optional.filter(o=>s(o.key))),i.index&&(i.index=i.index.filter(o=>s(o.signature))),i}get defaultable(){var t;return this.cacheGetter("defaultable",((t=this.optional)==null?void 0:t.filter(r=>r.hasDefault()))??[])}_compileDeclaresKey(t){const r=[];if(this.props.length&&r.push(`k in ${this.propsByKeyReference}`),this.index)for(const i of this.index)r.push(t.invoke(i.signature,{kind:"Allows",arg:"k"}));return this.sequence&&r.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),r.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",N_(this))}compile(t){t.traversalKind==="Apply"&&t.initializeErrorCount();for(const r of this.props)t.check(r),t.traversalKind==="Apply"&&t.returnIfFailFast();if(this.sequence&&(t.check(this.sequence),t.traversalKind==="Apply"&&t.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(t.const("keys","Object.keys(data)"),t.line("keys.push(...Object.getOwnPropertySymbols(data))"),t.for("i < keys.length",()=>this.compileExhaustiveEntry(t))),t.traversalKind==="Allows")return t.return(!0);this.structuralMorphRef&&t.if("ctx && !ctx.hasError()",()=>(t.line("ctx.queueMorphs(["),R_(t,this),t.line("])")))}compileExhaustiveEntry(t){if(t.const("k","keys[i]"),this.index)for(const r of this.index)t.if(`${t.invoke(r.signature,{arg:"k",kind:"Allows"})}`,()=>t.traverseKey("k","data[k]",r.value));return this.undeclared==="reject"&&t.if(`!(${this._compileDeclaresKey(t)})`,()=>t.traversalKind==="Allows"?t.return(!1):t.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>t.return())),t}reduceJsonSchema(t,r){var i;switch(t.type){case"object":return this.reduceObjectJsonSchema(t,r);case"array":const s=((i=this.sequence)==null?void 0:i.reduceJsonSchema(t,r))??t;return this.props.length||this.index?r.fallback.arrayObject({code:"arrayObject",base:s,object:this.reduceObjectJsonSchema({type:"object"},r)}):s;default:return Ae.throwInternalOperandError("structure",t)}}reduceObjectJsonSchema(t,r){if(this.props.length){t.properties={};for(const i of this.props){const s=i.value.toJsonSchemaRecurse(r);if(typeof i.key=="symbol"){r.fallback.symbolKey({code:"symbolKey",base:t,key:i.key,value:s,optional:i.optional});continue}if(i.hasDefault()){const o=typeof i.default=="function"?i.default():i.default;s.default=A.intrinsic.jsonData.allows(o)?o:r.fallback.defaultValue({code:"defaultValue",base:s,value:o})}t.properties[i.key]=s}this.requiredKeys.length&&t.properties&&(t.required=this.requiredKeys.filter(i=>typeof i=="string"&&i in t.properties))}if(this.index)for(const i of this.index){const s=i.value.toJsonSchemaRecurse(r);if(i.signature.equals(A.intrinsic.string)){t.additionalProperties=s;continue}for(const o of i.signature.branches){if(!o.extends(A.intrinsic.string)){t=r.fallback.symbolKey({code:"symbolKey",base:t,key:null,value:s,optional:!1});continue}let a={type:"string"};if(o.hasKind("morph")&&(a=r.fallback.morph({code:"morph",base:o.in.toJsonSchemaRecurse(r),out:o.out.toJsonSchemaRecurse(r)})),!o.hasKind("intersection"))return Ee(`Unexpected index branch kind ${o.kind}.`);const{pattern:c}=o.inner;if(c){const l=Object.assign(a,{pattern:c[0].rule});for(let u=1;u<c.length;u++)a=r.fallback.patternIntersection({code:"patternIntersection",base:l,pattern:c[u].rule});t.patternProperties??(t.patternProperties={}),t.patternProperties[l.pattern]=s}}}return this.undeclared&&!t.additionalProperties&&(t.additionalProperties=!1),t}}const ia={},A_=e=>{var t,r;let n="";for(let i=0;i<e.defaultable.length;i++)n+=e.defaultable[i].defaultValueMorphRef;if((t=e.sequence)!=null&&t.defaultValueMorphsReference&&(n+=(r=e.sequence)==null?void 0:r.defaultValueMorphsReference),e.undeclared==="delete"){if(n+="delete !(",e.required)for(const i of e.required)n+=i.compiledKey+" | ";if(e.optional)for(const i of e.optional)n+=i.compiledKey+" | ";if(e.index)for(const i of e.index)n+=i.signature.id+" | ";if(e.sequence)if(e.sequence.maxLength===null)n+=j.nonNegativeIntegerString.id;else for(let i=0;i<e.sequence.tuple.length;i++)n+=i+" | ";n+=")"}return n},N_=e=>{const n=A_(e);if(!n)return;if(ia[n])return ia[n];const t=(r,i)=>{var s;for(let o=0;o<e.defaultable.length;o++)e.defaultable[o].key in r||e.defaultable[o].defaultValueMorph(r,i);if((s=e.sequence)!=null&&s.defaultables)for(let o=r.length-e.sequence.prefixLength;o<e.sequence.defaultables.length;o++)e.sequence.defaultValueMorphs[o](r,i);if(e.undeclared==="delete")for(const o in r)e.declaresKey(o)||delete r[o];return r};return ia[n]=t},R_=(e,n)=>{var i;const r=`(data${n.defaultable.some(s=>s.defaultValueMorph.length===2)||((i=n.sequence)==null?void 0:i.defaultValueMorphs.some(s=>s.length===2))?", ctx":""})`;return e.block(`${r} => `,s=>{var o;for(let a=0;a<n.defaultable.length;a++){const{serializedKey:c,defaultValueMorphRef:l}=n.defaultable[a];s.if(`!(${c} in data)`,u=>u.line(`${l}${r}`))}return(o=n.sequence)!=null&&o.defaultables&&s.for(`i < ${n.sequence.defaultables.length}`,a=>a.set("data[i]",5),`data.length - ${n.sequence.prefixLength}`),n.undeclared==="delete"&&s.forIn("data",a=>a.if(`!(${n._compileDeclaresKey(a)})`,c=>c.line("delete data[k]"))),s.return("data")})},Vd={implementation:O_,Node:I_},P_=e=>(B(e,"root")&&e.hasKind("unit")&&(e=e.unit),typeof e=="number"&&(e=`${e}`),e),D_=(e,n)=>`${e} is not allowed as an array index on ${n}. Use the 'nonNegativeIntegerString' keyword instead.`,sa=(e,n,t)=>{const[r,i]=zy(e.branches,o=>o.hasKind("unit"));if(!r.length)return{index:t.node("index",{signature:e,value:n})};const s={};for(const o of r){const a=t.node("required",{key:o.unit,value:n});s[a.kind]=he(s[a.kind],a)}return i.length&&(s.index=t.node("index",{signature:i,value:n})),s},T_=e=>B(e,"root")?e.expression:ce(e),Ld=(e,n)=>`Key${n.length===1?"":"s"} ${n.map(T_).join(", ")} ${n.length===1?"does":"do"} not exist on ${e}`,Ji={...Cv,alias:Qo.implementation,domain:ta.implementation,unit:Od.implementation,proto:Gi.implementation,union:Cd.implementation,morph:kd.implementation,intersection:wd.implementation,divisor:ed.implementation,pattern:hd.implementation,predicate:Qu.implementation,required:Nd.implementation,optional:Yo.implementation,index:Ad.implementation,sequence:Rd.implementation,structure:Vd.implementation};A.defaultConfig=Xy(Object.assign(fe(Ji,(e,n)=>[e,n.defaults]),{jitless:sb(),clone:nb,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:Ae.defaultConfig})),A.resolvedConfig=Uo(A.defaultConfig,A.config);const F_={...Mv,alias:Qo.Node,domain:ta.Node,unit:Od.Node,proto:Gi.Node,union:Cd.Node,morph:kd.Node,intersection:wd.Node,divisor:ed.Node,pattern:hd.Node,predicate:Qu.Node,required:Nd.Node,optional:Yo.Node,index:Ad.Node,sequence:Rd.Node,structure:Vd.Node};class oa extends Hy{get[Ft](){return"module"}}const zd=(e,n)=>new oa(fe(e,(t,r)=>[t,B(r,"module")?zd(r,n):n.bindReference(r)])),V_=e=>Ke(e)?e:"branches"in e&&Ke(e.branches)?e.branches:void 0,L_=(e,n)=>I(`Node of kind ${n} is not valid as a ${e} definition`),Bd=e=>`#${e} duplicates public alias ${e}`,aa={};A.ambient??(A.ambient={});let qd;const Ud="function $",z_=e=>Kd(e,jd(e)),Kd=(e,n)=>{const t=n.write(Ud,4),r=n.compile()();for(const i of e)i.precompilation||(i.traverseAllows=r[`${i.id}Allows`].bind(r),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=r[`${i.id}Apply`].bind(r),r[`${i.id}Optimistic`]&&(i.traverseOptimistic=r[`${i.id}Optimistic`].bind(r)),i.precompilation=t)},jd=e=>new Tu().return(e.reduce((n,t)=>{const r=new zo({kind:"Allows"}).indent();t.compile(r);const i=r.write(`${t.id}Allows`),s=new zo({kind:"Apply"}).indent();t.compile(s);const o=s.write(`${t.id}Apply`),a=`${n}${i},
${o},
`;if(!t.hasKind("union"))return a;const c=new zo({kind:"Allows",optimistic:!0}).indent();t.compile(c);const l=c.write(`${t.id}Optimistic`);return`${a}${l},
`},`{
`)+"}");class Wd{constructor(n,t){y(this,"config");y(this,"resolvedConfig");y(this,"name");y(this,"referencesById",{});y(this,"references",[]);y(this,"resolutions",{});y(this,"exportedNames",[]);y(this,"aliases",{});y(this,"resolved",!1);y(this,"nodesByHash",{});y(this,"intrinsic");y(this,"_json");y(this,"generic",(...n)=>{const t=this;return(r,i)=>new Ui(n,i?new Xu(r):r,t,t,i??null)});y(this,"units",(n,t)=>{const r=[];for(const s of n)r.includes(s)||r.push(s);const i=r.map(s=>this.node("unit",{unit:s},t));return this.node("union",i,{...t,prereduced:!0})});y(this,"lazyResolutions",[]);y(this,"schema",(n,t)=>this.finalize(this.parseSchema(n,t)));y(this,"parseSchema",(n,t)=>this.node(Ki(n),n,t));y(this,"precompilation");y(this,"_exportedResolutions");y(this,"_exports");y(this,"node",(n,t,r={})=>{const i=this.preparseNode(n,t,r);if(Ge(i))return this.bindReference(i);const s=this.createParseContext(i),o=md(s),a=this.bindReference(o);return lt[s.id]=a});y(this,"parse",(n,t={})=>this.finalize(this.parseDefinition(n,t)));this.config=Uo(A.config,t),this.resolvedConfig=Uo(A.resolvedConfig,t),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(aa).length}`,this.name in aa&&I(`A Scope already named ${this.name} already exists`),aa[this.name]=this;const r=Object.entries(n).map(i=>this.preparseOwnAliasEntry(...i));for(const[i,s]of r){let o=i;if(i[0]==="#"?(o=i.slice(1),o in this.aliases&&I(Bd(o)),this.aliases[o]=s):(o in this.aliases&&I(Bd(i)),this.aliases[o]=s,this.exportedNames.push(o)),!B(s,"module")&&!B(s,"generic")&&!Ai(s)){const a=this.preparseOwnDefinitionFormat(s,{alias:o});this.resolutions[o]=B(a,"root")?this.bindReference(a):this.createParseContext(a).id}}qd??(qd=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0})),this.nodesByHash[qd.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=A.intrinsic?fe(A.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}get[Ft](){return"scope"}cacheGetter(n,t){return Object.defineProperty(this,n,{value:t}),t}get internal(){return this}get json(){return this._json||this.export(),this._json}defineSchema(n){return n}lazilyResolve(n,t){const r=this.node("alias",{reference:t??"synthetic",resolve:n},{prereduced:!0});return this.resolved||this.lazyResolutions.push(r),r}preparseNode(n,t,r){var a;let i=typeof n=="string"?n:Ki(t,n);if(Ge(t)&&t.kind===i)return t;if(i==="alias"&&!(r!=null&&r.prereduced)){const{reference:c}=Qo.implementation.normalize(t,this);if(c.startsWith("$")){const l=this.resolveRoot(c.slice(1));t=l,i=l.kind}}else if(i==="union"&&fn(t,"object")){const c=V_(t);(c==null?void 0:c.length)===1&&(t=c[0],i=Ki(t))}if(Ge(t)&&t.kind===i)return t;const s=Ji[i],o=((a=s.normalize)==null?void 0:a.call(s,t,this))??t;return Ge(o)?o.kind===i?o:L_(i,o.kind):{...r,$:this,kind:i,def:o,prefix:r.alias??i}}bindReference(n){let t;return Ge(n)?t=n.$===this?n:new n.constructor(n.attachments,this):t=n.$===this?n:new Ui(n.params,n.bodyDef,n.$,this,n.hkt),this.resolved||Object.assign(this.referencesById,t.referencesById),t}resolveRoot(n){return this.maybeResolveRoot(n)??I(Zd(n))}maybeResolveRoot(n){const t=this.maybeResolve(n);if(!B(t,"generic"))return t}maybeResolveSubalias(n){return la(this.aliases,n)??la(this.ambient,n)}get ambient(){return A.ambient}maybeResolve(n){var i;const t=this.resolutions[n];if(t){if(typeof t!="string")return this.bindReference(t);const s=lt[t];if(B(s,"root"))return this.resolutions[n]=s;if(B(s,"context")){if(s.phase==="resolving")return this.node("alias",{reference:`$${n}`},{prereduced:!0});if(s.phase==="resolved")return Ee(`Unexpected resolved context for was uncached by its scope: ${ce(s)}`);s.phase="resolving";const o=this.bindReference(this.parseOwnDefinitionFormat(s.def,s));return s.phase="resolved",lt[o.id]=o,lt[s.id]=o,this.resolutions[n]=o}return Ee(`Unexpected nodesById entry for ${t}: ${ce(s)}`)}let r=this.aliases[n]??((i=this.ambient)==null?void 0:i[n]);return r?(r=this.normalizeRootScopeValue(r),B(r,"generic")?this.resolutions[n]=this.bindReference(r):B(r,"module")?(r.root||I(Xd(n)),this.resolutions[n]=this.bindReference(r.root)):this.resolutions[n]=this.parse(r,{alias:n})):this.maybeResolveSubalias(n)}createParseContext(n){const t=n.id??pd(n.prefix);return lt[t]=Object.assign(n,{[Ft]:"context",$:this,id:t,phase:"unresolved"})}traversal(n){return new Un(n,this.resolvedConfig)}import(...n){return new oa(fe(this.export(...n),(t,r)=>[`#${t}`,r]))}export(...n){if(!this._exports){this._exports={};for(const r of this.exportedNames){const i=this.aliases[r];this._exports[r]=B(i,"module")?zd(i,this):Gd(this.maybeResolve(r))}for(const r of this.lazyResolutions)r.resolution;if(this._exportedResolutions=Yd(this,this._exports),this._json=Jd(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const r=jd(this.references);this.precompilation=r.write(Ud,4),Kd(this.references,r)}this.resolved=!0}const t=n.length?n:this.exportedNames;return new oa(fe(t,(r,i)=>[i,this._exports[i]]))}resolve(n){return this.export()[n]}parseDefinition(n,t={}){if(B(n,"root"))return this.bindReference(n);const r=this.preparseOwnDefinitionFormat(n,t);if(B(r,"root"))return this.bindReference(r);const i=this.createParseContext(r);lt[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(n,i));return s.isCyclic&&(s=Nv(s,i.id)),lt[i.id]=s,s}finalize(n){return Gd(n),!n.precompilation&&!this.resolvedConfig.jitless&&z_(n.references),n}}class Hd extends Wd{parseOwnDefinitionFormat(n,t){return md(t)}preparseOwnDefinitionFormat(n,t){return this.preparseNode(Ki(n),n,t)}preparseOwnAliasEntry(n,t){return[n,t]}normalizeRootScopeValue(n){return n}}const Gd=e=>{const n=e.references.filter(t=>t.hasKind("alias"));for(const t of n){Object.assign(t.referencesById,t.resolution.referencesById);for(const r of e.references)t.id in r.referencesById&&Object.assign(r.referencesById,t.referencesById)}return e},Jd=e=>fe(e,(n,t)=>[n,B(t,"root")||B(t,"generic")?t.json:B(t,"module")?Jd(t):Ee(`Unexpected resolution ${ce(t)}`)]),la=(e,n)=>{const t=n.indexOf(".");if(t===-1)return;const r=n.slice(0,t),i=e[r];if(i===void 0)return;if(!B(i,"module"))return I(B_(r));const s=n.slice(t+1),o=i[s];if(o===void 0)return la(i,s);if(B(o,"root")||B(o,"generic"))return o;if(B(o,"module"))return o.root??I(Xd(n));Ee(`Unexpected resolution for alias '${n}': ${ce(o)}`)},ca=(e,n)=>new Hd(e,n),Lr=new Hd({}),Yd=(e,n)=>{const t={};for(const r in n){const i=n[r];if(B(i,"module")){const s=Yd(e,i),o=fe(s,(a,c)=>[`${r}.${a}`,c]);Object.assign(t,o)}else B(i,"root")||B(i,"generic")?t[r]=i:Ee(`Unexpected scope resolution ${ce(i)}`)}return t},Zd=e=>`'${e}' is unresolvable`,B_=e=>`'${e}' must reference a module to be accessed using dot syntax`,Xd=e=>`Reference to submodule '${e}' must specify an alias`;Lr.export();const ye=Lr.schema,ua=Lr.node;Lr.defineSchema;const zt=Lr.generic,Qd="^(?:0|[1-9]\\d*)$",q_=new RegExp(Qd);He(q_);const eh=ca({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();A.intrinsic={...eh};const th=ca({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:Qd}},{prereducedAliases:!0}).export();Object.assign(A.intrinsic,th);const U_=ca({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),j={...eh,...th,...U_,emptyStructure:ua("structure",{},{prereduced:!0})};A.intrinsic={...j};const K_=e=>typeof e=="string"&&e[0]==="d"&&(e[1]==="'"||e[1]==='"')&&e.at(-1)===e[1],nh=e=>e.toString()!=="Invalid Date",j_=e=>e.slice(2,-1),rh=e=>`'${e}' could not be parsed by the Date constructor`,W_=(e,n)=>H_(e,n),H_=(e,n)=>{const t=new Date(e);if(nh(t))return t;const r=wb(e);if(r!==void 0){const i=new Date(r);if(nh(i))return i}return n?I(n===!0?rh(e):n):void 0},ih=(e,n)=>{const t=e.scanner.shiftUntil(J_[oh[n]]);if(e.scanner.lookahead==="")return e.error(Z_(t,n));if(e.scanner.shift(),n==="/"){try{new RegExp(t)}catch(r){I(String(r))}e.root=e.ctx.$.node("intersection",{domain:"string",pattern:t},{prereduced:!0})}else if(Ot(n,sh))e.root=e.ctx.$.node("unit",{unit:t});else{const r=W_(t,rh(t));e.root=e.ctx.$.node("unit",{meta:t,unit:r})}},sh={"'":1,'"':1},G_={"/":1,"'":1,'"':1},oh={"d'":"'",'d"':'"',"'":"'",'"':'"',"/":"/"},J_={"'":e=>e.lookahead==="'",'"':e=>e.lookahead==='"',"/":e=>e.lookahead==="/"},Y_={'"':"double-quote","'":"single-quote","/":"forward slash"},Z_=(e,n)=>`${n}${e} requires a closing ${Y_[oh[n]]}`,X_=e=>`Private type references should not include '#'. Use '${e}' instead.`,ah="Optional definitions like 'string?' are only valid as properties in an object or tuple",lh="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",Q_={">":!0,">=":!0},e0={"<":!0,"<=":!0},Yi={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},t0=e=>`Unmatched )${e===""?"":` before ${e}`}`,ch=e=>`Missing ${e}`,n0=(e,n)=>`Left bounds are only valid when paired with right bounds (try ...${n}${e})`,uh=e=>`Left-bounded expressions must specify their limits using < or <= (was ${e})`,r0=(e,n,t,r)=>`An expression may have at most one left bound (parsed ${e}${Yi[n]}, ${t}${Yi[r]})`,i0=(e,n,t)=>dh(e,n,t,[]),dh=(e,n,t,r)=>{const i=t.parseUntilFinalizer();return r.push(i.root),i.finalizer===">"?r.length!==n.params.length?t.error(hh(e,n.names,r.map(s=>s.expression))):r:i.finalizer===","?dh(e,n,t,r):i.error(ch(">"))},hh=(e,n,t)=>`${e}<${n.join(", ")}> requires exactly ${n.length} args (got ${t.length}${t.length===0?"":`: ${t.join(", ")}`})`,fh=e=>{const n=e.scanner.shiftUntilNextTerminator();n==="keyof"?e.addPrefix("keyof"):e.root=o0(e,n)},s0=(e,n,t)=>{if(t.scanner.shiftUntilNonWhitespace(),t.scanner.shift()!=="<")return t.error(hh(e,n.names,[]));const i=i0(e,n,t);return n(...i)},o0=(e,n)=>a0(e,n)??l0(e,n)??e.error(n===""?e.scanner.lookahead==="#"?X_(e.shiftedByOne().scanner.shiftUntilNextTerminator()):ph(e):Zd(n)),a0=(e,n)=>{var r;if((r=e.ctx.args)!=null&&r[n]){const i=e.ctx.args[n];return typeof i!="string"?i:e.ctx.$.node("alias",{reference:i},{prereduced:!0})}const t=e.ctx.$.maybeResolve(n);if(B(t,"root"))return t;if(t!==void 0)return B(t,"generic")?s0(n,t,e):I(`Unexpected resolution ${ce(t)}`)},l0=(e,n)=>{const t=Sb(n);if(t!==void 0)return e.ctx.$.node("unit",{unit:t});const r=$b(n);if(r!==void 0)return e.ctx.$.node("unit",{unit:r})},ph=e=>{const n=e.previousOperator();return n?mh(n,e.scanner.unscanned):c0(e.scanner.unscanned)},mh=(e,n="")=>`Token '${e}' requires a right operand${n?` before '${n}'`:""}`,c0=e=>`Expected an expression${e?` before '${e}'`:""}`,gh=e=>e.scanner.lookahead===""?e.error(ph(e)):e.scanner.lookahead==="("?e.shiftedByOne().reduceGroupOpen():e.scanner.lookaheadIsIn(G_)?ih(e,e.scanner.shift()):e.scanner.lookaheadIsIn(Ni)?gh(e.shiftedByOne()):e.scanner.lookahead==="d"&&e.scanner.nextLookahead in sh?ih(e,`${e.scanner.shift()}${e.scanner.shift()}`):fh(e),xn=class xn extends Ab{shiftUntilNextTerminator(){return this.shiftUntilNonWhitespace(),this.shiftUntil(()=>this.lookahead in xn.terminatingChars)}};y(xn,"terminatingChars",{"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...Ni}),y(xn,"finalizingLookaheads",{">":1,",":1,"":1,"=":1,"?":1}),y(xn,"lookaheadIsFinalizing",(n,t)=>n===">"?t[0]==="="?t[1]==="=":t.trimStart()===""||Ot(t.trimStart()[0],xn.terminatingChars):n==="="?t[0]!=="=":n===","||n==="?");let zr=xn;const u0=(e,n)=>{const t=h0(e,n);if(e.root.hasKind("unit")){if(typeof e.root.unit=="number"){e.reduceLeftBound(e.root.unit,t),e.unsetRoot();return}if(e.root.unit instanceof Date){const r=`d'${e.root.description??e.root.unit.toISOString()}'`;e.unsetRoot(),e.reduceLeftBound(r,t);return}}return p0(e,t)},d0={"<":1,">":1,"=":1},h0=(e,n)=>e.scanner.lookaheadIs("=")?`${n}${e.scanner.shift()}`:n,yh=(e,n,t,r)=>t.extends(A.intrinsic.number)?typeof n!="number"?I(da(e,n,r)):e==="=="?["min","max"]:e[0]===">"?["min"]:["max"]:t.extends(A.intrinsic.lengthBoundable)?typeof n!="number"?I(da(e,n,r)):e==="=="?["exactLength"]:e[0]===">"?["minLength"]:["maxLength"]:t.extends(A.intrinsic.Date)?e==="=="?["after","before"]:e[0]===">"?["after"]:["before"]:I(dv(t.expression)),f0=e=>({rule:K_(e.limit)?j_(e.limit):e.limit,exclusive:e.comparator.length===1}),p0=(e,n)=>{const t=e.unsetRoot(),r=e.scanner.location;e.parseOperand();const i=e.unsetRoot(),s=e.scanner.sliceChars(r,e.scanner.location);if(e.root=t,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return e.error(da(n,s,"right"));const o=i.unit,a=n.length===1,c=yh(n,typeof o=="number"?o:s,t,"right");for(const u of c)e.constrainRoot(u,n==="=="?{rule:o}:{rule:o,exclusive:a});if(!e.branches.leftBound)return;if(!Ot(n,e0))return e.error(uh(n));const l=yh(e.branches.leftBound.comparator,e.branches.leftBound.limit,t,"left");e.constrainRoot(l[0],f0(e.branches.leftBound)),e.branches.leftBound=null},da=(e,n,t)=>`Comparator ${t==="left"?Yi[e]:e} must be ${t==="left"?"preceded":"followed"} by a corresponding literal (was ${n})`,m0=e=>{e.scanner.shiftUntilNonWhitespace();const n=e.scanner.shiftUntilNextTerminator();e.root=e.root.brand(n)},g0=e=>{const n=e.scanner.shiftUntilNextTerminator(),t=kb(n,{errorOnFail:bh(n)});t===0&&e.error(bh(0)),e.root=e.root.constrain("divisor",t)},bh=e=>`% operator must be followed by a non-zero integer literal (was ${e})`,vh=e=>{const n=e.scanner.shift();return n===""?e.finalize(""):n==="["?e.scanner.shift()==="]"?e.setRoot(e.root.array()):e.error(y0):n==="|"?e.scanner.lookahead===">"?e.shiftedByOne().pushRootToBranch("|>"):e.pushRootToBranch(n):n==="&"?e.pushRootToBranch(n):n===")"?e.finalizeGroup():zr.lookaheadIsFinalizing(n,e.scanner.unscanned)?e.finalize(n):Ot(n,d0)?u0(e,n):n==="%"?g0(e):n==="#"?m0(e):n in Ni?vh(e):e.error(ha(n))},ha=(e,n="")=>`'${e}' is not allowed here${n&&` (should be ${n})`}`,y0="Missing expected ']'",b0=e=>{const n=e.unsetRoot();e.parseOperand();const t=e.unsetRoot();if(!t.hasKind("unit"))return e.error(v0(t.expression));const r=t.unit instanceof Date?()=>new Date(t.unit):t.unit;return[n,"=",r]},v0=e=>`Default value '${e}' must a literal value`,_h=(e,n)=>{const t=n.$.maybeResolveRoot(e);if(t)return t;if(e.endsWith("[]")){const s=n.$.maybeResolveRoot(e.slice(0,-2));if(s)return s.array()}const r=new Zi(new zr(e),n),i=_0(r);return r.finalizer===">"&&I(ha(">")),i},_0=e=>{e.parseOperand();let n=fa(e).root;return n?(e.finalizer==="="?n=b0(e):e.finalizer==="?"&&(n=[n,"?"]),e.scanner.shiftUntilNonWhitespace(),e.scanner.lookahead&&I(ha(e.scanner.lookahead)),n):Ee(`Root was unexpectedly unset after parsing string '${e.scanner.scanned}'`)},fa=e=>{for(;e.finalizer===void 0;)x0(e);return e},x0=e=>e.hasRoot()?e.parseOperator():e.parseOperand();class Zi{constructor(n,t){y(this,"root");y(this,"branches",{prefixes:[],leftBound:null,intersection:null,union:null,pipe:null});y(this,"finalizer");y(this,"groups",[]);y(this,"scanner");y(this,"ctx");this.scanner=n,this.ctx=t}error(n){return I(n)}hasRoot(){return this.root!==void 0}setRoot(n){this.root=n}unsetRoot(){const n=this.root;return this.root=void 0,n}constrainRoot(...n){this.root=this.root.constrain(n[0],n[1])}finalize(n){if(this.groups.length)return this.error(ch(")"));this.finalizeBranches(),this.finalizer=n}reduceLeftBound(n,t){const r=Yi[t];if(!Ot(r,Q_))return this.error(uh(t));if(this.branches.leftBound)return this.error(r0(this.branches.leftBound.limit,this.branches.leftBound.comparator,n,r));this.branches.leftBound={comparator:r,limit:n}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const n=this.groups.pop();if(!n)return this.error(t0(this.scanner.unscanned));this.branches=n}addPrefix(n){this.branches.prefixes.push(n)}applyPrefixes(){for(;this.branches.prefixes.length;){const n=this.branches.prefixes.pop();this.root=n==="keyof"?this.root.keyof():Ee(`Unexpected prefix '${n}'`)}}pushRootToBranch(n){var r,i,s;this.assertRangeUnset(),this.applyPrefixes();const t=this.root;this.root=void 0,this.branches.intersection=((r=this.branches.intersection)==null?void 0:r.rawAnd(t))??t,n!=="&"&&(this.branches.union=((i=this.branches.union)==null?void 0:i.rawOr(this.branches.intersection))??this.branches.intersection,this.branches.intersection=null,n!=="|"&&(this.branches.pipe=((s=this.branches.pipe)==null?void 0:s.rawPipeOnce(this.branches.union))??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return fa(new Zi(this.scanner,this.ctx))}parseOperator(){return vh(this)}parseOperand(){return gh(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(n0(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){var n;return((n=this.branches.leftBound)==null?void 0:n.comparator)??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const w0="An empty string is not a valid generic parameter name",pa=(e,n,t)=>{e.shiftUntilNonWhitespace();const r=e.shiftUntilNextTerminator();return r===""?e.lookahead===""&&n.length?n:I(w0):(e.shiftUntilNonWhitespace(),S0(e,r,n,t))},xh="extends ",S0=(e,n,t,r)=>{if(e.shiftUntilNonWhitespace(),e.unscanned.startsWith(xh))e.jumpForward(xh.length);else return e.lookahead===","&&e.shift(),t.push(n),pa(e,t,r);const i=fa(new Zi(e,r));return t.push([n,i.root]),pa(e,t,r)};class k0 extends zn{constructor(t){super((...r)=>new Xi(t)(...r),{bind:t});y(this,"$");this.$=t}in(t){return new Xi(this.$,t===void 0?void 0:this.$.parse(t))}at(t,r){return new Xi(this.$).at(t,r)}case(t,r){return new Xi(this.$).case(t,r)}}class Xi extends zn{constructor(t,r){super(i=>this.caseEntries(Object.entries(i).map(([s,o])=>s==="default"?[s,o]:[this.$.parse(s),o])));y(this,"$");y(this,"in");y(this,"key");y(this,"branches",[]);this.$=t,this.in=r}at(t,r){return this.key&&I(C0),this.branches.length&&I($0),this.key=t,r?this.match(r):this}case(t,r){return this.caseEntry(this.$.parse(t),r)}caseEntry(t,r){const s=(this.key?this.$.parse({[this.key]:t}):t).pipe(r);return this.branches.push(s),this}match(t){return this(t)}strings(t){return this.caseEntries(Object.entries(t).map(([r,i])=>r==="default"?[r,i]:[this.$.node("unit",{unit:r}),i]))}caseEntries(t){for(let r=0;r<t.length;r++){const[i,s]=t[r];if(i==="default")return r!==t.length-1&&I("default may only be specified as the last key of a switch definition"),this.default(s);if(typeof s!="function")return I(`Value for case "${i}" must be a function (was ${yt(s)})`);this.caseEntry(i,s)}return this}default(t){typeof t=="function"&&this.case(j.unknown,t);const r={branches:this.branches,ordered:!0};(t==="never"||t==="assert")&&(r.meta={onFail:wh});const i=this.$.node("union",r);if(!this.in)return this.$.finalize(i);let s=this.in.pipe(i);return(t==="never"||t==="assert")&&(s=s.configureReferences({onFail:wh},"self")),this.$.finalize(s)}}const wh=e=>e.throw(),$0="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",C0="At most one key matcher may be specified per expression",Sh=(e,n)=>{if(Ke(e)){if(e[1]==="=")return[n.$.parseOwnDefinitionFormat(e[0],n),"=",e[2]];if(e[1]==="?")return[n.$.parseOwnDefinitionFormat(e[0],n),"?"]}return Rh(e,n)},M0="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",E0="Only required keys may specify default values, e.g. { value: 'number = 0' }",O0=(e,n)=>{var o;let t;const r={},i=Ii(e);for(const[a,c]of i){const l=N0(a);if(l.kind==="spread"){if(!Er(r))return I(A0);const p=n.$.parseOwnDefinitionFormat(c,n);if(p.equals(j.object))continue;if(!p.hasKind("intersection")||!((o=p.basis)!=null&&o.equals(j.object)))return I(R0(p.expression));t=p.structure;continue}if(l.kind==="undeclared"){c!=="reject"&&c!=="delete"&&c!=="ignore"&&I(I0(c)),r.undeclared=c;continue}const u=Sh(c,n),d=l;if(l.kind==="required"){Ke(u)?ma(r,"optional",u[1]==="="?{key:l.normalized,value:u[0],default:u[2]}:{key:l.normalized,value:u[0]},n):ma(r,"required",{key:l.normalized,value:u},n);continue}if(Ke(u)&&(u[1]==="?"&&I(M0),u[1]==="="&&I(E0)),l.kind==="optional"){ma(r,"optional",{key:l.normalized,value:u},n);continue}const h=n.$.parseOwnDefinitionFormat(d.normalized,n),f=sa(h,u,n.$);f.index&&(r.index=he(r.index,f.index)),f.required&&(r.required=he(r.required,f.required))}const s=n.$.node("structure",r);return n.$.parseSchema({domain:"object",structure:(t==null?void 0:t.merge(s))??s})},ma=(e,n,t,r)=>{e[n]=he(e[n],r.$.node(n,t))},I0=e=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${ce(e)})`,A0="Spread operator may only be used as the first key in an object",N0=e=>typeof e=="symbol"?{kind:"required",normalized:e}:e.at(-1)==="?"?e.at(-2)===No?{kind:"required",normalized:`${e.slice(0,-2)}?`}:{kind:"optional",normalized:e.slice(0,-1)}:e[0]==="["&&e.at(-1)==="]"?{kind:"index",normalized:e.slice(1,-1)}:e[0]===No&&e[1]==="["&&e.at(-1)==="]"?{kind:"required",normalized:e.slice(1)}:e==="..."?{kind:"spread"}:e==="+"?{kind:"undeclared"}:{kind:"required",normalized:e==="\\..."?"...":e==="\\+"?"+":e},R0=e=>`Spread operand must resolve to an object literal type (was ${e})`,P0=(e,n)=>U0(e)?Mh[e[0]](e,n):q0(e)?Ch[e[1]](e,n):null,D0=(e,n)=>n.$.parseOwnDefinitionFormat(e[1],n).keyof(),ga=(e,n)=>{if(e[2]===void 0)return I(mh(e[1],""));const t=n.$.parseOwnDefinitionFormat(e[0],n),r=n.$.parseOwnDefinitionFormat(e[2],n);if(e[1]==="|")return n.$.node("union",{branches:[t,r]});const i=e[1]==="&"?Lt(t,r,n.$):jo(t,r,n.$);return i instanceof V?i.throw():i},T0=(e,n)=>n.$.parseOwnDefinitionFormat(e[0],n).array(),F0=(e,n)=>typeof e[2]!="function"?I(kh("=>",e[2])):n.$.parseOwnDefinitionFormat(e[0],n).pipe(e[2]),kh=(e,n)=>`${e===":"?"Narrow":"Morph"} expression requires a function following '${e}' (was ${typeof n})`,V0=(e,n)=>typeof e[2]!="function"?I(kh(":",e[2])):n.$.parseOwnDefinitionFormat(e[0],n).constrain("predicate",e[2]),L0=(e,n)=>n.$.parseOwnDefinitionFormat(e[0],n).configureReferences(e[2],"shallow"),$h=e=>e,z0=$h({"[]":T0,"?":()=>I(ah)}),B0=$h({"|":ga,"&":ga,":":V0,"=>":F0,"|>":ga,"@":L0,"=":()=>I(lh)}),Ch={...z0,...B0},q0=e=>Ch[e[1]]!==void 0,Mh=(e=>e)({keyof:D0,instanceof:(e,n)=>{if(typeof e[1]!="function")return I(Eh(Io(e[1])));const t=e.slice(1).map(r=>typeof r=="function"?n.$.node("proto",{proto:r}):I(Eh(Io(r))));return t.length===1?t[0]:n.$.node("union",{branches:t})},"===":(e,n)=>n.$.units(e.slice(1))}),U0=e=>Mh[e[0]]!==void 0,Eh=e=>`Expected a constructor following 'instanceof' operator (was ${e})`,K0=(e,n)=>{let t=[{}],r=0;for(;r<e.length;){let i=!1;e[r]==="..."&&r<e.length-1&&(i=!0,r++);const s=Sh(e[r],n),[o,a,c]=Ke(s)?s:[s];if(r++,i){if(!o.extends(A.intrinsic.Array))return I(H0(o.expression));t=t.flatMap(l=>o.distribute(u=>W0(Lu(l),u)))}else t=t.map(l=>a==="?"?Oh(l,o):a==="="?j0(l,o,c):ya(l,o))}return n.$.parseSchema(t.map(i=>Er(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},ya=(e,n)=>e.defaultables||e.optionals?I(e.variadic?Dd:G0):(e.variadic?e.postfix=he(e.postfix,n):e.prefix=he(e.prefix,n),e),Oh=(e,n)=>e.variadic?I(Nh):(e.optionals=he(e.optionals,n),e),j0=(e,n,t)=>e.variadic?I(Nh):e.optionals?I(J0):(e.defaultables=he(e.defaultables,[[n,t]]),e),Ih=(e,n)=>(e.postfix&&I(Ah),e.variadic?e.variadic.equals(n)||I(Ah):e.variadic=n.internal,e),W0=(e,n)=>{const t=n.select({method:"find",kind:"sequence"});if(!t)return Ih(e,A.intrinsic.unknown);if(t.prefix)for(const r of t.prefix)ya(e,r);if(t.optionals)for(const r of t.optionals)Oh(e,r);if(t.variadic&&Ih(e,t.variadic),t.postfix)for(const r of t.postfix)ya(e,r);return e},H0=e=>`Spread element must be an array (was ${e})`,Ah="A tuple may have at most one variadic element",G0="A required element may not follow an optional element",Nh="An optional element may not follow a variadic element",J0="A defaultable element may not follow an optional element without a default",ba={},Rh=(e,n)=>{var t;if(typeof e=="string"){if(n.args&&Object.keys(n.args).some(i=>e.includes(i)))return _h(e,n);const r=ba[t=n.$.name]??(ba[t]={});return r[e]??(r[e]=_h(e,n))}return fn(e,"object")?Y0(e,n):I(va(yt(e)))},Y0=(e,n)=>{const t=Oo(e);switch(t){case void 0:return B(e,"root")?e:O0(e,n);case"Array":return Z0(e,n);case"RegExp":return n.$.node("intersection",{domain:"string",pattern:e},{prereduced:!0});case"Function":{const r=Ai(e)?e():e;return B(r,"root")?r:I(va("Function"))}default:return I(va(t??ce(e)))}},Z0=(e,n)=>P0(e,n)??K0(e,n),va=e=>`Type definitions must be strings or objects (was ${e})`;class X0 extends zn{constructor(n){const t=Object.assign({errors:Jt,hkt:It,$:n,raw:n.parse,module:n.constructor.module,scope:n.constructor.scope,define:n.define,match:n.match,generic:n.generic,schema:n.schema,keywords:n.ambient,unit:n.unit,enumerated:n.enumerated,instanceOf:n.instanceOf,valueOf:n.valueOf,or:n.or,and:n.and,merge:n.merge,pipe:n.pipe},n.ambientAttachments);super((...r)=>{if(r.length===1)return n.parse(r[0]);if(r.length===2&&typeof r[0]=="string"&&r[0][0]==="<"&&r[0].at(-1)===">"){const i=r[0].slice(1,-1),s=n.parseGenericParams(i,{});return new Ui(s,r[1],n,n,null)}return n.parse(r)},{bind:n,attach:t})}}const Br=A,tr=class tr extends Wd{constructor(){super(...arguments);y(this,"unit",t=>this.units([t]));y(this,"valueOf",t=>this.units(Qy(t)));y(this,"enumerated",(...t)=>this.units(t));y(this,"instanceOf",t=>this.node("proto",{proto:t},{prereduced:!0}));y(this,"or",(...t)=>this.schema(t.map(r=>this.parse(r))));y(this,"and",(...t)=>t.reduce((r,i)=>r.and(this.parse(i)),this.intrinsic.unknown));y(this,"merge",(...t)=>t.reduce((r,i)=>r.merge(this.parse(i)),this.intrinsic.object));y(this,"pipe",(...t)=>this.intrinsic.unknown.pipe(...t));y(this,"match",new k0(this));y(this,"declare",()=>({type:this.type}));y(this,"type",new X0(this))}get ambientAttachments(){if(Br.typeAttachments)return this.cacheGetter("ambientAttachments",fe(Br.typeAttachments,(t,r)=>[t,this.bindReference(r)]))}preparseOwnAliasEntry(t,r){var a;const i=t.indexOf("<");if(i===-1){if(B(r,"module")||B(r,"generic"))return[t,r];const c=this.name==="ark"?t:t==="root"?this.name:`${this.name}.${t}`,l=(a=this.resolvedConfig.keywords)==null?void 0:a[c];return l&&(r=[r,"@",l]),[t,r]}t.at(-1)!==">"&&I("'>' must be the last character of a generic declaration in a scope");const s=t.slice(0,i),o=t.slice(i+1,-1);return[s,()=>{const c=this.parseGenericParams(o,{alias:s});return Zb(c,r,this)}]}parseGenericParams(t,r){return pa(new zr(t),[],this.createParseContext({...r,def:t,prefix:"generic"}))}normalizeRootScopeValue(t){return Ai(t)&&!B(t,"generic")?t():t}preparseOwnDefinitionFormat(t,r){return{...r,def:t,prefix:r.alias??"type"}}parseOwnDefinitionFormat(t,r){!(r.alias&&r.alias in this.aliases)&&!r.args&&(r.args={this:r.id});const s=Rh(t,r);if(Ke(s)){if(s[1]==="=")return I(lh);if(s[1]==="?")return I(ah)}return s}define(t){return t}};y(tr,"scope",(t,r={})=>new tr(t,r)),y(tr,"module",(t,r={})=>tr.scope(t,r).export());let Qi=tr;const Q0=Object.assign(Qi.scope,{define:e=>e}),ne=Qi;class ex extends It{constructor(){super(...arguments);y(this,"description",'merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`')}}const tx=zt(["base",j.object],["props",j.object])(e=>e.base.merge(e.props),ex),nx=ne.module({Key:j.key,Merge:tx});class rx extends It{}const ix=zt("element")(e=>{const n=e.element.exclude(j.Array),t=n.array();return n.rawOr(t).pipe(Mr).distribute(r=>r.assertHasKind("morph").declareOut(t),ye)},rx),sx=ne.module({root:j.Array,readonly:"root",index:j.nonNegativeIntegerString,liftFrom:ix},{name:"Array"}),_a=ye(["string",Or.FileConstructor]),ox=_a.rawOr(_a.array()),Ph=ye({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:ox}}),ax=ne.module({root:["instanceof",FormData],value:_a,parsed:Ph,parse:ye({in:FormData,morphs:e=>{const n={};for(const[t,r]of e)if(t in n){const i=n[t];typeof i=="string"||i instanceof Or.FileConstructor?n[t]=[i,r]:i.push(r)}else n[t]=r;return n},declaredOut:Ph})},{name:"FormData"}),lx=ne.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),cx={Boolean:1,Number:1,String:1},ux=ne.module({...fe({...xu,...Su},(e,n)=>e in cx?[]:[e,["instanceof",n]]),Array:sx,TypedArray:lx,FormData:ax}),dx=ye({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),hx=ye({domain:"number",divisor:1}),Dh=ne.module({root:j.number,integer:hx,epoch:dx,safe:ye({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),be=(e,n,t)=>{const r={domain:"string",pattern:{rule:e.source,flags:e.flags,meta:n}};return t&&(r.meta={format:t}),ua("intersection",r)},Th=be(Ri,"a well-formed integer string"),Fh=ne.module({root:Th,parse:ye({in:Th,morphs:(e,n)=>{const t=Number.parseInt(e);return Number.isSafeInteger(t)?t:n.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:j.integer})},{name:"string.integer"}),fx=be(/^[\dA-Fa-f]+$/,"hex characters only"),px=ne.module({root:be(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:be(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),Vh=be(/^[A-Z].*$/,"capitalized"),mx=ne.module({root:ye({in:"string",morphs:e=>e.charAt(0).toUpperCase()+e.slice(1),declaredOut:Vh}),preformatted:Vh},{name:"string.capitalize"}),gx=e=>{const n=e.replaceAll(/[ -]+/g,"");let t=0,r,i,s=!1;for(let o=n.length-1;o>=0;o--)r=n.substring(o,o+1),i=Number.parseInt(r,10),s?(i*=2,t+=i>=10?i%10+1:i):t+=i,s=!s;return!!(t%10===0&&n)},yx=ye({domain:"string",pattern:{meta:"a credit card number",rule:/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/.source},predicate:{meta:"a credit card number",predicate:gx}}),bx=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Lh=ye({domain:"string",predicate:{meta:"a parsable date",predicate:e=>!Number.isNaN(new Date(e).valueOf())}}).assertHasKind("intersection"),zh=Fh.root.internal.narrow((e,n)=>{const t=Number.parseInt(e),r=Dh.epoch(t);return r instanceof Jt?(n.errors.merge(r),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),vx=ne.module({root:zh,parse:ye({in:zh,morphs:e=>new Date(e),declaredOut:j.Date})},{name:"string.date.epoch"}),Bh=be(bx,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),_x=ne.module({root:Bh,parse:ye({in:Bh,morphs:e=>new Date(e),declaredOut:j.Date})},{name:"string.date.iso"}),xx=ne.module({root:Lh,parse:ye({declaredIn:Lh,in:"string",morphs:(e,n)=>{const t=new Date(e);return Number.isNaN(t.valueOf())?n.error("a parsable date"):t},declaredOut:j.Date}),iso:_x,epoch:vx},{name:"string.date"}),wx=be(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),qh="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",Zt=`(${qh}[.]){3}${qh}`,Sx=new RegExp(`^${Zt}$`),Oe="(?:[0-9a-fA-F]{1,4})",kx=new RegExp(`^((?:${Oe}:){7}(?:${Oe}|:)|(?:${Oe}:){6}(?:${Zt}|:${Oe}|:)|(?:${Oe}:){5}(?::${Zt}|(:${Oe}){1,2}|:)|(?:${Oe}:){4}(?:(:${Oe}){0,1}:${Zt}|(:${Oe}){1,3}|:)|(?:${Oe}:){3}(?:(:${Oe}){0,2}:${Zt}|(:${Oe}){1,4}|:)|(?:${Oe}:){2}(?:(:${Oe}){0,3}:${Zt}|(:${Oe}){1,5}|:)|(?:${Oe}:){1}(?:(:${Oe}){0,4}:${Zt}|(:${Oe}){1,6}|:)|(?::((?::${Oe}){0,5}:${Zt}|(?::${Oe}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),$x=ne.module({root:["v4 | v6","@","an IP address"],v4:be(Sx,"an IPv4 address","ipv4"),v6:be(kx,"an IPv6 address","ipv6")},{name:"string.ip"}),Jn="a JSON string",Uh=e=>{if(!(e instanceof SyntaxError))throw e;return`must be ${Jn} (${e})`},Cx=ye({meta:Jn,domain:"string",predicate:{meta:Jn,predicate:(e,n)=>{try{return JSON.parse(e),!0}catch(t){return n.reject({code:"predicate",expected:Jn,problem:Uh(t)})}}}}),Mx=(e,n)=>{if(e.length===0)return n.error({code:"predicate",expected:Jn,actual:"empty"});try{return JSON.parse(e)}catch(t){return n.error({code:"predicate",expected:Jn,problem:Uh(t)})}},Ex=ne.module({root:Cx,parse:ye({meta:"safe JSON string parser",in:"string",morphs:Mx,declaredOut:j.jsonObject})},{name:"string.json"}),Kh=be(/^[a-z]*$/,"only lowercase letters"),Ox=ne.module({root:ye({in:"string",morphs:e=>e.toLowerCase(),declaredOut:Kh}),preformatted:Kh},{name:"string.lower"}),jh=["NFC","NFD","NFKC","NFKD"],qr=fe(jh,(e,n)=>[n,ye({domain:"string",predicate:t=>t.normalize(n)===t,meta:`${n}-normalized unicode`})]),es=fe(jh,(e,n)=>[n,ye({in:"string",morphs:t=>t.normalize(n),declaredOut:qr[n]})]),Ix=ne.module({root:es.NFC,preformatted:qr.NFC},{name:"string.normalize.NFC"}),Ax=ne.module({root:es.NFD,preformatted:qr.NFD},{name:"string.normalize.NFD"}),Nx=ne.module({root:es.NFKC,preformatted:qr.NFKC},{name:"string.normalize.NFKC"}),Rx=ne.module({root:es.NFKD,preformatted:qr.NFKD},{name:"string.normalize.NFKD"}),Px=ne.module({root:"NFC",NFC:Ix,NFD:Ax,NFKC:Nx,NFKD:Rx},{name:"string.normalize"}),Wh=be(Ro,"a well-formed numeric string"),Dx=ne.module({root:Wh,parse:ye({in:Wh,morphs:e=>Number.parseFloat(e),declaredOut:j.number})},{name:"string.numeric"}),Hh="a regex pattern",Tx=ye({domain:"string",predicate:{meta:Hh,predicate:(e,n)=>{try{return new RegExp(e),!0}catch(t){return n.reject({code:"predicate",expected:Hh,problem:String(t)})}}},meta:{format:"regex"}}),Fx=be(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,"a semantic version (see https://semver.org/)"),Gh=be(/^\S.*\S$|^\S?$/,"trimmed"),Vx=ne.module({root:ye({in:"string",morphs:e=>e.trim(),declaredOut:Gh}),preformatted:Gh},{name:"string.trim"}),Jh=be(/^[A-Z]*$/,"only uppercase letters"),Lx=ne.module({root:ye({in:"string",morphs:e=>e.toUpperCase(),declaredOut:Jh}),preformatted:Jh},{name:"string.upper"}),Yh=ye({domain:"string",predicate:{meta:"a URL string",predicate:e=>{if(URL.canParse)return URL.canParse(e);try{return new URL(e),!0}catch{return!1}}},meta:{format:"uri"}}),zx=ne.module({root:Yh,parse:ye({declaredIn:Yh,in:"string",morphs:(e,n)=>{try{return new URL(e)}catch{return n.error("a URL string")}},declaredOut:ye(URL)})},{name:"string.url"}),Bx=ne.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:be(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:be(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:be(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:be(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:be(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:be(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:be(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:be(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),qx=ne.module({root:j.string,alpha:be(/^[A-Za-z]*$/,"only letters"),alphanumeric:be(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex:fx,base64:px,capitalize:mx,creditCard:yx,date:xx,digits:be(/^\d*$/,"only digits 0-9"),email:wx,integer:Fh,ip:$x,json:Ex,lower:Ox,normalize:Px,numeric:Dx,regex:Tx,semver:Fx,trim:Vx,upper:Lx,url:zx,uuid:Bx},{name:"string"}),Ux=ne.module({bigint:j.bigint,boolean:j.boolean,false:j.false,never:j.never,null:j.null,number:j.number,object:j.object,string:j.string,symbol:j.symbol,true:j.true,unknown:j.unknown,undefined:j.undefined}),Kx=ne.module({root:j.unknown,any:j.unknown},{name:"unknown"}),jx=ne.module({root:j.jsonObject,stringify:ua("morph",{in:j.jsonObject,morphs:e=>JSON.stringify(e),declaredOut:j.string})},{name:"object.json"}),Wx=ne.module({root:j.object,json:jx},{name:"object"});class Hx extends It{constructor(){super(...arguments);y(this,"description",'instantiate an object from an index signature and corresponding value type like `Record("string", "number")`')}}const Gx=zt(["K",j.key],"V")(e=>({domain:"object",index:{signature:e.K,value:e.V}}),Hx);class Jx extends It{constructor(){super(...arguments);y(this,"description",'pick a set of properties from an object like `Pick(User, "name | age")`')}}const Yx=zt(["T",j.object],["K",j.key])(e=>e.T.pick(e.K),Jx);class Zx extends It{constructor(){super(...arguments);y(this,"description",'omit a set of properties from an object like `Omit(User, "age")`')}}const Xx=zt(["T",j.object],["K",j.key])(e=>e.T.omit(e.K),Zx);class Qx extends It{constructor(){super(...arguments);y(this,"description","make all named properties of an object optional like `Partial(User)`")}}const ew=zt(["T",j.object])(e=>e.T.partial(),Qx);class tw extends It{constructor(){super(...arguments);y(this,"description","make all named properties of an object required like `Required(User)`")}}const nw=zt(["T",j.object])(e=>e.T.required(),tw);class rw extends It{constructor(){super(...arguments);y(this,"description",'exclude branches of a union like `Exclude("boolean", "true")`')}}const iw=zt("T","U")(e=>e.T.exclude(e.U),rw);class sw extends It{constructor(){super(...arguments);y(this,"description",'extract branches of a union like `Extract("0 | false | 1", "number")`')}}const ow=zt("T","U")(e=>e.T.extract(e.U),sw),aw=ne.module({Exclude:iw,Extract:ow,Omit:Xx,Partial:ew,Pick:Yx,Record:Gx,Required:nw}),mn=Q0({...Ux,...aw,...ux,...nx,string:qx,number:Dh,object:Wx,unknown:Kx},{prereducedAliases:!0,name:"ark"}),De=mn.export();Object.assign(Br.ambient,De),Br.typeAttachments={string:De.string.root,number:De.number.root,bigint:De.bigint,boolean:De.boolean,symbol:De.symbol,undefined:De.undefined,null:De.null,object:De.object.root,unknown:De.unknown.root,false:De.false,true:De.true,never:De.never,arrayIndex:De.Array.index,Key:De.Key,Record:De.Record,Array:De.Array.root,Date:De.Date};const ct=Object.assign(mn.type,Br.typeAttachments);mn.match,mn.generic,mn.schema,mn.define,mn.declare,ct("'more-info' | 'toggle' | 'navigate' | 'url' | 'perform-action' | 'assist'"),ct("'tap' | 'hold' | 'double_tap'");const xa=ct({action:"'perform-action'",perform_action:"string",target:"object",data:"object"}).or({action:"'assist'","pipeline_id?":"string"}).or({action:"'url'",url_path:"string"}).or({action:"'navigate'",navigation_path:"string"}).or({action:"'more-info'","entity?":"string","camera_image?":"string"}).or({action:"'toggle'","entity?":"string"}).or({action:"'none'"}),Zh=ct({"entity?":"string","camera_image?":"string","tap_action?":xa.or("undefined"),"hold_action?":xa.or("undefined"),"double_tap_action?":xa.or("undefined")}),Xh=ct({"always_show_power_button?":"boolean | null"}),lw=ct({"icon?":"string","name?":"string",media_type:"string"}),Qh=ct({type:"string",entity_id:"string","use_art_colors?":"boolean","action?":Zh,"speaker_group?":{"entity_id?":ct("string").or("null"),entities:"string[]"},"custom_buttons?":ct({icon:"string > 0",name:"string > 0"}).and(Zh).array(),"ma_entity_id?":ct("string").or("null"),"ma_favorite_button_entity_id?":ct("string").or("null"),"search?":{"enabled?":"boolean | null","show_favorites?":"boolean | null","entity_id?":ct("string").or("null"),"media_types?":lw.array()},"options?":Xh,"grid_options?":"unknown","visibility?":"unknown"}),cw=Qh.and({"tap_opens_popup?":"boolean","options?":Xh.and({"always_show_custom_buttons?":"boolean | null"})}),uw=Qh.and({mode:"'panel'|'card'|'in-card'|'popup'"}),Yn=new WeakMap,ts=new WeakMap,ns={current:[]};let wa=!1,Ur=0;const Kr=new Set,rs=new Map;function ef(e){const n=Array.from(e).sort((t,r)=>t instanceof Bt&&t.options.deps.includes(r)?1:r instanceof Bt&&r.options.deps.includes(t)?-1:0);for(const t of n){if(ns.current.includes(t))continue;ns.current.push(t),t.recompute();const r=ts.get(t);if(r)for(const i of r){const s=Yn.get(i);s&&ef(s)}}}function dw(e){e.listeners.forEach(n=>n({prevVal:e.prevState,currentVal:e.state}))}function hw(e){e.listeners.forEach(n=>n({prevVal:e.prevState,currentVal:e.state}))}function tf(e){if(Ur>0&&!rs.has(e)&&rs.set(e,e.prevState),Kr.add(e),!(Ur>0)&&!wa)try{for(wa=!0;Kr.size>0;){const n=Array.from(Kr);Kr.clear();for(const t of n){const r=rs.get(t)??t.prevState;t.prevState=r,dw(t)}for(const t of n){const r=Yn.get(t);r&&(ns.current.push(t),ef(r))}for(const t of n){const r=Yn.get(t);if(r)for(const i of r)hw(i)}}}finally{wa=!1,ns.current=[],rs.clear()}}function At(e){Ur++;try{e()}finally{if(Ur--,Ur===0){const n=Array.from(Kr)[0];n&&tf(n)}}}function fw(e){return typeof e=="function"}class Sa{constructor(n,t){this.listeners=new Set,this.subscribe=r=>{var i,s;this.listeners.add(r);const o=(s=(i=this.options)==null?void 0:i.onSubscribe)==null?void 0:s.call(i,r,this);return()=>{this.listeners.delete(r),o==null||o()}},this.prevState=n,this.state=n,this.options=t}setState(n){var t,r,i;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(n):fw(n)?this.state=n(this.prevState):this.state=n,(i=(r=this.options)==null?void 0:r.onUpdate)==null||i.call(r),tf(this)}}class Bt{constructor(n){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],r=[];for(const i of this.options.deps)t.push(i.prevState),r.push(i.state);return this.lastSeenDepValues=r,{prevDepVals:t,currDepVals:r,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,r;this.prevState=this.state;const{prevDepVals:i,currDepVals:s,prevVal:o}=this.getDepVals();this.state=this.options.fn({prevDepVals:i,currDepVals:s,prevVal:o}),(r=(t=this.options).onUpdate)==null||r.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const s of this.options.deps)s instanceof Bt&&s.checkIfRecalculationNeededDeeply();let t=!1;const r=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let s=0;s<i.length;s++)if(i[s]!==r[s]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var r,i;this.listeners.add(t);const s=(i=(r=this.options).onSubscribe)==null?void 0:i.call(r,t,this);return()=>{this.listeners.delete(t),s==null||s()}},this.options=n,this.state=n.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(n=this.options.deps){for(const t of n)if(t instanceof Bt)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof Sa){let r=Yn.get(t);r||(r=new Set,Yn.set(t,r)),r.add(this);let i=ts.get(this);i||(i=new Set,ts.set(this,i)),i.add(t)}}unregisterFromGraph(n=this.options.deps){for(const t of n)if(t instanceof Bt)this.unregisterFromGraph(t.options.deps);else if(t instanceof Sa){const r=Yn.get(t);r&&r.delete(this);const i=ts.get(this);i&&i.delete(t)}}}function is(e,n){return typeof e=="function"?e(n):e}function jr(e,n){return $a(n).reduce((r,i)=>{if(r===null)return null;if(typeof r<"u")return r[i]},e)}function ss(e,n,t){const r=$a(n);function i(s){if(!r.length)return is(t,s);const o=r.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[o]:i(s[o])}):{[o]:i()};if(Array.isArray(s)&&typeof o=="number"){const a=s.slice(0,o);return[...a.length?a:new Array(o),i(s[o]),...s.slice(o+1)]}return[...new Array(o),i()]}return i(e)}function pw(e,n){const t=$a(n);function r(i){if(!i)return;if(t.length===1){const o=t[0];if(Array.isArray(i)&&typeof o=="number")return i.filter((l,u)=>u!==o);const{[o]:a,...c}=i;return c}const s=t.shift();if(typeof s=="string"&&typeof i=="object")return{...i,[s]:r(i[s])};if(typeof s=="number"&&Array.isArray(i)){if(s>=i.length)return i;const o=i.slice(0,s);return[...o.length?o:new Array(s),r(i[s]),...i.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return r(e)}const mw=/^(\d+)$/gm,gw=/\.(\d+)(?=\.)/gm,yw=/^(\d+)\./gm,bw=/\.(\d+$)/gm,vw=/\.{2,}/gm,ka="__int__",os=`${ka}$1`;function $a(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(mw,os).replace(gw,`.${os}.`).replace(yw,`${os}.`).replace(bw,`.${os}`).replace(vw,".").split(".").map(n=>{if(n.startsWith(ka)){const t=n.substring(ka.length),r=parseInt(t,10);return String(r)===t?r:t}return n})}function _w(e){return!(Array.isArray(e)&&e.length===0)}function Ca(e,n){const t=r=>r.validators.filter(Boolean).map(i=>({cause:i.cause,validate:i.fn}));return n.validationLogic({form:n.form,validators:n.validators,event:{type:e,async:!1},runValidation:t})}function Ma(e,n){const{asyncDebounceMs:t}=n,{onBlurAsyncDebounceMs:r,onChangeAsyncDebounceMs:i,onDynamicAsyncDebounceMs:s}=n.validators||{},o=t??0,a=c=>c.validators.filter(Boolean).map(l=>{const u=(l==null?void 0:l.cause)||e;let d=o;switch(u){case"change":d=i??o;break;case"blur":d=r??o;break;case"dynamic":d=s??o;break;case"submit":d=0;break}return e==="submit"&&(d=0),{cause:u,validate:l.fn,debounceMs:d}});return n.validationLogic({form:n.form,validators:n.validators,event:{type:e,async:!0},runValidation:a})}const Ea=e=>!!e&&typeof e=="object"&&"fields"in e;function Zn(e,n){if(Object.is(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(const[i,s]of e)if(!n.has(i)||!Object.is(s,n.get(i)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(const i of e)if(!n.has(i))return!1;return!0}const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const i of t)if(!r.includes(i)||!Zn(e[i],n[i]))return!1;return!0}const nf=({newFormValidatorError:e,isPreviousErrorFromFormValidator:n,previousErrorValue:t})=>e?{newErrorValue:e,newSource:"form"}:n?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},rf=({formLevelError:e,fieldLevelError:n})=>n?{newErrorValue:n,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0},Xn=e=>{if(!e.validators)return e.runValidation({validators:[],form:e.form});const n=e.event.async,t=n?void 0:{fn:e.validators.onMount,cause:"mount"},r={fn:n?e.validators.onChangeAsync:e.validators.onChange,cause:"change"},i={fn:n?e.validators.onBlurAsync:e.validators.onBlur,cause:"blur"},s={fn:n?e.validators.onSubmitAsync:e.validators.onSubmit,cause:"submit"},o=n?void 0:{fn:()=>{},cause:"server"};switch(e.event.type){case"mount":return e.runValidation({validators:[t],form:e.form});case"submit":return e.runValidation({validators:[r,i,s,o],form:e.form});case"server":return e.runValidation({validators:[],form:e.form});case"blur":return e.runValidation({validators:[i,o],form:e.form});case"change":return e.runValidation({validators:[r,o],form:e.form});default:throw new Error(`Unknown validation event type: ${e.event.type}`)}};function xw(e){const n=new Map;for(const t of e){const r=[...t.path??[]].map(i=>{const s=typeof i=="object"?i.key:i;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");n.set(r,(n.get(r)??[]).concat(t))}return Object.fromEntries(n)}const sf=e=>{const n=xw(e);return{form:n,fields:n}},Qn={validate({value:e,validationSource:n},t){const r=t["~standard"].validate(e);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return n==="field"?r.issues:sf(r.issues)},async validateAsync({value:e,validationSource:n},t){const r=await t["~standard"].validate(e);if(r.issues)return n==="field"?r.issues:sf(r.issues)}},of=e=>!!e&&"~standard"in e,as={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function ls(e){function n(d,h,f,p){const g=r(d,h,f,p);({insert:()=>a(g,d,h),remove:()=>c(g),swap:()=>p!==void 0&&u(g,d,h,p),move:()=>p!==void 0&&l(g,d,h,p)})[f]()}function t(d,h){return`${d}[${h}]`}function r(d,h,f,p){const g=[t(d,h)];if(f==="swap")g.push(t(d,p));else if(f==="move"){const[b,_]=[Math.min(h,p),Math.max(h,p)];for(let v=b;v<=_;v++)g.push(t(d,v))}else{const b=e.getFieldValue(d),_=Array.isArray(b)?b.length:0;for(let v=h+1;v<_;v++)g.push(t(d,v))}return Object.keys(e.fieldInfo).filter(b=>g.some(_=>b.startsWith(_)))}function i(d,h){return d.replace(/\[(\d+)\]/,(f,p)=>{const g=parseInt(p,10);return`[${h==="up"?g+1:Math.max(0,g-1)}]`})}function s(d,h){(h==="up"?d:[...d].reverse()).forEach(p=>{const g=i(p.toString(),h),b=e.getFieldMeta(g);b?e.setFieldMeta(p,b):e.setFieldMeta(p,o())})}const o=()=>as,a=(d,h,f)=>{s(d,"down"),d.forEach(p=>{p.toString().startsWith(t(h,f))&&e.setFieldMeta(p,o())})},c=d=>{s(d,"up")},l=(d,h,f,p)=>{const g=new Map(Object.keys(e.fieldInfo).filter(b=>b.startsWith(t(h,f))).map(b=>[b,e.getFieldMeta(b)]));s(d,f<p?"up":"down"),Object.keys(e.fieldInfo).filter(b=>b.startsWith(t(h,p))).forEach(b=>{const _=b.replace(t(h,p),t(h,f)),v=g.get(_);v&&e.setFieldMeta(b,v)})},u=(d,h,f,p)=>{d.forEach(g=>{if(!g.toString().startsWith(t(h,f)))return;const b=g.toString().replace(t(h,f),t(h,p)),[_,v]=[e.getFieldMeta(g),e.getFieldMeta(b)];_&&e.setFieldMeta(b,_),v&&e.setFieldMeta(g,v)})};return{handleArrayFieldMetaShift:n}}function Oa(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class ww{constructor(n){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var a,c;const r=this.fieldMetaDerived.mount(),i=this.store.mount(),s=()=>{r(),i()};(c=(a=this.options.listeners)==null?void 0:a.onMount)==null||c.call(a,{formApi:this});const{onMount:o}=this.options.validators||{};return o&&this.validateSync("mount"),s},this.update=r=>{var c,l;if(!r)return;const i=this.options;this.options=r;const s=!!((l=(c=r.transform)==null?void 0:c.deps)!=null&&l.some((u,d)=>u!==this.prevTransformArray[d])),o=r.defaultValues&&!Zn(r.defaultValues,i.defaultValues)&&!this.state.isTouched,a=!Zn(r.defaultState,i.defaultState)&&!this.state.isTouched;!o&&!a&&!s||At(()=>{this.baseStore.setState(()=>Oa(Object.assign({},this.state,a?r.defaultState:{},o?{values:r.defaultValues}:{},s?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(r,i)=>{const{fieldMeta:s}=this.state,o=this.resetFieldMeta(s);r&&!(i!=null&&i.keepDefaultValues)&&(this.options={...this.options,defaultValues:r}),this.baseStore.setState(()=>{var a;return Oa({...this.options.defaultState,values:r??this.options.defaultValues??((a=this.options.defaultState)==null?void 0:a.values),fieldMetaBase:o})})},this.validateAllFields=async r=>{const i=[];return At(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const a=o.instance;i.push(Promise.resolve().then(()=>a.validate(r,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(c=>({...c,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null,c=[`${r}[${i}]`];for(let h=i+1;h<=(a??0);h++)c.push(`${r}[${h}]`);const l=Object.keys(this.fieldInfo).filter(h=>c.some(f=>h.startsWith(f))),u=[];return At(()=>{l.forEach(h=>{u.push(Promise.resolve().then(()=>this.validateField(h,s)))})}),(await Promise.all(u)).flat()},this.validateField=(r,i)=>{var o;const s=(o=this.fieldInfo[r])==null?void 0:o.instance;return s?(s.state.meta.isTouched||s.setMeta(a=>({...a,isTouched:!0})),s.validate(i)):[]},this.validateSync=r=>{const i=Ca(r,{...this.options,form:this,validationLogic:this.options.validationLogic||Xn});let s=!1;const o={};return At(()=>{var l,u,d;for(const h of i){if(!h.validate)continue;const f=this.runValidator({validate:h.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:p,fieldErrors:g}=cs(f),b=Wr(h.cause);for(const _ of Object.keys(this.state.fieldMeta)){const v=this.getFieldMeta(_);if(!v)continue;const{errorMap:S,errorSourceMap:k}=v,x=g==null?void 0:g[_],{newErrorValue:$,newSource:M}=nf({newFormValidatorError:x,isPreviousErrorFromFormValidator:(k==null?void 0:k[b])==="form",previousErrorValue:S==null?void 0:S[b]});M==="form"&&(o[_]={...o[_],[b]:x}),(S==null?void 0:S[b])!==$&&this.setFieldMeta(_,E=>({...E,errorMap:{...E.errorMap,[b]:$},errorSourceMap:{...E.errorSourceMap,[b]:M}}))}((l=this.state.errorMap)==null?void 0:l[b])!==p&&this.baseStore.setState(_=>({..._,errorMap:{..._.errorMap,[b]:p}})),(p||g)&&(s=!0)}const a=Wr("submit");(u=this.state.errorMap)!=null&&u[a]&&r!=="submit"&&!s&&this.baseStore.setState(h=>({...h,errorMap:{...h.errorMap,[a]:void 0}}));const c=Wr("server");(d=this.state.errorMap)!=null&&d[c]&&r!=="server"&&!s&&this.baseStore.setState(h=>({...h,errorMap:{...h.errorMap,[c]:void 0}}))}),{hasErrored:s,fieldsErrorMap:o}},this.validateAsync=async r=>{const i=Ma(r,{...this.options,form:this,validationLogic:this.options.validationLogic||Xn});this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const s=[];let o;for(const l of i){if(!l.validate)continue;const u=Wr(l.cause),d=this.state.validationMetaMap[u];d==null||d.lastAbortController.abort();const h=new AbortController;this.state.validationMetaMap[u]={lastAbortController:h},s.push(new Promise(async f=>{let p;try{p=await new Promise((v,S)=>{setTimeout(async()=>{if(h.signal.aborted)return v(void 0);try{v(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:h.signal},type:"validateAsync"}))}catch(k){S(k)}},l.debounceMs)})}catch(v){p=v}const{formError:g,fieldErrors:b}=cs(p);b&&(o=o?{...o,...b}:b);const _=Wr(l.cause);for(const v of Object.keys(this.state.fieldMeta)){const S=this.getFieldMeta(v);if(!S)continue;const{errorMap:k,errorSourceMap:x}=S,$=o==null?void 0:o[v],{newErrorValue:M,newSource:E}=nf({newFormValidatorError:$,isPreviousErrorFromFormValidator:(x==null?void 0:x[_])==="form",previousErrorValue:k==null?void 0:k[_]});(k==null?void 0:k[_])!==M&&this.setFieldMeta(v,C=>({...C,errorMap:{...C.errorMap,[_]:M},errorSourceMap:{...C.errorSourceMap,[_]:E}}))}this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[_]:g}})),f(o?{fieldErrors:o,errorMapKey:_}:void 0)}))}let a=[];const c={};if(s.length){a=await Promise.all(s);for(const l of a)if(l!=null&&l.fieldErrors){const{errorMapKey:u}=l;for(const[d,h]of Object.entries(l.fieldErrors)){const p={...c[d]||{},[u]:h};c[d]=p}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),c},this.validate=r=>{const{hasErrored:i,fieldsErrorMap:s}=this.validateSync(r);return i&&!this.options.asyncAlways?s:this.validateAsync(r)},this.getFieldValue=r=>jr(this.state.values,r),this.getFieldMeta=r=>this.state.fieldMeta[r],this.getFieldInfo=r=>{var i;return(i=this.fieldInfo)[r]||(i[r]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}})},this.setFieldMeta=(r,i)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[r]:is(i,s.fieldMetaBase[r])}}))},this.resetFieldMeta=r=>Object.keys(r).reduce((i,s)=>{const o=s;return i[o]=as,i},{}),this.setFieldValue=(r,i,s)=>{const o=(s==null?void 0:s.dontUpdateMeta)??!1;At(()=>{o||this.setFieldMeta(r,a=>({...a,isTouched:!0,isDirty:!0,errorMap:{...a==null?void 0:a.errorMap,onMount:void 0}})),this.baseStore.setState(a=>({...a,values:ss(a.values,r,i)}))})},this.deleteField=r=>{const s=[...Object.keys(this.fieldInfo).filter(o=>{const a=r.toString();return o!==a&&o.startsWith(a)}),r];this.baseStore.setState(o=>{const a={...o};return s.forEach(c=>{a.values=pw(a.values,c),delete this.fieldInfo[c],delete a.fieldMetaBase[c]}),a})},this.pushFieldValue=(r,i,s)=>{this.setFieldValue(r,o=>[...Array.isArray(o)?o:[],i],s),this.validateField(r,"change")},this.insertFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>[...a.slice(0,i),s,...a.slice(i)],o),await this.validateField(r,"change"),ls(this).handleArrayFieldMetaShift(r,i,"insert"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.replaceFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>a.map((c,l)=>l===i?s:c),o),await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.removeFieldValue=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(r,c=>c.filter((l,u)=>u!==i),s),ls(this).handleArrayFieldMetaShift(r,i,"remove"),a!==null){const c=`${r}[${a}]`;this.deleteField(c)}await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.swapFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>{const c=a[i],l=a[s];return ss(ss(a,`${i}`,l),`${s}`,c)},o),ls(this).handleArrayFieldMetaShift(r,i,"swap",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.moveFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>{const c=[...a];return c.splice(s,0,c.splice(i,1)[0]),c},o),ls(this).handleArrayFieldMetaShift(r,i,"move",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.clearFieldValues=(r,i)=>{const s=this.getFieldValue(r),o=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(r,[],i),o!==null)for(let a=0;a<=o;a++){const c=`${r}[${a}]`;this.deleteField(c)}this.validateField(r,"change")},this.resetField=r=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[r]:as},values:this.options.defaultValues?ss(i.values,r,jr(this.options.defaultValues,r)):i.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((r,[i,s])=>(Object.keys(s).length&&s.errors.length&&(r[i]={errors:s.errors,errorMap:s.errorMap}),r),{})}),this.parseValuesWithSchema=r=>Qn.validate({value:this.state.values,validationSource:"form"},r),this.parseValuesWithSchemaAsync=r=>Qn.validateAsync({value:this.state.values,validationSource:"form"},r),this.baseStore=new Sa(Oa({...n==null?void 0:n.defaultState,values:(n==null?void 0:n.defaultValues)??((t=n==null?void 0:n.defaultState)==null?void 0:t.values)})),this.fieldMetaDerived=new Bt({deps:[this.baseStore],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var d,h,f;const o=s,a=r==null?void 0:r[0],c=i[0];let l=0;const u={};for(const p of Object.keys(c.fieldMetaBase)){const g=c.fieldMetaBase[p],b=a==null?void 0:a.fieldMetaBase[p],_=o==null?void 0:o[p],v=jr(c.values,p);let S=_==null?void 0:_.errors;if(!b||g.errorMap!==b.errorMap){S=Object.values(g.errorMap??{}).filter(E=>E!==void 0);const M=(d=this.getFieldInfo(p))==null?void 0:d.instance;M&&!M.options.disableErrorFlat&&(S=S==null?void 0:S.flat(1))}const k=!_w(S??[]),x=!g.isDirty,$=Zn(v,jr(this.options.defaultValues,p))||Zn(v,(f=(h=this.getFieldInfo(p))==null?void 0:h.instance)==null?void 0:f.options.defaultValue);if(_&&_.isPristine===x&&_.isValid===k&&_.isDefaultValue===$&&_.errors===S&&g===b){u[p]=_,l++;continue}u[p]={...g,errors:S,isPristine:x,isValid:k,isDefaultValue:$}}return Object.keys(c.fieldMetaBase).length&&o&&l===Object.keys(c.fieldMetaBase).length?o:u}}),this.store=new Bt({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var U,Y,Te,pe;const o=s,a=r==null?void 0:r[0],c=i[0],l=i[1],u=Object.values(l).filter(Boolean),d=u.some(H=>H.isValidating),h=u.every(H=>H.isValid),f=u.some(H=>H.isTouched),p=u.some(H=>H.isBlurred),g=u.every(H=>H.isDefaultValue),b=f&&((U=c.errorMap)==null?void 0:U.onMount),_=u.some(H=>H.isDirty),v=!_,S=!!((Y=c.errorMap)!=null&&Y.onMount||u.some(H=>{var K;return(K=H==null?void 0:H.errorMap)==null?void 0:K.onMount})),k=!!d;let x=(o==null?void 0:o.errors)??[];(!a||c.errorMap!==a.errorMap)&&(x=Object.values(c.errorMap).reduce((H,K)=>K===void 0?H:K&&Ea(K)?(H.push(K.form),H):(H.push(K),H),[]));const $=x.length===0,M=h&&$,E=this.options.canSubmitWhenInvalid??!1,C=c.submissionAttempts===0&&!f&&!S||!k&&!c.isSubmitting&&M||E;let N=c.errorMap;if(b&&(x=x.filter(H=>H!==c.errorMap.onMount),N=Object.assign(N,{onMount:void 0})),o&&a&&o.errorMap===N&&o.fieldMeta===this.fieldMetaDerived.state&&o.errors===x&&o.isFieldsValidating===d&&o.isFieldsValid===h&&o.isFormValid===$&&o.isValid===M&&o.canSubmit===C&&o.isTouched===f&&o.isBlurred===p&&o.isPristine===v&&o.isDefaultValue===g&&o.isDirty===_&&Zn(a,c))return o;let R={...c,errorMap:N,fieldMeta:this.fieldMetaDerived.state,errors:x,isFieldsValidating:d,isFieldsValid:h,isFormValid:$,isValid:M,canSubmit:C,isTouched:f,isBlurred:p,isPristine:v,isDefaultValue:g,isDirty:_};const F=((Te=this.options.transform)==null?void 0:Te.deps)??[];if(F.length!==this.prevTransformArray.length||F.some((H,K)=>H!==this.prevTransformArray[K])){const H=Object.assign({},this,{state:R});(pe=this.options.transform)==null||pe.fn(H),R=H.state,this.prevTransformArray=F}return R}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(n||{})}get state(){return this.store.state}get formId(){return this.options.formId}runValidator(n){return of(n.validate)?Qn[n.type](n.value,n.validate):n.validate(n.value)}async handleSubmit(n){var i,s,o,a,c,l,u,d;if(this.baseStore.setState(h=>({...h,isSubmitted:!1,submissionAttempts:h.submissionAttempts+1,isSubmitSuccessful:!1})),At(()=>{Object.values(this.fieldInfo).forEach(h=>{h.instance&&(h.instance.state.meta.isTouched||h.instance.setMeta(f=>({...f,isTouched:!0})))})}),!this.state.canSubmit)return;const t=n??this.options.onSubmitMeta;this.baseStore.setState(h=>({...h,isSubmitting:!0}));const r=()=>{this.baseStore.setState(h=>({...h,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){r(),(s=(i=this.options).onSubmitInvalid)==null||s.call(i,{value:this.state.values,formApi:this,meta:t});return}if(await this.validate("submit"),!this.state.isValid){r(),(a=(o=this.options).onSubmitInvalid)==null||a.call(o,{value:this.state.values,formApi:this,meta:t});return}At(()=>{Object.values(this.fieldInfo).forEach(h=>{var f,p,g;(g=(p=(f=h.instance)==null?void 0:f.options.listeners)==null?void 0:p.onSubmit)==null||g.call(p,{value:h.instance.state.value,fieldApi:h.instance})})}),(l=(c=this.options.listeners)==null?void 0:c.onSubmit)==null||l.call(c,{formApi:this,meta:t});try{await((d=(u=this.options).onSubmit)==null?void 0:d.call(u,{value:this.state.values,formApi:this,meta:t})),At(()=>{this.baseStore.setState(h=>({...h,isSubmitted:!0,isSubmitSuccessful:!0})),r()})}catch(h){throw this.baseStore.setState(f=>({...f,isSubmitSuccessful:!1})),r(),h}}setErrorMap(n){At(()=>{Object.entries(n).forEach(([t,r])=>{const i=t;if(Ea(r)){const{formError:s,fieldErrors:o}=cs(r);for(const a of Object.keys(this.fieldInfo))this.getFieldMeta(a)&&this.setFieldMeta(a,l=>({...l,errorMap:{...l.errorMap,[i]:o==null?void 0:o[a]},errorSourceMap:{...l.errorSourceMap,[i]:"form"}}));this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[i]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[i]:r}}))})})}}function cs(e){if(e){if(Ea(e)){const n=cs(e.form).formError,t=e.fields;return{formError:n,fieldErrors:t}}return{formError:e}}return{formError:void 0}}function Wr(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Sw{constructor(n){this.options={},this.mount=()=>{var s,o;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const r=this.getInfo();r.instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const a=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});a&&this.setMeta(c=>({...c,errorMap:{...c==null?void 0:c.errorMap,onMount:a},errorSourceMap:{...c==null?void 0:c.errorSourceMap,onMount:"field"}}))}return(o=(s=this.options.listeners)==null?void 0:s.onMount)==null||o.call(s,{value:this.state.value,fieldApi:this}),t},this.update=t=>{this.options=t;const r=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const i=jr(t.form.options.defaultValues,t.name),s=t.defaultValue??i;r?this.setValue(o=>o||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,r)=>{this.form.setFieldValue(this.name,t,r),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,r)=>{this.form.pushFieldValue(this.name,t,r),this.triggerOnChangeListener()},this.insertValue=(t,r,i)=>{this.form.insertFieldValue(this.name,t,r,i),this.triggerOnChangeListener()},this.replaceValue=(t,r,i)=>{this.form.replaceFieldValue(this.name,t,r,i),this.triggerOnChangeListener()},this.removeValue=(t,r)=>{this.form.removeFieldValue(this.name,t,r),this.triggerOnChangeListener()},this.swapValues=(t,r,i)=>{this.form.swapFieldValues(this.name,t,r,i),this.triggerOnChangeListener()},this.moveValue=(t,r,i)=>{this.form.moveFieldValues(this.name,t,r,i),this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,t),this.triggerOnChangeListener()},this.getLinkedFields=t=>{const r=Object.values(this.form.fieldInfo),i=[];for(const s of r){if(!s.instance)continue;const{onChangeListenTo:o,onBlurListenTo:a}=s.instance.options.validators||{};t==="change"&&(o!=null&&o.includes(this.name))&&i.push(s.instance),t==="blur"&&(a!=null&&a.includes(this.name))&&i.push(s.instance)}return i},this.validateSync=(t,r)=>{var l;const i=Ca(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Xn}),o=this.getLinkedFields(t).reduce((u,d)=>{const h=Ca(t,{...d.options,form:d.form,validationLogic:d.form.options.validationLogic||Xn});return h.forEach(f=>{f.field=d}),u.concat(h)},[]);let a=!1;At(()=>{const u=(d,h)=>{var v;const f=us(h.cause),p=h.validate?af(d.runValidator({validate:h.validate,value:{value:d.store.state.value,validationSource:"field",fieldApi:d},type:"validate"})):void 0,g=r[f],{newErrorValue:b,newSource:_}=rf({formLevelError:g,fieldLevelError:p});((v=d.state.meta.errorMap)==null?void 0:v[f])!==b&&d.setMeta(S=>({...S,errorMap:{...S.errorMap,[f]:b},errorSourceMap:{...S.errorSourceMap,[f]:_}})),b&&(a=!0)};for(const d of i)u(this,d);for(const d of o)d.validate&&u(d.field,d)});const c=us("submit");return(l=this.state.meta.errorMap)!=null&&l[c]&&t!=="submit"&&!a&&this.setMeta(u=>({...u,errorMap:{...u.errorMap,[c]:void 0},errorSourceMap:{...u.errorSourceMap,[c]:void 0}})),{hasErrored:a}},this.validateAsync=async(t,r)=>{const i=Ma(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Xn}),s=await r,o=this.getLinkedFields(t),a=o.reduce((h,f)=>{const p=Ma(t,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||Xn});return p.forEach(g=>{g.field=f}),h.concat(p)},[]);this.state.meta.isValidating||this.setMeta(h=>({...h,isValidating:!0}));for(const h of o)h.setMeta(f=>({...f,isValidating:!0}));const c=[],l=[],u=(h,f,p)=>{const g=us(f.cause),b=h.getInfo().validationMetaMap[g];b==null||b.lastAbortController.abort();const _=new AbortController;this.getInfo().validationMetaMap[g]={lastAbortController:_},p.push(new Promise(async v=>{var E;let S;try{S=await new Promise((C,N)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(_.signal.aborted)return C(void 0);try{C(await this.runValidator({validate:f.validate,value:{value:h.store.state.value,fieldApi:h,signal:_.signal,validationSource:"field"},type:"validateAsync"}))}catch(R){N(R)}},f.debounceMs)})}catch(C){S=C}if(_.signal.aborted)return v(void 0);const k=af(S),x=(E=s[this.name])==null?void 0:E[g],{newErrorValue:$,newSource:M}=rf({formLevelError:x,fieldLevelError:k});h.setMeta(C=>({...C,errorMap:{...C==null?void 0:C.errorMap,[g]:$},errorSourceMap:{...C.errorSourceMap,[g]:M}})),v($)}))};for(const h of i)h.validate&&u(this,h,c);for(const h of a)h.validate&&u(h.field,h,l);let d=[];(c.length||l.length)&&(d=await Promise.all(c),await Promise.all(l)),this.setMeta(h=>({...h,isValidating:!1}));for(const h of o)h.setMeta(f=>({...f,isValidating:!1}));return d.filter(Boolean)},this.validate=(t,r)=>{var a;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=r!=null&&r.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:s}=this.validateSync(t,i[this.name]??{});if(s&&!this.options.asyncAlways)return(a=this.getInfo().validationMetaMap[us(t)])==null||a.lastAbortController.abort(),this.state.meta.errors;const o=r!=null&&r.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,o)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(r=>({...r,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(r=>({...r,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>Qn.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>Qn.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=n.form,this.name=n.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new Bt({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),r=this.form.getFieldMeta(this.name)??{...as,...n.defaultMeta};return{value:t,meta:r}}}),this.options=n}get state(){return this.store.state}runValidator(n){return of(n.validate)?Qn[n.type](n.value,n.validate):n.validate(n.value)}setErrorMap(n){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...n}}))}triggerOnBlurListener(){var r,i,s,o,a,c;const n=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;n&&n>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{formApi:this.form,fieldApi:this})},n)):(s=(i=this.form.options.listeners)==null?void 0:i.onBlur)==null||s.call(i,{formApi:this.form,fieldApi:this});const t=(o=this.options.listeners)==null?void 0:o.onBlurDebounceMs;t&&t>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{value:this.state.value,fieldApi:this})},t)):(c=(a=this.options.listeners)==null?void 0:a.onBlur)==null||c.call(a,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,i,s,o,a,c;const n=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;n&&n>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{formApi:this.form,fieldApi:this})},n)):(s=(i=this.form.options.listeners)==null?void 0:i.onChange)==null||s.call(i,{formApi:this.form,fieldApi:this});const t=(o=this.options.listeners)==null?void 0:o.onChangeDebounceMs;t&&t>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{value:this.state.value,fieldApi:this})},t)):(c=(a=this.options.listeners)==null?void 0:a.onChange)==null||c.call(a,{value:this.state.value,fieldApi:this})}}function af(e){if(e)return e}function us(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}var ds={exports:{}},Ia={};const hs=sm(ur);var fs={exports:{}},Aa={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lf;function kw(){if(lf)return Aa;lf=1;var e=hs;function n(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var t=typeof Object.is=="function"?Object.is:n,r=e.useState,i=e.useEffect,s=e.useLayoutEffect,o=e.useDebugValue;function a(d,h){var f=h(),p=r({inst:{value:f,getSnapshot:h}}),g=p[0].inst,b=p[1];return s(function(){g.value=f,g.getSnapshot=h,c(g)&&b({inst:g})},[d,f,h]),i(function(){return c(g)&&b({inst:g}),d(function(){c(g)&&b({inst:g})})},[d]),o(f),f}function c(d){var h=d.getSnapshot;d=d.value;try{var f=h();return!t(d,f)}catch{return!0}}function l(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return Aa.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,Aa}var Na={},cf;function $w(){if(cf)return Na;cf=1;var e={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){function n(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}function t(p,g){d||s.startTransition===void 0||(d=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var b=g();if(!h){var _=g();o(b,_)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),h=!0)}_=a({inst:{value:b,getSnapshot:g}});var v=_[0].inst,S=_[1];return l(function(){v.value=b,v.getSnapshot=g,r(v)&&S({inst:v})},[p,b,g]),c(function(){return r(v)&&S({inst:v}),p(function(){r(v)&&S({inst:v})})},[p]),u(b),b}function r(p){var g=p.getSnapshot;p=p.value;try{var b=g();return!o(p,b)}catch{return!0}}function i(p,g){return g()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var s=hs,o=typeof Object.is=="function"?Object.is:n,a=s.useState,c=s.useEffect,l=s.useLayoutEffect,u=s.useDebugValue,d=!1,h=!1,f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?i:t;Na.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:f,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),Na}var uf;function df(){if(uf)return fs.exports;uf=1;var e={};return e.NODE_ENV==="production"?fs.exports=kw():fs.exports=$w(),fs.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hf;function Cw(){if(hf)return Ia;hf=1;var e=hs,n=df();function t(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:t,i=n.useSyncExternalStore,s=e.useRef,o=e.useEffect,a=e.useMemo,c=e.useDebugValue;return Ia.useSyncExternalStoreWithSelector=function(l,u,d,h,f){var p=s(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=a(function(){function _($){if(!v){if(v=!0,S=$,$=h($),f!==void 0&&g.hasValue){var M=g.value;if(f(M,$))return k=M}return k=$}if(M=k,r(S,$))return M;var E=h($);return f!==void 0&&f(M,E)?(S=$,M):(S=$,k=E)}var v=!1,S,k,x=d===void 0?null:d;return[function(){return _(u())},x===null?void 0:function(){return _(x())}]},[u,d,h,f]);var b=i(l,p[0],p[1]);return o(function(){g.hasValue=!0,g.value=b},[b]),c(b),b},Ia}var Ra={},ff;function Mw(){if(ff)return Ra;ff=1;var e={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return e.NODE_ENV!=="production"&&function(){function n(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var t=hs,r=df(),i=typeof Object.is=="function"?Object.is:n,s=r.useSyncExternalStore,o=t.useRef,a=t.useEffect,c=t.useMemo,l=t.useDebugValue;Ra.useSyncExternalStoreWithSelector=function(u,d,h,f,p){var g=o(null);if(g.current===null){var b={hasValue:!1,value:null};g.current=b}else b=g.current;g=c(function(){function v(M){if(!S){if(S=!0,k=M,M=f(M),p!==void 0&&b.hasValue){var E=b.value;if(p(E,M))return x=E}return x=M}if(E=x,i(k,M))return E;var C=f(M);return p!==void 0&&p(E,C)?(k=M,E):(k=M,x=C)}var S=!1,k,x,$=h===void 0?null:h;return[function(){return v(d())},$===null?void 0:function(){return v($())}]},[d,h,f,p]);var _=s(u,g[0],g[1]);return a(function(){b.hasValue=!0,b.value=_},[_]),l(_),_},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),Ra}var pf;function Ew(){if(pf)return ds.exports;pf=1;var e={};return e.NODE_ENV==="production"?ds.exports=Cw():ds.exports=Mw(),ds.exports}var Ow=Ew();function ps(e,n=t=>t){return Ow.useSyncExternalStoreWithSelector(e.subscribe,()=>e.state,()=>e.state,n,Iw)}function Iw(e,n){if(Object.is(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(const[r,i]of e)if(!n.has(r)||!Object.is(i,n.get(r)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(const r of e)if(!n.has(r))return!1;return!0}if(e instanceof Date&&n instanceof Date)return e.getTime()===n.getTime();const t=Object.keys(e);if(t.length!==Object.keys(n).length)return!1;for(let r=0;r<t.length;r++)if(!Object.prototype.hasOwnProperty.call(n,t[r])||!Object.is(e[t[r]],n[t[r]]))return!1;return!0}const ms=typeof window<"u"?xt:Q;function Aw(e){const[n]=P(()=>{const r=new Sw({...e,form:e.form,name:e.name});return r.Field=mf,r});return ms(n.mount,[n]),ms(()=>{n.update(e)}),ps(n.store,e.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),n}const mf=({children:e,...n})=>{const t=Aw(n),r=W(()=>is(e,t),[e,t,t.state.value,t.state.meta]);return Ie(xe,{children:r})};function Nw({form:e,selector:n,children:t}){const r=ps(e.store,n);return is(t,r)}function gf(e){const[n]=P(()=>{const t=new ww(e),r=t;return r.Field=function(s){return Ie(mf,{...s,form:t})},r.Subscribe=function(s){return Ie(Nw,{form:t,selector:s.selector,children:s.children})},r});return ms(n.mount,[]),ms(()=>{n.update(e)}),n}const Xt={root:w({border:"1px solid var(--outline-color, #e0e0e0)",borderRadius:"6px",position:"relative",marginBottom:"16px"}),rootError:w({borderColor:"var(--error-color, #ff5252)"}),header:w({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",borderBottom:"none"}),headerButtons:w({display:"flex",gap:"8px",alignItems:"center"}),headerExpanded:w({borderBottom:"1px solid var(--outline-color, #e0e0e0)"}),title:w({margin:0,fontSize:"14px",fontWeight:500}),content:w({padding:12,display:"none"}),contentExpanded:w({display:"block"})},ze=({title:e,children:n,initiallyExpanded:t=!1,buttons:r=[],error:i})=>{const[s,o]=P(t);return O("div",{css:[Xt.root,!!i&&Xt.rootError],children:[O("div",{css:[Xt.header,s&&Xt.headerExpanded],children:[m("div",{css:Xt.title,children:e}),O("div",{css:Xt.headerButtons,children:[r.map((a,c)=>m(G,{icon:a.icon,onClick:a.onClick,type:"button",size:"small"},c+a.icon)),m(G,{onClick:()=>o(!s),icon:s?"mdi:chevron-up":"mdi:chevron-down",type:"button",size:"small"})]})]}),m("div",{css:[Xt.content,s&&Xt.contentExpanded],children:n})]})},Rw={buttons:w({display:"flex",flexDirection:"row",gap:"8px"})},yf=({hass:e,entityId:n,mediaTypes:t,onChange:r})=>{const[i,s]=P(null),o=D(async()=>{var c;const a={type:"call_service",domain:"media_player",service:"browse_media",service_data:{entity_id:n},return_response:!0};try{const l=await e.connection.sendMessagePromise(a);return l?((c=l.response[n])==null?void 0:c.children.filter(u=>!u.media_content_id||u.media_content_id&&!u.media_content_id.startsWith("media-source")).map(u=>({name:u.title,media_type:u.media_content_type,icon:Pw(u)})))||[]:[]}catch(l){return s(l instanceof Error?l.message:String(l)),[]}},[n]);return m(ze,{title:"Media Types (optional)",children:O(xe,{children:[m(On,{children:"Use custom media types. If none added sensible defaults will be used. Be aware that not all media types are necessarily searchable."}),t.map((a,c)=>O(ze,{title:a.name??a.media_type,error:!a.media_type,buttons:[{icon:"mdi:arrow-up",onClick:()=>{if(c===0)return;const l=[...t],u=l[c-1];l[c-1]=l[c],l[c]=u,r(l)}},{icon:"mdi:arrow-down",onClick:()=>{if(c===t.length-1)return;const l=[...t],u=l[c+1];l[c+1]=l[c],l[c]=u,r(l)}},{icon:"mdi:delete",onClick:()=>{const l=[...t];l.splice(c,1),r(l)}}],children:[m(an,{hass:e,value:a.name||"",label:"Name",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],name:l},r(u)}}),m(an,{hass:e,value:a.icon??"",isIconInput:!0,label:"Icon",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],icon:l},r(u)}}),m(an,{hass:e,value:a.media_type||"",label:"Media Type",onChange:l=>{if(!l)return;const u=[...t];u[c]={...u[c],media_type:l},r(u)}})]},c+a.media_type)),O("div",{css:Rw.buttons,children:[m(vr,{type:"button",onClick:()=>r([...t,{name:"",media_type:""}]),children:"Add"}),m(vr,{type:"button",onClick:async()=>{const a=await o();a.length!==0&&r(a)},children:"Generate"}),m(vr,{type:"button",onClick:()=>r([]),children:"Clear"})]}),i&&m(co,{children:i})]})})},Pw=e=>{if(e.thumbnail)return e.thumbnail;switch(e.media_class){case"album":return"mdi:album";case"artist":return"mdi:account-music";case"track":return"mdi:music-note";case"playlist":return"mdi:playlist-music";default:return"mdi:folder-music"}},bf=e=>{var n,t,r,i,s,o,a,c;return{type:e.type??"custom:mediocre-media-player-card",entity_id:(e==null?void 0:e.entity_id)??"",use_art_colors:(e==null?void 0:e.use_art_colors)??!1,tap_opens_popup:(e==null?void 0:e.tap_opens_popup)??!1,action:(e==null?void 0:e.action)??{},speaker_group:{entity_id:((n=e==null?void 0:e.speaker_group)==null?void 0:n.entity_id)??null,entities:((t=e==null?void 0:e.speaker_group)==null?void 0:t.entities)??[]},search:{enabled:((r=e==null?void 0:e.search)==null?void 0:r.enabled)??!1,show_favorites:((i=e==null?void 0:e.search)==null?void 0:i.show_favorites)??!1,entity_id:((s=e==null?void 0:e.search)==null?void 0:s.entity_id)??null,media_types:((o=e==null?void 0:e.search)==null?void 0:o.media_types)??[]},ma_entity_id:(e==null?void 0:e.ma_entity_id)??null,ma_favorite_button_entity_id:(e==null?void 0:e.ma_favorite_button_entity_id)??null,custom_buttons:(e==null?void 0:e.custom_buttons)??[],options:{always_show_power_button:((a=e==null?void 0:e.options)==null?void 0:a.always_show_power_button)??!1,always_show_custom_buttons:((c=e==null?void 0:e.options)==null?void 0:c.always_show_custom_buttons)??!1},grid_options:e==null?void 0:e.grid_options,visibility:e==null?void 0:e.visibility}},vf=e=>{var n,t,r,i,s,o,a;return{type:e.type??"custom:mediocre-massive-media-player-card",entity_id:(e==null?void 0:e.entity_id)??"",use_art_colors:(e==null?void 0:e.use_art_colors)??!1,mode:(e==null?void 0:e.mode)??"card",action:(e==null?void 0:e.action)??{},speaker_group:{entity_id:((n=e==null?void 0:e.speaker_group)==null?void 0:n.entity_id)??null,entities:((t=e==null?void 0:e.speaker_group)==null?void 0:t.entities)??[]},search:{enabled:((r=e==null?void 0:e.search)==null?void 0:r.enabled)??!1,show_favorites:((i=e==null?void 0:e.search)==null?void 0:i.show_favorites)??!1,entity_id:((s=e==null?void 0:e.search)==null?void 0:s.entity_id)??null,media_types:((o=e==null?void 0:e.search)==null?void 0:o.media_types)??[]},ma_entity_id:(e==null?void 0:e.ma_entity_id)??null,ma_favorite_button_entity_id:(e==null?void 0:e.ma_favorite_button_entity_id)??null,custom_buttons:(e==null?void 0:e.custom_buttons)??[],options:{always_show_power_button:((a=e==null?void 0:e.options)==null?void 0:a.always_show_power_button)??!1},grid_options:e==null?void 0:e.grid_options,visibility:e==null?void 0:e.visibility}},_f=e=>{var t,r,i,s,o,a,c,l,u,d,h,f;const n={...e};return n.use_art_colors||delete n.use_art_colors,n.tap_opens_popup||delete n.tap_opens_popup,(!n.action||Object.keys(n.action).length===0)&&delete n.action,n.ma_entity_id||delete n.ma_entity_id,n.ma_favorite_button_entity_id||delete n.ma_favorite_button_entity_id,(!n.custom_buttons||n.custom_buttons.length===0)&&delete n.custom_buttons,((t=n.speaker_group)==null?void 0:t.entity_id)===null&&delete n.speaker_group.entity_id,!((r=n.speaker_group)!=null&&r.entity_id)&&(!((i=n.speaker_group)!=null&&i.entities)||n.speaker_group.entities.length===0)&&delete n.speaker_group,((s=n.search)==null?void 0:s.entity_id)===null&&delete n.search.entity_id,((a=(o=n.search)==null?void 0:o.media_types)==null?void 0:a.length)===0&&delete n.search.media_types,!((c=n.search)!=null&&c.enabled)&&!((l=n.search)!=null&&l.show_favorites)&&!((u=n.search)!=null&&u.entity_id)&&!((d=n.search)!=null&&d.media_types)&&delete n.search,((h=n.options)==null?void 0:h.always_show_power_button)===!1&&delete n.options.always_show_power_button,((f=n.options)==null?void 0:f.always_show_custom_buttons)===!1&&delete n.options.always_show_custom_buttons,Object.keys(n.options??{}).length===0&&delete n.options,n},xf=e=>{var t,r,i,s,o,a,c,l,u,d,h,f;const n={...e};return n.use_art_colors||delete n.use_art_colors,(!n.action||Object.keys(n.action).length===0)&&delete n.action,n.ma_entity_id||delete n.ma_entity_id,n.ma_favorite_button_entity_id||delete n.ma_favorite_button_entity_id,(!n.custom_buttons||n.custom_buttons.length===0)&&delete n.custom_buttons,((t=n.speaker_group)==null?void 0:t.entity_id)===null&&delete n.speaker_group.entity_id,!((r=n.speaker_group)!=null&&r.entity_id)&&(!((i=n.speaker_group)!=null&&i.entities)||n.speaker_group.entities.length===0)&&delete n.speaker_group,((s=n.search)==null?void 0:s.entity_id)===null&&delete n.search.entity_id,((a=(o=n.search)==null?void 0:o.media_types)==null?void 0:a.length)===0&&delete n.search.media_types,!((c=n.search)!=null&&c.enabled)&&!((l=n.search)!=null&&l.show_favorites)&&!((u=n.search)!=null&&u.entity_id)&&!((d=n.search)!=null&&d.media_types)&&delete n.search,((h=n.options)==null?void 0:h.always_show_power_button)===!1&&delete n.options.always_show_power_button,(f=n.options)!=null&&f.always_show_power_button||delete n.options,n},Dw=({config:e,rootElement:n,hass:t})=>{const r=D(l=>{const u=new Event("config-changed",{bubbles:!0,composed:!0});u.detail={config:l},n.dispatchEvent(u)},[n]),i=gf({defaultValues:vf(e),validators:{onChange:uw},listeners:{onChange:({formApi:l})=>{if(l.state.isValid){const u=xf(l.state.values);JSON.stringify(e)!==JSON.stringify(xf(u))&&r(u)}else console.log(l.state.errors)},onChangeDebounceMs:500}}),s=ps(i.store,l=>l.errorMap),o=D(l=>!!Object.keys((s==null?void 0:s.onChange)??{}).find(u=>u.startsWith(l)),[s]),a=D(()=>{const l=i.getFieldValue("custom_buttons")||[];i.setFieldValue("custom_buttons",[...l,{icon:"mdi:paper-roll",name:"New Button",tap_action:{action:"toggle"}}])},[i]),c=D(l=>{const d=[...i.getFieldValue("custom_buttons")||[]];d.splice(l,1),i.setFieldValue("custom_buttons",d)},[i]);return Q(()=>{const l=i.state.values,u=vf(e);JSON.stringify(l)!==JSON.stringify(u)&&i.reset(u)},[e,i]),!e||!t?null:O("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),i.handleSubmit()},children:[m(i.Field,{name:"entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??""),label:"Media Player Entity",domains:["media_player"],error:gn(l),required:!0})})}),m(Ue,{css:w({display:"flex",flexDirection:"row",gap:"16px"}),children:m(i.Field,{name:"use_art_colors",children:l=>O($t,{children:[m(Mt,{id:"use_art_colors",checked:l.state.value,onChange:u=>{var d;return l.handleChange(((d=u.target)==null?void 0:d.checked)??!1)}}),m(Ct,{htmlFor:"use_art_colors",children:"Use album art colors"})]})})}),m(ze,{title:"Display Mode",error:o("mode"),children:m(i.Field,{name:"mode",children:l=>m(Pm,{options:[{name:"Panel",value:"panel"},{name:"Card",value:"card"},{name:"In Card",value:"in-card"}],onSelected:u=>l.handleChange(u),selected:e.mode||"panel"})})}),m(ze,{title:"Interactions",error:o("action"),children:m(i.Field,{name:"action",children:l=>m(mi,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??{})})})}),O(ze,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[m(i.Field,{name:"speaker_group.entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value||"",onChange:u=>{l.handleChange(u??null)},label:"Main Speaker Entity ID (Optional)",error:gn(l),domains:["media_player"]})})}),m(i.Field,{name:"speaker_group.entities",children:l=>m(Ue,{children:m(bc,{hass:t,value:l.state.value??[],onChange:u=>{l.handleChange(u??[])},label:"Select Speakers (including main speaker)",domains:["media_player"]})})})]}),O(ze,{title:"Search (optional)",error:o("search"),children:[m(i.Field,{name:"ma_entity_id",children:l=>{var u;return m(yr,{children:(((u=l.state.value)==null?void 0:u.length)??0)>0&&m(On,{children:"ma_entity_id is already set. Any change in this section will not have any effect."})})}}),O(Ue,{children:[m(i.Field,{name:"search.enabled",children:l=>O($t,{children:[m(Mt,{type:"checkbox",id:"search.enabled",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"search.enabled",children:"Enable Search"})]})}),m(i.Field,{name:"search.enabled",children:l=>m(yr,{children:l.state.value&&m(i.Field,{name:"search.show_favorites",children:u=>O($t,{children:[m(Mt,{type:"checkbox",id:"search.show_favorites",checked:u.state.value??!1,onChange:d=>u.handleChange(d.target.checked)}),m(Ct,{htmlFor:"search.show_favorites",children:"Show Favorites when not searching"})]})})})}),m(i.Field,{name:"search.entity_id",children:l=>m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Search target (Optional, if not set, will use the main entity_id)",error:gn(l),domains:["media_player"]})})]}),m(i.Field,{name:"search.media_types",children:l=>{var u;return m(yf,{entityId:((u=e.search)==null?void 0:u.entity_id)??e.entity_id??"",hass:t,mediaTypes:l.state.value??[],onChange:d=>{l.handleChange(d??[])}})}})]}),O(ze,{title:"Music Assistant Configuration (optional)",error:o("ma_entity_id")??o("ma_favorite_button_entity_id"),children:[m(i.Field,{name:"ma_entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Music Assistant Entity ID (Optional)",error:gn(l),domains:["media_player"]})})}),m(i.Field,{name:"ma_favorite_button_entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"MA Favorite Button Entity ID (Optional)",error:gn(l),domains:["button"]})})})]}),m(ze,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:O(gc,{children:[m(i.Field,{name:"custom_buttons",children:l=>{var u;return(u=l.state.value)==null?void 0:u.map((d,h)=>O(ze,{title:`Button ${h} - ${d.name}`,error:o(`custom_buttons[${h}]`),children:[O(Ue,{children:[m(i.Field,{name:`custom_buttons[${h}].name`,children:f=>m(pi,{children:m(an,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,label:"Name",error:gn(f)})})}),m(i.Field,{name:`custom_buttons[${h}].icon`,children:f=>m(pi,{children:m(an,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,isIconInput:!0,label:"Icon",error:gn(f)})})}),m(On,{children:"Interactions"}),m(i.Field,{name:`custom_buttons[${h}]`,children:f=>{const p=f.state.value??{icon:"",name:""},{name:g,icon:b,..._}=p;return m(mi,{hass:t,value:_,onChange:v=>{f.handleChange({name:g,icon:b,...v})}})}})]}),m(yc,{type:"button",onClick:()=>c(h),children:"Remove Button"})]},h))}}),m(vr,{type:"button",onClick:a,children:"Add Custom Button"})]})}),m(ze,{title:"Additional options (optional)",error:o("options"),children:m(i.Field,{name:"options.always_show_power_button",children:l=>O($t,{children:[m(Mt,{id:"options.always_show_power_button",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"options.always_show_power_button",children:"Always show power button"})]})})})]})},gn=e=>e.state.meta.isValid?void 0:e.state.meta.errors.map(n=>typeof n=="string"?n:(n==null?void 0:n.message)||String(n)).filter(Boolean).join(", "),wf={root:w({display:"flex",flexDirection:"row",justifyContent:"flex-start",overflowX:"auto",scrollbarWidth:"none","-ms-overflow-style":"none","&::-webkit-scrollbar":{display:"none"},paddingTop:"16px",paddingBottom:"16px",borderTop:`0.5px solid ${de.colors.onCardDivider}`,gap:"2px"}),chip:w({"&:first-child":{marginLeft:16},"&:last-child":{marginRight:16}})},Tw=()=>{const{config:e}=le(Ve),{custom_buttons:n}=e;return m("div",{css:wf.root,children:n==null?void 0:n.map((t,r)=>m(Sf,{button:t},r))})},Sf=({button:e,type:n="chip"})=>{const{rootElement:t,config:r}=le(Ve),{icon:i,name:s,...o}=e,a=Dn({rootElement:t,actionConfig:{...o,entity:r.entity_id}});return n==="icon-button"?m(G,{icon:e.icon??"mdi:dots-vertical",size:"x-small",...a}):O(on,{css:wf.chip,icon:i,...a,children:[!!s&&m("span",{children:s}),a.renderLongPressIndicator()]})},Fw=En`
  from {
    top: 15%;
    opacity: 0;
  }
  to {
    top: 0%;
    opacity: 1;
  }
`,kf=58,yn={overlay:w({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:8,transition:"opacity 0.3s ease-in-out",display:"flex",justifyContent:"center",alignItems:"flex-end","@media screen and (min-height: 832px)":{alignItems:"center"}}),clickableBackground:w({position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),popUpContainer:w({position:"relative",animation:`${Fw} 0.55s cubic-bezier(0.25, 1, 0.5, 1) forwards`,maxHeight:"98vh",height:"fit-content",width:"424px",maxWidth:"98vw",backgroundColor:de.colors.dialog,overflow:"hidden",boxShadow:"0px 10px 20px var(--clear-background-color)",borderTopLeftRadius:"var(--ha-dialog-border-radius, 28px)",borderTopRightRadius:"var(--ha-dialog-border-radius, 28px)","@media screen and (min-height: 832px)":{borderRadius:"var(--ha-dialog-border-radius, 28px)",boxShadow:"0px 0px 20px var(--clear-background-color)"},"@media (prefers-color-scheme: light)":{boxShadow:"0px 10px 20px rgba(0, 0, 0, 0.2)"}}),popUpContent:w({display:"grid",height:"100%"}),popUpHeader:w({display:"flex",height:kf,justifyContent:"flex-start",alignItems:"center",padding:"0px 16px",borderBottom:"1px solid var(--divider-color, rgba(0, 0, 0, 0.12))",gap:"8px"}),title:w({margin:0,fontSize:"18px",fontWeight:500,color:de.colors.onDialog,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"auto"}),massiveCard:w({maxHeight:`calc(98vh - ${kf}px)`,maxWidth:"98vw",width:"100%",height:"100%",overflow:"hidden"})},Vw=({visible:e,setVisible:n})=>{var p,g;const t=An(),{config:r,rootElement:i}=le(Ve),{entity_id:s,speaker_group:o}=r,{attributes:{friendly_name:a,icon:c,device_class:l}}=Le(),u=(g=(p=t.states[(o==null?void 0:o.entity_id)??s])==null?void 0:p.attributes)==null?void 0:g.group_members,d=lo({icon:c,deviceClass:l}),h=W(()=>{const{tap_opens_popup:b,..._}=r;return{..._,mode:"popup"}},[r]),f=Dn({rootElement:i,actionConfig:{tap_action:{action:"more-info"},entity:s}});return e?O("div",{css:yn.overlay,children:[m("div",{css:yn.clickableBackground,onClick:()=>n(!1)}),O("div",{css:yn.popUpContainer,children:[O("div",{css:yn.popUpHeader,children:[m(gt,{size:"small",icon:d}),O("h2",{css:yn.title,children:[a,(u==null?void 0:u.length)>1&&O("span",{children:[" +",u.length-1]})]}),m(G,{size:"small",...f,icon:"mdi:dots-vertical"}),m(G,{icon:"mdi:close",size:"small",onClick:()=>n(!1)})]}),m("div",{css:yn.popUpContent,children:m(fc,{rootElement:i,config:h,children:m(gu,{css:yn.massiveCard})})})]})]}):null},$f={titleText:w({margin:0,fontSize:"16px",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:de.colors.onCard}),artistText:w({margin:0,fontSize:"14px",color:de.colors.onCardMuted,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},Lw=()=>{const{title:e,subtitle:n}=Le();return O(xe,{children:[!!e&&m("h3",{css:$f.titleText,children:e}),!!n&&m("p",{css:$f.artistText,children:n})]})},Hr={root:w({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",marginTop:"auto",height:"36px",marginLeft:"-4px"}),buttonMuted:w({opacity:.8}),shuffleButton:w({"@container (max-width: 150px)":{display:"none"}}),repeatButton:w({"@container (max-width: 130px)":{display:"none"}})},zw=()=>{const{config:e}=le(Ve),{attributes:{shuffle:n,repeat:t},state:r}=Le(),i=r==="playing",{supportPreviousTrack:s,supportNextTrack:o,supportsShuffle:a,supportsRepeat:c,supportsTogglePlayPause:l}=Co(),u=D(()=>{X().callService("media_player","media_play_pause",{entity_id:e.entity_id})},[]),d=D(()=>{X().callService("media_player","media_next_track",{entity_id:e.entity_id})},[]),h=D(()=>{X().callService("media_player","media_previous_track",{entity_id:e.entity_id})},[]),f=D(()=>{X().callService("media_player","shuffle_set",{entity_id:e.entity_id,shuffle:!n})},[n]),p=D(()=>{const g=t==="off"?"one":t==="one"?"all":"off";X().callService("media_player","repeat_set",{entity_id:e.entity_id,repeat:g})},[t]);return O("div",{css:Hr.root,children:[!!a&&m(G,{css:[Hr.shuffleButton,...n?[]:[Hr.buttonMuted]],size:"x-small",onClick:f,icon:n?"mdi:shuffle-variant":"mdi:shuffle-disabled"}),!!s&&m(G,{size:"small",onClick:h,icon:"mdi:skip-previous"}),l&&m(G,{size:"medium",onClick:u,icon:i?"mdi:pause-circle":"mdi:play-circle"}),!!o&&m(G,{size:"small",onClick:d,icon:"mdi:skip-next"}),!!c&&m(G,{css:[Hr.repeatButton,...t==="off"?[Hr.buttonMuted]:[]],size:"x-small",onClick:p,icon:t==="one"?"mdi:repeat-once":t==="all"?"mdi:repeat":"mdi:repeat-off"})]})},Pa={root:w({display:"flex",flexDirection:"row",alignItems:"center",gap:"4px"}),friendlyName:w({fontSize:"11px",color:de.colors.onCardMuted,opacity:.8,fontStyle:"italic"})},Bw=()=>{var u,d;const e=An(),{config:n}=le(Ve),{entity_id:t,speaker_group:r}=n,{attributes:{friendly_name:i,icon:s,device_class:o},state:a}=Le(),c=(d=(u=e.states[(r==null?void 0:r.entity_id)??t])==null?void 0:u.attributes)==null?void 0:d.group_members,l=lo({icon:s,deviceClass:o});return a==="off"?null:O("div",{css:Pa.root,children:[m(gt,{icon:l,size:"xx-small"}),m("span",{css:Pa.friendlyName,children:i}),c&&c.length>1&&O("span",{css:Pa.friendlyName,children:["+",c.length-1]})]})},qw={root:w({maxHeight:300,paddingTop:12,paddingBottom:12,borderTop:`0.5px solid ${de.colors.onCardDivider}`,overflowY:"auto"})},Uw=()=>{const{config:e}=le(Ve),{ma_entity_id:n,search:t,entity_id:r}=e,i=()=>n?m(lu,{maEntityId:n,horizontalPadding:12}):t!=null&&t.enabled?m(Rc,{entityId:t.entity_id??r,showFavorites:t.show_favorites??!1,horizontalPadding:12,filterConfig:t.media_types}):null;return m("div",{css:qw.root,children:i()})},bn={speakerGroupContainer:w({display:"flex",flexDirection:"column",paddingTop:"12px",paddingBottom:"16px",borderTop:`0.5px solid ${de.colors.onCardDivider}`,gap:"12px"}),groupTitle:w({fontSize:"16px",fontWeight:500,color:de.colors.onCard,margin:"0px 16px"}),syncContainer:w({display:"flex",flexDirection:"row",alignItems:"center",marginLeft:"auto",gap:"4px",marginRight:"19px"}),syncText:w({fontSize:"12px",color:de.colors.onCardMuted}),groupedSpeakers:w({display:"flex",flexDirection:"column",gap:"8px",marginLeft:"16px",marginRight:"16px"}),titleRow:w({display:"flex",alignItems:"center"})},Kw=()=>{var c,l;const e=An(),{config:n}=le(Ve),{entity_id:t,speaker_group:r}=n,[i,s]=P(!0),o=(r==null?void 0:r.entity_id)||t,a=e.states[o];return O("div",{css:bn.speakerGroupContainer,children:[((l=(c=a==null?void 0:a.attributes)==null?void 0:c.group_members)==null?void 0:l.length)>1&&O(xe,{children:[O("div",{css:bn.titleRow,children:[m("h3",{css:bn.groupTitle,children:"Grouped Speakers"}),O("div",{css:bn.syncContainer,children:[m("span",{css:bn.syncText,onClick:()=>s(!i),children:"Link Volume"}),m(G,{icon:i?"mdi:check-circle":"mdi:circle-outline",size:"x-small",onClick:()=>s(!i)})]})]}),m("div",{css:bn.groupedSpeakers,children:m(_c,{config:{entity_id:t,speaker_group:r},syncMainSpeaker:i})})]}),m("h3",{css:bn.groupTitle,children:"Add speakers to group"}),m(uo,{config:{entity_id:t,speaker_group:r},showGrouped:!1,layout:{horizontalMargin:16}})]})},jw={root:w({display:"flex",alignItems:"center",transition:"all 0.3s ease",width:"100%",gap:"4px"})},Ww=()=>{var a,c;const e=Le(),n=e.entity_id,t=((a=e.attributes)==null?void 0:a.volume_level)??0,r=((c=e.attributes)==null?void 0:c.is_volume_muted)??!1,i=D(l=>{X().callService("media_player","volume_set",{entity_id:n,volume_level:l})},[]),s=D(()=>{X().callService("media_player","volume_mute",{entity_id:n,is_volume_muted:!r})},[r]),o=W(()=>br(t,r),[t,r]);return O("div",{css:jw.root,children:[m(G,{size:"x-small",onClick:s,icon:o}),m(Va,{min:0,max:1,step:.01,value:t,sliderSize:"small",onChange:i})]})},Hw=({sliderVisible:e,setSliderVisible:n})=>{var o,a;const t=Le(),r=((o=t.attributes)==null?void 0:o.volume_level)??0,i=((a=t.attributes)==null?void 0:a.is_volume_muted)??!1,s=br(r,i);return m(xe,{children:e?m(G,{size:"x-small",onClick:()=>n(!1),icon:"mdi:chevron-left"}):m(G,{size:"x-small",onClick:()=>n(!0),icon:s})})},bt={card:w({borderRadius:"var(--ha-card-border-radius, 12px)",overflow:"hidden"}),cardArtBackground:w({background:`
      radial-gradient( circle at bottom right, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top center, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at bottom center, var(--art-color, transparent) -500%, transparent 40% ),
      radial-gradient( circle at top left, var(--art-color, transparent) -500%, transparent 40% )`}),cardContent:w({display:"flex",gap:"14px",padding:"12px",opacity:1,transition:"opacity 0.3s ease",position:"relative"}),cardRowRight:w({display:"grid",gridTemplateColumns:"repeat(3, auto)",gap:"4px",minWidth:"max-content"}),cardRow:w({display:"flex",flexDirection:"row",gap:"8px",alignItems:"center",justifyContent:"space-between"}),alignStart:w({alignItems:"start"}),cardColumn:w({display:"flex",flexDirection:"column",flex:1}),grid:w({display:"grid"}),controlsContainer:w({display:"flex",flexGrow:1,containerType:"inline-size"})},Gw=()=>{const{rootElement:e,config:n}=le(Ve),{entity_id:t,custom_buttons:r,action:i,tap_opens_popup:s,use_art_colors:o,ma_entity_id:a,ma_favorite_button_entity_id:c,search:l,options:{always_show_power_button:u,always_show_custom_buttons:d}={}}=n,h=r&&r.length>0,p=a&&a.length>0||(l==null?void 0:l.enabled),[g,b]=P(!1),[_,v]=P(d??!1),[S,k]=P(!1),[x,$]=P(!1),{artVars:M,haVars:E}=hu(),{state:C,subtitle:N}=Le(),R=Co(),F=!R.supportsTogglePlayPause&&!R.supportNextTrack&&!R.supportPreviousTrack&&!R.supportsShuffle&&!R.supportsRepeat,z=C!=="off"&&C!=="unavailable",U=n.speaker_group&&n.speaker_group.entities&&n.speaker_group.entities.length>0,Y=()=>{b(!g)},[Te,pe]=P(!1),H=C==="off"||!N&&F?68:100,me=Dn({rootElement:e,actionConfig:{...i??{tap_action:{action:"more-info"}},entity:n.entity_id},overrideCallback:s?{onTap:()=>{pe(!0)}}:{}}),Xe=D(()=>{X().callService("media_player","toggle",{entity_id:t})},[t]);return m("ha-card",{children:O("div",{css:[bt.card,o&&bt.cardArtBackground],style:{...M??{},...E&&o?E:{}},children:[O("div",{css:bt.cardContent,style:{opacity:z?1:.7},children:[m(hc,{size:H,iconSize:"large",...me}),O("div",{css:bt.cardColumn,children:[O("div",{css:[bt.cardRow,bt.alignStart],children:[O("div",{css:bt.grid,children:[m(Lw,{}),m(Bw,{})]}),O("div",{css:bt.cardRowRight,children:[h&&!d&&m(xe,{children:r.length===1?m(Sf,{button:r[0],type:"icon-button"}):m(G,{size:"x-small",onClick:()=>v(!_),icon:"mdi:dots-vertical"})}),a&&m(ou,{ma_entity_id:a??void 0,ma_favorite_button_entity_id:c??void 0,renderTrigger:Se=>m(G,{icon:"mdi:bookshelf",size:"x-small",...Se})}),p&&m(G,{size:"x-small",onClick:()=>$(!x),icon:"mdi:magnify"})]})]}),O("div",{css:bt.cardRow,style:{marginTop:"auto",minHeight:F?"unset":"36px"},children:[m("div",{css:bt.controlsContainer,children:S||F?m(Ww,{}):m(zw,{})}),O("div",{css:bt.cardRowRight,children:[!!z&&!F&&m(Hw,{sliderVisible:S,setSliderVisible:k}),!!z&&U&&m(G,{size:"x-small",onClick:Y,icon:"mdi:speaker-multiple"}),(!z||F||u)&&m(G,{size:"x-small",onClick:Xe,icon:"mdi:power"})]})]})]})]}),g&&U&&m(Kw,{}),_&&m(Tw,{}),x&&m(Uw,{}),Te&&m(Vw,{visible:Te,setVisible:pe})]})})},Jw=({config:e,rootElement:n,hass:t})=>{const r=D(l=>{const u=new Event("config-changed",{bubbles:!0,composed:!0});u.detail={config:l},n.dispatchEvent(u)},[n]),i=gf({defaultValues:bf(e),validators:{onChange:cw},listeners:{onChange:({formApi:l})=>{if(l.state.isValid){const u=_f(l.state.values);JSON.stringify(e)!==JSON.stringify(_f(u))&&r(u)}else console.log(l.state.errors)},onChangeDebounceMs:500}}),s=ps(i.store,l=>l.errorMap),o=D(l=>!!Object.keys((s==null?void 0:s.onChange)??{}).find(u=>u.startsWith(l)),[s]),a=D(()=>{const l=i.getFieldValue("custom_buttons")||[];i.setFieldValue("custom_buttons",[...l,{icon:"mdi:paper-roll",name:"New Button",tap_action:{action:"toggle"}}])},[i]),c=D(l=>{const d=[...i.getFieldValue("custom_buttons")||[]];d.splice(l,1),i.setFieldValue("custom_buttons",d)},[i]);return Q(()=>{const l=i.state.values,u=bf(e);JSON.stringify(l)!==JSON.stringify(u)&&i.reset(u)},[e,i]),!e||!t?null:O("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),i.handleSubmit()},children:[m(i.Field,{name:"entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??""),label:"Media Player Entity",domains:["media_player"],error:vn(l),required:!0})})}),O(Ue,{css:w({display:"flex",flexDirection:"row",gap:"16px"}),children:[m(i.Field,{name:"use_art_colors",children:l=>O($t,{children:[m(Mt,{id:"use_art_colors",checked:l.state.value,onChange:u=>{var d;return l.handleChange(((d=u.target)==null?void 0:d.checked)??!1)}}),m(Ct,{htmlFor:"use_art_colors",children:"Use album art colors"})]})}),m(i.Field,{name:"tap_opens_popup",children:l=>O($t,{children:[m(Mt,{id:"tap_opens_popup",checked:l.state.value,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"tap_opens_popup",children:"Tap opens popup."})]})})]}),O(ze,{title:"Interactions",error:o("action"),children:[m(i.Field,{name:"tap_opens_popup",children:l=>m(yr,{children:l.state.value&&m(On,{children:'Tap action overridden by "tap opens popup".'})})}),m(i.Field,{name:"action",children:l=>m(mi,{hass:t,value:l.state.value,onChange:u=>l.handleChange(u??{})})})]}),O(ze,{title:"Speaker Group Configuration (optional)",error:o("speaker_group"),children:[m(i.Field,{name:"speaker_group.entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value||"",onChange:u=>{l.handleChange(u??null)},label:"Main Speaker Entity ID (Optional)",error:vn(l),domains:["media_player"]})})}),m(i.Field,{name:"speaker_group.entities",children:l=>m(Ue,{children:m(bc,{hass:t,value:l.state.value??[],onChange:u=>{l.handleChange(u??[])},label:"Select Speakers (including main speaker)",domains:["media_player"]})})})]}),O(ze,{title:"Search (optional)",error:o("search"),children:[m(i.Field,{name:"ma_entity_id",children:l=>{var u;return m(yr,{children:(((u=l.state.value)==null?void 0:u.length)??0)>0&&m(On,{children:"ma_entity_id is already set. Any change in this section will not have any effect."})})}}),O(Ue,{children:[m(i.Field,{name:"search.enabled",children:l=>O($t,{children:[m(Mt,{type:"checkbox",id:"search.enabled",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"search.enabled",children:"Enable Search"})]})}),m(i.Field,{name:"search.enabled",children:l=>m(yr,{children:l.state.value&&m(i.Field,{name:"search.show_favorites",children:u=>O($t,{children:[m(Mt,{type:"checkbox",id:"search.show_favorites",checked:u.state.value??!1,onChange:d=>u.handleChange(d.target.checked)}),m(Ct,{htmlFor:"search.show_favorites",children:"Show Favorites when not searching"})]})})})}),m(i.Field,{name:"search.entity_id",children:l=>m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Search target (Optional, if not set, will use the main entity_id)",error:vn(l),domains:["media_player"]})})]}),m(i.Field,{name:"search.media_types",children:l=>{var u;return m(yf,{entityId:((u=e.search)==null?void 0:u.entity_id)??e.entity_id??"",hass:t,mediaTypes:l.state.value??[],onChange:d=>{l.handleChange(d??[])}})}})]}),O(ze,{title:"Music Assistant Configuration (optional)",error:o("ma_entity_id")??o("ma_favorite_button_entity_id"),children:[m(i.Field,{name:"ma_entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"Music Assistant Entity ID (Optional)",error:vn(l),domains:["media_player"]})})}),m(i.Field,{name:"ma_favorite_button_entity_id",children:l=>m(Ue,{children:m(ot,{hass:t,value:l.state.value??"",onChange:u=>{l.handleChange(u??null)},label:"MA Favorite Button Entity ID (Optional)",error:vn(l),domains:["button"]})})})]}),m(ze,{title:"Custom Buttons (optional)",error:o("custom_buttons"),children:O(gc,{children:[m(i.Field,{name:"custom_buttons",children:l=>{var u;return(u=l.state.value)==null?void 0:u.map((d,h)=>O(ze,{title:`Button ${h} - ${d.name}`,error:o(`custom_buttons[${h}]`),children:[O(Ue,{children:[m(i.Field,{name:`custom_buttons[${h}].name`,children:f=>m(pi,{children:m(an,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,label:"Name",error:vn(f)})})}),m(i.Field,{name:`custom_buttons[${h}].icon`,children:f=>m(pi,{children:m(an,{value:f.state.value??"",onChange:p=>f.handleChange(p??""),hass:t,isIconInput:!0,label:"Icon",error:vn(f)})})}),m(On,{children:"Interactions"}),m(i.Field,{name:`custom_buttons[${h}]`,children:f=>{const p=f.state.value??{icon:"",name:""},{name:g,icon:b,..._}=p;return m(mi,{hass:t,value:_,onChange:v=>{f.handleChange({name:g,icon:b,...v})}})}})]}),m(yc,{type:"button",onClick:()=>c(h),children:"Remove Button"})]},h))}}),m(vr,{type:"button",onClick:a,children:"Add Custom Button"})]})}),O(ze,{title:"Additional options (optional)",error:o("options"),children:[m(i.Field,{name:"options.always_show_power_button",children:l=>O($t,{children:[m(Mt,{id:"options.always_show_power_button",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"options.always_show_power_button",children:"Always show power button"})]})}),m(i.Field,{name:"options.always_show_custom_buttons",children:l=>O($t,{children:[m(Mt,{id:"options.always_show_custom_buttons",checked:l.state.value??!1,onChange:u=>l.handleChange(u.target.checked)}),m(Ct,{htmlFor:"options.always_show_custom_buttons",children:"Always show custom buttons panel below card"})]})})]})]})},vn=e=>e.state.meta.isValid?void 0:e.state.meta.errors.map(n=>typeof n=="string"?n:(n==null?void 0:n.message)||String(n)).filter(Boolean).join(", "),Cf={root:w({display:"flex",flexDirection:"row",height:"4px",width:"100%",backgroundColor:"var(--divider-color)",borderRadius:"2px",overflow:"hidden"}),progress:w({height:"100%",backgroundColor:"var(--secondary-text-color)",width:"0%",transition:"width 1s linear"})},Yw=({min:e,max:n,value:t})=>{const r=(t-e)/(n-e)*100;return m("div",{css:Cf.root,children:m("div",{css:Cf.progress,style:{width:`${r}%`}})})};function Gr(e){return(e==null?void 0:e.ownerDocument)||document}const gs={clip:"rect(0 0 0 0)",overflow:"hidden",whiteSpace:"nowrap",position:"fixed",top:0,left:0,border:0,padding:0,width:1,height:1,margin:-1};var Mf={};let Da;Mf.NODE_ENV!=="production"&&(Da=new Set);function Zw(...e){if(Mf.NODE_ENV!=="production"){const n=e.join(" ");Da.has(n)||(Da.add(n),console.warn(`Base UI: ${n}`))}}function _n(e,n=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER){return Math.max(n,Math.min(e,t))}function Xw(e,n,t=(r,i)=>r===i){return e.length===n.length&&e.every((r,i)=>t(r,n[i]))}var Qw={};const Ta=st({register:()=>{},unregister:()=>{},subscribeMapChange:()=>()=>{},elementsRef:{current:[]},nextIndexRef:{current:0}});Qw.NODE_ENV!=="production"&&(Ta.displayName="CompositeListContext");function e1(){return le(Ta)}function t1(e){const{children:n,elementsRef:t,labelsRef:r,onMapChange:i}=e,s=Z(0),o=cn(r1).current,a=cn(n1).current,[c,l]=P(0),u=Z(c),d=Re((b,_)=>{a.set(b,_??null),u.current+=1,l(u.current)}),h=Re(b=>{a.delete(b),u.current+=1,l(u.current)}),f=W(()=>{const b=new Map;return Array.from(a.keys()).sort(i1).forEach((v,S)=>{const k=a.get(v)??{};b.set(v,{...k,index:S})}),b},[a,c]);nt(()=>{u.current===c&&(t.current.length!==f.size&&(t.current.length=f.size),r&&r.current.length!==f.size&&(r.current.length=f.size)),i==null||i(f)},[i,f,t,r,c,u]);const p=Re(b=>(o.add(b),()=>{o.delete(b)}));nt(()=>{o.forEach(b=>b(f))},[o,f]);const g=W(()=>({register:d,unregister:h,subscribeMapChange:p,elementsRef:t,labelsRef:r,nextIndexRef:s}),[d,h,p,t,r,s]);return Ie(Ta.Provider,{value:g,children:n})}function n1(){return new Map}function r1(){return new Set}function i1(e,n){const t=e.compareDocumentPosition(n);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}function Ef(e,n){return e-n}function Of(e,n,t){const r=e.slice();return r[n]=t,r.sort(Ef)}function If(e,n,t,r,i,s){let o=e;return o=_n(o,t,r),i&&(o=Of(s,n,_n(o,s[n-1]||-1/0,s[n+1]||1/0))),o}function Af(e,n,t){if(!Array.isArray(e))return!0;const r=e.reduce((i,s,o,a)=>(o===a.length-1||i.push(Math.abs(s-a[o+1])),i),[]);return Math.min(...r)>=n*t}const ys={activeThumbIndex:()=>null,max:()=>null,min:()=>null,minStepsBetweenValues:()=>null,step:()=>null,values:()=>null};var s1={};const Fa=st(void 0);s1.NODE_ENV!=="production"&&(Fa.displayName="SliderRootContext");function bs(){const e=le(Fa);if(e===void 0)throw new Error("Base UI: SliderRootContext is missing. Slider parts must be placed within <Slider.Root>.");return e}var o1={};function a1(e,n){return typeof e=="number"&&typeof n=="number"?e===n:Array.isArray(e)&&Array.isArray(n)?Xw(e,n):!1}const Nf=pt(function(n,t){const{"aria-labelledby":r,className:i,defaultValue:s,disabled:o=!1,id:a,inputRef:c,format:l,largeStep:u=10,locale:d,render:h,max:f=100,min:p=0,minStepsBetweenValues:g=0,name:b,onValueChange:_,onValueCommitted:v,orientation:S="horizontal",step:k=1,tabIndex:x,value:$,...M}=n,E=bo(a),C=Re(_),N=Re(v),{clearErrors:R}=go(),{labelId:F,state:z,disabled:U,name:Y,setTouched:Te,setDirty:pe,validityData:H,validationMode:K}=Nn(),me=eu(),Xe=r??F,Se=U||o,Qe=Y??b??"",[L,ve]=Zc({controlled:$,default:s??p,name:"Slider"}),se=Z(null),ke=Z(null),oe=Z([]),vt=_i(c,me.inputRef),ae=Z(null),Qt=Xc(l),[je,T]=P(-1),[We,$e]=P(!1),[rt,it]=P(()=>new Map);Qc({id:E,commitValidation:me.commitValidation,value:L,controlRef:ke,name:Qe,getValue:()=>L});const ut=Re(ge=>{ge&&(ke.current=ge)}),dt=Array.isArray(L),qt=W(()=>dt?L.slice().sort(Ef):[_n(L,p,f)],[f,p,dt,L]),Yr=Re((ge,ht,rr)=>{if(Number.isNaN(ge)||a1(ge,L))return;ve(ge);const Ut=new rr.constructor(rr.type,rr);Object.defineProperty(Ut,"target",{writable:!0,value:{value:ge,name:Qe}}),ae.current=ge,C(ge,Ut,ht),R(Qe),me.commitValidation(ge,!0)}),Ms=Re((ge,ht,rr)=>{const Ut=If(ge,ht,p,f,dt,qt);if(Af(Ut,k,g)){Yr(Ut,ht,rr.nativeEvent),pe(Ut!==H.initialValue),Te(!0);const za=ae.current??Ut;N(za,rr.nativeEvent),R(Qe),K==="onChange"?me.commitValidation(za??Ut):me.commitValidation(za??Ut,!0)}}),nr=Re(()=>{var ge,ht;(ht=(ge=oe.current)==null?void 0:ge[0])==null||ht.focus()});nt(()=>{$===void 0||We||p>=f&&Zw("Slider `max` must be greater than `min`")},[We,p,f,$]),nt(()=>{var ht;const ge=Gc(Gr(se.current));Se&&((ht=se.current)!=null&&ht.contains(ge))&&ge.blur()},[Se]),Se&&je!==-1&&T(-1);const Ce=W(()=>({...z,activeThumbIndex:je,disabled:Se,dragging:We,orientation:S,max:f,min:p,minStepsBetweenValues:g,step:k,values:qt}),[z,je,Se,We,f,p,g,S,k,qt]),et=W(()=>({active:je,disabled:Se,dragging:We,fieldControlValidation:me,formatOptionsRef:Qt,handleInputChange:Ms,labelId:Xe,largeStep:u,lastChangedValueRef:ae,locale:d,max:f,min:p,minStepsBetweenValues:g,onValueCommitted:N,orientation:S,range:dt,registerFieldControlRef:ut,setActive:T,setDragging:$e,setValue:Yr,state:Ce,step:k,tabIndex:x??null,thumbMap:rt,thumbRefs:oe,values:qt}),[je,Xe,Se,We,x,me,Qt,Ms,u,ae,d,f,p,g,N,S,dt,ut,T,$e,Yr,Ce,k,rt,oe,qt]),Es=kr("div",n,{state:Ce,ref:[t,se],props:[{"aria-labelledby":Xe,id:E,role:"group"},me.getValidationProps,M],customStyleHookMapping:ys});return Ie(Fa.Provider,{value:et,children:Ie(t1,{elementsRef:oe,onMapChange:it,children:[Es,dt?qt.map((ge,ht)=>Ie("input",{...me.getInputValidationProps({disabled:Se,name:Qe,ref:vt,value:ge,onFocus:nr,style:gs,tabIndex:-1,"aria-hidden":!0})},`${Qe}-input-${ht}`)):Ie("input",{...me.getInputValidationProps({disabled:Se,name:Qe,ref:vt,value:L,onFocus:nr,style:gs,tabIndex:-1,"aria-hidden":!0})})]})})});o1.NODE_ENV!=="production"&&(Nf.displayName="SliderRoot");const Rf=new Map;function l1(e,n){const t=JSON.stringify({locale:e,options:n}),r=Rf.get(t);if(r)return r;const i=new Intl.NumberFormat(e,n);return Rf.set(t,i),i}function vs(e,n,t){return e==null?"":l1(n,t).format(e)}function Pf(e,n,t){return(e-n)*100/(t-n)}var c1={};const Df=st(void 0);c1.NODE_ENV!=="production"&&(Df.displayName="DirectionContext");function Tf(e=!0){const n=le(Df);if(n===void 0&&!e)throw new Error("Base UI: DirectionContext is missing.");return(n==null?void 0:n.direction)??"ltr"}function u1(e){if(Math.abs(e)<1){const t=e.toExponential().split("e-"),r=t[0].split(".")[1];return(r?r.length:0)+parseInt(t[1],10)}const n=e.toString().split(".")[1];return n?n.length:0}function Ff(e,n,t){const r=Math.round((e-t)/n)*n+t;return Number(r.toFixed(u1(n)))}var d1={};const h1=2;function f1(e,n,t){let r,i;for(let s=0;s<e.length;s+=1){const o=Math.abs(n-e[s]);(i===void 0||(e[s]===t?o<i:o<=i))&&(r=s,i=o)}return r}function p1(e,n){if(!e)return{start:0,end:0};const t=n==="horizontal"?"InlineStart":"Top",r=n==="horizontal"?"InlineEnd":"Bottom";return{start:parseFloat(e[`border${t}Width`])+parseFloat(e[`padding${t}`]),end:parseFloat(e[`border${r}Width`])+parseFloat(e[`padding${r}`])}}function _s(e,n){if(n.current!==void 0&&e.changedTouches){const t=e;for(let r=0;r<t.changedTouches.length;r+=1){const i=t.changedTouches[r];if(i.identifier===n.current)return{x:i.clientX,y:i.clientY}}return null}return{x:e.clientX,y:e.clientY}}const Vf=pt(function(n,t){const{render:r,className:i,...s}=n,{active:o,disabled:a,dragging:c,fieldControlValidation:l,lastChangedValueRef:u,max:d,min:h,minStepsBetweenValues:f,onValueCommitted:p,orientation:g,range:b,registerFieldControlRef:_,setActive:v,setDragging:S,setValue:k,state:x,step:$,thumbRefs:M,values:E}=bs(),C=Z(null),N=Z(null),R=Re(L=>{L&&N.current==null&&N.current==null&&(N.current=getComputedStyle(L))}),F=Z(null),z=Z(null),U=Z(0),Y=Z(0),Te=Tf(),pe=Re((L,ve=!1,se=0)=>{if(L==null)return null;const ke=C.current;if(!ke)return null;const oe=Te==="rtl",vt=g==="vertical",{width:ae,height:Qt,bottom:je,left:T,right:We}=ke.getBoundingClientRect(),$e=p1(N.current,g);let rt=vt?(je-$e.end-L.y)/(Qt-$e.start-$e.end)+se:(oe?We-$e.start-L.x:L.x-T-$e.start)/(ae-$e.start-$e.end)+se*(oe?-1:1);rt=_n(rt,0,1);let it=(d-h)*rt+h;if(it=Ff(it,$,h),it=_n(it,h,d),!b)return{value:it,valueRescaled:rt,thumbIndex:0};ve&&(F.current=f1(E,it,d)??0);const ut=F.current??0,dt=f*$;return it=_n(it,E[ut-1]+dt||-1/0,E[ut+1]-dt||1/0),{value:Of(E,ut,it),valueRescaled:rt,thumbIndex:ut}}),H=Re(L=>{var ke,oe,vt;const ve=C.current;if(!ve)return;const se=Gc(Gr(ve));(se==null||!ve.contains(se)||o!==L)&&(v(L),(vt=(oe=(ke=M.current)==null?void 0:ke[L])==null?void 0:oe.querySelector('input[type="range"]'))==null||vt.focus())}),K=Re(L=>{const ve=_s(L,z);if(ve==null)return;if(U.current+=1,L.type==="pointermove"&&L.buttons===0){me(L);return}const se=pe(ve,!1,Y.current);se!=null&&(H(se.thumbIndex),Af(se.value,$,f)&&(!c&&U.current>h1&&S(!0),k(se.value,se.thumbIndex,L)))}),me=Re(L=>{var ke,oe;const ve=_s(L,z);if(S(!1),ve==null)return;const se=pe(ve,!1);se!=null&&(v(-1),l.commitValidation(u.current??se.value),p(u.current??se.value,L),"pointerType"in L&&((ke=C.current)!=null&&ke.hasPointerCapture(L.pointerId))&&((oe=C.current)==null||oe.releasePointerCapture(L.pointerId)),z.current=null,Se())}),Xe=Re(L=>{if(a)return;const ve=L.changedTouches[0];ve!=null&&(z.current=ve.identifier);const se=_s(L,z);if(se!=null){const oe=pe(se,!0);if(oe==null)return;H(oe.thumbIndex),k(oe.value,oe.thumbIndex,L)}U.current=0;const ke=Gr(C.current);ke.addEventListener("touchmove",K,{passive:!0}),ke.addEventListener("touchend",me,{passive:!0})}),Se=Re(()=>{Y.current=0;const L=Gr(C.current);L.removeEventListener("pointermove",K),L.removeEventListener("pointerup",me),L.removeEventListener("touchmove",K),L.removeEventListener("touchend",me)});return Q(()=>{const L=C.current;return L?(L.addEventListener("touchstart",Xe,{passive:!0}),()=>{L.removeEventListener("touchstart",Xe),Se()}):()=>Se()},[Se,Xe,C]),Q(()=>{a&&Se()},[a,Se]),kr("div",n,{state:x,ref:[t,_,C,R],props:[{onPointerDown(L){var ke;if(a||L.defaultPrevented||L.button!==0)return;L.preventDefault();const ve=_s(L,z);if(ve!=null){const oe=pe(ve,!0);if(oe==null)return;H(oe.thumbIndex),S(!0),M.current.includes(L.target)?Y.current=Pf(E[oe.thumbIndex],h,d)/100-oe.valueRescaled:k(oe.value,oe.thumbIndex,L.nativeEvent)}L.nativeEvent.pointerId&&((ke=C.current)==null||ke.setPointerCapture(L.nativeEvent.pointerId)),U.current=0;const se=Gr(C.current);se.addEventListener("pointermove",K,{passive:!0}),se.addEventListener("pointerup",me)}},s],customStyleHookMapping:ys})});d1.NODE_ENV!=="production"&&(Vf.displayName="SliderControl");var m1={};const Lf=pt(function(n,t){const{render:r,className:i,...s}=n,{state:o}=bs();return kr("div",n,{state:o,ref:t,props:[{style:{position:"relative"}},s],customStyleHookMapping:ys})});m1.NODE_ENV!=="production"&&(Lf.displayName="SliderTrack");const xs="ArrowUp",ws="ArrowDown",Ss="ArrowLeft",ks="ArrowRight",$s="Home",Cs="End",g1=new Set([Ss,ks]),y1=new Set([xs,ws]);[...new Set([...g1,...y1])];const b1=new Set([xs,ws,Ss,ks,$s,Cs]);let v1=function(e){return e[e.None=0]="None",e[e.GuessFromOrder=1]="GuessFromOrder",e}({});function _1(e={}){const{label:n,metadata:t,textRef:r,indexGuessBehavior:i}=e,{register:s,unregister:o,subscribeMapChange:a,elementsRef:c,labelsRef:l,nextIndexRef:u}=e1(),d=Z(-1),[h,f]=P(i===v1.GuessFromOrder?()=>{if(d.current===-1){const b=u.current;u.current+=1,d.current=b}return d.current}:-1),p=Z(null),g=D(b=>{var _;if(p.current=b,h!==-1&&b!==null&&(c.current[h]=b,l)){const v=n!==void 0;l.current[h]=v?n:((_=r==null?void 0:r.current)==null?void 0:_.textContent)??b.textContent}},[h,c,l,n,r]);return nt(()=>{const b=p.current;if(b)return s(b,t),()=>{o(b)}},[s,o,t]),nt(()=>a(b=>{var v;const _=p.current?(v=b.get(p.current))==null?void 0:v.index:null;_!=null&&f(_)}),[a,f]),W(()=>({ref:g,index:h}),[h,g])}function zf(e,n,t){const r=[];for(let i=0;i<e.length;i+=1)r.push(_n(Pf(e[i],n,t),0,100));return r}let Bf=function(e){return e.index="data-index",e.dragging="data-dragging",e.orientation="data-orientation",e.disabled="data-disabled",e.readonly="data-readonly",e.required="data-required",e.valid="data-valid",e.invalid="data-invalid",e.touched="data-touched",e.dirty="data-dirty",e.focused="data-focused",e}({});var x1={};const qf="PageUp",Uf="PageDown",w1=new Set([xs,ws,Ss,ks,$s,Cs,qf,Uf]);function S1(e,n){const{children:t,...r}=e;return Ie("div",{...r,children:[t,Ie("input",{...n})]})}function k1(e,n,t,r){if(!(n<0))return e.length===2?n===0?`${vs(e[n],r,t)} start range`:`${vs(e[n],r,t)} end range`:t?vs(e[n],r,t):void 0}function er(e,n,t,r,i){return t===1?Math.min(e+n,i):Math.max(e-n,r)}const Kf=pt(function(n,t){const{render:r,className:i,disabled:s=!1,getAriaLabel:o,getAriaValueText:a,id:c,onBlur:l,onFocus:u,onKeyDown:d,tabIndex:h,...f}=n,p=bo(c),g=`${p}-input`,b=r??S1,{active:_,disabled:v,fieldControlValidation:S,formatOptionsRef:k,handleInputChange:x,labelId:$,largeStep:M,locale:E,max:C,min:N,minStepsBetweenValues:R,orientation:F,setActive:z,state:U,step:Y,tabIndex:Te,values:pe}=bs();let H=null;typeof b!="function"&&(H=Bc(19)?b.props.ref:b.ref);const K=s||v,me=h??Te,Xe=Tf(),{controlId:Se,setControlId:Qe,setTouched:L,setFocused:ve,validationMode:se}=Nn(),ke=Z(null);nt(()=>(Qe(g),()=>{Qe(void 0)}),[Se,g,Qe]);const oe=W(()=>({inputId:g}),[g]),{ref:vt,index:ae}=_1({metadata:oe}),Qt=_i(H,t,vt,ke),je=pe[ae],T=zf(pe.slice(),N,C),We=T.length===1?T[0]:T[ae],$e=Xe==="rtl",rt=D(()=>{const Ce=F==="vertical";return Number.isFinite(We)?{position:"absolute",[{horizontal:"insetInlineStart",vertical:"bottom"}[F]]:`${We}%`,[Ce?"left":"top"]:"50%",transform:`translate(${(Ce||!$e?-1:1)*50}%, ${(Ce?1:-1)*50}%)`,zIndex:_===ae?1:void 0}:gs},[_,$e,F,We,ae]),it=W(()=>Uc({disabled:K,dragging:ae!==-1&&_===ae}),[_,K,ae]),ut=Rn({[Bf.index]:ae,className:Kc(i,U),id:p,onFocus(){z(ae),ve(!0)},onBlur(){ke.current&&(z(-1),L(!0),ve(!1),se==="onBlur"&&S.commitValidation(If(je,ae,N,C,pe.length>1,pe)))},onKeyDown(Ce){if(!w1.has(Ce.key))return;b1.has(Ce.key)&&Ce.stopPropagation();let et=null;const Es=pe.length>1,ge=Ff(je,Y,N);switch(Ce.key){case xs:et=er(ge,Ce.shiftKey?M:Y,1,N,C);break;case ks:et=er(ge,Ce.shiftKey?M:Y,$e?-1:1,N,C);break;case ws:et=er(ge,Ce.shiftKey?M:Y,-1,N,C);break;case Ss:et=er(ge,Ce.shiftKey?M:Y,$e?1:-1,N,C);break;case qf:et=er(ge,M,1,N,C);break;case Uf:et=er(ge,M,-1,N,C);break;case Cs:et=C,Es&&(et=Number.isFinite(pe[ae+1])?pe[ae+1]-Y*R:C);break;case $s:et=N,Es&&(et=Number.isFinite(pe[ae-1])?pe[ae-1]+Y*R:N);break}et!==null&&(x(et,ae,Ce),Ce.preventDefault())},ref:Qt,style:rt(),tabIndex:me??(K?void 0:0)},it,f);let dt;F==="vertical"&&(dt=$e?"vertical-rl":"vertical-lr");const qt=Rn({"aria-label":typeof o=="function"?o(ae):f["aria-label"],"aria-labelledby":$,"aria-orientation":F,"aria-valuemax":C,"aria-valuemin":N,"aria-valuenow":je,"aria-valuetext":typeof a=="function"?a(vs(je,E,k.current??void 0),je,ae):f["aria-valuetext"]||k1(pe,ae,k.current??void 0,E),[Bf.index]:ae,disabled:K,id:g,max:C,min:N,onChange(Ce){x(Ce.target.valueAsNumber,ae,Ce)},step:Y,style:{...gs,width:"100%",height:"100%",writingMode:dt},tabIndex:-1,type:"range",value:je??""},S.getValidationProps);if(typeof b=="function")return b(ut,qt,U);const{children:Yr,...Ms}=b.props,nr=ut.children??Yr;return ti(b,Rn(ut,{children:Ie(xe,{children:[typeof nr=="function"?nr():nr,Ie("input",{...qt})]})},Ms,{ref:ut.ref}))});x1.NODE_ENV!=="production"&&(Kf.displayName="SliderThumb");var $1={};function C1(e,n,t){return e==="vertical"?{position:"absolute",bottom:`${n}%`,height:`${t}%`,width:"inherit"}:{position:"relative",insetInlineStart:`${n}%`,width:`${t}%`,height:"inherit"}}const jf=pt(function(n,t){const{render:r,className:i,...s}=n,{max:o,min:a,orientation:c,state:l,values:u}=bs(),d=zf(u.slice(),a,o);let h;if(d.length>1){const p=d[0],g=d[d.length-1]-p;h=C1(c,p,g)}else c==="vertical"?h={position:"absolute",bottom:0,height:`${d[0]}%`,width:"inherit"}:h={position:"relative",insetInlineStart:0,width:`${d[0]}%`,height:"inherit"};return kr("div",n,{state:l,ref:t,props:[{style:h},s],customStyleHookMapping:ys})});$1.NODE_ENV!=="production"&&(jf.displayName="SliderIndicator");const Jr={root:w({width:"100%","--unselected-color":"var(--divider-color)",margin:"0"}),control:w({position:"relative",cursor:"pointer"}),track:w({background:"var(--unselected-color)",height:"var(--mmpc-slider-height)",borderRadius:"6px",overflow:"hidden"}),indicator:w({background:"var(--primary-color)",height:"100%",borderRadius:"4px"}),thumb:w({width:"6px",height:"64%",backgroundColor:"var(--text-primary-color)","@media (prefers-color-scheme: light)":{backgroundColor:"var(--art-surface-color, rgba(255, 255, 255, 0.8))"},cursor:"pointer",borderRadius:"2px",marginLeft:"-8px"})},Va=({min:e,max:n,step:t,value:r,sliderSize:i="medium",onChange:s})=>{const[o,a]=P(r),c=Z(),l=D(u=>{a(u),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{s(u)},200)},[s]);return Q(()=>{r!==o&&a(r)},[r]),m(Nf,{css:Jr.root,value:o,onValueChange:l,min:e,max:n,step:t,children:m(Vf,{css:Jr.control,children:O(Lf,{css:Jr.track,style:{"--mmpc-slider-height":M1(i)},children:[m(jf,{css:Jr.indicator}),m(Kf,{css:Jr.thumb})]})})})},M1=e=>{switch(e){case"xsmall":return"16px";case"small":return"22px";case"medium":return"28px";case"large":return"32px"}};class Wf extends HTMLElement{constructor(){super(...arguments),this._config=null,this.Card=null,this.extraProps={},this._hass=null}set hass(n){this._hass=n}setConfig(n){this._config=n,!(!this._hass||!this.Card)&&nn(m(mc,{rootElement:this,children:m(Tm,{children:m(this.Card,{config:this._config,hass:this._hass,rootElement:this,...this.extraProps})})}),this)}}class La extends HTMLElement{constructor(){super(...arguments),this.Card=null,this.config=null,this.shouldUpdate=null,this._previousHass=null}set hass(n){var i,s;if(!this.Card)throw new Error("Preact Card is not defined");const t=(i=this.config)==null?void 0:i.entity_id;!!t&&((s=this.shouldUpdate)==null?void 0:s.call(this,this._previousHass,n))?(this._previousHass=n,nn(m(mc,{rootElement:this,children:m(fc,{rootElement:this,config:this.config,children:m(ag,{hass:n,children:m(jg,{hass:n,entityId:t,children:m(this.Card,{})})})})}),this)):this._previousHass=n}getCardSize(){return 1}}class E1 extends La{constructor(){super(...arguments),this.Card=ty,this.shouldUpdate=(n,t)=>!t||!n||!this.config||!n&&t?!0:sn(n.states[this.config.entity_id],t.states[this.config.entity_id])}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");if(!n.entities)throw new Error("You need to define entities");this.config=n}getCardSize(){return 1}getLayoutOptions(){return{grid_rows:1,grid_columns:6,grid_min_rows:1,grid_max_rows:1}}}customElements.define("mediocre-chip-media-player-group-card",E1);class O1 extends Wf{constructor(){super(...arguments),this.Card=Dw,this.extraProps={isMassive:!0,className:void 0}}}customElements.define("mediocre-massive-media-player-card-editor",O1);class I1 extends La{constructor(){super(...arguments),this.Card=gu,this.shouldUpdate=(n,t)=>{var r,i;if(!t||!n||!this.config||!n&&t||sn(n.states[this.config.entity_id],t.states[this.config.entity_id])||(r=this.config.speaker_group)!=null&&r.entity_id&&sn(n.states[this.config.speaker_group.entity_id],t.states[this.config.speaker_group.entity_id]))return!0;if((i=this.config.speaker_group)!=null&&i.entities){for(const s of this.config.speaker_group.entities)if(sn(n.states[s],t.states[s],!0))return!0}return!1}}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");this.config=n}static getConfigElement(){return document.createElement("mediocre-massive-media-player-card-editor")}static getStubConfig(n){return{entity_id:Object.keys(n.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??"",mode:"card"}}}customElements.define("mediocre-massive-media-player-card",I1),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-massive-media-player-card",name:"Mediocre Massive Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"});class A1 extends Wf{constructor(){super(...arguments),this.Card=Jw}}customElements.define("mediocre-media-player-card-editor",A1);class N1 extends La{constructor(){super(...arguments),this.Card=Gw,this.shouldUpdate=(n,t)=>{var r,i;if(!t||!n||!this.config||!n&&t||sn(n.states[this.config.entity_id],t.states[this.config.entity_id])||(r=this.config.speaker_group)!=null&&r.entity_id&&sn(n.states[this.config.speaker_group.entity_id],t.states[this.config.speaker_group.entity_id]))return!0;if((i=this.config.speaker_group)!=null&&i.entities){for(const s of this.config.speaker_group.entities)if(sn(n.states[s],t.states[s],!0))return!0}return!1}}setConfig(n){if(!n.entity_id)throw new Error("You need to define an entity_id");this.config=n}static getConfigElement(){return document.createElement("mediocre-media-player-card-editor")}static getStubConfig(n){return{entity_id:Object.keys(n.states).filter(i=>i.substr(0,i.indexOf("."))==="media_player")[0]??""}}getCardSize(){return 2}getGridOptions(){return{columns:12,min_columns:8}}}customElements.define("mediocre-media-player-card",N1),window.customCards=window.customCards||[],window.customCards.push({type:"mediocre-media-player-card",name:"Mediocre Media Player Card",preview:!0,description:"A media player card with player grouping support.",documentationURL:"https://github.com/antontanderup/mediocre-hass-media-player-cards"})});
